/*! Copyright (c) 2015 WhatsApp Inc.  All Rights Reserved. */
webpackJsonp([0],[function(e,t,r){r(1);var n=window.performance.now();r(2).validateDependencies(),r(16),r(17),["getSelection","open","focus"].forEach(function(e){var t=Object.getPrototypeOf(window)[e];_.isFunction(t)&&window[e]!==t&&(window[e]=t)}),window.Wa=r(18),window.Store=r(173);var i=r(15);window.WamLog=r(259),i.isGecko||WebFont.load({google:{families:["Open Sans:400,600","Roboto:300,400,500"]}}),window.l10n=r(263),l10n.init(r(143).getLangPref());var o=r(14);window.onerror=function(e,t,r,n,i){return o.log("exe:onerror ("+t+") "+e,"red")(),"Script error."===e&&null===i?(t&&Wa.uploadLogs("script-error"),!1):(i instanceof Error&&i.stack?(o.log("exe:unhandled error: "+i.stack,"red",void 0,!0)(),Wa.uploadLogs(null)):(o.log("exe:unhandled error: "+i,"red")(),Wa.uploadLogs("window-error")),!1)},Promise.onPossiblyUnhandledRejection(function(e,t){o.log("exe:unhandled rejection: "+e,"red")(),e instanceof Error&&e.stack?(o.log(e.stack,"red",void 0,!0)(),Wa.uploadLogs(null)):Wa.uploadLogs("unhandled-rejection")});var a=r(433);window.onbeforeunload=function(e){return Wa.isDownloading?void(Wa.isDownloading=!1):(o.log("webclient close/reload triggered")(),o.log("latest hash: "+Wa.CONST.LATEST_HASH)(),o.log("version: "+Wa.CONST.VERSION_STR)(),Wa.promptUnloadGuards>0?void 0:a.hasPending()?l10n.t("confirm_closing_webclient"):void 0)},window.addEventListener("dragover",function(e){e.preventDefault()}),window.addEventListener("drop",function(e){e.preventDefault()}),React.render(React.createElement(a,null),document.body);var s=window.performance.now();WamLog.exeTiming({exeStart:n,exeDone:s})},function(e,t){!function(){if("performance"in window==!1&&(window.performance={}),!("now"in window.performance)){var e=window.performance,t=e.timing&&e.timing.navigationStart?e.timing.navigationStart:Date.now();e.now=function(){return Date.now()-t}}}()},function(e,t,r){function n(e){if(l){l.generation=e;try{window.name=JSON.stringify(l)}catch(t){}}else window.localStorage.setItem(h.KEY_LOAD_RETRY_GENERATION,e)}function i(){g>u?n(u+1):u>g&&n(g);var e=0===u?0:1e3*Math.pow(2,u),t=5e3*Math.random();window.setTimeout(function(){document.location.reload(!0)},e+t)}function o(){var e=new f;e.setUA(window.navigator.userAgent);var t="WhatsApp/"+h.VERSION_STR,r="Web/"+e.getBrowser().name+"-"+e.getBrowser().version,n=e.getOS(),i="Device/"+(n.name+" "+n.version||"");return t+" "+r+" "+i}function a(){var e=new Date,t=s(e.getMonth(),2),r=s(e.getHours(),2),n=s(e.getMinutes(),2),i=s(e.getSeconds(),2);return e.getFullYear()+"-"+t+"-"+e.getDate()+" "+r+":"+n+":"+i+": "}function s(e,t){var r=e.toString(),n=t-r.length;return n>0?Array(n+1).join("0")+r:r}function c(){var e=JSON.parse(window.localStorage.getItem(h.KEY_UNKNOWN_ID));if(!e){e="unknown-"+Math.floor(1e10*Math.random());try{window.localStorage.setItem(h.KEY_UNKNOWN_ID,JSON.stringify(e))}catch(t){return"unknown-user"}}return e}function d(e){for(var t=e.split("."),r=window,n=0;n<t.length;n++)if(r=r[t[n]],!r)return!1;return!0}var u,l,p=r(3),h=r(4),f=r(8),m=r(10),g=10;if(m._hasLocalStorage())u=+window.localStorage.getItem(h.KEY_LOAD_RETRY_GENERATION)||0;else{try{l=JSON.parse(window.name||"null")}catch(v){}l=l||{generation:0},u=l.generation||0}e.exports.validateDependencies=function(){function e(e){if(e&&!d(e)){var t=a(),r=[t+"==================================================",t+"error: Missing Dependencies",t+("reason for logs: Missing Lib: "+e+" "+Math.min(u,1)),t+"==================================================",t+("Generation: "+u)].join("\n"),n=new FormData,s=new Blob([r],{type:"text/plain"});n.append("from",c()),n.append("agent",o()),n.append("file",s,"logs.txt");var l=new XMLHttpRequest;throw l.onload=i,l.onerror=i,l.open("POST",h.CLB_URL,!0),l.send(n),new Error("Missing Dependencies: ",e)}}for(var t,r,s=0;s<p.length;s++)if(t=p[s],r=t["export"],Array.isArray(r))for(var l=0;l<r.length;l++)e(r[l]);else r&&e(r);n(0)}},function(e,t){e.exports=[{name:"modernizr",version:"2.8.3","export":"Modernizr"},{name:"moment-with-locales",version:"2.8.4","export":"moment"},{name:"bluebird",version:"2.9.24","export":"Promise"},{name:"lodash",version:"3.6.0","export":"_"},{name:"velocity",version:"1.2.0","export":"Velocity"},{name:"velocity-ui",version:"5.0","export":"Velocity.RegisterEffect"},{name:"react-with-addons",version:"0.13.3","export":"React"},{name:"webfontloader",version:"1.6.6","export":"WebFont"},{name:"hmac-sha256-3.1.2.min","export":"CryptoJS.algo.HMAC"},{name:"aes-3.1.2.min","export":"CryptoJS.AES"},{name:"lib-typedarrays-3.1.2.min","export":"CryptoJS.lib.WordArray"},{name:"enc-base64-3.1.2.min","export":"CryptoJS.enc"},{name:"end-to-end.compiled.min","export":["e2e","goog"]},{name:"canvas-to-blob-2.0.5.min","export":"dataURLtoBlob"},{name:"qrcode.min","export":"QRCode"}]},function(e,t,r){var n=r(5);["webkitGetUserMedia"].forEach(function(e){var t=Object.getPrototypeOf(navigator)[e];t&&navigator[e]!==t&&(navigator[e]=t)}),window.URL=window.URL||window.webkitURL,window.AudioContext=window.AudioContext||window.webkitAudioContext,navigator.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia,window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.crypto=window.crypto||window.msCrypto;var i={MAX_GROUP_SIZE:101,MAX_SUBJECT_LENGTH:25,IMG_MAX_EDGE:1600,MAX_MEDIA_UPLOAD_SIZE:16777216,BROWSER_CAPABILITY:{localstorage:!!window.localStorage,sessionstorage:!!window.sessionStorage,indexeddb:!!window.indexedDB,url:!!window.URL,websocket:!!window.WebSocket,worker:!!window.Worker},BROWSER_TYPE:{CHROME:"chrome",CHROMIUM:"chromium",FIREFOX:"firefox",SAFARI:"safari",IE:"ie",OPERA:"OPERA"},BROWSER_LINK:{CHROME:'<a href="https://www.google.com/chrome">Google Chrome</a>',FIREFOX:'<a href="http://www.firefox.com">Mozilla Firefox</a>',OPERA:'<a href="http://www.opera.com">Opera</a>'},OS_TYPE:{WINDOWS:"windows",MAC:"mac os",CHROMEOS:"chromium os"},LATEST_HASH:"607452957cd3bb018755eae4958deaeecbb5c729",VERSION:{p:0,s:1,t:4770},VERSION_STR:"0.1.4770",CLB_URL:"https://web-crashlog.whatsapp.net/upload.php",PREVIEW_WINDOW:"preview-window",UPLOAD_SELECT:"upload-select",CURRENT_LOCATION_ICON:"https://maps.gstatic.com/mapfiles/ms2/micons/blue-dot.png",CURRENT_LOCATION_SHADOW:"https://maps.gstatic.com/mapfiles/ms2/micons/msmarker.shadow.png",GROUP_DEFAULT_ICON:r(6),USER_DEFAULT_ICON:r(7),NOTIFICATION_TIMEOUT:5e3,CALL_NOTIFICATION_TIMEOUT:45e3,NOTIFICATION_TONE_PATH:"/res/notification.mp3",IDLE_TIMEOUT:6e4,IDLE_TIMEOUT_WAIT:78e4,PING_INTERVAL:24e4,ACK_TIMEOUT:8e3,RETRY_TIMESTEP:20500,SEND_UNAVAILABLE_WAIT:15e3,SEND_PAUSED_WAIT:2500,CLEAR_CHAT_DIRTY_WAIT:2500,MAX_RETRY_GENERATION:4,GIVE_UP_WAIT:12e4,LOG_UPLOAD_INTERVAL:36e5,EMOJI_SYNC_DELAY:3e4,MAX_TXT_MSG_SIZE:65536,DRAG_TYPE_FILE:"Files",DRAG_TYPE_LOCAL_IMAGE:"drag_type_local_image",NUM_COLORS:20,KEY_STORAGE_TEST:"storage_test",KEY_CLIENT_TOKEN:"WAToken1",KEY_SERVER_TOKEN:"WAToken2",KEY_SECRET:"WASecretKey",KEY_SECRET_BUNDLE:"WASecretBundle",KEY_BROWSER_ID:"WABrowserId",KEY_GEOCODER_LOCATION:"WAGeocoderLocation",KEY_GROUP_ASSIGNED_COLOR:"WAGroupAssignedColor",KEY_GMAPS_OVER_LIMIT:"WAGmapsOverLimit",KEY_GLOBAL_MUTE_SOUNDS:"WAGlobalSounds",KEY_GLOBAL_MUTE_NOTIFICATIONS:"WAGlobalNotifications",KEY_LANG:"WALangPref",KEY_LAST_ACTIVE_EMOJI_TAB:"WALastActiveEmojiTab",KEY_UNKNOWN_ID:"WAUnknownID",KEY_VERSION:"WAVersion",KEY_LOAD_RETRY_GENERATION:"WALoadRetryGeneration",KEY_REMEMBER_ME:"remember-me",KEY_LOGOUT_TOKEN:"logout-token",KEY_OLD_LOGOUT_CREDS:"old-logout-cred",KEY_NO_TAKEOVER:"no-takeover",KEY_WHATSAPP_MUTEX:"whatsapp-mutex",KEY_WHATSAPP_LS_VERSION:"ver",KEY_LOCAL_TAKEOVER_OK:"local-takeover-ok",KEY_WAM_BUFFER:"WAWamBuffer",KEY_WAM_STATUS:"WAWamStatus",KEY_WAM_LAST_ROTATE:"WAWamLastRotate",KEY_WAM_OLD_BUFFER:"WAWamOldBuffer",KEY_WAM_DIMENSION_CACHE:"WAWamDimensionCache",COOKIE_REF:"ref",COOKIE_TOK:"tok",PAGE_SIZE:50,MSG_PRELOAD_THRESHOLD:20,SCROLL_FUDGE:100,MIN_PIC_SIDE:192,MAX_PIC_SIDE:640,PROF_PIC_THUMB_SIDE:96,MAX_CAPTION_LENGTH:160,MAX_VCARD_PHOTO_SIDE:64,EMOJI_PANEL_HEIGHT:222,GROUP_SET_PIC_CONTEXT:"group",GROUP_CREATE_PIC_CONTEXT:"create_group",PROFILE_PIC_CONTEXT:"profile",PERMISSION_ALLOWED:"granted",PERMISSION_DEFAULT:"default",PERMISSION_DENIED:"denied",PRESENCE_COMPOSING_TIMEOUT:25e3,PRESENCE_RESEND_WAIT:1e4,PTT_CANCEL_AREA:300,PTT_TIME_CHECK:1,PTT_TIME_CANCEL:.75,CANCEL_ANIMATION_DURATION:2700,IMAGE_MIMES:"image/*",VIDEO_MIMES:"video/*",SEARCH_ANIMATION_DURATION:150,SLIDEDOWN_DURATION:100,CSS_TRANSITION_DURATION:1,EARTH_RADIUS:6378137,LOG_SIZE:4999,KEY_LOG_CURSOR:"debugCursor",MAX_STATUS_LENGTH:139,QR_EDGE:240,FILE_ERROR_MISSING:"File missing.",FILE_ERROR_SIZE:"File size is too large.",FILE_ERROR_TYPE:"File type is invalid.",FILE_ERROR_MIN_DIM:"File dimensions are too small.",GMAPS_OVER_LIMIT_DURATION:14400,ACK_ERROR:-1,ACK_PENDING:0,ACK_SERVER:1,ACK_DEVICE:2,ACK_READ:3,ACK_PLAYED:4,TIMESTAMP_FORMAT_24H:"HH:mm",TIMESTAMP_WITH_DATE_FORMAT_24H:"HH:mm, l",TIMESTAMP_FORMAT_12H:"LT",TIMESTAMP_WITH_DATE_FORMAT_12H:"LT, l",BATTERY_LOW_THRESHOLD_1:15,BATTERY_LOW_THRESHOLD_2:5,WAM_MAX_BUFFER_SIZE:5e4,NUX:{SAFARI_LIMITED_SUPPORT:"safari_limited_support"},COLLECTION_HAS_SYNCED:"collection_has_synced",ONE_BY_ONE_TRANS_GIF:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"};for(var o in n)n.hasOwnProperty(o)&&(i[o]=n[o]);e.exports=i},function(e,t){var r={CAPABILITY_URL:"https://web.whatsapp.com/browsers.html",PP_URL:"https://dyn.web.whatsapp.com/pp",LOGOUT_URL:"https://dyn.web.whatsapp.com/logout",WS_FAIL_URL:"https://web.whatsapp.com/health_check.json",WAM_URL:"https://dyn.web.whatsapp.com/wam",COOKIE_DOMAIN:".web.whatsapp.com",UPLOAD_TO_CLB:1,DIAGNOSTIC_DELAY:18e3,FLAVOR_TAGS:!1,WAM_ROTATE_INTERVAL:36e5,RECORDER_CFG:{workerPath:"lib/WArecorderWorker.min.js"},SOCKETS:["wss://w1.web.whatsapp.com/ws","wss://w2.web.whatsapp.com/ws","wss://w3.web.whatsapp.com/ws","wss://w4.web.whatsapp.com/ws","wss://w5.web.whatsapp.com/ws","wss://w6.web.whatsapp.com/ws","wss://w7.web.whatsapp.com/ws","wss://w8.web.whatsapp.com/ws"]};e.exports=r},function(e,t,r){e.exports=r.p+"img/92b8a80d57227e2f342bd57ccf6382d8.png"},function(e,t,r){e.exports=r.p+"img/bfb4ec026499f5b2d80e673a1a3a5bd7.png"},,,function(e,t,r){function n(){this.initializeStorage(),this.dbName="wawc",this.db=new o(this.dbName),this.db.version(1).stores({logs:"line,log"}),this.db.version(2).stores({logs:"line,log",assets:"key,hash,data"}),this.openAttempt=0,this.openDB(),this.deleteLegacyDBs()}var i=r(4),o=r(11),a=r(14),s=r(15),c="WA";n.prototype.initializeStorage=function(){var e=window.localStorage,t=window.sessionStorage,r={setItem:function(e,t){this[e]=t},getItem:function(e,t){return this[e]},removeItem:function(e){delete this[e]},clear:function(){for(var e in this)this.hasOwnProperty(e)&&"function"!=typeof e&&delete this[e]}};this.permanentStorage=this._hasLocalStorage()?e:r,this.temporaryStorage=this._hasSessionStorage()?t:r},n.prototype._hasLocalStorage=function(){try{return localStorage.setItem(i.KEY_STORAGE_TEST,i.KEY_STORAGE_TEST),!0}catch(e){return!1}},n.prototype._hasSessionStorage=function(){try{return sessionStorage.setItem(i.KEY_STORAGE_TEST,i.KEY_STORAGE_TEST),!0}catch(e){return!1}},n.prototype.openDB=function(){var e=this;return this.db.isOpen()&&this.db.close(),this.db.open().then(function(){a.log("db: Successfully opened db","green")()})["catch"](function(t){return a.log("db: Error opened db","red",t)(),e.openAttempt>1||s.isSafari?Promise.resolve():(e.openAttempt+=1,e.db["delete"]().then(function(){return e.openDB()}))})},n.prototype.deleteLegacyDBs=function(){return o.getDatabaseNames().then(function(e){e.forEach(function(e){e===c&&(localStorage.setItem(i.KEY_LOG_CURSOR,0),o["delete"](e))})})},e.exports=new n},,,,function(e,t,r){function n(){this.pendingLogs=[],this.logs=[],this.cursor=0}var i=r(4),o=250;n.prototype.trace=function(e){var t=new Error(e);this.log(t.stack,"red",t,!0)()},n.prototype.log=function(e,t,r,n){e=n?e:e?e.toString().substring(0,o):e;var i=moment().locale("en").format("YYYY-MM-DD HH:mm:ss: ")+e;return this.persist(i),_.noop},n.prototype.persist=function(e){var t=r(10);if(t.db.isOpen()){var n=this.getCursor(),o=this.addLogPromise(t.db.logs.put({line:n,log:e}));return this.setCursor(n+1),o}return this.logs.push(e),this.logs>i.LOG_SIZE&&this.logs.shift(),Promise.resolve()},n.prototype.clearLogs=function(){var e=r(10);this.addLogPromise(e.db.logs["delete"]()),this.setCursor(0),this.logs=[]},n.prototype.getLogs=function(){var e=r(10);if(e.db.isOpen()){var t=this.getCursor();return Promise.settle(this.pendingLogs).then(function(){return e.db.logs.orderBy("line").toArray()}).then(function(e){var r=t<e.length-1?e.slice(t,e.length):[],n=e.slice(0,t);return _.pluck(r.concat(n),"log")})}Promise.resolve(this.logs)},n.prototype.getCursor=function(){var e=r(10);try{return JSON.parse(e.permanentStorage.getItem(i.KEY_LOG_CURSOR))||this.cursor}catch(t){return this.cursor}},n.prototype.setCursor=function(e){var t=r(10);return this.cursor=e%i.LOG_SIZE,t.permanentStorage.setItem(i.KEY_LOG_CURSOR,this.cursor)},n.prototype.addLogPromise=function(e){var t=this;return this.pendingLogs.push(e),e["finally"](function(){var r=t.pendingLogs.indexOf(e);r>-1&&t.pendingLogs.splice(r,1)}),e},e.exports=new n},function(e,t,r){function n(e,t){var r,n,i,o=/(\.0)+[^\.]*$/;for(e=(e+"").replace(o,"").split("."),t=(t+"").replace(o,"").split("."),i=Math.min(e.length,t.length),r=0;i>r;r++)if(n=parseInt(e[r],10)-parseInt(t[r],10),0!==n)return n;return e.length-t.length}function i(e,t){return n(e,t)>=0}var o,a=r(8),s=window.navigator.userAgent;if(s&&s.indexOf("Edge")>40){var c={ua:s,browser:{name:"Spartan",major:"0",version:"1"},cpu:{architecture:"x86_64"},device:{model:"Computer",type:"Computer",vendor:""},engine:{name:"Edge",version:"12"},os:{name:"Windows 10",version:"0"}};o={getResult:_.constant(c),getBrowser:_.constant(c.browser),getCPU:_.constant(c.cpu),getDevice:_.constant(c.device),getEngine:_.constant(c.engine),getOS:_.constant(c.os),getUA:_.constant(s),setUa:function(){throw new Error("not real ua parser")}}}else o=new a,o.setUA(s);var d=(o.getBrowser().name||"").toUpperCase(),u=o.getBrowser().version||"0.0.0",l=(o.getEngine().name||"").toUpperCase(),p=(o.getOS().name||"").toUpperCase(),h=o.getOS().version||"0.0.0",f=!l||"WEBKIT"===l,m="SAFARI"===d,g="CHROME"===d,v="EDGE"===l,y=v||"TRIDENT"===l,b="GECKO"===l,E=!1;switch(p){case"MAC OS":g?E=i(h,"10.10")&&i(u,"41.0.0"):i(h,"10.7")&&(E=!0);break;case"WINDOWS":i(h,"8.1")&&(b?E=!0:g&&i(u,"41.0.0")&&(E=!0))}e.exports={isWebkit:f,isGecko:b,isTrident:y,isSpartan:v,isSafari:m,hasEmoji:E,os:p.toLowerCase(),browser:d.toLowerCase(),parser:o}},function(e,t,r){function n(e){i.log("Application Cache "+e.type+" event","black",e)()}var i=r(14);applicationCache.addEventListener("cached",n),applicationCache.addEventListener("checking",n),applicationCache.addEventListener("downloading",n),applicationCache.addEventListener("error",n),applicationCache.addEventListener("noupdate",n),applicationCache.addEventListener("obsolete",n),applicationCache.addEventListener("progress",n),applicationCache.addEventListener("updateready",n)},function(e,t){_.mixin({forceArray:function(e){return _.isArray(e)?e:[e]}})},function(e,t,r){function n(e){window.history.pushState({},"",window.location.href)}var i=r(14),o=r(19),a=r(4),s=r(143),c=r(20),d=r(163),u=r(167).XRegExp,l=r(168),p=r(166),h=r(169),f=r(171),m=r(15);moment.locale("zh-tw",{longDateFormat:{LT:"Ah:mm",LTS:"Ah:m:s",L:"YYYY年MMMD日",LL:"YYYY年MMMD日",LLL:"YYYY年MMMD日LT",LLLL:"YYYY年MMMD日ddddLT",l:"YYYY年MMMD日",ll:"YYYY年MMMD日",lll:"YYYY年MMMD日LT",llll:"YYYY年MMMD日ddddLT"}}),moment.locale("zh-cn",{longDateFormat:{LT:"Ah:mm",LTS:"Ah:m:s",L:"YYYY-MM-DD",LL:"YYYY年MMMD日",LLL:"YYYY年MMMD日LT",LLLL:"YYYY年MMMD日ddddLT",l:"YYYY年MMMD日",ll:"YYYY年MMMD日",lll:"YYYY年MMMD日LT",llll:"YYYY年MMMD日ddddLT"}}),moment.locale("ar",{longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"}}),moment.locale("en");var g,v=["c.us","g.us","broadcast"],y=window.history&&window.history.pushState&&window.location,b=!1,E=window.location.href;y&&E&&E.indexOf("/%F0%9F%8C%90/")>-1&&window.history.replaceState({},"","/");var R={me:void 0,verbose:!1,originalUrl:E,allowBackButton:function(e){y&&(e?b&&(b=!1,window.removeEventListener("popstate",n),window.history.back()):b||(b=!0,window.history.pushState({},"",window.location.href),window.addEventListener("popstate",n)))},hardRefresh:function(e){R.promptUnloadGuards++,e&&s.setNoTakeover(!0),location.reload(!0)},boundHeightWidth:function(e,t,r,n){return t=t||n,e=e||r,t>e?t>n&&(e*=n/t,t=n):e>r&&(t*=r/e,e=r),{width:Math.max(t,1),height:Math.max(e,1)}},clone:function(e){return JSON.parse(JSON.stringify(e))},createMsgKey:function(e,t,r,n,i){return new h(e,t,r,n,i)},splitMsgKey:function(e){return e},isValidContactFile:function(e){if(!e)return!1;var t=e.type,r=e.size;return i.log("wa:isValidContactFile info: "+e.name+" "+r+" "+t)(),t.match(/^text\/(directory|vcardx-vcard)/)?!0:(i.log("wa:isValidContactFile mime is not of a vcard")(),!1)},isValidMediaFile:function(e){if(!e)return!1;var t=e.type,r=e.size;return i.log("wa:isValidMediaFile info: "+e.name+" "+r+" "+t)(),t.match(/^image\/.*/)||t.match(/^video\/.*/)||t.match(/^audio\/.*/)?r>1<<24?(i.log("wa:isValidMediaFile too large")(),!1):!0:(i.log("wa:isValidMediaFile type not valid")(),!1)},getUnknownId:function(){var e=s.getUnknownId();return e||(e="unknown-"+Math.floor(1e10*Math.random()),s.setUnknownId(e)),e},uploadLogsTimer:0,uploadLogsTimerReason:void 0,uploadLogs:function(e,t){function r(){R.uploadLogsTimer=setTimeout(function(){var e=R.uploadLogsTimerReason;R.uploadLogsTimer=0,R.uploadLogsTimerReason=void 0,"undefined"!=typeof e&&(e?R.uploadLogs("delayed-"+e):R.uploadLogs("delayed"))},a.LOG_UPLOAD_INTERVAL)}var n=Store.Conn.get(1);c.summary(),i.log("==================================================")(),i.log("wa:uploadLogs ref: "+(n?n.ref:"no conn"))(),i.log("wa:uploadLogs hash: "+a.LATEST_HASH)(),i.log("wa:uploadLogs version: "+a.VERSION_STR)(),i.log("wa:uploadLogs userAgent: "+navigator.userAgent)(),i.log("wa:uploadLogs platform: "+(n?n.platform:"no platform"))(),i.log("wa:uploadLogs url: "+location.href)();var s;"undefined"==typeof e?(s=prompt("Please describe the situation that inspired you to upload logs: what happened, what you were doing before that happened (both in the app and just with your phone and computer in general, like if you had just opened it or moved it around)."),i.log("user report: "+s)()):e&&i.log("reason for logs: "+e)(),i.log("==================================================")();var d=R.me,u=d?this.widGetUser(d):this.getUnknownId(),l=this.getLogUserAgent();if(!s){if(!(Math.random()<a.UPLOAD_TO_CLB))return i.log("wa:uploadLogs squelched logs")(),Promise.resolve("deferred");if(R.uploadLogsTimer)return i.log("wa:uploadLogs delayed logs")(),"undefined"==typeof R.uploadLogsTimerReason&&(R.uploadLogsTimerReason=e),Promise.resolve("deferred")}var p=(t?Promise.resolve(i.getLogs()):Promise.delay(500).then(i.getLogs.bind(i))).bind(this).then(function(e){e=e.join("\n");var t=new FormData,r=new Blob([e],{type:"text/plain"});return t.append("from",u),t.append("agent",l),t.append("file",r,"logs.txt"),o.post(a.CLB_URL,t)["catch"](_.noop)});return r(),p},destroyPreview:function(e){("VIDEO"===e.prop("tagName")||"AUDIO"===e.prop("tagName"))&&URL.revokeObjectURL(e.prop("src"))},enc:function(){return JSON.stringify(Array.prototype.slice.call(arguments))},fileToCanvas:function(e,t,r,n){var i,o,a=this.typeFromMimetype(e.type),s=document.createElement("canvas");"image"===a?(i=new Image,o=function(e){i.onload=e}):"video"===a&&(i=document.createElement("video"),o=function(e){i.addEventListener("seeked",e),i.addEventListener("loadeddata",function(){var e=i.seekable.end(0);i.currentTime=~~(e/2)})});var c=function(){var e=R.boundHeightWidth(i.height,i.width,r,t);s.width=e.width,s.height=e.height;var o=s.getContext("2d");o.drawImage(i,0,0,e.width,e.height),URL.revokeObjectURL(i.src),n&&n(s)};o(c),i.src=URL.createObjectURL(e)},fileToBlobs:function(e){var t=this;return new Promise(function(r){var n=t.typeFromMimetype(e.type);"image"===n?t.fileToCanvas(e,a.IMG_MAX_EDGE,a.IMG_MAX_EDGE,function(e){var t=e.toDataURL("image/jpeg"),n=window.dataURLtoBlob(t);r({dataUrl:t,blob:n,h:e.height,w:e.width})}):("video"===n||"audio"===n)&&r({dataUrl:URL.createObjectURL(e),blob:e})})},fileToThumb:function(e){var t=this;return new Promise(function(r){var n=t.typeFromMimetype(e.type);"image"===n||"video"===n?t.fileToCanvas(e,100,100,function(e){var t=e.toDataURL("image/jpeg");r(R.parseDataURL(t).data)}):"audio"===n&&r()})},fileToAudio:function(e,t){var r=document.createElement("audio");t&&r.addEventListener("loadeddata",function(){t(r)}),r.src=URL.createObjectURL(e)},fileToVideo:function(e,t){var r=document.createElement("video");t&&r.addEventListener("loadeddata",function(){t(r)}),r.src=URL.createObjectURL(e)},formatDate:function(e){return moment.unix(e).format("l")},formatDateAndTimeRelative:function(e){var t=moment().startOf("day"),r=moment.unix(e).startOf("day"),n=t.diff(r,"days"),i=R.formatTimestamp(e);switch(n){case 0:return l10n.t("web_today_at",{time:i});case 1:return l10n.t("web_yesterday_at",{time:i});default:return l10n.t("web_time_at",{date:R.formatDateRelative(e),time:i})}},formatDateRelative:function(e){var t=moment().startOf("day"),r=moment.unix(e).startOf("day"),n=t.diff(r,"days");return 0===n?l10n.t("web_today"):1===n?l10n.t("web_yesterday"):6>n?moment.unix(e).format("dddd"):R.formatDate(e)},formatDuration:function(e){var t=moment.utc(1e3*e);return t.isValid()?t.format("m:ss"):""},formatBroadcastNotification:function(e,t){var r,n,i="";if("create"===e){var o=parseInt(t,10);i=l10n.t("web_you_created_list_unnamed",{count:o,_plural:o})}else"add"===e?(r=Store.Contact.get(t),n=r?r.get("name"):"",n=n?n:this.widGetFormattedUser(t),i=l10n.t("web_list_recipient_added",{name:n})):"remove"===e&&(r=Store.Contact.get(t),n=r?r.get("name"):"",n=n?n:this.widGetFormattedUser(t),i=l10n.t("web_list_recipient_removed",{name:n}));return i},formatGroupNotification:function(e){var t,r,n="",o=e.get("type"),a=e.get("subtype"),s=e.displayName(),c=e.get("author"),d=e.get("body");if("group_notification"===o)switch(a){case"add":n=c===R.me?l10n.t("web_group_participant_added_you"):l10n.t("web_group_participant_added_name",{name:s});break;case"remove":n=c===R.me?l10n.t("web_group_participant_removed_you"):l10n.t("web_group_participant_removed_name",{name:s});break;case"leave":n=c===R.me?l10n.t("web_group_participant_left_you"):l10n.t("web_group_participant_left_name",{name:s});break;case"picture":n="remove"===d?c===R.me?l10n.t("web_photo_removed_by_you"):l10n.t("web_photo_removed_by",{name:s}):c===R.me?l10n.t("web_photo_changed_by_you"):l10n.t("web_photo_changed_by",{name:s});break;case"subject":n=c===R.me?l10n.t("web_group_subject_changed_by_you",{subject:d}):l10n.t("web_group_subject_changed_by_name",{name:s,subject:d});break;case"modify":t=this.widGetFormattedUser(e.get("author")),r=this.widGetFormattedUser(d),n=t===s?l10n.t("web_group_participant_changed_number_unknown_name",{name:s,new_number:r}):l10n.t("web_group_participant_changed_number",{name:s,old_number:t,new_number:r});break;default:i.log("wa:formatGroupNotification:unknown message subtype: "+a)()}else if("gp2"===o){var u,l=e.recipients,p=l?l.map(function(e){var t=Store.Contact.get(e);return t?t.get("formattedName"):R.widGetFormattedUser(e)}).join(l10n.t("enumeration_comma")):"",h=l?_.first(l):"",f=Store.Contact.get(h),m=f?f.get("formattedName"):h?R.widGetFormattedUser(h):"";switch(a){case"add":n=c?c===R.me?l10n.t("web_group_participants_you_added_names",{participants:p}):h===R.me?l10n.t("web_group_participants_name_added_you",{name:s}):l10n.t("web_group_participants_name_added_names",{name:s,participants:p}):h===R.me?l10n.t("web_group_participant_added_you"):l10n.t("web_group_participant_added_name",{name:m});break;case"remove":n=c?c===R.me?l10n.t("web_group_participants_you_removed_names",{participants:p}):h===R.me?l10n.t("web_group_participants_name_removed_you",{name:s}):l10n.t("web_group_participants_name_removed_names",{name:s,participants:p}):h===R.me?l10n.t("web_group_participant_removed_you"):l10n.t("web_group_participant_removed_name",{name:m});break;case"leave":n=h===R.me?l10n.t("web_group_participant_left_you"):l10n.t("web_group_participant_left_name",{name:p});break;case"picture":n="remove"===d?c===R.me?l10n.t("web_photo_removed_by_you"):l10n.t("web_photo_removed_by",{name:s}):c===R.me?l10n.t("web_photo_changed_by_you"):l10n.t("web_photo_changed_by",{name:s});break;case"subject":n=c===R.me?l10n.t("web_group_subject_changed_by_you",{subject:d}):l10n.t("web_group_subject_changed_by_name",{name:s,subject:d});break;case"modify":t=this.widGetFormattedUser(c),r=this.widGetFormattedUser(h),n=t===s?l10n.t("web_group_participant_changed_number_unknown_name",{name:s,new_number:r}):l10n.t("web_group_participant_changed_number",{name:s,old_number:t,new_number:r});break;case"create":n=c===R.me?d?l10n.t("web_group_created_by_you",{subject:d}):l10n.t("web_group_created_by_you_no_subject"):d?l10n.t("web_group_created_by_name",{name:s,subject:d}):l10n.t("web_group_created_by_name_no_subject",{name:s});break;case"delete":n=c===R.me?l10n.t("web_group_ended_you"):l10n.t("web_group_ended_name",{name:s});break;case"promote":u=l.length,n=1===u&&h===R.me?l10n.t("web_group_participant_promoted_you"):l10n.t("web_group_participant_promoted_names",{count:u,participants:p,_plural:u});break;case"demote":u=l.length,n=1===u&&h===R.me?l10n.t("web_group_participant_demoted_you"):l10n.t("web_group_participant_demoted_names",{count:u,participants:p,_plural:u});break;default:i.log("wa:formatGroupNotification:unknown message subtype: "+a)()}}return l10n.isRTL()&&(n=l10n.forceRTL(n)),n},formatPhoneNumber:_.memoize(function(e){return"Server"===e?e:f.format(e)}),timestampFormat:a.TIMESTAMP_FORMAT_12H,timestampWithDateFormat:a.TIMESTAMP_WITH_DATE_FORMAT_12H,formatTimestamp:function(e){return moment.unix(e).format(this.timestampFormat)},formatTimestampWithDate:function(e){return moment.unix(e).format(this.timestampWithDateFormat)},getBrowserId:function(){var e=s.getBrowserId();if(!e){var t=new Uint32Array(4);window.crypto.getRandomValues(t);var r=CryptoJS.lib.WordArray.create(t);e=CryptoJS.enc.Base64.stringify(r),s.setBrowserId(e)}return e},getBrowserInfo:function(){var e=m.parser.getResult();return{os:e.os.name+(e.os.version?" "+e.os.version:""),name:e.browser.name,ua:e.browser.name+" "+e.browser.version}},getHash:function(e,t,r){return new Promise(function(n){var o,a;if("image"===e){var s=R.parseDataURL(t);o=CryptoJS.enc.Base64.parse(s.data),a=CryptoJS.SHA256(o),n({hash:a.toString(CryptoJS.enc.Base64),size:o.sigBytes})}else if("video"===e||"audio"===e){var c=new FileReader;c.onload=function(e){o=CryptoJS.enc.Latin1.parse(e.target.result),a=CryptoJS.SHA256(o),n({hash:a.toString(CryptoJS.enc.Base64),size:o.sigBytes})},c.onerror=function(e){i.log("wa:getHash:filereader error: "+e)()},c.readAsBinaryString(r)}})},_flatten:function(e){var t=[];if(null===e||"undefined"==typeof e)return[];if(_.isArray(e))for(var r=0;r<e.length;r++)t=t.concat(this._flatten(e[r]));else if("object"==typeof e)if("undefined"!=typeof e.words&&"undefined"!=typeof e.sigBytes)t.push(e);else for(var n in e){var i=e[n];i&&(t=t.concat(this._flatten(i)))}else t.push(R.widUserToLegacy(e.toString()));return t},getHmac:function(e){for(var t=this.secretBundle.key.toString(CryptoJS.enc.Base64),r=this._flatten(e),n=[],i=0;i<r.length;i++){var o=CryptoJS.enc.Base64.parse(t);n.push(CryptoJS.HmacSHA256(r[i],o))}return n.reduce(R.XORWordArray)},getFileDuration:function(e){var t=this;return new Promise(function(r){var n=t.typeFromMimetype(e.type);"image"===n?r(void 0):"video"===n?t.fileToVideo(e,function(e){r(~~e.seekable.end(0)),URL.revokeObjectURL(e.src)}):"audio"===n&&t.fileToAudio(e,function(e){r(~~e.seekable.end(0)),URL.revokeObjectURL(e.src)})})},getMapThumb:function(e,t){var r=R.buildUrl("https://maps.googleapis.com/maps/api/staticmap",{size:"170x170",center:e+","+t,zoom:15,sensor:"true",format:"png8",mobile:"true",markers:"color:red|size:mid|"+e+","+t,key:"AIzaSyAd9DUC0P8PLPdtCBcLFcka6DTwoXhjf-k"});return new Promise(function(e,t){var n=new Image;n.onload=function(t){var r=document.createElement("canvas");r.width=100,r.height=100;var i=r.getContext("2d");i.drawImage(n,35,35,100,100,0,0,100,100),e(r.toDataURL("image/jpeg"))},n.onerror=t,n.setAttribute("crossOrigin","anonymous"),n.src=r})},getSecurityToken:function(){if(!this.secretBundle)return i.log("wa:getSecurityToken:no secret bundle !")(),"nosecretbundle!";var e=this.getHmac(Array.prototype.slice.call(arguments));return e.toString(CryptoJS.enc.Base64)},getLogUserAgent:function(){var e=R.getBrowserInfo();if(e){var t="WhatsApp/"+a.VERSION_STR,r="Web/"+e.ua,n="Device/"+e.os;return t+" "+r+" "+n}},generateSecretBundle:function(){if(this.secretBundle&&this.secretBundle.key&&this.secretBundle.keyPair)return this.secretBundle.key.toString(CryptoJS.enc.Base64);var e=window.e2e.ecc.PrimeCurve.CURVE_25519,t=window.e2e.ecc.Protocol.generateKeyPair(e),r=window.goog.crypt.base64.encodeByteArray(t.pubKey);return this.secretBundle={key:CryptoJS.enc.Base64.parse(r),keyPair:t},r},isBlobURL:function(e){return _.isString(e)&&"blob:"===e.substring(0,5)},isEncryptedMediaURL:function(e){return e&&_.isString(e)&&_.endsWith(e,".enc")},isDataURL:function(e){return 0===e.indexOf("data:")},isUserWid:function(e){return this.isXWid("c.us",e)},isBroadcastWid:function(e){return this.isXWid("broadcast",e)},isGroupWid:function(e){return this.isXWid("g.us",e)},isWid:function(e){return _.isString(e)?_.contains(v,e.split("@")[1]):!1},isXWid:function(e,t){return"string"==typeof t?t.split("@")[1]===e:("undefined"!=typeof t&&i.log("wa:isXWid called on nonstring: "+t)(),!1)},isTypeGroupNotification:function(e){return"group_notification"===e||"gp2"===e},isHttpUrl:function(e){return e&&("https://"===e.substring(0,8)||"http://"===e.substring(0,7))},_initURIRE:function(){if(!this.URI_RE){var e="[a-z\\d.-]+://",t="(?:(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])\\.){3}(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])",r="(?:(?:[^\\s!@#$%^&*()_=+[\\]{}\\\\|;:'\",.<>/?]+)\\.)+",n="(?:ac|ad|aero|ae|af|ag|ai|al|am|an|ao|aq|arpa|ar|asia|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|biz|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|cat|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|coop|com|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|info|int|in|io|iq|ir|is|it|je|jm|jobs|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mm|mn|mobi|mo|mp|mq|mr|ms|mt|museum|mu|mv|mw|mx|my|mz|name|na|nc|net|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|org|pa|pe|pf|pg|ph|pk|pl|pm|pn|pro|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tp|travel|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|xn--0zwm56d|xn--11b5bs3a9aj6g|xn--80akhbyknj4f|xn--9t4b11yi5a|xn--deba0ad|xn--g6w251d|xn--hgbk6aj7f53bba|xn--hlcj6aya9esc7a|xn--jxalpdlp|xn--kgbechtv|xn--zckzah|ye|yt|yu|za|zm|zw)",i="(?:"+r+n+"|"+t+")",o="(?:[;/][^#?<>\\s]*)?",a="(?:\\?[^#<>\\s]*)?(?:#[^<>\\s]*)?",s="\\s`!(\\[{;:'\".,<?«“‘",c="\\s`!()\\[\\]{};:'\".,<>?«»“”‘’",d="[^"+s+"]",u="(?=["+c+"]|$)",l="\\b"+e+"[^<>\\s]+"+d+u,p="\\b"+i+o+a+d+u,h="mailto:",f="(?:"+h+")?[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@"+i+a+"(?!\\w)",m=new RegExp("("+l+"|"+p+"|"+f+")","ig"),g=new RegExp("^"+e,"i");this.PUNC_PAIRS={")":"(","]":"[","}":"{","'":"'",'"':'"',">":"<","»":"«","”":"“","’":"‘"},this.SCHEME_RE=g,this.MAILTO=h,this.URI_RE=m,this.SAFE_PROTOCOLS=new RegExp("^(https?|mailto):","i")}},knowsPhone:function(){var e=s.getLoginTokens();return!(!e.client||!e.server)},_wbrRe:_.memoize(function(e){return u("(\\p{Arabic}{"+e+"})(\\p{Arabic})","g");
}),_wbrFn:function(e,t,r){return t+"​"+r},wbr:_.memoize(function(e,t){if(!m.isWebkit)return e;if(e.length<=t)return e;for(var r=e.split(/\s/),n=!1,i=R._wbrRe(t),o=0,a=r.length;a>o;++o){var s=r[o];if(s.length>t){var c=s.replace(i,R._wbrFn);s!==c&&(r[o]=c,n=!0)}}return n?r.join(" "):e},function(e,t){return"s:"+e+"n:"+t}),linkify:_.memoize(function(e,t,r,n){r=m.isWebkit?r:0;var i,o,a="",s=0;for(this.URI_RE||this._initURIRE();i=this.URI_RE.exec(e);){var c=i[0],u=c;if(this.SCHEME_RE.test(u)||(u=(-1!==u.indexOf("@")?u.indexOf(this.MAILTO)?this.MAILTO:"":u.indexOf("irc.")?u.indexOf("ftp.")?"http://":"ftp://":"irc://")+u),this.SAFE_PROTOCOLS.test(u)){var l,h=u.slice(-1);(l=this.PUNC_PAIRS[h])&&u.split(l).length!==u.split(h).length&&(this.URI_RE.lastIndex--,c=c.slice(0,-1),u=u.slice(0,-1)),o=_.escape(e.slice(s,i.index)),o=r&&o.length>r?R.wbr(o,r):o,a+=t?d.emojiToHTML(o,n):o;var f=document.createElement("a");f.href=u,f.title=u,f.target="_blank",f.className=p(n);var g=t?d.emojiToHTML(_.escape(c),n):_.escape(c);f.innerHTML=r&&c.length>r?R.wbr(g,r):g,a+=f.outerHTML,s=this.URI_RE.lastIndex}}return o=_.escape(e.slice(s)),o=r&&o.length>r?R.wbr(o,r):o,a+=t?d.emojiToHTML(o,n):o},function(e,t,r,n){return"t:"+e+"e:"+(t||!1)+"w:"+(r||0)+"c:"+n}),loadSavedSecretBundle:function(){var e=s.getSecretBundle();return e?this.secretBundle=e:(i.log("wa:loadSavedSecretBundle: attempted to load non-existent secret bundle!")(),null)},now:function(){return Math.round(Date.now()/1e3)},chunk:function(e,t){for(var r=[],n=0,i=e.length;i>n;n+=t)r.push(e.slice(n,n+t));return r},parseDataURL:function(e){var t=e.indexOf(":"),r=e.indexOf(";"),n=e.indexOf(",");return{mimetype:e.substring(t+1,r),data:e.substring(n+1)}},promptUnloadGuards:0,saveCurrentSecretBundle:function(){return this.secretBundle?(delete this.secretBundle.keyPair,void s.setSecretBundle(this.secretBundle)):void i.log("wa:saveSecretBundle: trying to save empty secret bundle!")()},setMe:function(e){i.log("wa:setMe","black",e)(),R.me=e},setSecretKeys:function(e,t,r){"0.1"===e?t&&r?(this.secretBundle.encKey=t,this.secretBundle.macKey=r,this.secretBundle.key=r):i.log("Wa:setSecretKeys v"+e+" "+t+" "+r,"red")():i.log("Wa:setSecretKeys unknown version: v"+e)()},typeFromMimetype:function(e){return e.split("/")[0]},userToWid:function(e){return e.indexOf("-")>0?e+"@g.us":e+"@c.us"},updateConnSettings:function(e){e.is24h?(this.timestampFormat=a.TIMESTAMP_FORMAT_24H,this.timestampWithDateFormat=a.TIMESTAMP_WITH_DATE_FORMAT_24H):(this.timestampFormat=a.TIMESTAMP_FORMAT_12H,this.timestampWithDateFormat=a.TIMESTAMP_WITH_DATE_FORMAT_12H)},vCardPrepareForSend:function(e){return new Promise(function(t,r){var n=new FileReader;n.onload=function(){var e=R.vCardParse(n.result),r=e.vcard.FN||{},i=e.vcard.PHOTO;if(i){var o=a.MAX_VCARD_PHOTO_SIDE,s="data:image/jpeg;base64,"+i.value;R.resizeDataURI(s,o,o,function(n){var o=R.parseDataURL(n);i.value=o.data,i.line="PHOTO;BASE64:"+o.data,t(R.vCardSerialize(e.rows),r.value)})}else t(R.vCardSerialize(e.rows),r.value)},n.onerror=r,n.readAsText(e)})},vCardParse:function(e){function t(e){var t={line:e},r=e.split(/:/,2);return t.key=t.fullkey=r[0],t.value=r[1],r=t.key.split(/;/,2),r.length>1&&(t.key=r[0]),t}if(!e)return void 0;e=e.replace(/\n^ /gm,"");var r=e.split(/\n/),n="BEGIN VERSION FN N TEL EMAIL ADR PHOTO END".split(/ /),i={};n.forEach(function(e){i[e]=!0});for(var o=[],a={},s=0;s<r.length;++s){var c=t(r[s]);i[c.key]&&(o.push(c),a[c.key]=c)}return{vcard:a,rows:o}},vCardSerialize:function(e){return e.map(function(e){return e.line.replace(/(.{75,75})/g,"$1\n ").replace(/\n^-$/gm,"")}).join("\n")},vCardGetThumbnail:function(e){if(!e)return void 0;e=e.replace(/\n^ /gm,"");var t=e.match(/^PHOTO;(BASE64|ENCODING=b;TYPE=image\/jpeg):(.*)$/m);return t?t[2]:void 0},widGetUser:function(e){return _.isString(e)?e.split("@")[0]:void 0},widGetFormattedUser:function(e){if(e){var t=this.widGetUser(e);if(t)return l10n.numAndPunc(this.formatPhoneNumber(t))}return""},widUserToLegacy:function(e){if("string"==typeof e){var t=e.split("@");if(2===t.length&&"c.us"===t[1])return t[0]+"@s.whatsapp.net"}return e},XORWordArray:function(e,t){var r,n;e.sigBytes>t.sigBytes?(n=e,r=t):(n=t,r=e);for(var i=r.words.length,o=0;i>o;o++)n.words[o]=r.words[o]^n.words[o];return n},buildUrl:function(e,t){return t&&(t=_.chain(t).map(function(e,t){return e?encodeURIComponent(t)+"="+encodeURIComponent(e):null}).compact().join("&").value()),t?e+"?"+t:e},computeDistanceBetween:function(e,t){var r=this.degreesToRadians(e.lat()),n=this.degreesToRadians((e.lng()+360)%360),i=this.degreesToRadians(t.lat()),o=this.degreesToRadians((t.lng()+360)%360),s=(o-n)*Math.cos((r+i)/2),c=i-r;return Math.sqrt(s*s+c*c)*a.EARTH_RADIUS},degreesToRadians:function(e){return Math.PI*e/180},resizeImageFromCanvas:function(e,t,r,n){var i=new Image;i.onload=function(){var o=this.resizeImageCanvas(i,e,t,r);n(o)}.bind(this),i.src=e.toDataURL("image/jpeg")},resizeDataURI:function(e,t,r,n){var i=new Image;i.onload=function(){n(this.resizeImageCanvas(i,document.createElement("canvas"),t,r))}.bind(this),i.src=e},resizeImageCanvas:function(e,t,r,n){var i=R.boundHeightWidth(e.height,e.width,n,r);t.width=i.width,t.height=i.height;var o=t.getContext("2d");return o.drawImage(e,0,0,i.width,i.height),t.toDataURL("image/jpeg")},cropCanvas:function(e,t){var r=e.getContext("2d"),n=r.getImageData(t.x,t.y,t.w,t.h);return e.height=t.h,e.width=t.w,r.putImageData(n,0,0),e},multibyteLength:function(e){return l.ucs2.decode(e).length},multibyteSubstr:function(e,t,r){var n=l.ucs2.decode(e);if("undefined"==typeof r)n=n.slice(t);else{if(0>=r)return"";n=n.slice(t,t+r)}return l.ucs2.encode(n)},fillInThumbnailDims:function(e){return Promise.all(e.map(function(e){return["image","video"].indexOf(e.type)>-1&&!parseInt(e.width||0,10)&&e.body?new Promise(function(t,r){var n=new Image;n.onload=function(){e.width=n.width,e.height=n.height,t(e)},n.src="data:image/jpeg;base64,"+e.body}):Promise.resolve(e)}))},filteredJoin:function(){var e=Array.prototype.slice.call(arguments),t=e.shift();return e.filter(function(e){return e}).join(t)},relToAbs:function(e){var t=this.A_TAG=this.A_TAG||document.createElement("a");return t.href=e,t.href},position:function(e){var t=0,r=0,n=e;do t-=n.scrollTop||0,r-=n.scrollLeft||0;while((n=n.parentNode)&&n!==document.body);do t+=e.offsetTop,r+=e.offsetLeft;while(e=e.offsetParent);return{top:t,left:r}},expBackoff:function(e,t,r,n){var i;return i=0===e?r||0:Math.pow(2,e),_.isFinite(t)&&i>t&&(i=t),_.isFinite(r)&&r>i&&(i=r),n&&(i*=1+n*Math.random()),i},sha256:_.memoize(function(e){return CryptoJS.SHA256(e).toString(CryptoJS.enc.Base64)}),md5:_.memoize(function(e){return CryptoJS.MD5(e).toString(CryptoJS.enc.Base64)}),textDir:_.memoize(function(e){g||(g=document.createElement("span"),g.dir="auto",g.style.opacity="0",g.style.position="absolute",document.body.appendChild(g)),g.textContent=e;var t=window.getComputedStyle(g).direction;return g.textContent="",t}),missingCapabilities:function(){return _.filter(_.keys(a.BROWSER_CAPABILITY),function(e){return!a.BROWSER_CAPABILITY[e]})},a8n:function(e){var t=!1;return t?e:void 0}};R.CONST=a,e.exports=R},function(e,t,r){function n(e,t,r,n,i){var o=new XMLHttpRequest,a=new Promise(function(a,s){o.onload=function(e){4===o.readyState?a(o):s(e)},o.onerror=s,o.ontimeout=s,o.onprogress=i,o.onabort=s,r instanceof FormData?(o.open(t||h.POST,e,!0),n&&(o.responseType=n),o.send(r)):r instanceof Object?(e=Wa.buildUrl(e,r),o.open(t||h.GET,e,!0),n&&(o.responseType=n),o.send()):(o.open(t||h.GET,e,!0),n&&(o.responseType=n),o.send())});return a.cancellable()["catch"](Promise.CancellationError,function(){o.abort()})}function i(e,t){return n(e,h.GET,null,t)}function o(e,t){return d(function(){return i(e,t)})}function a(e,t){return n(e,h.POST,t)}function s(e){return n(e,h.HEAD)}function c(e){return d(function(){return s(e)})}function d(e){return l.loopOnError(p.ShouldLoop,function(t){var r;return r=u.state===u.STATE.CONNECTED?Promise.delay(Math.floor(1e3*Wa.expBackoff(t,60,void 0,.1))):l.waitForBBEvent(u,"change:state",_.matches({state:u.STATE.CONNECTED})),r.then(function(){return e().then(function(e){if(e.state>=500)throw new p.ShouldLoop;return e})["catch"](function(){throw new p.ShouldLoop})})})}var u=r(20),l=r(150),p=r(151),h={GET:"GET",POST:"POST",HEAD:"HEAD",PUT:"PUT"},f={BLOB:"blob",ARRAY_BUFFER:"arraybuffer"};e.exports={head:s,headRetry:c,get:i,getRetry:o,post:a,request:n,VERB:h,RESP_TYPE:f}},function(e,t,r){function n(e){return e instanceof g}function i(e){var t=c.getOldLogoutCreds();c.setOldLogoutCreds(_.filter(t,_.negate(_.matches(e))))}var o=r(14),a=r(21),s=r(4),c=r(143),d=r(144),u=r(146),l=r(149),p=r(154),h=r(150),f=r(151),m=r(152),g=r(156),v=r(153),y=r(160),b=r(161),E={OPENING:"OPENING",PAIRING:"PAIRING",UNPAIRED:"UNPAIRED",UNPAIRED_IDLE:"UNPAIRED_IDLE",CONNECTED:"CONNECTED",TIMEOUT:"TIMEOUT",CONFLICT:"CONFLICT",UNLAUNCHED:"UNLAUNCHED",PROXYBLOCK:"PROXYBLOCK"},R={DISCONNECTED:"DISCONNECTED",SYNCING:"SYNCING",RESUMING:"RESUMING",CONNECTED:"CONNECTED"},w={NEW:"new",SENT:"sent",WEBDACKED:"webdacked",WILL_RETRY:"will_retry"},S=f.defineAll(["SendCalledWhileDisconnected","ExternalPoke","MustExitLoop","Denied401Failed","Denied409Conflict","DeniedUnknown","ForcedRefresh","TooManyRefRequest","UILogout","WindowOffline","PhoneFailedPing","AssertionFailed","TakeoverRequested","PhoneReplacedClient","NoSecretBundle","PhoneKickedClient"]),T={SYNC_INFO:["Conn",m.OBJECT],CHALLENGE:["Cmd",{type:"challenge",challenge:m.STRING}],DISCONNECT:["Cmd",{type:"disconnect",kind:_}],HARD_REFRESH:["Cmd",{type:"update"}],PONG:["Pong",m.BOOLEAN]},C={TAG:function(e){return new m({tag:e,data:m.ANY})},SYNC_INFO:new m({tag:m.ANY,data:T.SYNC_INFO}),CHALLENGE:new m({tag:m.ANY,data:T.CHALLENGE}),DISCONNECT:new m({tag:m.ANY,data:T.DISCONNECT}),HARD_REFRESH:new m({tag:m.ANY,data:T.HARD_REFRESH}),PONG:new m({tag:m.ANY,data:T.PONG})},N=new m({status:function(e){return"number"==typeof e&&e>=500},_:_}),I=5,P=6e4,O=5,M=500,k=3e3,A=3e3,D=864e5,L=120,x=40,$=a.extend({extraProperties:"reject",props:{data:"any",tag:"string",state:{type:"string",values:_.values(w),"default":w.NEW},ephemeral:"boolean",ignore:"boolean",clientCacheable:"boolean",onSend:"function",onDrop:"function",age:{type:"number","default":0},resends:{type:"number","default":0},resendTimer:{type:"number","default":0},binaryOpts:"object"},derived:{likelyDead:{deps:["age"],fn:function(){return this.age>=x}},isToPhone:{deps:["data"],fn:function(){return this.data instanceof ArrayBuffer}}},getTag:function(){return this.tag||(this.onSend?this.onSend.tag:void 0)},toString:function(){return this.binaryOpts?this.binaryOpts.debugString:!_.isArray(this.data)||"query"!==this.data[0]&&"action"!==this.data[0]?_.isArray(this.data)?"["+this.data[0]+(this.data.length>1?", ...]":"]"):_.isObject(this.data)?"{...}":this.data+"":"["+this.data[0]+", "+this.data[1]+(this.data.length>2?", ...]":"]")},serialize:function(){var e=this.tag;if(this.binaryOpts){var t=this.binaryOpts,r=g.calculateUTF8Bytes(e)+3,n=new g(r,!1),i=t.metric?t.metric:0,o=(this.ignore?0:1)<<7|(!this.ignore&&t.ackRequest?1:0)<<6|(t.available===!0?1:0)<<5|(t.available===!1?1:0)<<4|(t.expires?1:0)<<3|(t.skipOffline?1:0)<<2;return n.writeString(e),n.writeString(","),n.writeByte(i),n.writeByte(o),n.reset(),g.concat([n,this.data]).toBuffer()}var a=_.isString(this.data)?this.data:JSON.stringify(this.data);return e+",,"+a}}),U=a.extend({extraProperties:"reject",session:{socketPreload:"object",socket:"object",socketSequence:{type:"number","default":0},launchGeneration:{type:"number","default":0},backoffGeneration:{type:"number","default":0},online:{type:"boolean","default":!0},hasSynced:"boolean",state:{type:"string",values:_.keys(E),"default":E.UNLAUNCHED},stream:{type:"string",values:_.keys(R),"default":R.DISCONNECTED},canSend:"boolean",sendQueue:"array",sendHash:"object",sequence:{type:"number","default":0},shortTagBase:"string",socketWatcher:"object",refWatcher:"object",phoneWatchdog:"object",pendingPhoneReqs:{type:"number","default":0},isIncognito:"boolean",runPromise:"object",streamPromise:"object",logoutMutex:{type:"number","default":0},retryTimestamp:"number",pokeable:"object",conflictPromise:"object",launched:"boolean",mustExitLoop:"boolean",syncTag:"string",lastPhoneMessage:"number"},initialize:function(){this.sendQueue=[],this.sendHash={},this.phoneWatchdog=new p({waitAlgorithm:p.FIBONACCI(k,A,D),onTimeout:this.phoneTimedOut.bind(this),onActivated:this.onPhoneWatchdogActivated.bind(this),onFed:this.onPhoneWatchdogFed.bind(this),onDeactivated:this.onPhoneWatchdogDeactivated.bind(this)}),this.listenTo(this,"change:state",this.onStateChange.bind(this)),this.listenTo(this,"change:stream",this.onStreamChange.bind(this)),Promise.delay(0).then(h.determineIncognito).bind(this).then(function(e){this.isIncognito=e})},STATE:E,STREAM:R,preload:function(e){this.socketPreload=e||new y},send:function(e){var t=new $(e);this.sendQueue.push(t),this.flushQueue()},shortTag:function(){this.shortTagBase||(this.shortTagBase=(moment().unix()%1e3).toString());var e=s.FLAVOR_TAGS?"w":".--";return this.shortTagBase+e+this.sequence++},tag:function(e){var t=s.FLAVOR_TAGS?"w":".--",r=moment().unix()+t+this.sequence++;return e&&s.FLAVOR_TAGS?r+"-"+e:r},launch:function(e,t){function r(){o.log("ws2:socket loop closed")(),this.socketPreload&&this.socketPreload.deactivate(),this.clearState(),this.set({state:E.UNLAUNCHED,mustExitLoop:!1,launched:!1,socketPreload:null})}o.log("ws2:Launch gen"+this.launchGeneration+" (backoff gen"+this.backoffGeneration+")")(),t=t||0;var n=Date.now()+300*Wa.expBackoff(this.backoffGeneration,100),i=n+P;if(this.launched){var a=new Error;return o.log("ws2:launch redundantly called!","red")(),o.log(a.stack,"red",void 0,!0)(),void Wa.uploadLogs("redundant-launch")}this.mustExitLoop?r.call(this):(this.launched=!0,this.run(t,e).then(function(e){return[e,!1]}).bind(this)["catch"](S.MustExitLoop,function(){return this.mustExitLoop=!0,[!1,!1]})["catch"](S.TakeoverRequested,function(){return[!1,!0]})["catch"](function(e){return o.log("ws2:run error unknown!","red",e)(),o.log(e.stack,"red",void 0,!0)(),Wa.uploadLogs("unknown-error-in-ws-loop"),this.clearState(),[!0,!1]}).spread(function(e,t){if(this.mustExitLoop)r.call(this);else{var o=Date.now();this.launchGeneration++,this.backoffGeneration=e&&i>o?this.backoffGeneration+1:0,this.launched=!1,this.launch(t,n>o?n-o:0)}}))},poke:function(){this.pokeable?this.pokeable.poke():this.phoneWatchdog.forceTimeout()},takeover:function(){if(!this.conflictPromise)throw"Takeover called without conflict!";this.conflictPromise.cancel(new S.TakeoverRequested)},exitLoop:function(){this.mustExitLoop=!0,this.runPromise&&this.runPromise.cancel(new S.MustExitLoop)},logout:function(e){var t=this.runPromise;o.log("ws2:user logged out","red")(),this.stream===R.DISCONNECTED||e?this.sendCurrentLogout():this.sendCurrentLogout(this.socket),this.clearCredentials(),t&&t.cancel(new S.UILogout),this.state===E.OPENING&&this.trigger("change:state")},summary:function(){o.log("ws:summary --------------------------------")(),o.log("ws state           "+this.state)(),o.log("wd online:         "+navigator.onLine)(),o.log("ws socket id:      "+(this.socket?this.socket.id:"n/a"))(),o.log("ws queue:")(),_.isEmpty(this.sendQueue)||u.printArray(_.map(this.sendQueue,function(e){var t=_.pick(e,"tag","state","age","ephemeral","isToPhone");return e&&e.toString&&(t.debug=e.toString()),t})).split(/\n/).forEach(function(e){o.log(e)()}),o.log("ws hash:")(),_.isEmpty(this.sendHash)||u.printArray(_.map(this.sendHash,function(e){var t=_.pick(e,"tag","state","age","ephemeral","isToPhone");return e&&e.toString&&(t.debug=e.toString()),t})).split(/\n/).forEach(function(e){o.log(e)()})},onStateChange:function(){o.log("ws2:state change: "+this.state)()},onStreamChange:function(){o.log("ws2:stream change: "+this.stream)(),this.stream===R.DISCONNECTED&&this.onRefCycle()},onRefCycle:function(){o.log("ws2:onRefCycle")(),this.sendQueue.forEach(function(e){e.state=w.NEW,e.age=0}),this.clearSendHash()},onActivity:function(e){if(e){var t=e.data;if(C.HARD_REFRESH.test(e))o.log("ws2:hard refresh!","red")(),b.update(0);else if(t){var r=_.isArray(t)?" ["+t[0]+", ...]":"";o.log("    recv: "+e.tag+r,"green",t)()}else o.log("     ack: "+e.tag,"#669999")()}this.sendRemainingLogouts()},onPhoneWatchdogActivated:function(){},onPhoneWatchdogFed:function(){this.state=E.CONNECTED},onPhoneWatchdogDeactivated:function(){},flushQueue:function(){if(this.canSend&&this.sendQueue.length){var e=_.where(this.sendQueue,{state:w.NEW}),t=moment().unix(),r=_.partition(e,function(e){return e.binaryOpts&&e.binaryOpts.expires?t-e.binaryOpts.expires>L:!1}),n=r[0],i=r[1];this.sendQueue=_.difference(this.sendQueue,n),n.forEach(function(e){delete this.sendHash[e.tag],e.onSend({status:408})},this),i.length&&i.forEach(this._send,this)}},phoneTimedOut:function(){if(1===this.phoneWatchdog.failGeneration){o.log("ws2:Phone timed out","orange")();var e=_.pluck(this.sendHash,"tag");o.log("ws2:Outstanding Reqs: "+e.join(","),"orange")()}var t=this.phoneWatchdog.waitAlgorithm(this.phoneWatchdog);return this.set({state:E.TIMEOUT,retryTimestamp:Date.now()+t}),this._basicSend({tag:this.tag("ping"),data:["admin","test"]},"ping"),!0},clearSendHash:function(e){if(e)_.each(this.sendHash,function(e){e.resendTimer&&clearTimeout(e.resendTimer),e.onDrop(new f.LogoutDrop(e.toString()))});else{var t=_.filter(this.sendHash,"ephemeral");o.log("Ephemeral Drop: "+_.pluck(t,"tag").join(","),"orange")(),t.forEach(function(e){e.resendTimer&&clearTimeout(e.resendTimer),e.onDrop(new f.EphemeralDrop(e.toString()))})}this.sendHash={},this.pendingPhoneReqs=0,this.phoneWatchdog.deactivate()},_basicSend:function(e,t){o.log("low-send: "+t+" "+e.tag,"blue",e.data)(),this.socket.cast(e.tag+","+JSON.stringify(e.data))},_send:function(e){e.tag=e.getTag()||this.shortTag(),this.sendHash[e.tag]=e;var t=e.binaryOpts?e.binaryOpts.debugObj:e.data;o.log("    send: "+e.tag+", "+e.toString(),"blue",t)(),this.socket.send(e.serialize()),e.isToPhone&&(this.pendingPhoneReqs++,this.phoneWatchdog.activate()),e.state=w.SENT},sendBasic:function(e){return this.socket?(e.tag=this.tag(),this._basicSend(e,"external"),this.socket.nextMessage(C.TAG(e.tag))):Promise.reject("socket not open")},sendEphemeral:function(e){e.ephemeral=!0;var t=new $(e);this.canSend?this._send(t):t.onDrop(new f.EphemeralDrop(t.toString()))},sendEphemeralIgnore:function(e){e.ephemeral=!0,e.ignore=!0,e.tag=this.tag();var t=new $(e);if(this.canSend){var r=t.serialize();this.socket.send(r),o.log("sending: "+t.tag+", "+t.toString(),"blue",t.data)()}else t.onDrop(new f.EphemeralDrop(t.toString()))},onMessage:function(e){var t=e.tag,r=e.data;if(n(r)&&(this.lastPhoneMessage=moment().unix()),C.PONG.test(e))if(r[1]){var i=0,a=!1;_.each(this.sendHash,function(e){var t=e.likelyDead;e.age++,e.likelyDead&&!t?(a=!0,o.log(e.tag+" likely dead: "+e.toString(),"red",e)(),d.error2412("("+e.tag+") "+e.toString()),Store.Wap.error2412()):e.likelyDead||i++}),this.pendingPhoneReqs=i,this.phoneWatchdog.feed(),0===i&&this.phoneWatchdog.deactivate(),a&&Wa.uploadLogs("error-2412")}else this.state!==E.TIMEOUT?o.log("ws2:Pang while not timed-out","red")():this.runPromise.cancel(new S.PhoneFailedPing);else{var s=this.sendHash[t];if(s){if(!r)return void(s.state=w.WEBDACKED);var c;try{c=s.onSend(r)}catch(u){if(u instanceof f.E401)return void this.logout();o.log("ws2:onMessage error","red",u)(),s.onDrop(u)}N.test(c)?(o.log("ws2:onMessage 5xx error "+s.tag,"red",c)(),s.resends>=I?(o.log("ws2:onMessage dropping "+s.tag,"red")(),s.onDrop(new f.Server5xxDrop)):this.resendRequestEventually(s)):(delete this.sendHash[t],this.sendQueue=_.without(this.sendQueue,s),s.isToPhone&&(s.likelyDead||this.pendingPhoneReqs--,this.phoneWatchdog.feed(),0===this.pendingPhoneReqs&&this.phoneWatchdog.deactivate()))}else if(r){var l;if(g.isByteBuffer(r))l=Store.Wap;else{var p=_.isFunction(r.shift)?r.shift():r;l=Store[p]}l?l.handle(r,this,t):o.log("ws2: Invalid type received","red",r)(),n(r)&&this.phoneWatchdog.feed()}}},run:function(e,t){return this.runPromise=v.resolve(e).bind(this).cancellable().then(function(e){if(this.state=E.OPENING,e>0){o.log("ws2:Run Backoff "+e+"ms")();var t=v.delay(e).cancellable()["catch"](S.ExternalPoke,_.noop);return this.setPokeable(t,Date.now()+e),t}})["finally"](function(){this.unset("pokeable"),this.unset("retryTimestamp")}).then(function(){return o.log("ws2:Running")(),this.openSocket()}).then(function(e){return this.online=!0,e.onactivity=this.onActivity.bind(this),this.socket=e,this.socketWatcher=h.attachWatcher(this.runPromise,this.throwOnClose()),this.state=E.PAIRING,"undefined"==typeof this.isIncognito?h.waitForBBEvent(this,"change:isIncognito"):void 0}).then(function(){var e=this;this.shortTagBase=(moment().unix()%1e3).toString();var r=this.initConn();if(!Wa.knowsPhone())return r.bind(this).then(function(){this.set({state:E.UNPAIRED,refWatcher:h.attachWatcher(this.runPromise,this.manageRef())})});var n=function(){var n=e.requestSync(t);return{v:Promise.all([r,n])["finally"](function(){r.cancel(),n.cancel()})}}();return"object"==typeof n?n.v:void 0}).then(this.waitForSyncInfo)["finally"](function(){this.refWatcher&&(this.refWatcher.cancel(),this.unset("refWatcher"))}).then(function(e){o.log("ws2:completed "+(this.hasSynced?"re-auth":"auth"))(),e.initial=!0,Store.Conn.handle([e]);var t=this.openStream();return this.set({state:E.CONNECTED,streamPromise:t}),t}).then(function(){return new v})["catch"](f.SocketClosed,function(e){throw e.event instanceof S.UILogout?e.event:e})["catch"](function(e){o.log("ws2:run loop interrupt: "+e,"orange",e)(),this.set({canSend:!1,stream:R.DISCONNECTED,runPromise:null}),this.phoneWatchdog.deactivate(),this.streamPromise&&(this.streamPromise.cancel(),this.unset("streamPromise")),this.socketWatcher&&(this.socketWatcher.cancel(),this.unset("socketWatcher"));var t=this.socket;return t&&"closed"!==t.state&&(t.detachCallbacks(),t.close(!0,e)),this.unset("socket"),Promise.reject(e)})["catch"](f.E401,S.PhoneFailedPing,function(){return!1})["catch"](S.ForcedRefresh,function(){return this.clearState(),!1})["catch"](f.SocketClosed,f.SocketError,function(){return!0})["catch"](S.Denied401Failed,S.DeniedUnknown,function(e){return o.log("ws2:phone denied "+e,"red")(),this.clearCredentials(),!1})["catch"](S.PhoneKickedClient,function(){return o.log("ws2:phone kicked")(),this.clearCredentials(),!1})["catch"](S.NoSecretBundle,function(){return o.log("ws2:No secret bundle!","red")(),this.clearCredentials(),Wa.uploadLogs("no-secret-bundle"),!1})["catch"](S.TooManyRefRequest,function(){return this.state=E.UNPAIRED_IDLE,this.setPokeable(h.waitForOfflineNaive()["throw"](new S.WindowOffline)["catch"](S.ExternalPoke,_.constant(!1)))})["catch"](f.BlockedByProxy,function(){return Wa.promptUnloadGuards++,this.state=E.PROXYBLOCK,this.setPokeable((new v)["catch"](S.ExternalPoke,_.constant(!1))["finally"](function(){Wa.promptUnloadGuards--}))})["catch"](S.Denied409Conflict,S.PhoneReplacedClient,function(e){e instanceof S.Denied409Conflict?o.log("ws2:phone denied (conflict)")():o.log("ws2:phone replaced")(),this.clearState();var t=(new v).cancellable();return this.set({state:E.CONFLICT,conflictPromise:t,runPromise:t}),t})["finally"](function(){this.conflictPromise&&this.conflictPromise.cancel()})["catch"](S.UILogout,S.WindowOffline,function(){return!1})},openSocket:function(){var e=this,t=this.socketPreload;if(this.socketPreload=null,t&&t.socket&&"open"===t.socket.state)return this.socketSequence+=t.attempts,this.online=!0,Promise.resolve(t.socket);t&&t.active?(this.socketSequence+=t.attempts,this.online=t.online):t=new y({online:this.online,startId:this.socketSequence});var r=function(){e.online=t.online},n=function(){e.socketSequence++},i=function(){e.retryTimestamp=t.retryTimestamp};t.on("change:online",r),t.on("change:attempts",n),t.on("change:retryTimestamp",i),this.pokeable=t;var o=h.waitForBBEvent(t,"change:socket").cancellable().then(function(){return t.socket})["finally"](function(){t.off("change:online",r),t.off("change:attempts",n),t.off("change:retryTimestamp",i),t.onerror=null,t.deactivate(),e.pokeable=null});return t.onerror=function(e){o.cancel(e)},o},initConn:function(){return new Promise(function(e,t){var r=s.VERSION,n=this.tag("init"),i=Wa.getBrowserInfo();return this._basicSend({tag:n,data:["admin","init",[r.p,r.s,r.t],[i.os,i.name],Wa.getBrowserId(),!this.isIncognito&&!!c.getRememberMe()]},"init"),this.socket.nextMessage(C.TAG(n)).get("data")["catch"](t).then(e)}.bind(this)).then(function(e){b.update(e.update,e.curr),Store.Conn.handle([{id:1,ref:e.ref,refTTL:e.ttl}])})},manageRef:function(){var e=this;return h.loopOnError(f.ShouldLoop,function(t){var r=Store.Conn.get(1).refExpiry-Date.now()-M;return Promise.delay(Math.max(r,0)).cancellable().then(function(){if(t>=O)throw new S.TooManyRefRequest;o.log("ws2:Requesting Ref Update")();var r=e.tag("qr"+t);return e._basicSend({tag:r,data:["admin","Conn","reref"]},"reref"),e.socket.nextMessage(C.TAG(r))}).then(function(e){var t=e.data;switch(t.status){case 200:throw o.log("ws2:Updating Ref")(),Store.Conn.handle([{ref:t.ref,refTTL:t.ttl}]),new f.ShouldLoop;case 304:return void o.log("ws2:Keeping Ref")();case 429:throw o.log("ws2:Server denied new ref")(),new S.TooManyRefRequest;default:throw o.log("ws2:Bad Ref Response!","red",t)(),new S.AssertionFailed("unrecognized ref request status ("+t.status+")")}})}).cancellable()},requestSync:function(e){var t=this;if(this.syncTag=this.tag("sync"),!Wa.loadSavedSecretBundle())throw new S.NoSecretBundle;var r=c.getLoginTokens(),n=r.client,i=r.server,a=["admin","login",n,i,Wa.getBrowserId()];e?a.push("takeover"):this.hasSynced&&(a.push("reconnect"),a.push(Wa.me));var s=function(){return t._basicSend({tag:t.syncTag,data:a},"sync"),!0},d=new p({waitAlgorithm:p.FIBONACCI(0,8500,6e4),onTimeout:s});d.on("change:ts",function(){t.retryTimestamp=d.ts}),this.pokeable=d,d.activate(),s();var u=this.socket.nextMessage(C.TAG(this.syncTag)),l=this.lookForAndHandleChallenge()["catch"](Promise.CancellationError,_.noop)["catch"](u.cancel.bind(u));return u.then(function(e){o.log("ws2:login",void 0,e)();var t=e.data;switch(t.status){case 200:return e;case 401:return Promise.reject(new S.Denied401Failed);case 405:return o.log("ws2:Already authorized!","red")(),Wa.uploadLogs("already-authorized"),Promise.reject(new S.ForcedRefresh);case 409:return Promise.reject(new S.Denied409Conflict);default:return o.log("ws2:unknown error! status:"+t.status,"red",e)(),Promise.reject(new S.DeniedUnknown)}})["finally"](function(){l.cancel(),d.deactivate(),t.unset("pokeable"),t.unset("retryTimestamp")})},waitForSyncInfo:function(){return this.socket.nextMessage(C.SYNC_INFO).then(function(e){return e.data[1]})},lookForAndHandleChallenge:function(){return this.socket.nextMessage(C.CHALLENGE).bind(this).then(function(e){o.log("ws2:challenged!")();var t=CryptoJS.enc.Base64.parse(e.data[1].challenge),r=Wa.getSecurityToken(t),n=c.getLoginTokens(),i=n?n.server:void 0;if(!i)return o.log("ws2:handleChallenge no server token!","red",n)(),Promise.reject(new Error);var a=this.tag("challenge");return this._basicSend({tag:a,data:["admin","challenge",r,i,Wa.getBrowserId()]},"challenge"),this.socket.nextMessage(C.TAG(a))}).then(function(e){return e.data.status>=400?(o.log("ws2:handleChallenge failed challenge!","red",e.data)(),Promise.reject(new S.Denied401Failed)):void o.log("ws2:handleChallenge passed challenge")()})},throwOnClose:function(){return this.socket.nextMessage(C.DISCONNECT).then(function(e){var t=e.data[1];throw"replaced"===t.kind?new S.PhoneReplacedClient:new S.PhoneKickedClient})},openStream:function(){this.canSend=!0;var e,t;return this.hasSynced?e=Promise.join(this.queryReceivedActions(),Store.Chat.resyncMessages(),Store.Msg.resyncReceipts(),_.noop).bind(this).then(function(){this.flushQueue(),this.stream=R.CONNECTED})["catch"](f.EphemeralDrop,Promise.CancellationError,function(){this.stream=R.DISCONNECTED})["catch"](function(e){throw o.log("ws2:error during resume, resyncing: "+e,"red",e)(),o.log(e.stack,"red",void 0,!0)(),Wa.uploadLogs("error-on-resume"),this.stream=R.DISCONNECTED,new S.ForcedRefresh}):(t=Store.Chat.sync().cancellable().bind(this).then(function(){this.set({hasSynced:!0,stream:R.CONNECTED})})["catch"](Promise.CancellationError,_.noop),e=Promise.join(t,Store.Contact.sync(),_.noop).bind(this)["catch"](function(e){return t.cancel(),this.set({hasSynced:!1,stream:R.DISCONNECTED}),Promise.reject(e)})["catch"](Promise.CancellationError,_.noop)),Promise.resolve().cancellable().bind(this).then(function(){return this.stream=this.hasSynced?R.RESUMING:R.SYNCING,this.socket.onmessage=this.onMessage.bind(this),this.socket.releaseMessages(),e})["catch"](Promise.CancellationError,function(){e.cancel()})},queryReceivedActions:function(){var e=this,t=_.filter(this.sendQueue,"clientCacheable",!0),r=_.pluck(t,"tag").filter(function(e){return e});return o.log("ws2:queryReceivedActions")(),0===r.length?Promise.resolve():Store.Wap.queryReceivedActions(r).then(function(r){_.isArray(r)?r.forEach(function(t){var r=_.find(e.sendQueue,"tag",t.id);if(r)if(o.log("ws2:queryReceivedActions found dup: "+t.id+","+t.code)(),delete e.sendHash[t.id],e.sendQueue=_.without(e.sendQueue,r),r.onSend){var n=r.onSend({status:t.code,_duplicate:!0});N.test(n)&&r.onDrop(new f.Server5xxDrop)}else o.log("ws2:queryReceivedActions onSendDup undefined; should be defined: "+t.id,"red")(),r.onDrop(new f.ConventionViolationDrop);else o.log("ws2:queryReceivedActions unknown tag in response: "+t.id,"red")()}):"replaced"===r?(t.forEach(function(e){e.onDrop(new f.BrowserReplacedDrop)}),e.sendQueue=_.difference(e.sendQueue,t)):o.log("ws2:queryReceivedActions error","red",r)()})},setPokeable:function(e){var t=arguments.length<=1||void 0===arguments[1]?this.retryTimestamp:arguments[1];return this.set({pokeable:{poke:function(){e.cancel(new S.ExternalPoke)}},retryTimestamp:t}),e},clearCredentials:function(){this.clearState(),c.setBrowserId(),c.setUnknownId(),c.clearTokens(),c.clearAllLocalState(),delete Wa.secretBundle,Wa.me=void 0},clearState:function(){this.sendQueue=[],this.clearSendHash(!0),this.unset("hasSynced"),_.each(Store,function(e){_.isFunction(e["delete"])&&e["delete"]()})},resendRequestEventually:function(e){var t=this,r=300*Wa.expBackoff(e.resends,100);o.log("ws2:Resending "+e.toString()+" in "+r+"ms")();var n=_.delay(function(){e.resends++,e.resendTimer=0,t.sendHash[e.tag]===e&&t._send(e)},r);e.set({resendTimer:n,state:w.WILL_RETRY})},sendCurrentLogout:function(e){if(Wa.loadSavedSecretBundle()){var t={t:c.getLogoutToken(),m:Store.Wap.logoutToken()},r=c.getOldLogoutCreds();r.push(t),c.setOldLogoutCreds(r)}if(e&&e.state===l.STATE.OPEN){var n=this.logoutMutex;this.logoutMutex=0>=n?n=1:++n,o.log("ws2:logout through socket","blue")(),e.partingSend(new S.UILogout,'goodbye,,["admin","Conn","disconnect"]',_.matches("goodbye,")).bind(this).then(function(e){e?(o.log("ws2:logout through socket success","green")(),i(t)):o.log("ws2:logout through socket failure, will POST","red")()})["finally"](function(){this.logoutMutex===n&&(this.logoutMutex=0)})}else this.logoutMutex<0&&(this.logoutMutex=0),this.sendRemainingLogouts()},sendRemainingLogouts:function(){var e=this.logoutMutex;if(0===e){var t=r(19),n=c.getOldLogoutCreds();if(0===n.length)return void(this.logoutMutex=-1);this.logoutMutex=e=1,Promise.all(_.map(n,function(e){return o.log("ws2:POST logout","blue")(),t.post(s.LOGOUT_URL,e).then(function(){i(e)})["catch"](function(e){o.log("ws2:POST logout failure","red")()})})).bind(this)["finally"](function(){e===this.logoutMutex&&(this.logoutMutex=0)})}}});e.exports=new U},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){var n=r(4),i=r(10),o=r(14),a=[n.KEY_LOGOUT_TOKEN,n.KEY_CLIENT_TOKEN,n.KEY_SERVER_TOKEN,n.KEY_SECRET_BUNDLE],s=[n.KEY_LOG_CURSOR,n.KEY_WHATSAPP_MUTEX,n.KEY_REMEMBER_ME,n.KEY_WHATSAPP_LS_VERSION],c=[n.KEY_WHATSAPP_MUTEX,n.KEY_REMEMBER_ME,n.KEY_OLD_LOGOUT_CREDS],d=[n.KEY_VERSION],u=1,l={
v0:function(){var e=localStorage.getItem(n.KEY_SECRET_BUNDLE);e&&(e=JSON.parse(e),e=_.isObject(e)?JSON.stringify(e):e,localStorage.setItem(n.KEY_SECRET_BUNDLE,e)),this._setLSVersion(1)}},p="x"+Math.round(1e9*Math.random()),h=function(e){if(e.key!==n.KEY_WHATSAPP_MUTEX)return!1;var t=e.newValue||"";return-1===t.indexOf(p)?!0:!1},f=function(e){if(e.key!==n.KEY_LOCAL_TAKEOVER_OK)return!1;var t=e.newValue||"";return-1===t.indexOf(p)?!0:!1},m={thisTabId:p,getRememberMe:function(){var e=this._getPS(n.KEY_REMEMBER_ME);return _.isNull(e)&&(e=!0,this._setPS(n.KEY_REMEMBER_ME,!0)),e},setRememberMe:function(e){if(e=!!e,e!==this.getRememberMe()){o.log("UserPrefs:setRememberMe: "+e)();var t,r;if(t=this._storage(),this._setPS(n.KEY_REMEMBER_ME,e),r=this._storage(),t!==r){var i=_.difference(_.keys(t),s,c);i.forEach(function(e){_.isFunction(t[e])||(r[e]=t[e],t.removeItem(e))})}e||o.clearLogs()}},_storage:function(){return this.getRememberMe()?i.permanentStorage:i.temporaryStorage},clear:function(){var e=this._getPreservedKeys();this._storage().clear(),this._setPreservedKeys(e)},_getKeys:function(e,t){return _.object(t,t.map(function(t){return e.getItem(t)}))},_setKeys:function(e,t){_.each(t,function(t,r){e.setItem(r,t)})},_getPreservedKeys:function(){return this._getKeys(i.permanentStorage,c)},_setPreservedKeys:function(e){return this._setKeys(i.permanentStorage,e)},_getAllKeyValues:function(){var e=this._storage();return _.object(_.keys(e).map(function(t){return[t,e.getItem(t)]}))},_setAllKeyValues:function(e){var t=this._storage();_.keys(e).forEach(function(r){t.setItem(r,e[r])})},_getPS:function(e){return this._get(e,i.permanentStorage)},_setPS:function(e,t){return this._set(e,t,i.permanentStorage)},_getTS:function(e){return this._get(e,i.temporaryStorage)},_setTS:function(e,t){return this._set(e,t,i.temporaryStorage)},_get:function(e,t){if(_.isUndefined(e))throw new Error("_get called with no key");t=t||this._storage();var r=t.getItem(e);try{return JSON.parse(r)}catch(n){return o.log("userPrefs:_get("+e+") '"+n+"' "+r)(),Wa.uploadLogs("userprefs-parse-error"),void t.removeItem(e)}},_set:function(e,t,r){if(_.isUndefined(e))throw new Error("_set called with no key");r=r||this._storage(),_.isUndefined(t)?r.removeItem(e):r.setItem(e,JSON.stringify(t))},_getUser:function(e){if(!Wa.me)return o.log("userPrefs: Me has not loaded yet.","red")(),null;var t=Wa.md5([Wa.me,e].join(":"));return this._get(t)},_setUser:function(e,t){if(!Wa.me)return o.log("userPrefs: Me has not loaded yet.","red")(),null;var r=Wa.md5([Wa.me,e].join(":"));return this._set(r,t)},getLoginTokens:function(){return{client:this._get(n.KEY_CLIENT_TOKEN),server:this._get(n.KEY_SERVER_TOKEN)}},setLoginTokens:function(e){var t=e.client,r=e.server;t&&r&&!_.isUndefined(t)&&(o.log("UserPrefs:setLoginTokens")(),this._set(n.KEY_CLIENT_TOKEN,t),this._set(n.KEY_SERVER_TOKEN,r))},setRefTokCookies:function(e,t){m.clearCookies(),m.clearDeprecatedKeys(),document.cookie=n.COOKIE_REF+"="+e+";secure;path=/pp;domain="+n.COOKIE_DOMAIN,document.cookie=n.COOKIE_TOK+"="+t+";secure;path=/pp;domain="+n.COOKIE_DOMAIN},clearCookies:function(){[n.COOKIE_REF,n.COOKIE_TOK].forEach(function(e){document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/",document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain="+n.COOKIE_DOMAIN,document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/pp;domain="+n.COOKIE_DOMAIN})},clearDeprecatedKeys:function(){d.forEach(function(e){i.permanentStorage.removeItem(e)})},getSecretBundle:function(){var e=this._get(n.KEY_SECRET_BUNDLE);return e?_.object(_.map(e,function(e,t){return[t,CryptoJS.enc.Base64.parse(e)]})):(o.log("UserPrefs:Attempted to load non-existent secret bundle!","red",e)(),null)},setSecretBundle:function(e){return this._set(n.KEY_SECRET_BUNDLE,_.object(_.map(e,function(e,t){return[t,CryptoJS.enc.Base64.stringify(e)]})))},clearTokens:function(){a.forEach(function(e){this._set(e)},this)},getNUX:function(e){return this._getUser(e)},setNUX:function(e,t){return this._setUser(e,t)},getUnknownId:function(){return this._get(n.KEY_UNKNOWN_ID)},setUnknownId:function(e){return this._set(n.KEY_UNKNOWN_ID,e)},getBrowserId:function(){return this._get(n.KEY_BROWSER_ID)},setBrowserId:function(e){this._set(n.KEY_BROWSER_ID,e)},setLastEmojiTab:function(e){return this._setUser(n.KEY_LAST_ACTIVE_EMOJI_TAB,e)},getLastEmojiTab:function(){return this._getUser(n.KEY_LAST_ACTIVE_EMOJI_TAB)},getCollection:function(e){return this._getUser(e)},setCollection:function(e,t){return this._setUser(e,t)},getGlobalSounds:function(){return!this._getUser(n.KEY_GLOBAL_MUTE_SOUNDS)},setGlobalSounds:function(e){return this._setUser(n.KEY_GLOBAL_MUTE_SOUNDS,!e)},getGlobalNotifications:function(){return!this._getUser(n.KEY_GLOBAL_MUTE_NOTIFICATIONS)},setGlobalNotifications:function(e){return this._setUser(n.KEY_GLOBAL_MUTE_NOTIFICATIONS,!e)},getGeocoderLocation:function(){return this._getUser(n.KEY_GEOCODER_LOCATION)},setGeocoderLocation:function(e){this._setUser(n.KEY_GEOCODER_LOCATION,e)},getMapsOverQuota:function(){return this._get(n.KEY_GMAPS_OVER_LIMIT)},setMapsOverQuota:function(e){return this._set(n.KEY_GMAPS_OVER_LIMIT,e)},getGroupParticipantAssignedColor:function(e){return this._getUser(n.KEY_GROUP_ASSIGNED_COLOR+"-"+e)},setGroupParticipantAssignedColor:function(e,t){this._setUser(n.KEY_GROUP_ASSIGNED_COLOR+"-"+e,t)},getMutex:function(){var e=this._getPS(n.KEY_WHATSAPP_MUTEX);return e},setMutex:function(e){var t=e?p+":"+e:e;return this._setPS(n.KEY_WHATSAPP_MUTEX,t)},removeMutex:function(){return this._setPS(n.KEY_WHATSAPP_MUTEX)},parseMutex:function(e){return e=e?JSON.parse(e):"",e?e.toString().split(/:/).pop():e},mutexFilter:h,localTakeoverSuccess:function(){var e=this.getRememberMe()?{}:_.omit(this._getAllKeyValues(),s);e.wa_tab_src=p,this._setPS(n.KEY_LOCAL_TAKEOVER_OK,e),this._setPS(n.KEY_LOCAL_TAKEOVER_OK)},parseTakeover:function(e){return e=e?JSON.parse(e):{},_.isObject(e)?(delete e.wa_tab_src,e):{}},takeoverFilter:f,getLangPref:function(){return this._get(n.KEY_LANG)},setLangPref:function(e){return this._set(n.KEY_LANG,e)},getLogoutToken:function(){return this._getPS(n.KEY_LOGOUT_TOKEN)},setLogoutToken:function(e){return this._setPS(n.KEY_LOGOUT_TOKEN,e)},getOldLogoutCreds:function(){return this._getPS(n.KEY_OLD_LOGOUT_CREDS)||[]},setOldLogoutCreds:function(e){return this._setPS(n.KEY_OLD_LOGOUT_CREDS,e)},setLogCursor:function(e){e%=n.LOG_SIZE,this._setPS(n.KEY_LOG_CURSOR,e)},_getLSVersion:function(){return this._getPS(n.KEY_WHATSAPP_LS_VERSION)||0},_setLSVersion:function(e){return this._setPS(n.KEY_WHATSAPP_LS_VERSION,e)},_version:function(){return u},compareVersion:function(){var e=this._getLSVersion();return u-e},_migrate:function(e){if(e>5)throw new Error("too many migrations");var t=this.compareVersion();if(0!==t){var r,n=this._getLSVersion();if(!(t>0))throw new Error("downgrades not supported");if(r=l["v"+n],!r)throw new Error("no migration for: "+n);o.log("userPrefs:migrate from: "+n+" towards: "+u)(),r.call(this),this._migrate(e+1)}},maybeMigrate:function(){if(!_.isEmpty(localStorage)||!_.isEmpty(sessionStorage)){var e=_.flatten([a,n.KEY_BROWSER_ID,n.KEY_LOG_CURSOR]),t=_.pick(localStorage,e);try{this._migrate(0)}catch(r){o.log("userPrefs:error migrating","red",r)(),this.clear(),this._setAllKeyValues(t),this._setLSVersion(u)}}},clearAllLocalState:function(){var e=this._getPreservedKeys();localStorage.clear(),this._setPreservedKeys(e),sessionStorage.clear(),this.clearCookies(),o.clearLogs()},setNoTakeover:function(e){return this._setTS(n.KEY_NO_TAKEOVER,e)},getNoTakeover:function(){return this._getTS(n.KEY_NO_TAKEOVER)},getWamBuffer:function(){return this._get(n.KEY_WAM_BUFFER)},setWamBuffer:function(e){this._set(n.KEY_WAM_BUFFER,e)},getWamStatus:function(){return this._get(n.KEY_WAM_STATUS)},setWamStatus:function(e){this._set(n.KEY_WAM_STATUS,e)},getWamLastRotate:function(){return this._get(n.KEY_WAM_LAST_ROTATE)},setWamLastRotate:function(e){this._set(n.KEY_WAM_LAST_ROTATE,e)},getWamOldBuffer:function(){return this._get(n.KEY_WAM_OLD_BUFFER)},setWamOldBuffer:function(e){this._set(n.KEY_WAM_OLD_BUFFER,e)},getWamDimensionCache:function(){return this._get(n.KEY_WAM_DIMENSION_CACHE)},setWamDimensionCache:function(e){this._set(n.KEY_WAM_DIMENSION_CACHE,e)}};e.exports=m},function(e,t,r){var n=r(14),i=r(109),o=r(145),a={muteChat:function(e,t){this.trigger("mute_chat",e,t)},deleteOrExitChat:function(e){this.trigger("delete_or_exit_chat",e)},archiveChat:function(e,t){this.trigger("archive_chat",e,t)},markChatUnread:function(e,t){this.trigger("mark_chat_unread",e,t)},openChat:function(e){this.closeDrawer(),this.trigger("open_chat",e)},clearChat:function(e){this.trigger("clear_chat",e)},focusChatTextInput:function(e){this.trigger("focus_chat_text_input_"+e.id)},pasteChatTextInput:function(e,t){this.trigger("paste_chat_text_input_"+e.id,t)},composeHeightChange:function(e,t){this.trigger("compose_height_change",e,t)},isMsgVisible:function(e,t){this.trigger("is_msg_visible",e,t)},jsHaltDetected:function(e){this.trigger("js_halt_detected",e)},login:function(e){this.trigger("login",e)},openContextMenu:function(e,t){this.trigger("open_context_menu",e,t)},openTooltip:function(e,t){this.trigger("open_tooltip",e,t)},openToast:function(e){this.trigger("open_toast",e)},closeToast:function(e){this.trigger("close_toast",e)},alertNewMsg:function(e){this.trigger("alert_new_msg",e)},alertCall:function(e,t){this.trigger("alert_call",e,t)},cancelCall:function(e){this.trigger("cancel_call",e)},windowError:function(e){},error2412:function(e){},loadEarlierMsgs:function(e){this.trigger("load_earlier_msgs:"+e.get("id"))},openModal:function(e,t){this.trigger("open_modal",e,t)},closeModal:function(){this.trigger("close_modal")},openDrawer:function(e,t,r){this.trigger("open_drawer",e,t,r)},closeDrawer:function(e){this.trigger("close_drawer",e)},mediaPlaying:function(e){this.trigger("mediaPlaying",e)},uiResize:function(){this.trigger("resize")},localeChange:function(){this.trigger("locale_change")},clearUiBusy:_.debounce(function(){this.uiBusy&&(n.log("cmd:clearUIBusy uibusy timeout")(),this.uiBusy=0,this.trigger("ui_idle"))},5e3),setUiBusy:function(e){var t=this.uiBusy||0;e?(++t,this.clearUiBusy()):t&&--t,this.uiBusy=t,0===t&&(this.clearUiBusy.cancel(),this.trigger("ui_idle"))},windowMouseDown:function(e){this.trigger("window_mousedown",e)},windowClick:function(e){this.trigger("window_click",e)}};_.extend(a,i,o),e.exports=a},function(e,t,r){var n=r(109),i={listenTo:function(e,t,r){if(!_.isObject(e))throw Error("obj is not an object");if(_.isObject(t));else if(!_.isFunction(r))throw Error("callback is not a function");n.listenTo.apply(this,arguments)},listenToOnce:function(e,t,r){if(!_.isObject(e))throw Error("obj is not an object");if(_.isObject(t));else if(!_.isFunction(r))throw Error("callback is not a function");n.listenToOnce.apply(this,arguments)}};e.exports=i},,,,function(e,t,r){function n(e,t){var r=-1,n=_.find(e,function(e){return r++,t(e)});return void 0===n?void 0:{index:r,value:n}}function i(e){var t,r;try{t=new h(e)}catch(n){return o.log("WatchedSocket error constructing: "+n,"red",n)(),u.reject(n)}return new u(t,function(e,t){o.log("WatchedSocket opening socket "+this.id)(),r=WamLog.startTimer("WsOpen");var n=new WebSocket(this.url);n.binaryType="arraybuffer",n.onopen=e,n.onclose=n.onerror=function(e){t(new c.SocketError(e))},this.socket=n}).cancellable()["catch"](function(e){if(o.log("WatchedSocket error on open of "+this.id+": "+e,"red",e)(),r.cancel(),this.socket){var t=this.socket;switch(t.readyState){case WebSocket.OPENING:t.onopen=null;case WebSocket.OPEN:t.onerror=null,t.onclose=null,t.close();break;case WebSocket.CLOSING:case WebSocket.CLOSED:t.onerror=null,t.onclose=null}}throw e}).then(function(e){r.end(),o.log("WatchedSocket opened socket "+this.id)();var t=this.socket;return t.onmessage=this._onMessage.bind(this,!0),t.onerror=this._onCloseOrError.bind(this,!0),t.onclose=this._onCloseOrError.bind(this,!1),this._offlineListener=s.waitForOfflineNaive().then(this.close.bind(this,!1,"offline"))["catch"](Promise.CancellationError,_.noop),this._feedPing(),this.state=p.OPEN,this})}var o=r(14),a=r(21),s=r(150),c=r(151),d=r(152),u=r(153),l=2e4,p={OPEN:"open",CLOSED:"closed"},h=a.extend({extraProperties:"reject",session:{id:{type:"integer",required:!0,allowNull:!1},url:{type:"string",required:!0,allowNull:!1},onmessage:"function",onactivity:"function",pingTime:"number",killTime:"number",pingString:"string",pongString:"string",msgParser:"function",state:{type:"string",values:[p.OPEN,p.CLOSED]},error:"any",socket:"object",isQueueing:{type:"boolean","default":!0},maxQueueSize:"number",messageQueue:"array",_offlineListener:"object",_msgListeners:"array",_feedPing:"function",_feedKill:"function"},initialize:function(){this._msgListeners=[],this.messageQueue=[],this._killTimerID=null,this._feedPing=_.debounce(function(){this._ping(),this._feedPing()},this.pingTime)},_ping:function(){this.send(this.pingString),null===this._killTimerID&&(this._killTimerID=_.delay(this._killSocket,this.killTime,this))},_killSocket:function(e){o.log("Watchdog Socket "+e.id+" Timeout!","red")(),e.close(!0,"stale")},_stopKillTimer:function(){this._killTimerID&&(clearTimeout(this._killTimerID),this._killTimerID=null)},detachCallbacks:function(){this.set({onactivity:void 0,onmessage:void 0})},send:function(e){if("open"!==this.state)throw new c.SocketNotOpen(this.state);try{this.socket.send(e)}catch(t){o.log("exception sending: "+t,"red",t),o.log(t.stack),Wa.uploadLogs("send-exception"),this.close(!0,t)}},cast:function(e){this.send(e)},partingSend:function(e,t,r){var n=this,i=this.socket;return new Promise(function(o){function a(){o(void 0)}i.onclose=a,i.onerror=a,i.onmessage=function(e){var t=e.data;(!r||r(t))&&o(t)},n.send(t),n._onCloseOrError(!1,e)}).timeout(l,"paringSendTimeout")["catch"](_.noop)["finally"](function(){i.onclose=void 0,i.onerror=void 0,i.onmessage=void 0,i.readyState===WebSocket.OPEN&&i.close()})},close:function(e,t){var r,n=this.socket;if(this._onCloseOrError(!!e,t||"unspecified"),n&&(r=n.readyState,r===WebSocket.OPENING||r===WebSocket.OPEN))try{n.close()}catch(i){o.log("WatchedSocket:exception closing: "+i,"red",i),o.log(i.stack)}},_onMessage:function(e,t){if(e){if(this._feedPing(),this._stopKillTimer(),this.pongString===t.data)return void(this.onactivity&&this.onactivity());this.msgParser&&(t=this.msgParser(t)),this.onactivity&&this.onactivity(t)}var r=n(this._msgListeners,function(e){return!e.filter||e.filter(t)});r?(this._msgListeners.splice(r.index,1),r.value.removed=!0,r.value.promise.force(t)):this.isQueueing?(o.log("watchedSocket:enqueued","orange",t)(),this.messageQueue.push(t),void 0!==this.maxQueueSize&&this.messageQueue.length>this.maxQueueSize&&this.close(!0,"Queue Overflow")):this.onmessage?this.onmessage(t):o.log("watchedSocket:dropped!","red",t)()},_onCloseOrError:function(e,t){if("closed"!==this.state){this.socket&&(this.socket.onclose=void 0,this.socket.onerror=void 0,this.socket.onmessage=void 0),this._offlineListener&&this._offlineListener.cancel(),o.log("Socket "+this.id+" closing: "+t,"orange")(),this._feedPing.cancel(),this._stopKillTimer(),this.set({state:"closed",error:e?t:void 0});var r=this._msgListeners,n=e?new c.SocketError(t):new c.SocketClosed(t);this._msgListeners=[],_.forEach(r,function(e){e.removed=!0,e.promise.cancel(n)})}},holdMessages:function(e){var t=this.isQueueing&&void 0!==e&&this.messageQueue>e;this.set({isQueueing:!0,messageQueue:this.messageQueue||[],maxQueueSize:e}),t&&this.close(!0,"Queue Overflow")},releaseMessages:function(e){if(!this.isQueueing)return void o.log("WatchedSocket:releaseMessages not queued!","red")();var t=this.messageQueue;this.set({isQueueing:!1,messageQueue:void 0}),e?t.length>0&&o.log("WatchedSocket:releaseMessages dropping "+t.length+" messages.","red")():_.forEach(t,function(e){this._onMessage(!1,e)},this)},nextMessage:function(e){if("open"!==this.state&&"opening"!==this.state)return u.reject(new c.SocketNotOpen).cancellable();if(e instanceof d&&(e=e.test.bind(e)),this.isQueueing){var t;if(e){var r=n(this.messageQueue,e);r&&(t=r.value,this.messageQueue.splice(r.index,1))}else this.messageQueue.length>0&&(t=this.messageQueue.shift());if(t)return u.resolve(t).cancellable()}var i=(new u).cancellable().forceable(),o={removed:!1,filter:e,promise:i};return this._msgListeners.push(o),i.bind(this)["catch"](function(){o.removed||(this._msgListeners=_.without(this._msgListeners,o))}),i}});h.STATE=p,h.open=i,e.exports=h},function(e,t,r){function n(){function e(e){var s=Promise.resolve([a++,e]).cancellable().spread(i).then(function(){return r.apply(void 0,arguments)});t=s["catch"].apply(s,o)["catch"](function(){return n.apply(void 0,arguments)})}var t,r,n,i=_.last(arguments),o=_.initial(arguments),a=0;return o.push(e),Promise.resolve().then(function(){return new Promise(function(t,i){r=t,n=i,e()}).cancellable()["catch"](function(e){if(t&&t.isPending())return new Promise(function(i,o){r=i,n=o,t.cancel(e)});throw e})})}function i(e){return new Promise(function(t){function r(){t(n.status&&n.status<12e3?n:null)}var n=new XMLHttpRequest;n.onload=r,n.onreadystatechange=function(){4===n.readyState?r():0===n.readyState&&t(null)},n.onerror=t.bind(void 0,null),n.ontimeout=t.bind(void 0,null),n.open("GET",e,!0),n.send()})}function o(e,t){return t["catch"](Promise.CancellationError,_.noop)["catch"](function(t){e.cancel(t)})}function a(){return c(window,"offline")}function s(){var e,t;return new Promise(function(r){function n(){t&&t+1500<Date.now()?r(!0):(t=Date.now(),e=_.delay(n,1e3))}n()}).cancellable()["finally"](function(){clearTimeout(e)})}function c(e,t,r){var n;return new Promise(function(i){n=r?function(){r.apply(this,arguments)&&i.apply(this,arguments)}:i,e.addEventListener(t,n)}).cancellable()["finally"](function(){e.removeEventListener(t,n)})}function d(e,t,r){var n;return new Promise(function(i){n=r?function(){r.apply(this,arguments)&&i(arguments)}:function(){i(arguments)},e.on(t,n)}).cancellable()["finally"](function(){e.off(t,n)})}function u(){return new Promise(function(e,t){function r(){e(!1)}if(window.requestFileSystem)window.requestFileSystem(window.TEMPORARY,1,r,function(t){e("SecurityError"===t.name)});else if(window.indexedDB){var n=window.indexedDB.open("pb_detect");n?(n.onsuccess=r,n.onerror=function(t){t.preventDefault(),e(!0)}):r()}else r()}).then(function(e){if(e)return e;try{return window.localStorage.setItem("INCOG",0),window.localStorage.removeItem("INCOG"),!1}catch(t){return"QuotaExceededError"===t.name?!0:Promise.reject(t)}}).timeout(100,"detectIncognitoTimeout")["catch"](Promise.TimeoutError,function(){return!1})["catch"](function(e){return l.log("promiseUtil:determineIncognito failed check: "+e,"red",e)(),Wa.uploadLogs("incog-throw"),!1})}var l=r(14);e.exports={loopOnError:n,attachWatcher:o,getResponseIfOnline:i,waitForOfflineNaive:a,waitForEvent:c,waitForBBEvent:d,determineIncognito:u,waitForSkip:s}},function(e,t){function r(e,t,r,n){function i(r){this.name=e,_.isFunction(t)?this.message=t.apply(this,arguments):arguments.length>0?this.message=r:t&&(this.message=t),this.stack=Error().stack,_.isFunction(n)&&n.apply(this,_.rest(arguments))}return r=r||Error,i.prototype=Object.create(r.prototype),i}function n(e,t){return _.reduce(e,function(e,n,i){var o,a;return _.isString(i)?(o=i,a=n):o=n,e[o]=r(o,a,t),e},{})}function i(e){this.event=e;try{return JSON.stringify(e)}catch(t){return""+e}}var o=r("WAPStatusCode"),a=r("401",null,o),s=r("404",null,o),c=r("500",null,o),d=r("WapDrop"),u=r("EphemeralDrop",null,d),l=r("EphemeralDrop",null,d),p=r("Server5xxDrop",null,d),h=r("ConventionViolationDrop",null,d),f=r("BrowserReplacedDrop",null,d),m=r("ShouldLoop"),g=r("GaveUpRetry"),v=r("GUMError"),y=n({NotSupportedError:"The operation is not supported.",PermissionDeniedError:"The user did not grant permission for the operation",ConstraintNotSatisfiedError:"One of the mandatory Constraints could not be satisfied.",OverconstrainedError:"Due to changes in the environment, one or more mandatory constraints can no longer be satisfied.",NotFoundError:"The object can not be found here.",AbortError:"The operation was aborted.",SourceUnavailableError:"The source of the MediaStream could not be accessed due to a hardware error (e.g. lock from another process)."},v),b=r("MediaFileError"),E=r("InvalidMediaFileType",null,b),R=r("MediaFileTooLarge",null,b),w=r("MediaEncryptionError",null,b),S=r("ImageError","Image failed to load.",null,function(e){this.src=e,this.target={src:e}}),T=r("ContactBlocked","Contact is blocked",null,function(e){this.contact=e}),C=r("MediaMissing","Media is no longer available on your phone"),N=r("SocketError",i),I=r("SocketClosed",i),P=r("SocketNotOpen",function(e){return"socket not open, is "+e}),O=r("BlockedByProxy");e.exports={define:r,defineAll:n,QueryDrop:r("QueryDrop"),WapDrop:d,EphemeralDrop:u,LogoutDrop:l,Server5xxDrop:p,ConventionViolationDrop:h,BrowserReplacedDrop:f,ShouldLoop:m,GaveUpRetry:g,MediaFileError:b,InvalidMediaFileType:E,MediaFileTooLarge:R,MediaEncryptionError:w,WAPStatusCode:o,E401:a,E404:s,E500:c,SocketError:N,SocketClosed:I,SocketNotOpen:P,BlockedByProxy:O,ImageError:S,ContactBlocked:T,MediaMissing:C,ActionError:r("ActionError","Could not perform action."),GUM:_.defaults(y,{GUMError:v,PERMISSION_DENIED:y.PermissionDeniedError,NOT_SUPPORTED_ERROR:y.ConstraintNotSatisfiedError,MANDATORY_UNSATISFIED_ERROR:y.NotFoundError})}},function(e,t){function r(e){var t=[],r=!1,i=0;_.each(e,function(e,o){function a(e){return e.hasOwnProperty(o)&&s(e[o])}if(e===_)return void(r=!0);i++;var s=n(e);t.push(a)});var o=_.reduceRight(t,function(e,t){return e?function(r){return t(r)&&e(r)}:t});return function(e){if("object"!=typeof e)return!1;var t=_.keys(e).length;return i>t?!1:!r&&t>i?!1:o(e)}}function n(e){switch(typeof e){case"object":return r(e);case"function":return e;case"boolean":case"null":case"undefined":case"number":case"string":return function(t){return t===e}}}function i(e){this.predicate=n(e)}i.ANY=_.constant(!0),i.OBJECT=_.isObject,i.STRING=_.isString,i.BOOLEAN=_.isBoolean,i.prototype={test:function(e){return this.predicate(e)}},e.exports=i},function(e,t){function r(){this._parent=null,this._subs=[],this._catchTypes=null,this._onResolve=null,this._onReject=null,this.type=s.ROOT,this.state=c.PENDING,this.value=void 0,this._forceable=!1,this._cancellable=!1;var e,t;switch(arguments.length){case 0:break;case 1:e=arguments[0];break;case 2:t=arguments[0],e=arguments[1];break;default:throw new Error("TightPromise constructor with "+arguments.length+" arguments")}if(this.context=t,arguments.length>0)try{e.call(t,n.bind(this),i.bind(this))}catch(r){i.call(this,r)}}function n(e){this.state===c.PENDING&&(o(e)?e.then(n.bind(this),i.bind(this)):(this.value=e,this.state=c.FULFILLED,this._notifySubs()))}function i(e){this.state===c.PENDING&&(this.value=e,this.state=c.REJECTED,this._notifySubs())}function o(e){return("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then}function a(e){setTimeout(function(e){throw e},0,e)}var s={ROOT:1,THENABLE:2,FINALLY:3,META:4},c={PENDING:1,FULFILLED:2,REJECTED:3};r.STATE=c,r.TYPE=s,r.prototype={isPending:function(){return this.state===c.PENDING},then:function(e,t){if(!e&&!t)return this;var n=new r;return n.type=s.THENABLE,n._onResolve=e||null,n._onReject=t||null,this._addChild(n),n},"catch":function(){var e=new r;return e.type=s.THENABLE,e._onReject=arguments[arguments.length-1],arguments.length>1&&(e._catchTypes=Array.prototype.slice.call(arguments,0,arguments.length-1),e._catchTypes.forEach(function(e){if("function"!=typeof e)throw new Error("expected type, got "+e)})),this._addChild(e),e},"finally":function(e){var t=new r;return t.type=s.FINALLY,t._onResolve=e,this._addChild(t),t},bind:function(e){var t=new r;return t.type=s.META,this._addChild(t),t.context=e,t},spread:function(e){return this.then(function(t){e.apply(this,t)})},get:function(e){return this.then(function(t){return t[e]})},forceable:function(){var e=new r;return e.context=this.context,e.type=s.META,this._addChild(e),e._forceable=!0,e},cancellable:function(){var e=new r;return e.context=this.context,e.type=s.META,this._addChild(e),e._cancellable=!0,e},force:function(e){if(this._forceable){for(var t=this;t.type===s.META;){var r=t._parent;if(!r||!r._forceable||r.state!==c.PENDING)break;t=r}n.call(this,e)}},cancel:function(e){if(this._cancellable){e=e||new Promise.CancellationError;var t=this,r=!1;do{var n=t._parent;n&&n._cancellable&&n.state===c.PENDING?t=n:r=!0}while(!r);i.call(t,e)}},timeout:function(e,t){var n=new r;return n.type=s.META,this._addChild(n),n.state===c.PENDING&&setTimeout(i.bind(n,new Promise.TimeoutError(t)),e),n},loosen:function(){return Promise.resolve(this)},_run:function(e,t){var r;try{r=e.call(this.context,t)}catch(o){return void i.call(this,o)}n.call(this,r)},_handle:function(){if(this.state===c.PENDING){var e=this._parent;switch(this.type){case s.THENABLE:if(e.state===c.FULFILLED){var t=this._onResolve;t?this._run(t,e.value):n.call(this,e.value)}else if(this._onReject){var r=this._catchTypes,o=r?r.length:0,d=e.value;if(0===o)return void this._run(this._onReject,d);for(var u=0;o>u;u++)if(d instanceof r[u])return void this._run(this._onReject,d);i.call(this,d)}else i.call(this,e.value);return;case s.FINALLY:try{this._onResolve.call(this.context)}catch(l){a(l)}default:e.state===c.FULFILLED?n.call(this,e.value):i.call(this,e.value)}}},_addChild:function(e){e._parent=this,e.context=this.context,e._cancellable=this._cancellable,e.type===s.META&&(e._forceable=this._forceable),this.state===c.PENDING?this._subs.push(e):e._handle()},_notifySubs:function(){this._subs.forEach(function(e){e._handle()})}},r.delay=function(){var e,t;switch(arguments.length){case 0:e=0;break;case 1:e=arguments[0];break;default:e=arguments[1],t=arguments[0]}return new r(function(r){setTimeout(r.bind(null,t),e)})},r.resolve=function(e){var t=new r;return n.call(t,e),t},r.reject=function(e){var t=new r;return i.call(t,e),t},e.exports=r},function(e,t,r){function n(){var e=this.onTimeout;return e?(this.failGeneration++,void(e(this)&&this._run(!1))):(o.log("Watchdog timed-out without handler!","red")(),void Wa.uploadLogs("watchdog-no-handler"))}function i(e,t,r){return"number"==typeof r?function(n){switch(n.failGeneration){case 0:return Math.min(r,t);case 1:return Math.min(r,e+t);default:return Math.min(r,n.waitDuration+n.prevWaitDuration)}}:function(r){switch(r.failGeneration){case 0:return t;case 1:return e+t;default:return r.waitDuration+r.prevWaitDuration}}}var o=r(14),a=r(21),s=r(155),c=a.extend({session:{failGeneration:{type:"number",allowNull:!1,"default":0},ts:"number",waitDuration:{type:"number",allowNull:!1,"default":0},prevWaitDuration:{type:"number",allowNull:!1,"default":0},jitter:{type:"number","default":0},shiftTimer:"object",waitAlgorithm:{type:"function",required:!0,allowNull:!1},onActivated:"function",onDeactivated:"function",onFed:"function",onTimeout:"function"},initialize:function(){this.shiftTimer=new s(this,n)},activate:function(){this.shiftTimer.ts||(this._run(!0),this.onActivated&&this.onActivated(this))},deactivate:function(){this.shiftTimer.ts&&(this.shiftTimer.cancel(),this.onDeactivated&&this.onDeactivated(this))},feed:function(){this.shiftTimer.ts&&(this._run(!0),this.onFed&&this.onFed(this))},forceTimeout:function(e){this.shiftTimer.ts?e?this.ts=this.shiftTimer.before(e):this.shiftTimer.trigger():o.log("forced non-running watchdog!","red")()},poke:function(){this.forceTimeout.apply(this,arguments)},_run:function(e){e?this.failGeneration=0:this.failGeneration++;var t=this.waitAlgorithm(this),r=this.jitter*Math.random()*t;this.set({ts:this.shiftTimer.debounce(t+r),waitDuration:t,prevWaitDuration:this.waitDuration})}});c.FIBONACCI=i,e.exports=c},function(e,t){function r(){this.timer&&(clearTimeout(this.timer),this.timer=0,this.ts=0),this.foo.apply(this.context,arguments)}var n=function(){1===arguments.length?(this.context=null,this.foo=arguments[0]):(this.context=arguments[0],this.foo=arguments[1]),this.timer=0,this.ts=0,this.trigger=r.bind(this)};n.prototype={before:function(e){var t=void 0;return!t||t>e+Date.now()?this.set.apply(this,arguments):t},after:function(e){var t=this.ts;return!t||t<e+Date.now()?this.set.apply(this,arguments):t},debounce:function(){return this.set.apply(this,arguments)},set:function(e){for(var t=this,n=arguments.length,i=Array(n>1?n-1:0),o=1;n>o;o++)i[o-1]=arguments[o];return this.timer&&clearTimeout(this.timer),this.timer=i.length>0?setTimeout(function(){r.apply(t,i)},e):setTimeout(this.trigger,e),this.ts=e+Date.now()},cancel:function(){this.timer&&(clearTimeout(this.timer),this.timer=0,this.ts=0)}},e.exports=n},function(e,t,r){(function(e){/**
	 * @license ByteBuffer.js (c) 2013-2014 Daniel Wirtz <dcode@dcode.io>
	 * This version of ByteBuffer.js uses an ArrayBuffer (AB) as its backing buffer and is compatible with modern browsers.
	 * Released under the Apache License, Version 2.0
	 * see: https://github.com/dcodeIO/ByteBuffer.js for details
	 */
!function(t){"use strict";function n(e){var t=function(e,n,i){if("undefined"==typeof e&&(e=t.DEFAULT_CAPACITY),"undefined"==typeof n&&(n=t.DEFAULT_ENDIAN),"undefined"==typeof i&&(i=t.DEFAULT_NOASSERT),!i){if(e=0|e,0>e)throw new RangeError("Illegal capacity: 0 <= "+e);if("boolean"!=typeof n)throw new TypeError("Illegal littleEndian: Not a boolean");if("boolean"!=typeof i)throw new TypeError("Illegal noAssert: Not a boolean")}this.buffer=0===e?r:new ArrayBuffer(e),this.view=0===e?null:new DataView(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=e,this.littleEndian="undefined"!=typeof n?!!n:!1,this.noAssert=!!i};t.VERSION="3.1.0",t.LITTLE_ENDIAN=!0,t.BIG_ENDIAN=!1,t.DEFAULT_CAPACITY=16,t.DEFAULT_ENDIAN=t.BIG_ENDIAN,t.DEFAULT_NOASSERT=!1,t.Long=e||null;var r=new ArrayBuffer(0);t.allocate=function(e,r,n){return new t(e,r,n)},t.concat=function(e,r,n,i){("boolean"==typeof r||"string"!=typeof r)&&(i=n,n=r,r=void 0);for(var o,a=0,s=0,c=e.length;c>s;++s)t.isByteBuffer(e[s])||(e[s]=t.wrap(e[s],r)),o=e[s].limit-e[s].offset,o>0&&(a+=o);if(0===a)return new t(0,n,i);var d,u=new t(a,n,i),l=new Uint8Array(u.buffer);for(s=0;c>s;)d=e[s++],o=d.limit-d.offset,0>=o||(l.set(new Uint8Array(d.buffer).subarray(d.offset,d.limit),u.offset),u.offset+=o);return u.limit=u.offset,u.offset=0,u},t.isByteBuffer=function(e){return e&&e instanceof t},t.type=function(){return ArrayBuffer},t.wrap=function(e,r,n,o){if("string"!=typeof r&&(o=n,n=r,r=void 0),"string"==typeof e)switch("undefined"==typeof r&&(r="utf8"),r){case"base64":return t.fromBase64(e,n);case"hex":return t.fromHex(e,n);case"binary":return t.fromBinary(e,n);case"utf8":return t.fromUTF8(e,n);case"debug":return t.fromDebug(e,n);default:throw new TypeError("Unsupported encoding: "+r)}if(null===e||"object"!=typeof e)throw new TypeError("Illegal buffer: null or non-object");var a;if(t.isByteBuffer(e))return a=t.prototype.clone.call(e),a.markedOffset=-1,a;if(e instanceof Uint8Array)a=new t(0,n,o),e.length>0&&(a.buffer=e.buffer,a.offset=e.byteOffset,a.limit=e.byteOffset+e.length,a.view=e.length>0?new DataView(e.buffer):null);else if(e instanceof ArrayBuffer)a=new t(0,n,o),e.byteLength>0&&(a.buffer=e,a.offset=0,a.limit=e.byteLength,a.view=e.byteLength>0?new DataView(e):null);else{if("[object Array]"!==Object.prototype.toString.call(e))throw new TypeError("Illegal buffer");for(a=new t(e.length,n,o),a.limit=e.length,i=0;i<e.length;++i)a.view.setUint8(i,e[i])}return a},t.prototype.writeInt8=function(e,t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=1;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=1,this.view.setInt8(t,e),r&&(this.offset+=1),this},t.prototype.writeByte=t.prototype.writeInt8,t.prototype.readInt8=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+1>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=this.view.getInt8(e);return t&&(this.offset+=1),r},t.prototype.readByte=t.prototype.readInt8,t.prototype.writeUint8=function(e,t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=1;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=1,this.view.setUint8(t,e),r&&(this.offset+=1),this},t.prototype.readUint8=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+1>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=this.view.getUint8(e);return t&&(this.offset+=1),r},t.prototype.writeInt16=function(e,t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=2;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=2,this.view.setInt16(t,e,this.littleEndian),r&&(this.offset+=2),this},t.prototype.writeShort=t.prototype.writeInt16,t.prototype.readInt16=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+2>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var r=this.view.getInt16(e,this.littleEndian);return t&&(this.offset+=2),r},t.prototype.readShort=t.prototype.readInt16,t.prototype.writeUint16=function(e,t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=2;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=2,this.view.setUint16(t,e,this.littleEndian),r&&(this.offset+=2),this},t.prototype.readUint16=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+2>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var r=this.view.getUint16(e,this.littleEndian);return t&&(this.offset+=2),r},t.prototype.writeInt32=function(e,t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=4,this.view.setInt32(t,e,this.littleEndian),r&&(this.offset+=4),this},t.prototype.writeInt=t.prototype.writeInt32,t.prototype.readInt32=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+4>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=this.view.getInt32(e,this.littleEndian);return t&&(this.offset+=4),r},t.prototype.readInt=t.prototype.readInt32,t.prototype.writeUint32=function(e,t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=4,this.view.setUint32(t,e,this.littleEndian),r&&(this.offset+=4),this},t.prototype.readUint32=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+4>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=this.view.getUint32(e,this.littleEndian);return t&&(this.offset+=4),r},e&&(t.prototype.writeInt64=function(t,r){var n="undefined"==typeof r;if(n&&(r=this.offset),!this.noAssert){if("number"==typeof t)t=e.fromNumber(t);else if(!(t&&t instanceof e))throw new TypeError("Illegal value: "+t+" (not an integer or Long)");if("number"!=typeof r||r%1!==0)throw new TypeError("Illegal offset: "+r+" (not an integer)");if(r>>>=0,0>r||r+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}"number"==typeof t&&(t=e.fromNumber(t)),r+=8;var i=this.buffer.byteLength;return r>i&&this.resize((i*=2)>r?i:r),r-=8,this.littleEndian?(this.view.setInt32(r,t.low,!0),this.view.setInt32(r+4,t.high,!0)):(this.view.setInt32(r,t.high,!1),this.view.setInt32(r+4,t.low,!1)),n&&(this.offset+=8),this},t.prototype.writeLong=t.prototype.writeInt64,t.prototype.readInt64=function(t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+8>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var n=this.littleEndian?new e(this.view.getInt32(t,!0),this.view.getInt32(t+4,!0),!1):new e(this.view.getInt32(t+4,!1),this.view.getInt32(t,!1),!1);return r&&(this.offset+=8),n},t.prototype.readLong=t.prototype.readInt64,t.prototype.writeUint64=function(t,r){var n="undefined"==typeof r;if(n&&(r=this.offset),!this.noAssert){if("number"==typeof t)t=e.fromNumber(t);else if(!(t&&t instanceof e))throw new TypeError("Illegal value: "+t+" (not an integer or Long)");if("number"!=typeof r||r%1!==0)throw new TypeError("Illegal offset: "+r+" (not an integer)");if(r>>>=0,0>r||r+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}"number"==typeof t&&(t=e.fromNumber(t)),r+=8;var i=this.buffer.byteLength;return r>i&&this.resize((i*=2)>r?i:r),r-=8,this.littleEndian?(this.view.setInt32(r,t.low,!0),this.view.setInt32(r+4,t.high,!0)):(this.view.setInt32(r,t.high,!1),this.view.setInt32(r+4,t.low,!1)),n&&(this.offset+=8),this},t.prototype.readUint64=function(t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+8>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var n=this.littleEndian?new e(this.view.getInt32(t,!0),this.view.getInt32(t+4,!0),!0):new e(this.view.getInt32(t+4,!1),this.view.getInt32(t,!1),!0);return r&&(this.offset+=8),n}),t.prototype.writeFloat32=function(e,t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw new TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=4,this.view.setFloat32(t,e,this.littleEndian),r&&(this.offset+=4),this},t.prototype.writeFloat=t.prototype.writeFloat32,t.prototype.readFloat32=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+4>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=this.view.getFloat32(e,this.littleEndian);return t&&(this.offset+=4),r},t.prototype.readFloat=t.prototype.readFloat32,t.prototype.writeFloat64=function(e,t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw new TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=8;var n=this.buffer.byteLength;return t>n&&this.resize((n*=2)>t?n:t),t-=8,this.view.setFloat64(t,e,this.littleEndian),r&&(this.offset+=8),this},t.prototype.writeDouble=t.prototype.writeFloat64,t.prototype.readFloat64=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+8>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var r=this.view.getFloat64(e,this.littleEndian);return t&&(this.offset+=8),r},t.prototype.readDouble=t.prototype.readFloat64,t.MAX_VARINT32_BYTES=5,t.calculateVarint32=function(e){return e>>>=0,128>e?1:16384>e?2:1<<21>e?3:1<<28>e?4:5},t.zigZagEncode32=function(e){return((e|=0)<<1^e>>31)>>>0},t.zigZagDecode32=function(e){return e>>>1^-(1&e)|0},t.prototype.writeVarint32=function(e,r){var n="undefined"==typeof r;if(n&&(r=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof r||r%1!==0)throw new TypeError("Illegal offset: "+r+" (not an integer)");if(r>>>=0,0>r||r+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var i,o=t.calculateVarint32(e);r+=o;var a=this.buffer.byteLength;return r>a&&this.resize((a*=2)>r?a:r),r-=o,this.view.setUint8(r,i=128|e),e>>>=0,e>=128?(i=e>>7|128,this.view.setUint8(r+1,i),e>=16384?(i=e>>14|128,this.view.setUint8(r+2,i),e>=1<<21?(i=e>>21|128,this.view.setUint8(r+3,i),e>=1<<28?(this.view.setUint8(r+4,e>>28&15),o=5):(this.view.setUint8(r+3,127&i),o=4)):(this.view.setUint8(r+2,127&i),o=3)):(this.view.setUint8(r+1,127&i),o=2)):(this.view.setUint8(r,127&i),o=1),n?(this.offset+=o,this):o},t.prototype.writeVarint32ZigZag=function(e,r){return this.writeVarint32(t.zigZagEncode32(e),r)},t.prototype.readVarint32=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+1>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r,n=0,i=0;do r=this.view.getUint8(e+n),5>n&&(i|=(127&r)<<7*n>>>0),++n;while(128===(128&r));return i=0|i,t?(this.offset+=n,i):{value:i,length:n}},t.prototype.readVarint32ZigZag=function(e){var r=this.readVarint32(e);return"object"==typeof r?r.value=t.zigZagDecode32(r.value):r=t.zigZagDecode32(r),r},e&&(t.MAX_VARINT64_BYTES=10,t.calculateVarint64=function(t){"number"==typeof t&&(t=e.fromNumber(t));var r=t.toInt()>>>0,n=t.shiftRightUnsigned(28).toInt()>>>0,i=t.shiftRightUnsigned(56).toInt()>>>0;return 0==i?0==n?16384>r?128>r?1:2:1<<21>r?3:4:16384>n?128>n?5:6:1<<21>n?7:8:128>i?9:10},t.zigZagEncode64=function(t){return"number"==typeof t?t=e.fromNumber(t,!1):t.unsigned!==!1&&(t=t.toSigned()),t.shiftLeft(1).xor(t.shiftRight(63)).toUnsigned()},t.zigZagDecode64=function(t){return"number"==typeof t?t=e.fromNumber(t,!1):t.unsigned!==!1&&(t=t.toSigned()),t.shiftRightUnsigned(1).xor(t.and(e.ONE).toSigned().negate()).toSigned()},t.prototype.writeVarint64=function(r,n){var i="undefined"==typeof n;if(i&&(n=this.offset),!this.noAssert){if("number"==typeof r)r=e.fromNumber(r);else if(!(r&&r instanceof e))throw new TypeError("Illegal value: "+r+" (not an integer or Long)");if("number"!=typeof n||n%1!==0)throw new TypeError("Illegal offset: "+n+" (not an integer)");if(n>>>=0,0>n||n+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}"number"==typeof r?r=e.fromNumber(r,!1):r.unsigned!==!1&&(r=r.toSigned());var o=t.calculateVarint64(r),a=r.toInt()>>>0,s=r.shiftRightUnsigned(28).toInt()>>>0,c=r.shiftRightUnsigned(56).toInt()>>>0;n+=o;var d=this.buffer.byteLength;switch(n>d&&this.resize((d*=2)>n?d:n),n-=o,o){case 10:this.view.setUint8(n+9,c>>>7&1);case 9:this.view.setUint8(n+8,9!==o?128|c:127&c);case 8:this.view.setUint8(n+7,8!==o?s>>>21|128:s>>>21&127);case 7:this.view.setUint8(n+6,7!==o?s>>>14|128:s>>>14&127);case 6:this.view.setUint8(n+5,6!==o?s>>>7|128:s>>>7&127);case 5:this.view.setUint8(n+4,5!==o?128|s:127&s);case 4:this.view.setUint8(n+3,4!==o?a>>>21|128:a>>>21&127);case 3:this.view.setUint8(n+2,3!==o?a>>>14|128:a>>>14&127);case 2:this.view.setUint8(n+1,2!==o?a>>>7|128:a>>>7&127);case 1:this.view.setUint8(n,1!==o?128|a:127&a)}return i?(this.offset+=o,this):o},t.prototype.writeVarint64ZigZag=function(e,r){return this.writeVarint64(t.zigZagEncode64(e),r)},t.prototype.readVarint64=function(t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+1>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n=t,i=0,o=0,a=0,s=0;if(s=this.view.getUint8(t++),i=127&s,128&s&&(s=this.view.getUint8(t++),i|=(127&s)<<7,128&s&&(s=this.view.getUint8(t++),i|=(127&s)<<14,128&s&&(s=this.view.getUint8(t++),i|=(127&s)<<21,128&s&&(s=this.view.getUint8(t++),o=127&s,128&s&&(s=this.view.getUint8(t++),o|=(127&s)<<7,128&s&&(s=this.view.getUint8(t++),o|=(127&s)<<14,128&s&&(s=this.view.getUint8(t++),o|=(127&s)<<21,128&s&&(s=this.view.getUint8(t++),a=127&s,128&s&&(s=this.view.getUint8(t++),a|=(127&s)<<7,128&s))))))))))throw new Error("Data must be corrupt: Buffer overrun");var c=e.from28Bits(i,o,a,!1);return r?(this.offset=t,c):{value:c,length:t-n}},t.prototype.readVarint64ZigZag=function(r){var n=this.readVarint64(r);return n&&n.value instanceof e?n.value=t.zigZagDecode64(n.value):n=t.zigZagDecode64(n),n}),t.prototype.writeCString=function(e,t){var r="undefined"==typeof t;r&&(t=this.offset);var n,i=e.length;if(!this.noAssert){if("string"!=typeof e)throw new TypeError("Illegal str: Not a string");for(n=0;i>n;++n)if(0===e.charCodeAt(n))throw new RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var a=t;i=o.calculateUTF16asUTF8(o.stringSource(e))[1],t+=i+1;var s=this.buffer.byteLength;return t>s&&this.resize((s*=2)>t?s:t),t-=i+1,o.encodeUTF16toUTF8(o.stringSource(e),function(e){this.view.setUint8(t++,e)}.bind(this)),this.view.setUint8(t++,0),r?(this.offset=t-a,this):i},t.prototype.readCString=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+1>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r,n=e,i=-1;return o.decodeUTF8toUTF16(function(){if(0===i)return null;if(e>=this.limit)throw RangeError("Illegal range: Truncated data, "+e+" < "+this.limit);return 0===(i=this.view.getUint8(e++))?null:i}.bind(this),r=o.stringDestination(),!0),t?(this.offset=e,r()):{string:r(),length:e-n}},t.prototype.writeIString=function(e,t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("string"!=typeof e)throw new TypeError("Illegal str: Not a string");if("number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n,i=t;n=o.calculateUTF16asUTF8(o.stringSource(e),this.noAssert)[1],t+=4+n;var a=this.buffer.byteLength;if(t>a&&this.resize((a*=2)>t?a:t),t-=4+n,this.view.setUint32(t,n,this.littleEndian),t+=4,o.encodeUTF16toUTF8(o.stringSource(e),function(e){this.view.setUint8(t++,e)}.bind(this)),t!==i+4+n)throw new RangeError("Illegal range: Truncated data, "+t+" == "+(t+4+n));return r?(this.offset=t,this):t-i},t.prototype.readIString=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+4>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r,n=0,i=e;n=this.view.getUint32(e,this.littleEndian),e+=4;var a,s=e+n;return o.decodeUTF8toUTF16(function(){return s>e?this.view.getUint8(e++):null}.bind(this),a=o.stringDestination(),this.noAssert),r=a(),t?(this.offset=e,r):{string:r,length:e-i}},t.METRICS_CHARS="c",t.METRICS_BYTES="b",t.prototype.writeUTF8String=function(e,t){var r="undefined"==typeof t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: "+t+" (not an integer)");if(t>>>=0,0>t||t+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n,i=t;n=o.calculateUTF16asUTF8(o.stringSource(e))[1],t+=n;var a=this.buffer.byteLength;return t>a&&this.resize((a*=2)>t?a:t),t-=n,o.encodeUTF16toUTF8(o.stringSource(e),function(e){this.view.setUint8(t++,e)}.bind(this)),r?(this.offset=t,this):t-i},t.prototype.writeString=t.prototype.writeUTF8String,t.calculateUTF8Chars=function(e){return o.calculateUTF16asUTF8(o.stringSource(e))[0]},t.calculateUTF8Bytes=function(e){return o.calculateUTF16asUTF8(o.stringSource(e))[1]},t.prototype.readUTF8String=function(e,r,n){"number"==typeof r&&(n=r,r=void 0);var i="undefined"==typeof n;if(i&&(n=this.offset),"undefined"==typeof r&&(r=t.METRICS_CHARS),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal length: "+e+" (not an integer)");if(e|=0,"number"!=typeof n||n%1!==0)throw new TypeError("Illegal offset: "+n+" (not an integer)");if(n>>>=0,0>n||n+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}var a,s=0,c=n;if(r===t.METRICS_CHARS){if(a=o.stringDestination(),o.decodeUTF8(function(){return e>s&&n<this.limit?this.view.getUint8(n++):null}.bind(this),function(e){++s,o.UTF8toUTF16(e,a)}.bind(this)),s!==e)throw new RangeError("Illegal range: Truncated data, "+s+" == "+e);return i?(this.offset=n,a()):{string:a(),length:n-c}}if(r===t.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof n||n%1!==0)throw new TypeError("Illegal offset: "+n+" (not an integer)");if(n>>>=0,0>n||n+e>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+n+" (+"+e+") <= "+this.buffer.byteLength)}var d=n+e;if(o.decodeUTF8toUTF16(function(){return d>n?this.view.getUint8(n++):null}.bind(this),a=o.stringDestination(),this.noAssert),n!==d)throw new RangeError("Illegal range: Truncated data, "+n+" == "+d);return i?(this.offset=n,a()):{string:a(),length:n-c}}throw new TypeError("Unsupported metrics: "+r)},t.prototype.readString=t.prototype.readUTF8String,t.prototype.writeVString=function(e,r){var n="undefined"==typeof r;if(n&&(r=this.offset),!this.noAssert){if("string"!=typeof e)throw new TypeError("Illegal str: Not a string");if("number"!=typeof r||r%1!==0)throw new TypeError("Illegal offset: "+r+" (not an integer)");if(r>>>=0,0>r||r+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var i,a,s=r;i=o.calculateUTF16asUTF8(o.stringSource(e),this.noAssert)[1],a=t.calculateVarint32(i),r+=a+i;var c=this.buffer.byteLength;if(r>c&&this.resize((c*=2)>r?c:r),r-=a+i,r+=this.writeVarint32(i,r),o.encodeUTF16toUTF8(o.stringSource(e),function(e){this.view.setUint8(r++,e)}.bind(this)),r!==s+i+a)throw new RangeError("Illegal range: Truncated data, "+r+" == "+(r+i+a));return n?(this.offset=r,this):r-s},t.prototype.readVString=function(e){var t="undefined"==typeof e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+1>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r,n=this.readVarint32(e),i=e;e+=n.length,n=n.value;var a=e+n,s=o.stringDestination();return o.decodeUTF8toUTF16(function(){return a>e?this.view.getUint8(e++):null}.bind(this),s,this.noAssert),r=s(),t?(this.offset=e,r):{string:r,length:e-i}},t.prototype.append=function(e,r,n){("number"==typeof r||"string"!=typeof r)&&(n=r,r=void 0);var i="undefined"==typeof n;if(i&&(n=this.offset),!this.noAssert){if("number"!=typeof n||n%1!==0)throw new TypeError("Illegal offset: "+n+" (not an integer)");if(n>>>=0,0>n||n+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}e instanceof t||(e=t.wrap(e,r));var o=e.limit-e.offset;if(0>=o)return this;n+=o;var a=this.buffer.byteLength;return n>a&&this.resize((a*=2)>n?a:n),n-=o,new Uint8Array(this.buffer,n).set(new Uint8Array(e.buffer).subarray(e.offset,e.limit)),e.offset+=o,i&&(this.offset+=o),this},t.prototype.appendTo=function(e,t){return e.append(this,t),this},t.prototype.assert=function(e){return this.noAssert=!e,this},t.prototype.capacity=function(){return this.buffer.byteLength},t.prototype.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},t.prototype.clone=function(e){var r=new t(0,this.littleEndian,this.noAssert);if(e){var n=new ArrayBuffer(this.buffer.byteLength);new Uint8Array(n).set(this.buffer),r.buffer=n,r.view=new DataView(n)}else r.buffer=this.buffer,r.view=this.view;return r.offset=this.offset,r.markedOffset=this.markedOffset,r.limit=this.limit,r},t.prototype.compact=function(e,t){if("undefined"==typeof e&&(e=this.offset),"undefined"==typeof t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal end: Not an integer");if(t>>>=0,0>e||e>t||t>this.buffer.byteLength)throw new RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}if(0===e&&t===this.buffer.byteLength)return this;var n=t-e;if(0===n)return this.buffer=r,this.view=null,this.markedOffset>=0&&(this.markedOffset-=e),this.offset=0,this.limit=0,this;var i=new ArrayBuffer(n);return new Uint8Array(i).set(new Uint8Array(this.buffer).subarray(e,t)),this.buffer=i,this.view=new DataView(i),this.markedOffset>=0&&(this.markedOffset-=e),this.offset=0,this.limit=n,this},t.prototype.copy=function(e,r){if("undefined"==typeof e&&(e=this.offset),"undefined"==typeof r&&(r=this.limit),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof r||r%1!==0)throw new TypeError("Illegal end: Not an integer");if(r>>>=0,0>e||e>r||r>this.buffer.byteLength)throw new RangeError("Illegal range: 0 <= "+e+" <= "+r+" <= "+this.buffer.byteLength)}if(e===r)return new t(0,this.littleEndian,this.noAssert);var n=r-e,i=new t(n,this.littleEndian,this.noAssert);return i.offset=0,i.limit=n,i.markedOffset>=0&&(i.markedOffset-=e),this.copyTo(i,0,e,r),i},t.prototype.copyTo=function(e,r,n,i){var o,a;if(!this.noAssert&&!t.isByteBuffer(e))throw new TypeError("Illegal target: Not a ByteBuffer");if(r=(a="undefined"==typeof r)?e.offset:0|r,n=(o="undefined"==typeof n)?this.offset:0|n,i="undefined"==typeof i?this.limit:0|i,0>r||r>e.buffer.byteLength)throw new RangeError("Illegal target range: 0 <= "+r+" <= "+e.buffer.byteLength);if(0>n||i>this.buffer.byteLength)throw new RangeError("Illegal source range: 0 <= "+n+" <= "+this.buffer.byteLength);var s=i-n;return 0===s?e:(e.ensureCapacity(r+s),new Uint8Array(e.buffer).set(new Uint8Array(this.buffer).subarray(n,i),r),o&&(this.offset+=s),a&&(e.offset+=s),this)},t.prototype.ensureCapacity=function(e){var t=this.buffer.byteLength;return e>t?this.resize((t*=2)>e?t:e):this},t.prototype.fill=function(e,t,r){var n="undefined"==typeof t;if(n&&(t=this.offset),"string"==typeof e&&e.length>0&&(e=e.charCodeAt(0)),"undefined"==typeof t&&(t=this.offset),"undefined"==typeof r&&(r=this.limit),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof r||r%1!==0)throw new TypeError("Illegal end: Not an integer");if(r>>>=0,0>t||t>r||r>this.buffer.byteLength)throw new RangeError("Illegal range: 0 <= "+t+" <= "+r+" <= "+this.buffer.byteLength)}if(t>=r)return this;for(;r>t;)this.view.setUint8(t++,e);return n&&(this.offset=t),this},t.prototype.flip=function(){return this.limit=this.offset,this.offset=0,this},t.prototype.mark=function(e){if(e="undefined"==typeof e?this.offset:e,!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=e,this},t.prototype.order=function(e){if(!this.noAssert&&"boolean"!=typeof e)throw new TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!e,this},t.prototype.LE=function(e){return this.littleEndian="undefined"!=typeof e?!!e:!0,this},t.prototype.BE=function(e){return this.littleEndian="undefined"!=typeof e?!e:!1,this},t.prototype.prepend=function(e,r,n){("number"==typeof r||"string"!=typeof r)&&(n=r,r=void 0);var i="undefined"==typeof n;if(i&&(n=this.offset),!this.noAssert){if("number"!=typeof n||n%1!==0)throw new TypeError("Illegal offset: "+n+" (not an integer)");if(n>>>=0,0>n||n+0>this.buffer.byteLength)throw new RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}e instanceof t||(e=t.wrap(e,r));var o=e.limit-e.offset;if(0>=o)return this;var a,s=o-n;if(s>0){var c=new ArrayBuffer(this.buffer.byteLength+s);a=new Uint8Array(c),a.set(new Uint8Array(this.buffer).subarray(n,this.buffer.byteLength),o),this.buffer=c,this.view=new DataView(c),this.offset+=s,this.markedOffset>=0&&(this.markedOffset+=s),this.limit+=s,n+=s}else a=new Uint8Array(this.buffer);return a.set(new Uint8Array(e.buffer).subarray(e.offset,e.limit),n-o),e.offset=e.limit,i&&(this.offset-=o),this},t.prototype.prependTo=function(e,t){return e.prepend(this,t),this},t.prototype.printDebug=function(e){"function"!=typeof e&&(e=console.log.bind(console)),e(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},t.prototype.remaining=function(){return this.limit-this.offset},t.prototype.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},t.prototype.resize=function(e){if(!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal capacity: "+e+" (not an integer)");if(e|=0,0>e)throw new RangeError("Illegal capacity: 0 <= "+e)}if(this.buffer.byteLength<e){var t=new ArrayBuffer(e);new Uint8Array(t).set(new Uint8Array(this.buffer)),this.buffer=t,this.view=new DataView(t)}return this},t.prototype.reverse=function(e,t){if("undefined"==typeof e&&(e=this.offset),"undefined"==typeof t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal end: Not an integer");if(t>>>=0,0>e||e>t||t>this.buffer.byteLength)throw new RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}return e===t?this:(Array.prototype.reverse.call(new Uint8Array(this.buffer).subarray(e,t)),this.view=new DataView(this.buffer),this)},t.prototype.skip=function(e){if(!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal length: "+e+" (not an integer)");e|=0}var t=this.offset+e;if(!this.noAssert&&(0>t||t>this.buffer.byteLength))throw new RangeError("Illegal length: 0 <= "+this.offset+" + "+e+" <= "+this.buffer.byteLength);
return this.offset=t,this},t.prototype.slice=function(e,t){if("undefined"==typeof e&&(e=this.offset),"undefined"==typeof t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal end: Not an integer");if(t>>>=0,0>e||e>t||t>this.buffer.byteLength)throw new RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}var r=this.clone();return r.offset=e,r.limit=t,r},t.prototype.toBuffer=function(e){var t=this.offset,n=this.limit;if(t>n){var i=t;t=n,n=i}if(!this.noAssert){if("number"!=typeof t||t%1!==0)throw new TypeError("Illegal offset: Not an integer");if(t>>>=0,"number"!=typeof n||n%1!==0)throw new TypeError("Illegal limit: Not an integer");if(n>>>=0,0>t||t>n||n>this.buffer.byteLength)throw new RangeError("Illegal range: 0 <= "+t+" <= "+n+" <= "+this.buffer.byteLength)}if(!e&&0===t&&n===this.buffer.byteLength)return this.buffer;if(t===n)return r;var o=new ArrayBuffer(n-t);return new Uint8Array(o).set(new Uint8Array(this.buffer).subarray(t,n),0),o},t.prototype.toArrayBuffer=t.prototype.toBuffer,t.prototype.toString=function(e){if("undefined"==typeof e)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch(e){case"utf8":return this.toUTF8();case"base64":return this.toBase64();case"hex":return this.toHex();case"binary":return this.toBinary();case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw new Error("Unsupported encoding: "+e)}};var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n+="",t.prototype.toBase64=function(e,t){if("undefined"==typeof e&&(e=this.offset),"undefined"==typeof t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal end: Not an integer");if(t>>>=0,0>e||e>t||t>this.buffer.byteLength)throw new RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}if(e===t)return"";for(var r,i,o,a,s,c,d,u,l,p="";t>e;)r=this.view.getUint8(e++),i=(a=t>e)?this.view.getUint8(e++):0,o=(s=t>e)?this.view.getUint8(e++):0,c=r>>2,d=(3&r)<<4|i>>4,u=(15&i)<<2|o>>6,l=63&o,s||(l=64,a||(u=64)),p+=n.charAt(c)+n.charAt(d)+n.charAt(u)+n.charAt(l);return p},t.fromBase64=function(e,r,i){if(!i){if("string"!=typeof e)throw new TypeError("Illegal str: Not a string");if(e.length%4!==0)throw new TypeError("Illegal str: Length not a multiple of 4")}var o,a,s=e.length,c=0;for(o=e.length-1;o>=0&&"="===e.charAt(o);--o)c++;if(c>2)throw new TypeError("Illegal str: Suffix is too large");if(0===s)return new t(0,r,i);var d,u,l,p,h,f,m,g=new t(s/4*3-c,r,i);for(o=0,a=0;s>o;){if(d=n.indexOf(e.charAt(o++)),u=(h=s>o)?n.indexOf(e.charAt(o++)):0,l=(f=s>o)?n.indexOf(e.charAt(o++)):0,p=(m=s>o)?n.indexOf(e.charAt(o++)):0,!i&&(0>d||0>u||0>l||0>p))throw new TypeError("Illegal str: Contains non-base64 characters");g.view.setUint8(a++,d<<2|u>>4),64!==l&&(g.view.setUint8(a++,u<<4&240|l>>2,a),64!==p&&g.view.setUint8(a++,l<<6&192|p))}return g.limit=a,g},t.btoa=function(e){return t.fromBinary(e).toBase64()},t.atob=function(e){return t.fromBase64(e).toBinary()},t.prototype.toBinary=function(e,t){if(e="undefined"==typeof e?this.offset:e,t="undefined"==typeof t?this.limit:t,!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal end: Not an integer");if(t>>>=0,0>e||e>t||t>this.buffer.byteLength)throw new RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}if(e===t)return"";for(var r=[];t>e;)r.push(this.view.getUint8(e++));return String.fromCharCode.apply(String,r)},t.fromBinary=function(e,r,n){if(!n&&"string"!=typeof e)throw new TypeError("Illegal str: Not a string");for(var i,o=0,a=e.length,s=new t(a,r,n);a>o;){if(i=e.charCodeAt(o),!n&&i>255)throw new TypeError("Illegal charCode at "+o+": 0 <= "+i+" <= 255");s.view.setUint8(o++,i)}return s.limit=a,s},t.prototype.toDebug=function(e){for(var t,r=-1,n=this.buffer.byteLength,i="",o="",a="";n>r;){if(-1!==r&&(t=this.view.getUint8(r),i+=16>t?"0"+t.toString(16).toUpperCase():t.toString(16).toUpperCase(),e&&(o+=t>32&&127>t?String.fromCharCode(t):".")),++r,e&&r>0&&r%16===0&&r!==n){for(;i.length<51;)i+=" ";a+=i+o+"\n",i=o=""}i+=r===this.offset&&r===this.limit?r===this.markedOffset?"!":"|":r===this.offset?r===this.markedOffset?"[":"<":r===this.limit?r===this.markedOffset?"]":">":r===this.markedOffset?"'":e||0!==r&&r!==n?" ":""}if(e&&" "!==i){for(;i.length<51;)i+=" ";a+=i+o+"\n"}return e?a:i},t.fromDebug=function(e,r,n){for(var i,o,a=e.length,s=new t((a+1)/3|0,r,n),c=0,d=0,u=!1,l=!1,p=!1,h=!1,f=!1;a>c;){switch(i=e.charAt(c++)){case"!":if(!n){if(l||p||h){f=!0;break}l=p=h=!0}s.offset=s.markedOffset=s.limit=d,u=!1;break;case"|":if(!n){if(l||h){f=!0;break}l=h=!0}s.offset=s.limit=d,u=!1;break;case"[":if(!n){if(l||p){f=!0;break}l=p=!0}s.offset=s.markedOffset=d,u=!1;break;case"<":if(!n){if(l){f=!0;break}l=!0}s.offset=d,u=!1;break;case"]":if(!n){if(h||p){f=!0;break}h=p=!0}s.limit=s.markedOffset=d,u=!1;break;case">":if(!n){if(h){f=!0;break}h=!0}s.limit=d,u=!1;break;case"'":if(!n){if(p){f=!0;break}p=!0}s.markedOffset=d,u=!1;break;case" ":u=!1;break;default:if(!n&&u){f=!0;break}if(o=parseInt(i+e.charAt(c++),16),!n&&(isNaN(o)||0>o||o>255))throw new TypeError("Illegal str: Not a debug encoded string");s.view.setUint8(d++,o),u=!0}if(f)throw new TypeError("Illegal str: Invalid symbol at "+c)}if(!n){if(!l||!h)throw new TypeError("Illegal str: Missing offset or limit");if(d<s.buffer.byteLength)throw new TypeError("Illegal str: Not a debug encoded string (is it hex?) "+d+" < "+a)}return s},t.prototype.toHex=function(e,t){if(e="undefined"==typeof e?this.offset:e,t="undefined"==typeof t?this.limit:t,!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal end: Not an integer");if(t>>>=0,0>e||e>t||t>this.buffer.byteLength)throw new RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}for(var r,n=new Array(t-e);t>e;)r=this.view.getUint8(e++),16>r?n.push("0",r.toString(16)):n.push(r.toString(16));return n.join("")},t.fromHex=function(e,r,n){if(!n){if("string"!=typeof e)throw new TypeError("Illegal str: Not a string");if(e.length%2!==0)throw new TypeError("Illegal str: Length not a multiple of 2")}for(var i,o=e.length,a=new t(o/2|0,r),s=0,c=0;o>s;s+=2){if(i=parseInt(e.substring(s,s+2),16),!n&&(!isFinite(i)||0>i||i>255))throw new TypeError("Illegal str: Contains non-hex characters");a.view.setUint8(c++,i)}return a.limit=c,a};var o=function(){var e={};return e.encodeUTF8=function(e,t){var r=null;for("number"==typeof e&&(r=e,e=function(){return null});null!==r||null!==(r=e());)128>r?t(127&r):2048>r?(t(r>>6&31|192),t(63&r|128)):65536>r?(t(r>>12&15|224),t(r>>6&63|128),t(63&r|128)):(t(r>>18&7|240),t(r>>12&63|128),t(r>>6&63|128),t(63&r|128)),r=null},e.decodeUTF8=function(e,t){for(var r,n,i,o,a=function(e){e=e.slice(0,e.indexOf(null));var t=Error(e.toString());throw t.name="TruncatedError",t.bytes=e,t};null!==(r=e());)if(0===(128&r))t(r);else if(192===(224&r))null===(n=e())&&a([r,n]),t((31&r)<<6|63&n);else if(224===(240&r))(null===(n=e())||null===(i=e()))&&a([r,n,i]),t((15&r)<<12|(63&n)<<6|63&i);else{if(240!==(248&r))throw RangeError("Illegal starting byte: "+r);(null===(n=e())||null===(i=e())||null===(o=e()))&&a([r,n,i,o]),t((7&r)<<18|(63&n)<<12|(63&i)<<6|63&o)}},e.UTF16toUTF8=function(e,t){for(var r,n=null;;){if(null===(r=null!==n?n:e()))break;r>=55296&&57343>=r&&null!==(n=e())&&n>=56320&&57343>=n?(t(1024*(r-55296)+n-56320+65536),n=null):t(r)}null!==n&&t(n)},e.UTF8toUTF16=function(e,t){var r=null;for("number"==typeof e&&(r=e,e=function(){return null});null!==r||null!==(r=e());)65535>=r?t(r):(r-=65536,t((r>>10)+55296),t(r%1024+56320)),r=null},e.encodeUTF16toUTF8=function(t,r){e.UTF16toUTF8(t,function(t){e.encodeUTF8(t,r)})},e.decodeUTF8toUTF16=function(t,r){e.decodeUTF8(t,function(t){e.UTF8toUTF16(t,r)})},e.assertByte=function(e){if("number"!=typeof e||e!==e)throw TypeError("Illegal byte: "+typeof e);if(-128>e||e>255)throw RangeError("Illegal byte: "+e);return e},e.assertCharCode=function(e){if("number"!=typeof e||e!==e)throw TypeError("Illegal char code: "+typeof e);if(0>e||e>65535)throw RangeError("Illegal char code: "+e);return e},e.assertCodePoint=function(e){if("number"!=typeof e||e!==e)throw TypeError("Illegal code point: "+typeof e);if(0>e||e>1114111)throw RangeError("Illegal code point: "+e);return e},e.calculateCodePoint=function(e){return 128>e?1:2048>e?2:65536>e?3:4},e.calculateUTF8=function(t){for(var r,n=0;null!==(r=t());)n+=e.calculateCodePoint(r);return n},e.calculateUTF16asUTF8=function(t){var r=0,n=0;return e.UTF16toUTF8(t,function(t){++r,n+=e.calculateCodePoint(t)}),[r,n]},e}(),a=String.fromCharCode;return o.stringSource=function(e){var t=0;return function(){return t<e.length?e.charCodeAt(t++):null}},o.stringDestination=function(){var e=[],t=[];return function(){return 0===arguments.length?t.join("")+a.apply(String,e):(e.length+arguments.length>1024&&(t.push(a.apply(String,e)),e.length=0),void Array.prototype.push.apply(e,arguments))}},t.prototype.toUTF8=function(e,t){if("undefined"==typeof e&&(e=this.offset),"undefined"==typeof t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!==0)throw new TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!==0)throw new TypeError("Illegal end: Not an integer");if(t>>>=0,0>e||e>t||t>this.buffer.byteLength)throw new RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}var r,n=this;try{o.decodeUTF8toUTF16(function(){return t>e?n.view.getUint8(e++):null},r=o.stringDestination())}catch(i){if(e!==t)throw new RangeError("Illegal range: Truncated data, "+e+" != "+t)}return r()},t.fromUTF8=function(e,r,n){if(!n&&"string"!=typeof e)throw new TypeError("Illegal str: Not a string");var i=new t(o.calculateUTF16asUTF8(o.stringSource(e),!0)[1],r,n),a=0;return o.encodeUTF16toUTF8(o.stringSource(e),function(e){i.view.setUint8(a++,e)}),i.limit=a,i},t}e.exports=n(r(158))}(this)}).call(t,r(157)(e))},,function(e,t,r){var n,i;(function(e){/**
	 * @license Long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
	 * Released under the Apache License, Version 2.0
	 * Derived from goog.math.Long from the Closure Library
	 * see: https://github.com/dcodeIO/Long.js for details
	 */
!function(o){"use strict";var a=function(e,t,r){e&&"object"==typeof e&&(t=e.high,r=e.unsigned,e=e.low),this.low=0|e,this.high=0|t,this.unsigned=!!r},s={},c={};a.fromInt=function(e,t){var r,n;return t?(e>>>=0,e>=0&&256>e&&(n=c[e])?n:(r=new a(e,0>(0|e)?-1:0,!0),e>=0&&256>e&&(c[e]=r),r)):(e=0|e,e>=-128&&128>e&&(n=s[e])?n:(r=new a(e,0>e?-1:0,!1),e>=-128&&128>e&&(s[e]=r),r))},a.fromNumber=function(e,t){return t=!!t,isNaN(e)||!isFinite(e)?a.ZERO:!t&&-p>=e?a.MIN_SIGNED_VALUE:t&&0>=e?a.MIN_UNSIGNED_VALUE:!t&&e+1>=p?a.MAX_SIGNED_VALUE:t&&e>=l?a.MAX_UNSIGNED_VALUE:0>e?a.fromNumber(-e,!1).negate():new a(e%u|0,e/u|0,t)},a.fromBits=function(e,t,r){return new a(e,t,r)},a.from28Bits=function(e,t,r,n){return a.fromBits(e|t<<28,t>>>4|r<<24,n)},a.fromString=function(e,t,r){if(0==e.length)throw new Error("number format error: empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return a.ZERO;if("number"==typeof t&&(r=t,t=!1),r=r||10,2>r||r>36)throw new Error("radix out of range: "+r);if("-"==e.charAt(0))return a.fromString(e.substring(1),t,r).negate();if(e.indexOf("-")>=0)throw new Error('number format error: interior "-" character: '+e);for(var n=a.fromNumber(Math.pow(r,8)),i=a.ZERO,o=0;o<e.length;o+=8){var s=Math.min(8,e.length-o),c=parseInt(e.substring(o,o+s),r);if(8>s){var d=a.fromNumber(Math.pow(r,s));i=i.multiply(d).add(a.fromNumber(c))}else i=i.multiply(n),i=i.add(a.fromNumber(c))}return i.unsigned=t,i};var d=65536,u=d*d,l=u*u,p=l/2,h=a.fromInt(1<<24);a.ZERO=a.fromInt(0),a.UZERO=a.fromInt(0,!0),a.ONE=a.fromInt(1),a.UONE=a.fromInt(1,!0),a.NEG_ONE=a.fromInt(-1),a.MAX_SIGNED_VALUE=a.fromBits(-1,2147483647,!1),a.MAX_UNSIGNED_VALUE=a.fromBits(-1,-1,!0),a.MAX_VALUE=a.MAX_SIGNED_VALUE,a.MIN_SIGNED_VALUE=a.fromBits(0,-2147483648,!1),a.MIN_UNSIGNED_VALUE=a.fromBits(0,0,!0),a.MIN_VALUE=a.MIN_SIGNED_VALUE,a.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},a.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*u+(this.low>>>0):this.high*u+(this.low>>>0)},a.prototype.toString=function(e){if(e=e||10,2>e||e>36)throw new Error("radix out of range: "+e);if(this.isZero())return"0";var t;if(this.isNegative()){if(this.equals(a.MIN_SIGNED_VALUE)){var r=a.fromNumber(e),n=this.div(r);return t=n.multiply(r).subtract(this),n.toString(e)+t.toInt().toString(e)}return"-"+this.negate().toString(e)}var i=a.fromNumber(Math.pow(e,6));t=this;for(var o="";;){var s=t.div(i),c=t.subtract(s.multiply(i)).toInt(),d=c.toString(e);if(t=s,t.isZero())return d+o;for(;d.length<6;)d="0"+d;o=""+d+o}},a.prototype.getHighBits=function(){return this.high},a.prototype.getHighBitsUnsigned=function(){return this.high>>>0},a.prototype.getLowBits=function(){return this.low},a.prototype.getLowBitsUnsigned=function(){return this.low>>>0},a.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(a.MIN_SIGNED_VALUE)?64:this.negate().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},a.prototype.isZero=function(){return 0==this.high&&0==this.low},a.prototype.isNegative=function(){return!this.unsigned&&this.high<0},a.prototype.isOdd=function(){return 1==(1&this.low)},a.prototype.isEven=function(){return 0==(1&this.low)},a.prototype.equals=function(e){return this.unsigned!=e.unsigned&&this.high>>>31!=e.high>>>31?!1:this.high==e.high&&this.low==e.low},a.prototype.notEquals=function(e){return!this.equals(e)},a.prototype.lessThan=function(e){return this.compare(e)<0},a.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0},a.prototype.greaterThan=function(e){return this.compare(e)>0},a.prototype.greaterThanOrEqual=function(e){return this.compare(e)>=0},a.prototype.compare=function(e){if(this.equals(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high==this.high&&e.low>>>0>this.low>>>0?-1:1:this.subtract(e).isNegative()?-1:1},a.prototype.negate=function(){return!this.unsigned&&this.equals(a.MIN_SIGNED_VALUE)?a.MIN_SIGNED_VALUE:this.not().add(a.ONE)},a.prototype.add=function(e){var t=this.high>>>16,r=65535&this.high,n=this.low>>>16,i=65535&this.low,o=e.high>>>16,s=65535&e.high,c=e.low>>>16,d=65535&e.low,u=0,l=0,p=0,h=0;return h+=i+d,p+=h>>>16,h&=65535,p+=n+c,l+=p>>>16,p&=65535,l+=r+s,u+=l>>>16,l&=65535,u+=t+o,u&=65535,a.fromBits(p<<16|h,u<<16|l,this.unsigned)},a.prototype.subtract=function(e){return this.add(e.negate())},a.prototype.multiply=function(e){if(this.isZero())return a.ZERO;if(e.isZero())return a.ZERO;if(this.equals(a.MIN_VALUE))return e.isOdd()?a.MIN_VALUE:a.ZERO;if(e.equals(a.MIN_VALUE))return this.isOdd()?a.MIN_VALUE:a.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(h)&&e.lessThan(h))return a.fromNumber(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,r=65535&this.high,n=this.low>>>16,i=65535&this.low,o=e.high>>>16,s=65535&e.high,c=e.low>>>16,d=65535&e.low,u=0,l=0,p=0,f=0;return f+=i*d,p+=f>>>16,f&=65535,p+=n*d,l+=p>>>16,p&=65535,p+=i*c,l+=p>>>16,p&=65535,l+=r*d,u+=l>>>16,l&=65535,l+=n*c,u+=l>>>16,l&=65535,l+=i*s,u+=l>>>16,l&=65535,u+=t*d+r*c+n*s+i*o,u&=65535,a.fromBits(p<<16|f,u<<16|l,this.unsigned)},a.prototype.div=function(e){if(e.isZero())throw new Error("division by zero");if(this.isZero())return this.unsigned?a.UZERO:a.ZERO;var t,r,n;if(this.equals(a.MIN_SIGNED_VALUE)){if(e.equals(a.ONE)||e.equals(a.NEG_ONE))return a.MIN_SIGNED_VALUE;if(e.equals(a.MIN_SIGNED_VALUE))return a.ONE;var i=this.shiftRight(1);return t=i.div(e).shiftLeft(1),t.equals(a.ZERO)?e.isNegative()?a.ONE:a.NEG_ONE:(r=this.subtract(e.multiply(t)),n=t.add(r.div(e)))}if(e.equals(a.MIN_SIGNED_VALUE))return this.unsigned?a.UZERO:a.ZERO;if(this.isNegative())return e.isNegative()?this.negate().div(e.negate()):this.negate().div(e).negate();if(e.isNegative())return this.div(e.negate()).negate();for(n=a.ZERO,r=this;r.greaterThanOrEqual(e);){t=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(t)/Math.LN2),s=48>=o?1:Math.pow(2,o-48),c=a.fromNumber(t,this.unsigned),d=c.multiply(e);d.isNegative()||d.greaterThan(r);)t-=s,c=a.fromNumber(t,this.unsigned),d=c.multiply(e);c.isZero()&&(c=a.ONE),n=n.add(c),r=r.subtract(d)}return n},a.prototype.modulo=function(e){return this.subtract(this.div(e).multiply(e))},a.prototype.not=function(){return a.fromBits(~this.low,~this.high,this.unsigned)},a.prototype.and=function(e){return a.fromBits(this.low&e.low,this.high&e.high,this.unsigned)},a.prototype.or=function(e){return a.fromBits(this.low|e.low,this.high|e.high,this.unsigned)},a.prototype.xor=function(e){return a.fromBits(this.low^e.low,this.high^e.high,this.unsigned)},a.prototype.shiftLeft=function(e){if(e&=63,0==e)return this;var t=this.low;if(32>e){var r=this.high;return a.fromBits(t<<e,r<<e|t>>>32-e,this.unsigned)}return a.fromBits(0,t<<e-32,this.unsigned)},a.prototype.shiftRight=function(e){if(e&=63,0==e)return this;var t=this.high;if(32>e){var r=this.low;return a.fromBits(r>>>e|t<<32-e,t>>e,this.unsigned)}return a.fromBits(t>>e-32,t>=0?0:-1,this.unsigned)},a.prototype.shiftRightUnsigned=function(e){if(e&=63,0==e)return this;var t=this.high;if(32>e){var r=this.low;return a.fromBits(r>>>e|t<<32-e,t>>>e,this.unsigned)}return 32==e?a.fromBits(t,0,this.unsigned):a.fromBits(t>>>e-32,0,this.unsigned)},a.prototype.toSigned=function(){var e=this.clone();return e.unsigned=!1,e},a.prototype.toUnsigned=function(){var e=this.clone();return e.unsigned=!0,e},a.prototype.clone=function(){return new a(this.low,this.high,this.unsigned)},"undefined"!=typeof e&&e.exports?e.exports=a:r(159).amd?(n=[],i=function(){return a}.apply(t,n),!(void 0!==i&&(e.exports=i))):(o.dcodeIO||(o.dcodeIO={}),o.dcodeIO.Long=a)}(this)}).call(t,r(157)(e))},,function(e,t,r){function n(e,t){return Promise.any(t).cancellable().then(function(){e.forceTimeout()})["finally"](function(){t.forEach(function(e){e.cancel()})})["catch"](Promise.CancellationError,_.noop)}function i(){return h.waitForEvent(window,"online").then(function(){return Promise.delay(g)})}function o(e){var t,r,n=e.data;if(n instanceof ArrayBuffer){for(var i,o=[],a=d.wrap(n);44!==(i=a.readByte());)o.push(i);t=String.fromCharCode.apply(String,o),r=a}else{var s=n.indexOf(",");t=n.slice(0,s),r=n.slice(s+1),r=r?JSON.parse(r):r}return{tag:t,data:r}}var a,s,c=r(21),d=r(156),u=r(144),l=r(151),p=r(14),h=r(150),f=r(154),m=r(149),g=100,v=3e5,y=6e3,b=2,E=.2,R="server_ping",w=8e3,S=16e3,T=f.FIBONACCI(8e3,4e3,3e5),C=c.extend({props:{active:{type:"boolean","default":!0},socket:"object",sockets:"object",attempts:{type:"number","default":0},startId:{type:"number","default":0},online:{type:"boolean","default":!0},controller:"object",retryTimestamp:"number",tsListener:"function",onerror:"function",_resolve:"function",_reject:"function"},initialize:function(){var e=this;"undefined"==typeof a&&(a=Wa.CONST.SOCKETS,s=Date.now()%a.length),this.sockets=[],new Promise(function(t,r){e._resolve=t,e._reject=r}).then(function(t){p.log("SocketOpener set to socket "+t.id)(),e.set({active:!1,socket:t})})["finally"](function(){p.log("SocketOpener closing socket opener")(),e.active=!1,_.forEach(e.sockets,function(e){e.cancel()});var t=e.controller;t&&(t.deactivate(),e.controller=null)})["catch"](Promise.CancellationError,_.noop)["catch"](function(t){return p.log("SocketOpener deadly error! "+t,"red",t)(),e.onerror?void e.onerror(t):Promise.reject(t)}),this.tsListener=function(t){e.retryTimestamp=t.ts},this.listenTo(this,"change:online",this.onOnlineChange),this.onOnlineChange()},attemptOpen:function(){if(!this.active)return p.log("attemptOpen called while not active!")(),void Wa.uploadLogs("rogue-opener");var e=this.startId+this.attempts,t=m.open({id:e,url:a[(e+s)%a.length],pingTime:w,killTime:S,pingString:R+",,",pongString:R+",",msgParser:o});this.attempts=this.sockets.push(t);var r=_.once(this.checkOnline).bind(this),n=_.delay(r,6e3);t.then(this._resolve)["finally"](function(){return clearTimeout(n)})["catch"](Promise.CancellationError,_.noop)["catch"](r)},checkOnline:function(){var e=this;p.log("SocketOpener:checkOnline checking")(),h.getResponseIfOnline(Wa.CONST.WS_FAIL_URL+"?t="+Date.now()).then(function(t){if(p.log("SocketOpener:checkOnline response "+!!t)(),e.active&&(e.online=!!t,e.online&&!(t.status>=500))){var r=void 0;try{r=t.responseText?JSON.parse(t.responseText):{type:"empty"}}catch(n){r={type:"bad-parse",data:n+"\n"+t.responseText}}switch(r.type){case"allocated":p.log("ws2:diagnostic allocated")(),r.token&&(document.cookie="ws_failure_diagnostic="+r.token+"; secure; path=/; domain="+Wa.CONST.COOKIE_DOMAIN+"; max-age="+(r.age||120));break;case"empty":p.log("SocketOpener:empty healthcheck!","red")();break;case"missing":p.log("SocketOpener:request missing!","red")(),_.forEach(e.sockets,function(e){e.cancel()}),e.poke(g);break;case"found":p.log("SocketOpener:request noncompliant!","red")();var i=JSON.stringify(r.data,void 0,4);p.log(i,"red",r,!0)(),Wa.uploadLogs("websocket-req-noncompliant"),console.log("Error in connecting websocket."),console.log(i),e._reject(new l.BlockedByProxy);break;case"bad-parse":p.log("SocketOpener:healthcheck not json!","red",t)(),p.log(r.data,"red",r)(),Wa.uploadLogs("websocket-req-badparse"),e._reject(new l.BlockedByProxy);break;default:p.log("SocketOpener:received "+r.type)()}}})},poke:function(){this.controller&&this.controller.forceTimeout()},onOnlineChange:function(){var e=this.controller,t=this.online?this.onlineController():this.offlineController();e&&(e.off("change:ts",this.tsListener),e.deactivate()),t.on("change:ts",this.tsListener),t.activate(),this.controller=t},onlineController:function(){var e=this;return p.log("SocketOpener:online")(),new f({waitAlgorithm:T,jitter:E,onActivated:function(){e.attemptOpen()},onTimeout:function(){return e.attemptOpen(),!0}})},offlineController:function(){var e=this;p.log("SocketOpener:offline")();var t=void 0,r=function(e){return t&&t.cancel(),navigator.onLine?e.failGeneration<b?(p.log("SocketOpener:offline... quick poll")(),t=null,y):(p.log("SocketOpener:offline... heuristic poll")(),t=n(e,[i(),h.waitForBBEvent(u,"js_halt_detected"),h.waitForBBEvent(Store.Stream,"change:available")]),v):(p.log("SocketOpener:offline... wait for navigator")(),t=n(e,[i()]),v)};return new f({waitAlgorithm:r,jitter:E,onActivated:function(){0==e.pendingAttempts()&&e.attemptOpen()},onDeactivated:function(){t&&t.cancel()},onTimeout:function(){return e.attemptOpen(),!0}})},deactivate:function(){this._reject(new Promise.CancellationError)},pendingAttempts:function(){return _.sum(this.sockets,function(e){return e.isPending()?1:0})}});e.exports=C},function(e,t,r){function n(){this.Type=l,this.Mode=p,this.pendingUpdate=void 0,this.pendingHardRefreshTimer=void 0,this.mode=p.IDLE,this.appcacheVersion=o.VERSION_STR}var i=r(162),o=r(4),a=r(150),s=r(14),c=r(109),d=r(145),u=r(151),l={SILENT:"silent",SOFT:"soft",HARD:"hard"},p={IDLE:"idle",REFRESHING:"refreshing",PENDING_REFRESH:"pending_refresh"};n.prototype.update=function(e,t){var r=this;s.log("AppUpdate:update: "+e+" current: "+this.appcacheVersion+" latest: "+t)();var n=void 0;if(_.isNumber(e))n=l.HARD;else if(e)n=l.SOFT;else{if(this.appcacheVersion===t)return;n=l.SILENT}var o=n===l.HARD?Date.now()+e:void 0;return this.clearHardRefresh(),n===l.HARD&&this.setMode(p.REFRESHING),this._update(t).then(function(e){n!==l.SILENT&&(Store.Stream.needsUpdate=e),n===l.HARD&&(r.setMode(p.PENDING_REFRESH),r.pendingHardRefreshTimer=i.setTimeout(function(){Wa.hardRefresh(!0),r.clearHardRefresh()},o),r.listenTo(Store.Stream,"change:couldForce",function(){Wa.hardRefresh(!0),r.clearHardRefresh()}))})},n.prototype.setMode=function(e){this.mode=e,this.trigger("change:mode",e)},n.prototype._update=function(e){return this.appcacheVersion!==e&&window.applicationCache&&window.applicationCache.status!==window.applicationCache.UNCACHED?this.pendingUpdate||this.fetch(e).then(function(){return window.applicationCache.status===window.applicationCache.UPDATEREADY?(s.log("Updater:handleUpdate:ApplicationCacheSuccess","green")(),!0):(s.log("Updater:handleUpdate:ApplicationNoUpdate")(),!1)})["catch"](function(e){return s.log("Updater:handleUpdate:ApplicationCacheError "+e,"red",e)(),!1}):Promise.resolve(this.appcacheVersion!==e)},n.prototype.clearHardRefresh=function(){this.setMode(p.IDLE),this.pendingHardRefreshTimer&&(i.clearTimeout(this.pendingHardRefreshTimer),this.pendingHardRefreshTimer=void 0),this.stopListening(Store.Stream,"change:couldForce")},n.prototype.fetch=function(e){var t=this;return this.pendingUpdate=a.loopOnError(u.ShouldLoop,function(r){return Promise.delay(1e3*Wa.expBackoff(r,120,1,.1)).then(function(){return new Promise(function(r,n){function i(){window.applicationCache.removeEventListener("updateready",a),window.applicationCache.removeEventListener("error",s),window.applicationCache.removeEventListener("noupdate",o)}function o(){i(),c.appcacheVersion=e,r()}function a(){i(),c.appcacheVersion=e,r()}function s(e){i(),n(new u.ShouldLoop("AppCache Error. Retrying..."))}var c=t;window.applicationCache.addEventListener("updateready",a),window.applicationCache.addEventListener("error",s),window.applicationCache.addEventListener("noupdate",o),(window.applicationCache.status===window.applicationCache.IDLE||window.applicationCache.status===window.applicationCache.UPDATEREADY)&&window.applicationCache.update()})})})["finally"](function(){t.pendingUpdate=void 0})},e.exports=new n,_.extend(e.exports,c,d)},function(e,t,r){function n(e){this._alarms={},this._initialize(e)}var i=r(14),o=1e4,a=3e3,s=Math.pow(2,31)-1,c=r(144);n.prototype._initialize=function(e){var t,r,n,i=this;t=window.performance.now(),window.setInterval(function(){r=window.performance.now(),n=Math.abs(r-t-e),n>a&&(i._validateTimeouts(),c.jsHaltDetected(n)),t=r},e)},n.prototype._validateTimeouts=function(){var e=this;_.forEach(_.keys(this._alarms),function(t){var r=e._alarms[t];r&&(r.expiration<Date.now()?(e.clearTimeout(t),r.fn()):e.setTimeout(r.fn,r.expiration,t))})},n.prototype.setTimeout=function(e,t,r){var n=this;r&&this.clearTimeout(r),r=r||_.uniqueId("alarm_timer_");var o=t-Date.now(),c=Math.min(o,s);if(0>o)return i.log("Alarm:setTimeout:Cannot set alarm in the past.")(),e(),r;var d=window.setTimeout(function(){t-Date.now()<a?(delete n._alarms[r],e()):n.setTimeout(e,t,r)},c);return this._alarms[r]={fn:e,expiration:t,timeoutId:d},i.log("Alarm:setTimeout:"+r+" set","black",this._alarms[r])(),r},n.prototype.clearTimeout=function(e){var t=this._alarms[e];t&&(window.clearTimeout(t.timeoutId),delete this._alarms[e])},e.exports=new n(o)},function(e,t,r){function n(e){var t={};return e.forEach(function(e){var r=e.split(""),n=_.initial(r).join(""),i=_.last(r);(t[n]||(t[n]={}))[i]=1}),_.keys(t).forEach(function(e){t[e]=o(_.keys(t[e]))}),i(t)}function i(e){return _.map(_.keys(e).sort(function(e,t){return t.length-e.length}),function(t){return t+e[t]}).join("|")}function o(e){if(1===e.length)return e[0];e=e.sort();for(var t=[],r=0,n=e[r],i=e.length,o=0;i>=o;o++){var a=e[o];if(!a||a.charCodeAt(0)!==n.charCodeAt(0)+(o-r)){var s=e[o-1];s===n?t.push(s):t.push(n+"-"+s),r=o,n=a}}return"["+t.join("")+"]"}function a(){var e=Object.keys(R).concat(Object.keys(m),v);return new RegExp("("+n(e)+")","g")}var s=r(164),c=r(165),d=r(4),u=r(166),l=null,p={},h="□",f="🏻 🏼 🏽 🏾 🏿".split(/ /),m={"︀":!0,"︁":!0,"︂":!0,"︃":!0,"︄":!0,"︅":!0,"︆":!0,"︇":!0,"︈":!0,"︉":!0,"︊":!0,"︋":!0,"︌":!0,"︍":!0,"︎":!0,"️":!0},g=["🇦","🇧","🇨","🇩","🇪","🇫","🇬","🇭","🇮","🇯","🇰","🇱","🇲","🇳","🇴","🇵","🇶","🇷","🇸","🇹","🇺","🇻","🇼","🇽","🇾","🇿"],v=[];g.forEach(function(e){g.forEach(function(t){v.push(e+t)})});var y=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},b=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[e[r]]=r);return t},E=b(s),R=y(y({},c),s),w={},S=f[0];_.keys(s).forEach(function(e){s[e+S]&&(w[e]=e,f.map(function(t){w[e+t]=e}))});var T={containsEmoji:_.memoize(function(e){return l||(l=a()),l.test(e)}),normalizeEmoji:_.memoize(function(e){return l||(l=a()),e?e.replace(l,function(e,t){if(m[t])return"";var r=R[t];return E[r]||h}):""}),codeToEmoji:b(R),emojiToHTML:_.memoize(function(e,t,r){l||(l=a()),r=r||"small";var n="small"===r?"emoji":"emojik";return e?e.replace(l,function(e,r){if(m[r])return"";var i=p[r];if(i)return i;var o,a=R[r];if(a){var s=E[a]||h,c=document.createElement("img");return c.alt=s,c.draggable=!1,c.className=u(n,"emoji"+a,t),c.src=d.ONE_BY_ONE_TRANS_GIF,c.outerHTML}return o=h,p[r]=o}):""},function(e,t,r){return"t:"+(e||"")+"c:"+(t||"")+"s:"+(r||"small")}),NodeToEmoji:function(e){for(var t=[""],r=0,n=e.firstChild;null!==n;){if(1===n.nodeType)switch(n.tagName){case"P":case"PRE":case"DIV":t.push(""),r++;break;case"IMG":t[r]+=n.getAttribute("alt");break;case"BR":t[r]+="\n"}else 3===n.nodeType&&(t[r]+=n.nodeValue);if(n.hasChildNodes())n=n.firstChild;else{for(;null===n.nextSibling;){if(n=n.parentNode,n===e)return t.join("\n");switch(n.tagName){case"P":case"PRE":case"DIV":t.push(""),r++}}n=n.nextSibling}}return t.join("\n")},emojiMap:R,skinToneEmojis:w,skinToneVariations:f};e.exports=T},function(e,t){e.exports={"#⃣":"ordered0001","0⃣":"ordered0002","1⃣":"ordered0003","2⃣":"ordered0004","3⃣":"ordered0005","4⃣":"ordered0006","5⃣":"ordered0007","6⃣":"ordered0008","7⃣":"ordered0009","8⃣":"ordered0010","9⃣":"ordered0011","©":"ordered0012","®":"ordered0013","‼":"ordered0014","⁉":"ordered0015","™":"ordered0016","ℹ":"ordered0017","↔":"ordered0018","↕":"ordered0019","↖":"ordered0020","↗":"ordered0021","↘":"ordered0022","↙":"ordered0023","↩":"ordered0024","↪":"ordered0025","⌚":"ordered0026","⌛":"ordered0027","⏩":"ordered0028","⏪":"ordered0029","⏫":"ordered0030","⏬":"ordered0031","⏰":"ordered0032","⏳":"ordered0033","Ⓜ":"ordered0034","▪":"ordered0035","▫":"ordered0036","▶":"ordered0037","◀":"ordered0038","◻":"ordered0039","◼":"ordered0040","◽":"ordered0041","◾":"ordered0042","☀":"ordered0043","☁":"ordered0044","☎":"ordered0045","☑":"ordered0046","☔":"ordered0047","☕":"ordered0048","☝":"ordered0049","☝🏻":"ordered0050","☝🏼":"ordered0051","☝🏽":"ordered0052","☝🏾":"ordered0053","☝🏿":"ordered0054","☺":"ordered0055","♈":"ordered0056","♉":"ordered0057","♊":"ordered0058","♋":"ordered0059","♌":"ordered0060","♍":"ordered0061","♎":"ordered0062","♏":"ordered0063","♐":"ordered0064","♑":"ordered0065","♒":"ordered0066","♓":"ordered0067","♠":"ordered0068","♣":"ordered0069","♥":"ordered0070","♦":"ordered0071","♨":"ordered0072","♻":"ordered0073","♿":"ordered0074","⚓":"ordered0075","⚠":"ordered0076","⚡":"ordered0077","⚪":"ordered0078","⚫":"ordered0079","⚽":"ordered0080","⚾":"ordered0081","⛄":"ordered0082","⛅":"ordered0083","⛎":"ordered0084","⛔":"ordered0085","⛪":"ordered0086","⛲":"ordered0087","⛳":"ordered0088","⛵":"ordered0089","⛺":"ordered0090","⛽":"ordered0091","✂":"ordered0092","✅":"ordered0093","✈":"ordered0094","✉":"ordered0095","✊":"ordered0096","✊🏻":"ordered0097","✊🏼":"ordered0098","✊🏽":"ordered0099","✊🏾":"ordered0100","✊🏿":"ordered0101","✋":"ordered0102","✋🏻":"ordered0103","✋🏼":"ordered0104","✋🏽":"ordered0105","✋🏾":"ordered0106","✋🏿":"ordered0107","✌":"ordered0108","✌🏻":"ordered0109","✌🏼":"ordered0110","✌🏽":"ordered0111","✌🏾":"ordered0112","✌🏿":"ordered0113","✏":"ordered0114","✒":"ordered0115","✔":"ordered0116","✖":"ordered0117","✨":"ordered0118","✳":"ordered0119","✴":"ordered0120","❄":"ordered0121","❇":"ordered0122","❌":"ordered0123","❎":"ordered0124","❓":"ordered0125","❔":"ordered0126","❕":"ordered0127","❗":"ordered0128","❤":"ordered0129","➕":"ordered0130","➖":"ordered0131","➗":"ordered0132","➡":"ordered0133","➰":"ordered0134","➿":"ordered0135","⤴":"ordered0136","⤵":"ordered0137","⬅":"ordered0138","⬆":"ordered0139","⬇":"ordered0140","⬛":"ordered0141","⬜":"ordered0142","⭐":"ordered0143","⭕":"ordered0144","〰":"ordered0145","〽":"ordered0146","㊗":"ordered0147","㊙":"ordered0148","🀄":"ordered0149","🃏":"ordered0150","🅰":"ordered0151","🅱":"ordered0152","🅾":"ordered0153","🅿":"ordered0154","🆎":"ordered0155","🆑":"ordered0156","🆒":"ordered0157","🆓":"ordered0158","🆔":"ordered0159","🆕":"ordered0160","🆖":"ordered0161","🆗":"ordered0162","🆘":"ordered0163","🆙":"ordered0164","🆚":"ordered0165","🇦🇿":"ordered0166","🇦🇺":"ordered0167","🇦🇼":"ordered0168","🇦🇴":"ordered0169","🇦🇱":"ordered0170","🇦🇲":"ordered0171","🇦🇸":"ordered0172","🇦🇹":"ordered0173","🇦🇪":"ordered0174","🇦🇬":"ordered0175","🇦🇫":"ordered0176","🇦🇮":"ordered0177","🇦🇩":"ordered0178","🇦🇷":"ordered0179","🇧🇴":"ordered0180","🇧🇷":"ordered0181","🇧🇳":"ordered0182","🇧🇲":"ordered0183","🇧🇹":"ordered0184","🇧🇸":"ordered0185","🇧🇾":"ordered0186","🇧🇿":"ordered0187","🇧🇼":"ordered0188","🇧🇪":"ordered0189","🇧🇫":"ordered0190","🇧🇬":"ordered0191","🇧🇭":"ordered0192","🇧🇮":"ordered0193","🇧🇯":"ordered0194","🇧🇦":"ordered0195","🇧🇧":"ordered0196","🇧🇩":"ordered0197","🇨🇻":"ordered0198","🇨🇼":"ordered0199","🇨🇺":"ordered0200","🇨🇿":"ordered0201","🇨🇾":"ordered0202","🇨🇲":"ordered0203","🇨🇳":"ordered0204","🇨🇰":"ordered0205","🇨🇱":"ordered0206","🇨🇷":"ordered0207","🇨🇴":"ordered0208","🇨🇩":"ordered0209","🇨🇦":"ordered0210","🇨🇬":"ordered0211","🇨🇫":"ordered0212","🇨🇮":"ordered0213","🇨🇭":"ordered0214","🇩🇪":"ordered0215","🇩🇯":"ordered0216","🇩🇲":"ordered0217","🇩🇰":"ordered0218","🇩🇴":"ordered0219","🇩🇿":"ordered0220","🇪🇹":"ordered0221","🇪🇸":"ordered0222","🇪🇷":"ordered0223","🇪🇬":"ordered0224","🇪🇪":"ordered0225","🇪🇨":"ordered0226","🇫🇴":"ordered0227","🇫🇷":"ordered0228","🇫🇮":"ordered0229","🇫🇯":"ordered0230","🇬🇹":"ordered0231","🇬🇳":"ordered0232","🇬🇲":"ordered0233","🇬🇵":"ordered0234","🇬🇷":"ordered0235","🇬🇶":"ordered0236","🇬🇺":"ordered0237","🇬🇼":"ordered0238","🇬🇾":"ordered0239","🇬🇫":"ordered0240","🇬🇭":"ordered0241","🇬🇮":"ordered0242","🇬🇪":"ordered0243","🇬🇩":"ordered0244","🇬🇦":"ordered0245","🇬🇧":"ordered0246","🇭🇺":"ordered0247","🇭🇷":"ordered0248","🇭🇳":"ordered0249","🇭🇰":"ordered0250","🇭🇹":"ordered0251","🇮🇪":"ordered0252","🇮🇩":"ordered0253","🇮🇷":"ordered0254","🇮🇶":"ordered0255","🇮🇳":"ordered0256","🇮🇱":"ordered0257","🇮🇹":"ordered0258","🇮🇸":"ordered0259","🇯🇴":"ordered0260","🇯🇵":"ordered0261","🇯🇲":"ordered0262","🇰🇬":"ordered0263","🇰🇪":"ordered0264","🇰🇭":"ordered0265","🇰🇮":"ordered0266","🇰🇼":"ordered0267","🇰🇿":"ordered0268","🇰🇾":"ordered0269","🇰🇳":"ordered0270","🇰🇲":"ordered0271","🇰🇷":"ordered0272","🇰🇵":"ordered0273","🇱🇰":"ordered0274","🇱🇷":"ordered0275","🇱🇸":"ordered0276","🇱🇹":"ordered0277","🇱🇻":"ordered0278","🇱🇺":"ordered0279","🇱🇾":"ordered0280","🇱🇮":"ordered0281","🇱🇨":"ordered0282","🇱🇧":"ordered0283","🇱🇦":"ordered0284","🇲🇼":"ordered0285","🇲🇻":"ordered0286","🇲🇴":"ordered0287","🇲🇪":"ordered0288","🇲🇬":"ordered0289","🇲🇩":"ordered0290","🇲🇦":"ordered0291","🇲🇳":"ordered0292","🇲🇲":"ordered0293","🇲🇷":"ordered0294","🇲🇶":"ordered0295","🇲🇹":"ordered0296","🇲🇸":"ordered0297","🇲🇾":"ordered0298","🇲🇽":"ordered0299","🇲🇿":"ordered0300","🇲🇱":"ordered0301","🇲🇰":"ordered0302","🇲🇵":"ordered0303","🇳🇮":"ordered0304","🇳🇦":"ordered0305","🇳🇱":"ordered0306","🇳🇴":"ordered0307","🇳🇵":"ordered0308","🇳🇿":"ordered0309","🇳🇺":"ordered0310","🇳🇪":"ordered0311","🇳🇨":"ordered0312","🇳🇬":"ordered0313","🇴🇲":"ordered0314","🇵🇸":"ordered0315","🇵🇰":"ordered0316","🇵🇾":"ordered0317","🇵🇼":"ordered0318","🇵🇭":"ordered0319","🇵🇬":"ordered0320","🇵🇪":"ordered0321","🇵🇦":"ordered0322","🇵🇷":"ordered0323","🇵🇹":"ordered0324","🇵🇱":"ordered0325","🇶🇦":"ordered0326","🇷🇪":"ordered0327","🇷🇸":"ordered0328","🇷🇴":"ordered0329","🇷🇺":"ordered0330","🇷🇼":"ordered0331","🇸🇲":"ordered0332","🇸🇦":"ordered0333","🇸🇧":"ordered0334","🇸🇨":"ordered0335","🇸🇩":"ordered0336","🇸🇬":"ordered0337","🇸🇪":"ordered0338","🇸🇮":"ordered0339","🇸🇻":"ordered0340","🇸🇿":"ordered0341","🇸🇾":"ordered0342","🇸🇽":"ordered0343","🇸🇹":"ordered0344","🇸🇸":"ordered0345","🇸🇳":"ordered0346","🇸🇱":"ordered0347","🇸🇰":"ordered0348","🇸🇷":"ordered0349","🇸🇴":"ordered0350","🇹🇴":"ordered0351","🇹🇿":"ordered0352","🇹🇹":"ordered0353","🇹🇲":"ordered0354","🇹🇳":"ordered0355","🇹🇱":"ordered0356","🇹🇷":"ordered0357","🇹🇻":"ordered0358","🇹🇬":"ordered0359","🇹🇫":"ordered0360","🇹🇯":"ordered0361","🇹🇭":"ordered0362","🇹🇨":"ordered0363","🇺🇸":"ordered0364","🇺🇿":"ordered0365","🇺🇾":"ordered0366","🇺🇬":"ordered0367","🇺🇦":"ordered0368","🇻🇺":"ordered0369","🇻🇳":"ordered0370","🇻🇨":"ordered0371","🇻🇪":"ordered0372","🇻🇬":"ordered0373","🇻🇮":"ordered0374","🇼🇸":"ordered0375","🇾🇪":"ordered0376","🇿🇦":"ordered0377","🇿🇼":"ordered0378","🇿🇲":"ordered0379","🈁":"ordered0380","🈂":"ordered0381","🈚":"ordered0382","🈯":"ordered0383","🈲":"ordered0384","🈳":"ordered0385","🈴":"ordered0386","🈵":"ordered0387","🈶":"ordered0388","🈷":"ordered0389","🈸":"ordered0390","🈹":"ordered0391","🈺":"ordered0392","🉐":"ordered0393","🉑":"ordered0394","🌀":"ordered0395","🌁":"ordered0396","🌂":"ordered0397","🌃":"ordered0398","🌄":"ordered0399","🌅":"ordered0400","🌆":"ordered0401","🌇":"ordered0402","🌈":"ordered0403","🌉":"ordered0404","🌊":"ordered0405","🌋":"ordered0406","🌌":"ordered0407","🌍":"ordered0408","🌎":"ordered0409","🌏":"ordered0410","🌐":"ordered0411","🌑":"ordered0412","🌒":"ordered0413","🌓":"ordered0414","🌔":"ordered0415","🌕":"ordered0416","🌖":"ordered0417","🌗":"ordered0418","🌘":"ordered0419","🌙":"ordered0420","🌚":"ordered0421","🌛":"ordered0422","🌜":"ordered0423","🌝":"ordered0424","🌞":"ordered0425","🌟":"ordered0426","🌠":"ordered0427","🌰":"ordered0428","🌱":"ordered0429","🌲":"ordered0430","🌳":"ordered0431","🌴":"ordered0432","🌵":"ordered0433","🌷":"ordered0434","🌸":"ordered0435","🌹":"ordered0436","🌺":"ordered0437","🌻":"ordered0438","🌼":"ordered0439","🌽":"ordered0440","🌾":"ordered0441","🌿":"ordered0442","🍀":"ordered0443","🍁":"ordered0444","🍂":"ordered0445","🍃":"ordered0446","🍄":"ordered0447","🍅":"ordered0448","🍆":"ordered0449","🍇":"ordered0450","🍈":"ordered0451","🍉":"ordered0452","🍊":"ordered0453","🍋":"ordered0454","🍌":"ordered0455","🍍":"ordered0456","🍎":"ordered0457","🍏":"ordered0458","🍐":"ordered0459","🍑":"ordered0460","🍒":"ordered0461","🍓":"ordered0462","🍔":"ordered0463","🍕":"ordered0464","🍖":"ordered0465","🍗":"ordered0466","🍘":"ordered0467","🍙":"ordered0468","🍚":"ordered0469","🍛":"ordered0470","🍜":"ordered0471","🍝":"ordered0472","🍞":"ordered0473","🍟":"ordered0474","🍠":"ordered0475","🍡":"ordered0476","🍢":"ordered0477","🍣":"ordered0478","🍤":"ordered0479","🍥":"ordered0480","🍦":"ordered0481","🍧":"ordered0482","🍨":"ordered0483","🍩":"ordered0484","🍪":"ordered0485","🍫":"ordered0486","🍬":"ordered0487","🍭":"ordered0488","🍮":"ordered0489","🍯":"ordered0490","🍰":"ordered0491","🍱":"ordered0492","🍲":"ordered0493","🍳":"ordered0494","🍴":"ordered0495","🍵":"ordered0496","🍶":"ordered0497","🍷":"ordered0498","🍸":"ordered0499","🍹":"ordered0500","🍺":"ordered0501","🍻":"ordered0502","🍼":"ordered0503","🎀":"ordered0504","🎁":"ordered0505","🎂":"ordered0506","🎃":"ordered0507","🎄":"ordered0508","🎅":"ordered0509","🎅🏻":"ordered0510","🎅🏼":"ordered0511","🎅🏽":"ordered0512","🎅🏾":"ordered0513","🎅🏿":"ordered0514","🎆":"ordered0515","🎇":"ordered0516","🎈":"ordered0517","🎉":"ordered0518","🎊":"ordered0519","🎋":"ordered0520","🎌":"ordered0521","🎍":"ordered0522","🎎":"ordered0523","🎏":"ordered0524","🎐":"ordered0525","🎑":"ordered0526","🎒":"ordered0527","🎓":"ordered0528","🎠":"ordered0529","🎡":"ordered0530","🎢":"ordered0531","🎣":"ordered0532","🎤":"ordered0533","🎥":"ordered0534","🎦":"ordered0535","🎧":"ordered0536","🎨":"ordered0537","🎩":"ordered0538","🎪":"ordered0539","🎫":"ordered0540","🎬":"ordered0541","🎭":"ordered0542","🎮":"ordered0543","🎯":"ordered0544","🎰":"ordered0545","🎱":"ordered0546","🎲":"ordered0547","🎳":"ordered0548","🎴":"ordered0549","🎵":"ordered0550","🎶":"ordered0551","🎷":"ordered0552","🎸":"ordered0553","🎹":"ordered0554","🎺":"ordered0555","🎻":"ordered0556","🎼":"ordered0557","🎽":"ordered0558","🎾":"ordered0559","🎿":"ordered0560","🏀":"ordered0561","🏁":"ordered0562","🏂":"ordered0563","🏃":"ordered0564","🏃🏻":"ordered0565","🏃🏼":"ordered0566","🏃🏽":"ordered0567","🏃🏾":"ordered0568","🏃🏿":"ordered0569","🏄":"ordered0570","🏄🏻":"ordered0571","🏄🏼":"ordered0572","🏄🏽":"ordered0573","🏄🏾":"ordered0574","🏄🏿":"ordered0575","🏆":"ordered0576","🏇":"ordered0577","🏇🏻":"ordered0578","🏇🏼":"ordered0579","🏇🏽":"ordered0580","🏇🏾":"ordered0581","🏇🏿":"ordered0582","🏈":"ordered0583","🏉":"ordered0584","🏊":"ordered0585","🏊🏻":"ordered0586","🏊🏼":"ordered0587","🏊🏽":"ordered0588","🏊🏾":"ordered0589","🏊🏿":"ordered0590","🏠":"ordered0591","🏡":"ordered0592","🏢":"ordered0593","🏣":"ordered0594","🏤":"ordered0595","🏥":"ordered0596","🏦":"ordered0597","🏧":"ordered0598","🏨":"ordered0599","🏩":"ordered0600","🏪":"ordered0601","🏫":"ordered0602","🏬":"ordered0603","🏭":"ordered0604","🏮":"ordered0605","🏯":"ordered0606","🏰":"ordered0607","🏻":"ordered0608","🏼":"ordered0609","🏽":"ordered0610","🏾":"ordered0611","🏿":"ordered0612","🐀":"ordered0613","🐁":"ordered0614","🐂":"ordered0615","🐃":"ordered0616","🐄":"ordered0617","🐅":"ordered0618","🐆":"ordered0619","🐇":"ordered0620","🐈":"ordered0621","🐉":"ordered0622","🐊":"ordered0623","🐋":"ordered0624","🐌":"ordered0625","🐍":"ordered0626","🐎":"ordered0627","🐏":"ordered0628","🐐":"ordered0629","🐑":"ordered0630","🐒":"ordered0631","🐓":"ordered0632","🐔":"ordered0633","🐕":"ordered0634","🐖":"ordered0635","🐗":"ordered0636","🐘":"ordered0637","🐙":"ordered0638","🐚":"ordered0639","🐛":"ordered0640","🐜":"ordered0641","🐝":"ordered0642","🐞":"ordered0643","🐟":"ordered0644","🐠":"ordered0645","🐡":"ordered0646","🐢":"ordered0647","🐣":"ordered0648","🐤":"ordered0649","🐥":"ordered0650","🐦":"ordered0651","🐧":"ordered0652","🐨":"ordered0653",
"🐩":"ordered0654","🐪":"ordered0655","🐫":"ordered0656","🐬":"ordered0657","🐭":"ordered0658","🐮":"ordered0659","🐯":"ordered0660","🐰":"ordered0661","🐱":"ordered0662","🐲":"ordered0663","🐳":"ordered0664","🐴":"ordered0665","🐵":"ordered0666","🐶":"ordered0667","🐷":"ordered0668","🐸":"ordered0669","🐹":"ordered0670","🐺":"ordered0671","🐻":"ordered0672","🐼":"ordered0673","🐽":"ordered0674","🐾":"ordered0675","👀":"ordered0676","👂":"ordered0677","👂🏻":"ordered0678","👂🏼":"ordered0679","👂🏽":"ordered0680","👂🏾":"ordered0681","👂🏿":"ordered0682","👃":"ordered0683","👃🏻":"ordered0684","👃🏼":"ordered0685","👃🏽":"ordered0686","👃🏾":"ordered0687","👃🏿":"ordered0688","👄":"ordered0689","👅":"ordered0690","👆":"ordered0691","👆🏻":"ordered0692","👆🏼":"ordered0693","👆🏽":"ordered0694","👆🏾":"ordered0695","👆🏿":"ordered0696","👇":"ordered0697","👇🏻":"ordered0698","👇🏼":"ordered0699","👇🏽":"ordered0700","👇🏾":"ordered0701","👇🏿":"ordered0702","👈":"ordered0703","👈🏻":"ordered0704","👈🏼":"ordered0705","👈🏽":"ordered0706","👈🏾":"ordered0707","👈🏿":"ordered0708","👉":"ordered0709","👉🏻":"ordered0710","👉🏼":"ordered0711","👉🏽":"ordered0712","👉🏾":"ordered0713","👉🏿":"ordered0714","👊":"ordered0715","👊🏻":"ordered0716","👊🏼":"ordered0717","👊🏽":"ordered0718","👊🏾":"ordered0719","👊🏿":"ordered0720","👋":"ordered0721","👋🏻":"ordered0722","👋🏼":"ordered0723","👋🏽":"ordered0724","👋🏾":"ordered0725","👋🏿":"ordered0726","👌":"ordered0727","👌🏻":"ordered0728","👌🏼":"ordered0729","👌🏽":"ordered0730","👌🏾":"ordered0731","👌🏿":"ordered0732","👍":"ordered0733","👍🏻":"ordered0734","👍🏼":"ordered0735","👍🏽":"ordered0736","👍🏾":"ordered0737","👍🏿":"ordered0738","👎":"ordered0739","👎🏻":"ordered0740","👎🏼":"ordered0741","👎🏽":"ordered0742","👎🏾":"ordered0743","👎🏿":"ordered0744","👏":"ordered0745","👏🏻":"ordered0746","👏🏼":"ordered0747","👏🏽":"ordered0748","👏🏾":"ordered0749","👏🏿":"ordered0750","👐":"ordered0751","👐🏻":"ordered0752","👐🏼":"ordered0753","👐🏽":"ordered0754","👐🏾":"ordered0755","👐🏿":"ordered0756","👑":"ordered0757","👒":"ordered0758","👓":"ordered0759","👔":"ordered0760","👕":"ordered0761","👖":"ordered0762","👗":"ordered0763","👘":"ordered0764","👙":"ordered0765","👚":"ordered0766","👛":"ordered0767","👜":"ordered0768","👝":"ordered0769","👞":"ordered0770","👟":"ordered0771","👠":"ordered0772","👡":"ordered0773","👢":"ordered0774","👣":"ordered0775","👤":"ordered0776","👥":"ordered0777","👦":"ordered0778","👦🏻":"ordered0779","👦🏼":"ordered0780","👦🏽":"ordered0781","👦🏾":"ordered0782","👦🏿":"ordered0783","👧":"ordered0784","👧🏻":"ordered0785","👧🏼":"ordered0786","👧🏽":"ordered0787","👧🏾":"ordered0788","👧🏿":"ordered0789","👨":"ordered0790","👨🏻":"ordered0791","👨🏼":"ordered0792","👨🏽":"ordered0793","👨🏾":"ordered0794","👨🏿":"ordered0795","👩":"ordered0796","👩🏻":"ordered0797","👩🏼":"ordered0798","👩🏽":"ordered0799","👩🏾":"ordered0800","👩🏿":"ordered0801","👪":"ordered0802","👨‍👨‍👦":"ordered0803","👨‍👨‍👦‍👦":"ordered0804","👨‍👨‍👧":"ordered0805","👨‍👨‍👧‍👦":"ordered0806","👨‍👨‍👧‍👧":"ordered0807","👨‍👩‍👦‍👦":"ordered0808","👨‍👩‍👧":"ordered0809","👨‍👩‍👧‍👦":"ordered0810","👨‍👩‍👧‍👧":"ordered0811","👩‍👩‍👦":"ordered0812","👩‍👩‍👦‍👦":"ordered0813","👩‍👩‍👧":"ordered0814","👩‍👩‍👧‍👦":"ordered0815","👩‍👩‍👧‍👧":"ordered0816","👫":"ordered0817","👬":"ordered0818","👭":"ordered0819","👮":"ordered0820","👮🏻":"ordered0821","👮🏼":"ordered0822","👮🏽":"ordered0823","👮🏾":"ordered0824","👮🏿":"ordered0825","👯":"ordered0826","👰":"ordered0827","👰🏻":"ordered0828","👰🏼":"ordered0829","👰🏽":"ordered0830","👰🏾":"ordered0831","👰🏿":"ordered0832","👱":"ordered0833","👱🏻":"ordered0834","👱🏼":"ordered0835","👱🏽":"ordered0836","👱🏾":"ordered0837","👱🏿":"ordered0838","👲":"ordered0839","👲🏻":"ordered0840","👲🏼":"ordered0841","👲🏽":"ordered0842","👲🏾":"ordered0843","👲🏿":"ordered0844","👳":"ordered0845","👳🏻":"ordered0846","👳🏼":"ordered0847","👳🏽":"ordered0848","👳🏾":"ordered0849","👳🏿":"ordered0850","👴":"ordered0851","👴🏻":"ordered0852","👴🏼":"ordered0853","👴🏽":"ordered0854","👴🏾":"ordered0855","👴🏿":"ordered0856","👵":"ordered0857","👵🏻":"ordered0858","👵🏼":"ordered0859","👵🏽":"ordered0860","👵🏾":"ordered0861","👵🏿":"ordered0862","👶":"ordered0863","👶🏻":"ordered0864","👶🏼":"ordered0865","👶🏽":"ordered0866","👶🏾":"ordered0867","👶🏿":"ordered0868","👷":"ordered0869","👷🏻":"ordered0870","👷🏼":"ordered0871","👷🏽":"ordered0872","👷🏾":"ordered0873","👷🏿":"ordered0874","👸":"ordered0875","👸🏻":"ordered0876","👸🏼":"ordered0877","👸🏽":"ordered0878","👸🏾":"ordered0879","👸🏿":"ordered0880","👹":"ordered0881","👺":"ordered0882","👻":"ordered0883","👼":"ordered0884","👼🏻":"ordered0885","👼🏼":"ordered0886","👼🏽":"ordered0887","👼🏾":"ordered0888","👼🏿":"ordered0889","👽":"ordered0890","👾":"ordered0891","👿":"ordered0892","💀":"ordered0893","💁":"ordered0894","💁🏻":"ordered0895","💁🏼":"ordered0896","💁🏽":"ordered0897","💁🏾":"ordered0898","💁🏿":"ordered0899","💂":"ordered0900","💂🏻":"ordered0901","💂🏼":"ordered0902","💂🏽":"ordered0903","💂🏾":"ordered0904","💂🏿":"ordered0905","💃":"ordered0906","💃🏻":"ordered0907","💃🏼":"ordered0908","💃🏽":"ordered0909","💃🏾":"ordered0910","💃🏿":"ordered0911","💄":"ordered0912","💅":"ordered0913","💅🏻":"ordered0914","💅🏼":"ordered0915","💅🏽":"ordered0916","💅🏾":"ordered0917","💅🏿":"ordered0918","💆":"ordered0919","💆🏻":"ordered0920","💆🏼":"ordered0921","💆🏽":"ordered0922","💆🏾":"ordered0923","💆🏿":"ordered0924","💇":"ordered0925","💇🏻":"ordered0926","💇🏼":"ordered0927","💇🏽":"ordered0928","💇🏾":"ordered0929","💇🏿":"ordered0930","💈":"ordered0931","💉":"ordered0932","💊":"ordered0933","💋":"ordered0934","💌":"ordered0935","💍":"ordered0936","💎":"ordered0937","💏":"ordered0938","👨‍❤️‍💋‍👨":"ordered0939","👩‍❤️‍💋‍👩":"ordered0940","💐":"ordered0941","💑":"ordered0942","👨‍❤️‍👨":"ordered0943","👩‍❤️‍👩":"ordered0944","💒":"ordered0945","💓":"ordered0946","💔":"ordered0947","💕":"ordered0948","💖":"ordered0949","💗":"ordered0950","💘":"ordered0951","💙":"ordered0952","💚":"ordered0953","💛":"ordered0954","💜":"ordered0955","💝":"ordered0956","💞":"ordered0957","💟":"ordered0958","💠":"ordered0959","💡":"ordered0960","💢":"ordered0961","💣":"ordered0962","💤":"ordered0963","💥":"ordered0964","💦":"ordered0965","💧":"ordered0966","💨":"ordered0967","💩":"ordered0968","💪":"ordered0969","💪🏻":"ordered0970","💪🏼":"ordered0971","💪🏽":"ordered0972","💪🏾":"ordered0973","💪🏿":"ordered0974","💫":"ordered0975","💬":"ordered0976","💭":"ordered0977","💮":"ordered0978","💯":"ordered0979","💰":"ordered0980","💱":"ordered0981","💲":"ordered0982","💳":"ordered0983","💴":"ordered0984","💵":"ordered0985","💶":"ordered0986","💷":"ordered0987","💸":"ordered0988","💹":"ordered0989","💺":"ordered0990","💻":"ordered0991","💼":"ordered0992","💽":"ordered0993","💾":"ordered0994","💿":"ordered0995","📀":"ordered0996","📁":"ordered0997","📂":"ordered0998","📃":"ordered0999","📄":"ordered1000","📅":"ordered1001","📆":"ordered1002","📇":"ordered1003","📈":"ordered1004","📉":"ordered1005","📊":"ordered1006","📋":"ordered1007","📌":"ordered1008","📍":"ordered1009","📎":"ordered1010","📏":"ordered1011","📐":"ordered1012","📑":"ordered1013","📒":"ordered1014","📓":"ordered1015","📔":"ordered1016","📕":"ordered1017","📖":"ordered1018","📗":"ordered1019","📘":"ordered1020","📙":"ordered1021","📚":"ordered1022","📛":"ordered1023","📜":"ordered1024","📝":"ordered1025","📞":"ordered1026","📟":"ordered1027","📠":"ordered1028","📡":"ordered1029","📢":"ordered1030","📣":"ordered1031","📤":"ordered1032","📥":"ordered1033","📦":"ordered1034","📧":"ordered1035","📨":"ordered1036","📩":"ordered1037","📪":"ordered1038","📫":"ordered1039","📬":"ordered1040","📭":"ordered1041","📮":"ordered1042","📯":"ordered1043","📰":"ordered1044","📱":"ordered1045","📲":"ordered1046","📳":"ordered1047","📴":"ordered1048","📵":"ordered1049","📶":"ordered1050","📷":"ordered1051","📹":"ordered1052","📺":"ordered1053","📻":"ordered1054","📼":"ordered1055","🔀":"ordered1056","🔁":"ordered1057","🔂":"ordered1058","🔃":"ordered1059","🔄":"ordered1060","🔅":"ordered1061","🔆":"ordered1062","🔇":"ordered1063","🔈":"ordered1064","🔉":"ordered1065","🔊":"ordered1066","🔋":"ordered1067","🔌":"ordered1068","🔍":"ordered1069","🔎":"ordered1070","🔏":"ordered1071","🔐":"ordered1072","🔑":"ordered1073","🔒":"ordered1074","🔓":"ordered1075","🔔":"ordered1076","🔕":"ordered1077","🔖":"ordered1078","🔗":"ordered1079","🔘":"ordered1080","🔙":"ordered1081","🔚":"ordered1082","🔛":"ordered1083","🔜":"ordered1084","🔝":"ordered1085","🔞":"ordered1086","🔟":"ordered1087","🔠":"ordered1088","🔡":"ordered1089","🔢":"ordered1090","🔣":"ordered1091","🔤":"ordered1092","🔥":"ordered1093","🔦":"ordered1094","🔧":"ordered1095","🔨":"ordered1096","🔩":"ordered1097","🔪":"ordered1098","🔫":"ordered1099","🔬":"ordered1100","🔭":"ordered1101","🔮":"ordered1102","🔯":"ordered1103","🔰":"ordered1104","🔱":"ordered1105","🔲":"ordered1106","🔳":"ordered1107","🔴":"ordered1108","🔵":"ordered1109","🔶":"ordered1110","🔷":"ordered1111","🔸":"ordered1112","🔹":"ordered1113","🔺":"ordered1114","🔻":"ordered1115","🔼":"ordered1116","🔽":"ordered1117","🕐":"ordered1118","🕑":"ordered1119","🕒":"ordered1120","🕓":"ordered1121","🕔":"ordered1122","🕕":"ordered1123","🕖":"ordered1124","🕗":"ordered1125","🕘":"ordered1126","🕙":"ordered1127","🕚":"ordered1128","🕛":"ordered1129","🕜":"ordered1130","🕝":"ordered1131","🕞":"ordered1132","🕟":"ordered1133","🕠":"ordered1134","🕡":"ordered1135","🕢":"ordered1136","🕣":"ordered1137","🕤":"ordered1138","🕥":"ordered1139","🕦":"ordered1140","🕧":"ordered1141","🖖":"ordered1142","🖖🏻":"ordered1143","🖖🏼":"ordered1144","🖖🏽":"ordered1145","🖖🏾":"ordered1146","🖖🏿":"ordered1147","🗻":"ordered1148","🗼":"ordered1149","🗽":"ordered1150","🗾":"ordered1151","🗿":"ordered1152","😀":"ordered1153","😁":"ordered1154","😂":"ordered1155","😃":"ordered1156","😄":"ordered1157","😅":"ordered1158","😆":"ordered1159","😇":"ordered1160","😈":"ordered1161","😉":"ordered1162","😊":"ordered1163","😋":"ordered1164","😌":"ordered1165","😍":"ordered1166","😎":"ordered1167","😏":"ordered1168","😐":"ordered1169","😑":"ordered1170","😒":"ordered1171","😓":"ordered1172","😔":"ordered1173","😕":"ordered1174","😖":"ordered1175","😗":"ordered1176","😘":"ordered1177","😙":"ordered1178","😚":"ordered1179","😛":"ordered1180","😜":"ordered1181","😝":"ordered1182","😞":"ordered1183","😟":"ordered1184","😠":"ordered1185","😡":"ordered1186","😢":"ordered1187","😣":"ordered1188","😤":"ordered1189","😥":"ordered1190","😦":"ordered1191","😧":"ordered1192","😨":"ordered1193","😩":"ordered1194","😪":"ordered1195","😫":"ordered1196","😬":"ordered1197","😭":"ordered1198","😮":"ordered1199","😯":"ordered1200","😰":"ordered1201","😱":"ordered1202","😲":"ordered1203","😳":"ordered1204","😴":"ordered1205","😵":"ordered1206","😶":"ordered1207","😷":"ordered1208","😸":"ordered1209","😹":"ordered1210","😺":"ordered1211","😻":"ordered1212","😼":"ordered1213","😽":"ordered1214","😾":"ordered1215","😿":"ordered1216","🙀":"ordered1217","🙅":"ordered1218","🙅🏻":"ordered1219","🙅🏼":"ordered1220","🙅🏽":"ordered1221","🙅🏾":"ordered1222","🙅🏿":"ordered1223","🙆":"ordered1224","🙆🏻":"ordered1225","🙆🏼":"ordered1226","🙆🏽":"ordered1227","🙆🏾":"ordered1228","🙆🏿":"ordered1229","🙇":"ordered1230","🙇🏻":"ordered1231","🙇🏼":"ordered1232","🙇🏽":"ordered1233","🙇🏾":"ordered1234","🙇🏿":"ordered1235","🙈":"ordered1236","🙉":"ordered1237","🙊":"ordered1238","🙋":"ordered1239","🙋🏻":"ordered1240","🙋🏼":"ordered1241","🙋🏽":"ordered1242","🙋🏾":"ordered1243","🙋🏿":"ordered1244","🙌":"ordered1245","🙌🏻":"ordered1246","🙌🏼":"ordered1247","🙌🏽":"ordered1248","🙌🏾":"ordered1249","🙌🏿":"ordered1250","🙍":"ordered1251","🙍🏻":"ordered1252","🙍🏼":"ordered1253","🙍🏽":"ordered1254","🙍🏾":"ordered1255","🙍🏿":"ordered1256","🙎":"ordered1257","🙎🏻":"ordered1258","🙎🏼":"ordered1259","🙎🏽":"ordered1260","🙎🏾":"ordered1261","🙎🏿":"ordered1262","🙏":"ordered1263","🙏🏻":"ordered1264","🙏🏼":"ordered1265","🙏🏽":"ordered1266","🙏🏾":"ordered1267","🙏🏿":"ordered1268","🚀":"ordered1269","🚁":"ordered1270","🚂":"ordered1271","🚃":"ordered1272","🚄":"ordered1273","🚅":"ordered1274","🚆":"ordered1275","🚇":"ordered1276","🚈":"ordered1277","🚉":"ordered1278","🚊":"ordered1279","🚋":"ordered1280","🚌":"ordered1281","🚍":"ordered1282","🚎":"ordered1283","🚏":"ordered1284","🚐":"ordered1285","🚑":"ordered1286","🚒":"ordered1287","🚓":"ordered1288","🚔":"ordered1289","🚕":"ordered1290","🚖":"ordered1291","🚗":"ordered1292","🚘":"ordered1293","🚙":"ordered1294","🚚":"ordered1295","🚛":"ordered1296","🚜":"ordered1297","🚝":"ordered1298","🚞":"ordered1299","🚟":"ordered1300","🚠":"ordered1301","🚡":"ordered1302","🚢":"ordered1303","🚣":"ordered1304","🚣🏻":"ordered1305","🚣🏼":"ordered1306","🚣🏽":"ordered1307","🚣🏾":"ordered1308","🚣🏿":"ordered1309","🚤":"ordered1310","🚥":"ordered1311","🚦":"ordered1312","🚧":"ordered1313","🚨":"ordered1314","🚩":"ordered1315","🚪":"ordered1316","🚫":"ordered1317","🚬":"ordered1318","🚭":"ordered1319","🚮":"ordered1320","🚯":"ordered1321","🚰":"ordered1322","🚱":"ordered1323","🚲":"ordered1324","🚳":"ordered1325","🚴":"ordered1326","🚴🏻":"ordered1327","🚴🏼":"ordered1328","🚴🏽":"ordered1329","🚴🏾":"ordered1330","🚴🏿":"ordered1331","🚵":"ordered1332","🚵🏻":"ordered1333","🚵🏼":"ordered1334","🚵🏽":"ordered1335","🚵🏾":"ordered1336","🚵🏿":"ordered1337","🚶":"ordered1338","🚶🏻":"ordered1339","🚶🏼":"ordered1340","🚶🏽":"ordered1341","🚶🏾":"ordered1342","🚶🏿":"ordered1343","🚷":"ordered1344","🚸":"ordered1345","🚹":"ordered1346","🚺":"ordered1347","🚻":"ordered1348","🚼":"ordered1349","🚽":"ordered1350","🚾":"ordered1351","🚿":"ordered1352","🛀":"ordered1353","🛀🏻":"ordered1354","🛀🏼":"ordered1355","🛀🏽":"ordered1356","🛀🏾":"ordered1357","🛀🏿":"ordered1358","🛁":"ordered1359","🛂":"ordered1360","🛃":"ordered1361","🛄":"ordered1362","🛅":"ordered1363","🇹🇼":"ordered1364","🇽🇪":"ordered1365","🖕":"ordered1366","🖕🏻":"ordered1367","🖕🏼":"ordered1368","🖕🏽":"ordered1369","🖕🏾":"ordered1370","🖕🏿":"ordered1371"}},function(e,t){e.exports={"":"ordered0001","":"ordered0002","":"ordered0003","":"ordered0004","":"ordered0005","":"ordered0006","":"ordered0007","":"ordered0008","":"ordered0009","":"ordered0010","":"ordered0011","":"ordered0012","":"ordered0013","":"ordered0016","":"ordered0020","":"ordered0021","":"ordered0022","":"ordered0023","":"ordered0028","":"ordered0029","":"ordered0037","":"ordered0038","":"ordered0043","":"ordered0044","":"ordered0045","":"ordered0047","":"ordered0048","":"ordered0049","":"ordered0055","":"ordered0056","":"ordered0057","":"ordered0058","":"ordered0059","":"ordered0060","":"ordered0061","":"ordered0062","":"ordered0063","":"ordered0064","":"ordered0065","":"ordered0066","":"ordered0067","":"ordered0068","":"ordered0069","":"ordered0070","":"ordered0071","":"ordered0072","":"ordered0074","":"ordered0076","":"ordered0077","":"ordered0080","":"ordered0081","":"ordered0082","":"ordered0084","":"ordered0086","":"ordered0087","":"ordered0088","":"ordered0089","":"ordered0090","":"ordered0091","":"ordered0092","":"ordered0094","":"ordered0096","":"ordered0102","":"ordered0108","":"ordered0118","":"ordered0119","":"ordered0120","":"ordered0123","":"ordered0125","":"ordered0126","":"ordered0127","":"ordered0128","":"ordered0129","":"ordered0133","":"ordered0135","":"ordered0138","":"ordered0139","":"ordered0140","":"ordered0143","":"ordered0144","":"ordered0146","":"ordered0147","":"ordered0148","":"ordered0149","":"ordered0151","":"ordered0152","":"ordered0153","":"ordered0154","":"ordered0155","":"ordered0157","":"ordered0159","":"ordered0160","":"ordered0162","":"ordered0164","":"ordered0165","":"ordered0204","":"ordered0215","":"ordered0222","":"ordered0228","":"ordered0246","":"ordered0258","":"ordered0261","":"ordered0272","":"ordered0330","":"ordered0364","":"ordered0380","":"ordered0381","":"ordered0382","":"ordered0383","":"ordered0385","":"ordered0387","":"ordered0388","":"ordered0389","":"ordered0390","":"ordered0391","":"ordered0392","":"ordered0393","":"ordered0395","":"ordered0397","":"ordered0398","":"ordered0399","":"ordered0400","":"ordered0401","":"ordered0402","":"ordered0403","":"ordered0405","":"ordered0420","":"ordered0426","":"ordered0432","":"ordered0433","":"ordered0434","":"ordered0435","":"ordered0436","":"ordered0437","":"ordered0438","":"ordered0441","":"ordered0443","":"ordered0444","":"ordered0445","":"ordered0446","":"ordered0448","":"ordered0449","":"ordered0452","":"ordered0453","":"ordered0457","":"ordered0462","":"ordered0463","":"ordered0467","":"ordered0468","":"ordered0469","":"ordered0470","":"ordered0471","":"ordered0472","":"ordered0473","":"ordered0474","":"ordered0476","":"ordered0477","":"ordered0478","":"ordered0481","":"ordered0482","":"ordered0491","":"ordered0492","":"ordered0493","":"ordered0494","":"ordered0495","":"ordered0496","":"ordered0497","":"ordered0499","":"ordered0501","":"ordered0502","":"ordered0504","":"ordered0505","":"ordered0506","":"ordered0507","":"ordered0508","":"ordered0509","":"ordered0515","":"ordered0516","":"ordered0517","":"ordered0518","":"ordered0521","":"ordered0522","":"ordered0523","":"ordered0524","":"ordered0525","":"ordered0526","":"ordered0527","":"ordered0528","":"ordered0530","":"ordered0531","":"ordered0533","":"ordered0534","":"ordered0535","":"ordered0536","":"ordered0537","":"ordered0538","":"ordered0540","":"ordered0541","":"ordered0544","":"ordered0545","":"ordered0546","":"ordered0550","":"ordered0551","":"ordered0552","":"ordered0553","":"ordered0555","":"ordered0559","":"ordered0560","":"ordered0561","":"ordered0562","":"ordered0564","":"ordered0570","":"ordered0576","":"ordered0583","":"ordered0585","":"ordered0591","":"ordered0593","":"ordered0594","":"ordered0596","":"ordered0597","":"ordered0598","":"ordered0599","":"ordered0600","":"ordered0601","":"ordered0602","":"ordered0603","":"ordered0604","":"ordered0606","":"ordered0607","":"ordered0626","":"ordered0627","":"ordered0630","":"ordered0631","":"ordered0633","":"ordered0636","":"ordered0637","":"ordered0638","":"ordered0639","":"ordered0640","":"ordered0644","":"ordered0645","":"ordered0649","":"ordered0651","":"ordered0652","":"ordered0653","":"ordered0656","":"ordered0657","":"ordered0658","":"ordered0659","":"ordered0660","":"ordered0661","":"ordered0662","":"ordered0664","":"ordered0665","":"ordered0666","":"ordered0667","":"ordered0668","":"ordered0669","":"ordered0670","":"ordered0671","":"ordered0672","":"ordered0676","":"ordered0677","":"ordered0683","":"ordered0689","":"ordered0691","":"ordered0697","":"ordered0703","":"ordered0709","":"ordered0715","":"ordered0721","":"ordered0727","":"ordered0733","":"ordered0739","":"ordered0745","":"ordered0751","":"ordered0757","":"ordered0758","":"ordered0760","":"ordered0761","":"ordered0763","":"ordered0764","":"ordered0765","":"ordered0768","":"ordered0771","":"ordered0772","":"ordered0773","":"ordered0774","":"ordered0775","":"ordered0778","":"ordered0784","":"ordered0790","":"ordered0796","":"ordered0817","":"ordered0820","":"ordered0826","":"ordered0833","":"ordered0839","":"ordered0845","":"ordered0851","":"ordered0857","":"ordered0863","":"ordered0869","":"ordered0875","":"ordered0883","":"ordered0884","":"ordered0890","":"ordered0891","":"ordered0892","":"ordered0893","":"ordered0894","":"ordered0900","":"ordered0906","":"ordered0912","":"ordered0913","":"ordered0919","":"ordered0925","":"ordered0931","":"ordered0932","":"ordered0933","":"ordered0934","":"ordered0936","":"ordered0937","":"ordered0938","":"ordered0941","":"ordered0942","":"ordered0945","":"ordered0946","":"ordered0947","":"ordered0950","":"ordered0951","":"ordered0952","":"ordered0953","":"ordered0954","":"ordered0955","":"ordered0956","":"ordered0958","":"ordered0960","":"ordered0961","":"ordered0962","":"ordered0963","":"ordered0965","":"ordered0967","":"ordered0968","":"ordered0969","":"ordered0980","":"ordered0981","":"ordered0989","":"ordered0990","":"ordered0991","":"ordered0992","":"ordered0993","":"ordered0995","":"ordered0996","":"ordered1018","":"ordered1025","":"ordered1028","":"ordered1029","":"ordered1030","":"ordered1031","":"ordered1037","":"ordered1039","":"ordered1042","":"ordered1045","":"ordered1046","":"ordered1047","":"ordered1048","":"ordered1050","":"ordered1051","":"ordered1053","":"ordered1054","":"ordered1055","":"ordered1066","":"ordered1069","":"ordered1073","":"ordered1074","":"ordered1075","":"ordered1076","":"ordered1085","":"ordered1086","":"ordered1093","":"ordered1096","":"ordered1099","":"ordered1103","":"ordered1104","":"ordered1105","":"ordered1106","":"ordered1107","":"ordered1108","":"ordered1118","":"ordered1119","":"ordered1120","":"ordered1121","":"ordered1122","":"ordered1123","":"ordered1124","":"ordered1125","":"ordered1126","":"ordered1127","":"ordered1128","":"ordered1129","":"ordered1148","":"ordered1149","":"ordered1150","":"ordered1154","":"ordered1155","":"ordered1156","":"ordered1157","":"ordered1162","":"ordered1163","":"ordered1165","":"ordered1166","":"ordered1168","":"ordered1171","":"ordered1172","":"ordered1173","":"ordered1175","":"ordered1177","":"ordered1179","":"ordered1181","":"ordered1182","":"ordered1183","":"ordered1185","":"ordered1186","":"ordered1187","":"ordered1188","":"ordered1190","":"ordered1193","":"ordered1195","":"ordered1198","":"ordered1201","":"ordered1202","":"ordered1203","":"ordered1204","":"ordered1208","":"ordered1218","":"ordered1224","":"ordered1230","":"ordered1245","":"ordered1263","":"ordered1269","":"ordered1272","":"ordered1273","":"ordered1274","":"ordered1276","":"ordered1278","":"ordered1281","":"ordered1284","":"ordered1286","":"ordered1287","":"ordered1288","":"ordered1290","":"ordered1292","":"ordered1294","":"ordered1295","":"ordered1303","":"ordered1310","":"ordered1311","":"ordered1313","":"ordered1318","":"ordered1319","":"ordered1324","":"ordered1338","":"ordered1346","":"ordered1347","":"ordered1348","":"ordered1349","":"ordered1350","":"ordered1351","":"ordered1353"}},,,,function(e,t,r){function n(e,t,r,n,a){var s,c;if(!(e&&t&&r&&Wa.me))throw new Error("MsgKey error: "+[e,t,r,Wa.me].join());a=e===t?a:void 0,e===t&&e===Wa.me?(s="out"===a,c=Wa.me):e===Wa.me?(s=!0,c=t):t===Wa.me?(s=!1,c=e):e===t&&(Wa.isGroupWid(e)||Wa.isBroadcastWid(e))?(s=!0,c=e):i.log("MsgKey case error: "+[e,t,r,Wa.me].join(),"red")(),this.fromMe=s,this.remote=c,this.id=r;var d=[this.fromMe,this.remote,this.id];"undefined"!=typeof a&&(this.self=a,d.push(this.self)),o.gte([0,5])&&o.supportsFeature("KEY_PARTICIPANT")&&"undefined"!=typeof n&&(this.participant=n,d.push(this.participant)),this._serialized=d.join("_")}var i=r(14),o=r(170);n.prototype={toString:function(){return this._serialized}},e.exports=n},function(e,t){function r(){this.proto=[0,0]}var n=[[{KEY_PARTICIPANT:!1,MEDIA_RETRY:!1,RESEND_ICON:!1},{},{},{FORWARD_MESSAGE:!0},{SET_STATUS:!0,SET_PROFILE_PIC:!0,SET_BLOCK:!0,MUTE:!0,ARCHIVE:!0,DELETE:!0,GROUP_CREATE:!0,GROUP_EXIT:!0,GROUP_SET_SUBJECT:!0,GROUP_SET_PIC:!0,GROUP_ADD_PARTICIPANT:!0,GROUP_REMOVE_PARTICIPANT:!0,GROUP_PROMOTE_PARTICIPANT:!0},{RECENT_EMOJI_SYNC:!0,MESSAGE_DELETE:!0,CHAT_MARK_UNSEEN:!0},{},{}]],i={KEY_PARTICIPANT:!1,MEDIA_RETRY:!1};r.prototype={setVersion:function(e){if(this.proto.length!==e.length||this.proto[0]!==e[0]||this.proto[1]!==e[1]){this.proto=e;var t=n.slice(0,e[0]+1),r=n.slice(e[0]+1,n.length),i=t[e[0]],o=i.slice(0,e[1]+1),a=i.slice(e[1]+1,i.length);t[e[0]]=o,r.unshift(a),this.features=_.merge(_.omit(_.merge.apply(_,[{}].concat(_.flatten(t))),function(e){return!e}),this.features||{});var s=_.merge.apply(_,[{}].concat(_.flatten(r)));this.features=_.omit(this.features,function(e,t){return!!s[t]}),this.F=_(n).flatten().map(_.keys).flatten().uniq().map(function(e){return[e,e]}).zipObject().value()}},setPlatform:function(e){switch(e){case"iphone":this.features.RECENT_EMOJI_SYNC=!1,this.features.RESEND_ICON=!0;break;case"symbian":case"s40":case"bb":this.features.CHAT_MARK_UNSEEN=!1}},setFeature:function(e,t){var r=this.features[e]!==t;return this.features[e]=t,r},setFeatures:function(e){var t={},r=_.merge({},i,e);for(var n in r)t[n]=this.setFeature(n,!!r[n]);return t},supportsFeature:function(e){return!!this.features[e]},lt:function(e){var t=this.proto;return e[0]>t[0]||e[0]===t[0]&&e[1]>t[1]},lte:function(e){var t=this.proto;return e[0]>t[0]||e[0]===t[0]&&e[1]>=t[1]},gt:function(e){var t=this.proto;return e[0]<t[0]||e[0]===t[0]&&e[1]<t[1]},gte:function(e){var t=this.proto;return e[0]<t[0]||e[0]===t[0]&&e[1]<=t[1]}};var o=new r;e.exports=o},function(e,t,r){function n(e){this.regex=new RegExp("^"+e[0]+"$"),this.formatString=e[1],this.leadins=_.map(e[2],function(e){return new RegExp("^(?:"+e+")")})}function i(e){var t=s[e];return t?d[e]={lengths:t[0],formats:t[1].map(function(e){return new n(e)})}:null}function o(e){var t=e.match(c);return t?t[0]:e.length>=3?e.substring(0,3):e}function a(e){var t=o(e);if(!t)return e;var r=e.substring(t.length),n=d[t]||i(t);if(!n)return"+"+t+" "+r;for(var a=n.formats,s=0;s<a.length;s++){var c=a[s].testAndFormat(r);if(c)return"+"+t+" "+c}return"+"+t+" "+r}var s=r(172),c=/^(1|2[07]|3[0-469]|4[013-9]|5[1-8]|6[0-6]|7|8[1246]|9[0-58])/,d={};n.prototype={testAndFormat:function(e){return this.regex.test(e)&&this.checkLeadins(e)&&e.replace(this.regex,this.formatString)},checkLeadins:function(e){return 0===this.leadins.length||_.any(this.leadins,function(t){return t.test(e)})}},e.exports={findCC:o,format:a}},function(e,t){e.exports={1:[[10],[["(...)(....)","$1-$2",[]],["(...)(...)(....)","($1) $2-$3",[]]]],7:[[10],[["(...)(..)(..)","$1-$2-$3",["[1-79]"]],["([3489]..)(...)(..)(..)","$1 $2-$3-$4",["[34689]"]],["(7..)(...)(....)","$1 $2 $3",["7"]]]],20:[[9,10],[["(.)(.{7,8})","$1 $2",["[23]"]],["(...)(...)(....)","$1 $2 $3",["1[012]|[89]00"]],["(..)(.{6,7})","$1 $2",["1[35]|[4-6]|[89][2-9]"]]]],27:[[9],[["(860)(...)(...)","$1 $2 $3",["860"]],["(..)(...)(....)","$1 $2 $3",["[1-79]|8(?:[0-47]|6[1-9])"]],["(..)(.{3,4})","$1 $2",["8[1-4]"]],["(..)(...)(.{2,3})","$1 $2 $3",["8[1-4]"]]]],30:[[10],[["([27].)(....)(....)","$1 $2 $3",["21|7"]],["(...)(...)(....)","$1 $2 $3",["2[2-9]1|[689]"]],["(2...)(.{6})","$1 $2",["2[2-9][02-9]"]]]],31:[[9],[["([1-578].)(...)(....)","$1 $2 $3",["1[035]|2[0346]|3[03568]|4[0356]|5[0358]|7|8[4578]"]],["([1-5]..)(...)(...)","$1 $2 $3",["1[16-8]|2[259]|3[124]|4[17-9]|5[124679]"]],["(6)(.{8})","$1 $2",["6[0-57-9]"]],["(66)(.{7})","$1 $2",["66"]],["(14)(.{3,4})","$1 $2",["14"]],["([89]0.)(.{4,7})","$1 $2",["80|9"]]]],32:[[9],[["(...)(..)(..)(..)","$1 $2 $3 $4",["4[6-9]"]],["(.)(...)(..)(..)","$1 $2 $3 $4",["[23]|4[23]|9[2-4]"]],["(..)(..)(..)(..)","$1 $2 $3 $4",["[156]|7[018]|8(?:0[1-9]|[1-79])"]],["(...)(..)(...)","$1 $2 $3",["(?:80|9)0"]]]],33:[[9],[["([1-79])(..)(..)(..)(..)","$1 $2 $3 $4 $5",["[1-79]"]],["(1..)(...)","$1 $2",["11"]],["(8..)(..)(..)(..)","$1 $2 $3 $4",["8"]]]],34:[[9],[["([5-9]..)(..)(..)(..)","$1 $2 $3 $4",["[568]|[79][0-8]"]]]],36:[[9],[["(1)(...)(....)","$1 $2 $3",["1"]],["(..)(...)(.{3,4})","$1 $2 $3",["[2-9]"]]]],39:[[9,10],[["(..)(.{3,4})(....)","$1 $2 $3",["0[26]|55"]],["(0[26])(....)(.....)","$1 $2 $3",["0[26]"]],["(0[26])(.{4,6})","$1 $2",["0[26]"]],["(0..)(.{3,4})(....)","$1 $2 $3",["0[13-57-9][0159]"]],["(...)(.{3,6})","$1 $2",["0[13-57-9][0159]|8(?:03|4[17]|9[245])","0[13-57-9][0159]|8(?:03|4[17]|9(?:2|[45][0-4]))"]],["(0...)(...)(....)","$1 $2 $3",["0[13-57-9][2-46-8]"]],["(0...)(.{2,6})","$1 $2",["0[13-57-9][2-46-8]"]],["(...)(...)(.{3,4})","$1 $2 $3",["[13]|8(?:00|4[08]|9[59])","[13]|8(?:00|4[08]|9(?:5[5-9]|9))"]],["(....)(....)","$1 $2",["894","894[5-9]"]],["(...)(....)(....)","$1 $2 $3",["3"]]]],40:[[9],[["([237].)(...)(....)","$1 $2 $3",["[23]1"]],["(21)(....)","$1 $2",["21"]],["(...)(...)(...)","$1 $2 $3",["[23][3-7]|[7-9]"]],["(2..)(...)","$1 $2",["2[3-6]"]]]],41:[[9],[["([2-9].)(...)(..)(..)","$1 $2 $3 $4",["[2-7]|[89]1"]],["([89]..)(...)(...)","$1 $2 $3",["8[047]|90"]],["(...)(..)(...)(..)(..)","$1 $2 $3 $4 $5",["860"]]]],43:[[10,11,12,13],[["(1)(.{3,12})","$1 $2",["1"]],["(5.)(.{3,5})","$1 $2",["5[079]"]],["(5.)(...)(.{3,4})","$1 $2 $3",["5[079]"]],["(5.)(....)(.{4,7})","$1 $2 $3",["5[079]"]],["(...)(.{3,10})","$1 $2",["316|46|51|732|6(?:44|5[0-3579]|[6-9])|7(?:1|[28]0)|[89]"]],["(....)(.{3,9})","$1 $2",["2|3(?:1[1-578]|[3-8])|4[2378]|5[2-6]|6(?:[12]|4[1-35-9]|5[468])|7(?:2[1-8]|35|4[1-8]|[5-79])"]]]],44:[[10],[["(..)(....)(....)","$1 $2 $3",["2|5[56]|7(?:0|6[013-9])","2|5[56]|7(?:0|6(?:[013-9]|2[0-35-9]))"]],["(...)(...)(....)","$1 $2 $3",["1(?:1|.1)|3|9[018]"]],["(.....)(.{4,5})","$1 $2",["1(?:38|5[23]|69|76|94)","1(?:387|5(?:24|39)|697|768|946)","1(?:3873|5(?:242|39[456])|697[347]|768[347]|9467)"]],["(1...)(.{5,6})","$1 $2",["1"]],["(7...)(.{6})","$1 $2",["7(?:[1-5789]|62)","7(?:[1-5789]|624)"]],["(800)(....)","$1 $2",["800","8001","80011","800111","8001111"]],["(845)(46)(4.)","$1 $2 $3",["845","8454","84546","845464"]],["(8..)(...)(....)","$1 $2 $3",["8(?:4[2-5]|7[0-3])"]],["(80.)(...)(....)","$1 $2 $3",["80"]],["([58]00)(.{6})","$1 $2",["[58]00"]]]],45:[[8],[["(..)(..)(..)(..)","$1 $2 $3 $4",[]]]],46:[[9],[["(8)(.{2,3})(.{2,3})(..)","$1 $2 $3 $4",["8"]],["([1-69].)(.{2,3})(..)(..)","$1 $2 $3 $4",["1[013689]|2[0136]|3[1356]|4[0246]|54|6[03]|90"]],["([1-69].)(...)(..)","$1 $2 $3",["1[13689]|2[136]|3[1356]|4[0246]|54|6[03]|90"]],["(...)(..)(..)(..)","$1 $2 $3 $4",["1[2457]|2[2457-9]|3[0247-9]|4[1357-9]|5[0-35-9]|6[124-9]|9(?:[125-8]|3[0-5]|4[0-3])"]],["(...)(.{2,3})(..)","$1 $2 $3",["1[2457]|2[2457-9]|3[0247-9]|4[1357-9]|5[0-35-9]|6[124-9]|9(?:[125-8]|3[0-5]|4[0-3])"]],["(7.)(...)(..)(..)","$1 $2 $3 $4",["7"]],["(77)(..)(..)","$1 $2 $3",["7"]],["(20)(.{2,3})(..)","$1 $2 $3",["20"]],["(9[034].)(..)(..)(...)","$1 $2 $3 $4",["9[034]"]],["(9[034].)(....)","$1 $2",["9[034]"]]]],47:[[8],[["([489]..)(..)(...)","$1 $2 $3",["[489]"]],["([235-7].)(..)(..)(..)","$1 $2 $3 $4",["[235-7]"]]]],48:[[9],[["(..)(...)(..)(..)","$1 $2 $3 $4",["[14]|2[0-57-9]|3[2-4]|5[24-689]|6[1-3578]|7[14-7]|8[1-79]|9[145]"]],["(..)(.)(....)","$1 $2 $3",["[12]2"]],["(...)(...)(...)","$1 $2 $3",["26|39|5[0137]|6[0469]|7[02389]|8[08]"]],["(...)(..)(.{2,3})","$1 $2 $3",["64"]],["(...)(...)","$1 $2",["64"]]]],49:[[7,8,9,10,11,12],[["(1..)(.{7,8})","$1 $2",["1[67]"]],["(15...)(.{6})","$1 $2",["15[0568]"]],["(1...)(.{7})","$1 $2",["15"]],["(..)(.{3,11})","$1 $2",["3[02]|40|[68]9"]],["(...)(.{3,11})","$1 $2",["2(?:.1|0[2389]|1[24]|28|34)|3(?:[3-9][15]|40)|[4-8][1-9]1|9(?:06|[1-9]1)"]],["(....)(.{2,11})","$1 $2",["[24-6]|[7-9](?:.[1-9]|[1-9].)|3(?:[3569][02-46-9]|4[2-4679]|7[2-467]|8[2-46-8])","[24-6]|[7-9](?:.[1-9]|[1-9].)|3(?:3(?:0[1-467]|2[127-9]|3[124578]|[46][1246]|7[1257-9]|8[1256]|9[145])|4(?:2[135]|3[1357]|4[13578]|6[1246]|7[1356]|9[1346])|5(?:0[14]|2[1-3589]|3[1357]|4[1246]|6[1-4]|7[1346]|8[13568]|9[1246])|6(?:0[356]|2[1-489]|3[124-6]|4[1347]|6[13]|7[12579]|8[1-356]|9[135])|7(?:2[1-7]|3[1357]|4[145]|6[1-5]|7[1-4])|8(?:21|3[1468]|4[1347]|6[0135-9]|7[1467]|8[136])|9(?:0[12479]|2[1358]|3[1357]|4[134679]|6[1-9]|7[136]|8[147]|9[1468]))"]],["(3....)(.{1,10})","$1 $2",["3"]],["(800)(.{7,12})","$1 $2",["800"]],["(177)(99)(.{7,8})","$1 $2 $3",["177","1779","17799"]],["(...)(.)(.{4,10})","$1 $2 $3",["(?:18|90)0|137","1(?:37|80)|900[1359]"]],["(1..)(.{5,11})","$1 $2",["181"]],["(18...)(.{6})","$1 $2",["185","1850","18500"]],["(18..)(.{7})","$1 $2",["18[68]"]],["(18.)(.{8})","$1 $2",["18[2-579]"]],["(700)(....)(....)","$1 $2 $3",["700"]],["(138)(....)","$1 $2",["138"]]]],
51:[[9],[["(1)(.{7})","$1 $2",["1"]],["([4-8].)(.{6})","$1 $2",["[4-7]|8[2-4]"]],["(...)(.....)","$1 $2",["80"]],["(9..)(...)(...)","$1 $2 $3",["9"]]]],52:[[10,11],[["([358].)(....)(....)","$1 $2 $3",["33|55|81"]],["(...)(...)(....)","$1 $2 $3",["[2467]|3[0-2457-9]|5[089]|8[02-9]|9[0-35-9]"]],["(1)([358].)(....)(....)","$1 $2 $3 $4",["1(?:33|55|81)"]],["(1)(...)(...)(....)","$1 $2 $3 $4",["1(?:[2467]|3[0-2457-9]|5[089]|8[2-9]|9[1-35-9])"]]]],53:[[8],[["(.)(.{6,7})","$1 $2",["7"]],["(..)(.{4,6})","$1 $2",["[2-4]"]],["(.)(.{7})","$1 $2",["5"]]]],54:[[10,11],[["([68]..)(...)(....)","$1-$2-$3",["[68]"]],["(..)(....)","$1-$2",["[2-9]"]],["(...)(....)","$1-$2",["[2-9]"]],["(....)(....)","$1-$2",["[2-9]"]],["(9)(11)(....)(....)","$1 $2 $3-$4",["911"]],["(9)(...)(...)(....)","$1 $2 $3-$4",["9(?:2[234689]|3[3-8])","9(?:2(?:2[013]|3[067]|49|6[01346]|80|9[147-9])|3(?:36|4[1-358]|5[138]|6[24]|7[069]|8[013578]))","9(?:2(?:2(?:0[013-9]|[13])|3(?:0[013-9]|[67])|49|6(?:[0136]|4[0-59])|8|9(?:[19]|44|7[013-9]|8[14]))|3(?:36|4(?:[12]|3[456]|[58]4)|5(?:1|3[0-24-689]|8[46])|6|7[069]|8(?:[01]|34|[578][45])))","9(?:2(?:2(?:0[013-9]|[13])|3(?:0[013-9]|[67])|49|6(?:[0136]|4[0-59])|8|9(?:[19]|44|7[013-9]|8[14]))|3(?:36|4(?:[12]|3(?:4|5[014]|6[1239])|[58]4)|5(?:1|3[0-24-689]|8[46])|6|7[069]|8(?:[01]|34|[578][45])))"]],["(9)(....)(..)(....)","$1 $2 $3-$4",["9[23]"]],["(11)(....)(....)","$1 $2-$3",["1"]],["(...)(...)(....)","$1 $2-$3",["2(?:2[013]|3[067]|49|6[01346]|80|9[147-9])|3(?:36|4[1-358]|5[138]|6[24]|7[069]|8[013578])","2(?:2(?:0[013-9]|[13])|3(?:0[013-9]|[67])|49|6(?:[0136]|4[0-59])|8|9(?:[19]|44|7[013-9]|8[14]))|3(?:36|4(?:[12]|3[456]|[58]4)|5(?:1|3[0-24-689]|8[46])|6|7[069]|8(?:[01]|34|[578][45]))","2(?:2(?:0[013-9]|[13])|3(?:0[013-9]|[67])|49|6(?:[0136]|4[0-59])|8|9(?:[19]|44|7[013-9]|8[14]))|3(?:36|4(?:[12]|3(?:4|5[014]|6[1239])|[58]4)|5(?:1|3[0-24-689]|8[46])|6|7[069]|8(?:[01]|34|[578][45]))"]],["(....)(..)(....)","$1 $2-$3",["[23]"]],["(...)","$1",["1[012]|911"]]]],55:[[10,11],[["(....)(....)","$1-$2",["[2-9](?:[1-9]|0[1-9])"]],["(.....)(....)","$1-$2",["9(?:[1-9]|0[1-9])"]],["(.{3,5})","$1",["1[125689]"]],["(..)(.....)(....)","$1 $2-$3",["(?:[189][1-9]|2[12478])9"]],["(..)(....)(....)","$1 $2-$3",["[1-9][1-9]"]],["([34]00.)(....)","$1-$2",["[34]00"]],["([3589]00)(.{2,3})(....)","$1 $2 $3",["[3589]00"]]]],56:[[9],[["(.)(....)(....)","$1 $2 $3",["2[23]"]],["(..)(...)(....)","$1 $2 $3",["[357]|4[1-35]|6[13-57]"]],["(9)(....)(....)","$1 $2 $3",["9"]],["(44)(...)(....)","$1 $2 $3",["44"]],["([68]00)(...)(.{3,4})","$1 $2 $3",["60|8"]],["(600)(...)(..)(...)","$1 $2 $3 $4",["60"]],["(1230)(...)(....)","$1 $2 $3",["1"]],["(.....)(....)","$1 $2",["219"]],["(.{4,5})","$1",["[1-9]"]]]],57:[[10],[["(.)(.{7})","$1 $2",["1(?:8[2-9]|9[0-3]|[2-7])|[24-8]","1(?:8[2-9]|9(?:09|[1-3])|[2-7])|[24-8]"]],["(...)(.{7})","$1 $2",["3"]],["(1)(...)(.{7})","$1 $2 $3",["1(?:80|9[04])","1(?:800|9(?:0[01]|4[78]))"]]]],58:[[10],[["(...)(.{7})","$1-$2",[]]]],60:[[9,10],[["([4-79])(...)(....)","$1-$2 $3",["[4-79]"]],["(3)(....)(....)","$1-$2 $3",["3"]],["([18].)(...)(.{3,4})","$1-$2 $3",["1[02-46-9][1-9]|8"]],["(1)([36-8]00)(..)(....)","$1-$2-$3-$4",["1[36-8]0"]],["(11)(....)(....)","$1-$2 $3",["11"]],["(15[49])(...)(....)","$1-$2 $3",["15"]]]],61:[[9],[["([2378])(....)(....)","$1 $2 $3",["[2378]"]],["(...)(...)(...)","$1 $2 $3",["[45]|14"]],["(16)(...)(.{2,4})","$1 $2 $3",["16"]],["(1[389]..)(...)(...)","$1 $2 $3",["1(?:[38]0|90)","1(?:[38]00|90)"]],["(180)(2...)","$1 $2",["180","1802"]],["(19.)(...)","$1 $2",["19[13]"]],["(19..)(....)","$1 $2",["19[67]"]],["(13)(..)(..)","$1 $2 $3",["13[1-9]"]]]],62:[[9,10,11],[["(..)(.{5,8})","$1 $2",["2[124]|[36]1"]],["(...)(.{5,8})","$1 $2",["[4579]|2[035-9]|[36][02-9]"]],["(8..)(.{3,4})(.{3,4})","$1-$2-$3",["8[1-35-9]"]],["(177)(.{6,8})","$1 $2",["1"]],["(800)(.{5,7})","$1 $2",["800"]],["(80.)(.)(...)(...)","$1 $2 $3 $4",["80[79]"]]]],63:[[10],[["(2)(...)(....)","$1 $2 $3",["2"]],["(2)(.....)","$1 $2",["2"]],["(....)(.{4,6})","$1 $2",["3(?:23|39|46)|4(?:2[3-6]|[35]9|4[26]|76)|5(?:22|44)|642|8(?:62|8[245])","3(?:230|397|461)|4(?:2(?:35|[46]4|51)|396|4(?:22|63)|59[347]|76[15])|5(?:221|446)|642[23]|8(?:622|8(?:[24]2|5[13]))"]],["(.....)(....)","$1 $2",["346|4(?:27|9[35])|883","3469|4(?:279|9(?:30|56))|8834"]],["([3-8].)(...)(....)","$1 $2 $3",["[3-8]"]],["(...)(...)(....)","$1 $2 $3",["81|9"]],["(1800)(...)(....)","$1 $2 $3",["1"]],["(1800)(.{1,2})(...)(....)","$1 $2 $3 $4",["1"]]]],64:[[8,9,10],[["([34679])(...)(....)","$1-$2 $3",["[346]|7[2-57-9]|9[1-9]"]],["(24099)(...)","$1 $2",["240","2409","24099"]],["(..)(...)(...)","$1 $2 $3",["21"]],["(..)(...)(.{3,5})","$1 $2 $3",["2(?:1[1-9]|[69]|7[0-35-9])|70|86"]],["(2.)(.{3,4})(....)","$1 $2 $3",["2[028]"]],["(...)(...)(.{3,4})","$1 $2 $3",["2(?:10|74)|5|[89]0"]]]],65:[[8],[["([3689]...)(....)","$1 $2",["[369]|8[1-9]"]],["(1[89]00)(...)(....)","$1 $2 $3",["1[89]"]],["(7000)(....)(...)","$1 $2 $3",["70"]],["(800)(...)(....)","$1 $2 $3",["80"]]]],66:[[9],[["(2)(...)(....)","$1 $2 $3",["2"]],["([13-9].)(...)(.{3,4})","$1 $2 $3",["14|[3-9]"]],["(1[89]00)(...)(...)","$1 $2 $3",["1"]]]],81:[[10],[["(...)(...)(...)","$1-$2-$3",["(?:12|57|99)0"]],["(...)(...)(....)","$1-$2-$3",["800"]],["(....)(....)","$1-$2",["0077"]],["(....)(..)(.{3,4})","$1-$2-$3",["0077"]],["(....)(..)(....)","$1-$2-$3",["0088"]],["(....)(...)(.{3,4})","$1-$2-$3",["00(?:37|66)"]],["(....)(....)(.{4,5})","$1-$2-$3",["00(?:37|66)"]],["(....)(.....)(.{5,6})","$1-$2-$3",["00(?:37|66)"]],["(....)(.{6})(.{6,7})","$1-$2-$3",["00(?:37|66)"]],["(..)(....)(....)","$1-$2-$3",["[2579]0|80[1-9]"]],["(....)(.)(....)","$1-$2-$3",["1(?:26|3[79]|4[56]|5[4-68]|6[3-5])|5(?:76|97)|499|746|8(?:3[89]|63|47|51)|9(?:49|80|9[16])","1(?:267|3(?:7[247]|9[278])|4(?:5[67]|66)|5(?:47|58|64|8[67])|6(?:3[245]|48|5[4-68]))|5(?:76|97)9|499[2468]|7468|8(?:3(?:8[78]|96)|636|477|51[24])|9(?:496|802|9(?:1[23]|69))","1(?:267|3(?:7[247]|9[278])|4(?:5[67]|66)|5(?:47|58|64|8[67])|6(?:3[245]|48|5[4-68]))|5(?:769|979[2-69])|499[2468]|7468|8(?:3(?:8[78]|96[2457-9])|636[2-57-9]|477|51[24])|9(?:496|802|9(?:1[23]|69))"]],["(...)(..)(....)","$1-$2-$3",["1(?:2[3-6]|3[3-9]|4[2-6]|5[2-8]|[68][2-7]|7[2-689]|9[1-578])|2(?:2[03-689]|3[3-58]|4[0-468]|5[04-8]|6[013-8]|7[06-9]|8[02-57-9]|9[13])|4(?:2[28]|3[689]|6[035-7]|7[05689]|80|9[3-5])|5(?:3[1-36-9]|4[4578]|5[013-8]|6[1-9]|7[2-8]|8[14-7]|9[4-9])|7(?:2[15]|3[5-9]|4[02-9]|6[135-8]|7[0-4689]|9[014-9])|8(?:2[49]|3[3-8]|4[5-8]|5[2-9]|6[35-9]|7[579]|8[03-579]|9[2-8])|9(?:[23]0|4[02-46-9]|5[024-79]|6[4-9]|7[2-47-9]|8[02-7]|9[3-7])","1(?:2[3-6]|3[3-9]|4[2-6]|5(?:[236-8]|[45][2-69])|[68][2-7]|7[2-689]|9[1-578])|2(?:2(?:[04-689]|3[23])|3[3-58]|4[0-468]|5(?:5[78]|7[2-4]|[0468][2-9])|6(?:[0135-8]|4[2-5])|7(?:[0679]|8[2-7])|8(?:[024578]|3[25-9]|9[6-9])|9(?:11|3[2-4]))|4(?:2(?:2[2-9]|8[237-9])|3[689]|6[035-7]|7(?:[059][2-8]|[68])|80|9[3-5])|5(?:3[1-36-9]|4[4578]|5[013-8]|6[1-9]|7[2-8]|8[14-7]|9(?:[89][2-8]|[4-7]))|7(?:2[15]|3[5-9]|4[02-9]|6[135-8]|7[0-4689]|9(?:[017-9]|4[6-8]|5[2-478]|6[2-589]))|8(?:2(?:4[4-8]|9[2-8])|3(?:7[2-6]|[3-6][2-9]|8[2-5])|4[5-8]|5[2-9]|6(?:[37]|5[4-7]|6[2-9]|8[2-8]|9[236-9])|7[579]|8[03-579]|9[2-8])|9(?:[23]0|4[02-46-9]|5[024-79]|6[4-9]|7[2-47-9]|8[02-7]|9(?:3[34]|[4-7]))","1(?:2[3-6]|3[3-9]|4[2-6]|5(?:[236-8]|[45][2-69])|[68][2-7]|7[2-689]|9[1-578])|2(?:2(?:[04-689]|3[23])|3[3-58]|4[0-468]|5(?:5[78]|7[2-4]|[0468][2-9])|6(?:[0135-8]|4[2-5])|7(?:[0679]|8[2-7])|8(?:[024578]|3[25-9]|9[6-9])|9(?:11|3[2-4]))|4(?:2(?:2[2-9]|8[237-9])|3[689]|6[035-7]|7(?:[059][2-8]|[68])|80|9[3-5])|5(?:3[1-36-9]|4[4578]|5[013-8]|6[1-9]|7[2-8]|8[14-7]|9(?:[89][2-8]|[4-7]))|7(?:2[15]|3[5-9]|4[02-9]|6[135-8]|7[0-4689]|9(?:[017-9]|4[6-8]|5[2-478]|6[2-589]))|8(?:2(?:4[4-8]|9(?:[3578]|20|4[04-9]|6[56]))|3(?:7(?:[2-5]|6[0-59])|[3-6][2-9]|8[2-5])|4[5-8]|5[2-9]|6(?:[37]|5(?:[467]|5[014-9])|6(?:[2-8]|9[02-69])|8[2-8]|9(?:[236-8]|9[23]))|7[579]|8[03-579]|9[2-8])|9(?:[23]0|4[02-46-9]|5[024-79]|6[4-9]|7[2-47-9]|8[02-7]|9(?:3(?:3[02-9]|4[0-24689])|4[2-69]|[5-7]))","1(?:2[3-6]|3[3-9]|4[2-6]|5(?:[236-8]|[45][2-69])|[68][2-7]|7[2-689]|9[1-578])|2(?:2(?:[04-689]|3[23])|3[3-58]|4[0-468]|5(?:5[78]|7[2-4]|[0468][2-9])|6(?:[0135-8]|4[2-5])|7(?:[0679]|8[2-7])|8(?:[024578]|3[25-9]|9[6-9])|9(?:11|3[2-4]))|4(?:2(?:2[2-9]|8[237-9])|3[689]|6[035-7]|7(?:[059][2-8]|[68])|80|9[3-5])|5(?:3[1-36-9]|4[4578]|5[013-8]|6[1-9]|7[2-8]|8[14-7]|9(?:[89][2-8]|[4-7]))|7(?:2[15]|3[5-9]|4[02-9]|6[135-8]|7[0-4689]|9(?:[017-9]|4[6-8]|5[2-478]|6[2-589]))|8(?:2(?:4[4-8]|9(?:[3578]|20|4[04-9]|6(?:5[25]|60)))|3(?:7(?:[2-5]|6[0-59])|[3-6][2-9]|8[2-5])|4[5-8]|5[2-9]|6(?:[37]|5(?:[467]|5[014-9])|6(?:[2-8]|9[02-69])|8[2-8]|9(?:[236-8]|9[23]))|7[579]|8[03-579]|9[2-8])|9(?:[23]0|4[02-46-9]|5[024-79]|6[4-9]|7[2-47-9]|8[02-7]|9(?:3(?:3[02-9]|4[0-24689])|4[2-69]|[5-7]))"]],["(..)(...)(....)","$1-$2-$3",["1|2(?:2[37]|5[5-9]|64|78|8[39]|91)|4(?:2[2689]|64|7[347])|5(?:[2-589]|39)|60|8(?:[46-9]|3[279]|2[124589])|9(?:[235-8]|93)","1|2(?:2[37]|5(?:[57]|[68]0|9[19])|64|78|8[39]|917)|4(?:2(?:[68]|20|9[178])|64|7[347])|5(?:[2-589]|39[67])|60|8(?:[46-9]|3[279]|2[124589])|9(?:[235-8]|93[34])","1|2(?:2[37]|5(?:[57]|[68]0|9(?:17|99))|64|78|8[39]|917)|4(?:2(?:[68]|20|9[178])|64|7[347])|5(?:[2-589]|39[67])|60|8(?:[46-9]|3[279]|2[124589])|9(?:[235-8]|93(?:31|4))"]],["(...)(..)(....)","$1-$2-$3",["2(?:9[14-79]|74|[34]7|[56]9)|82|993"]],["(.)(....)(....)","$1-$2-$3",["3|4(?:2[09]|7[01])|6[1-9]"]],["(..)(...)(....)","$1-$2-$3",["[2479][1-9]"]]]],82:[[9,10],[["(..)(....)(....)","$1-$2-$3",["1(?:0|1[19]|[69]9|5[458])|[57]0","1(?:0|1[19]|[69]9|5(?:44|59|8))|[57]0"]],["(..)(.{3,4})(....)","$1-$2-$3",["1(?:[169][2-8]|[78]|5[1-4])|[68]0|[3-6][1-9][1-9]","1(?:[169][2-8]|[78]|5(?:[1-3]|4[56]))|[68]0|[3-6][1-9][1-9]"]],["(...)(.)(....)","$1-$2-$3",["131","1312"]],["(...)(..)(....)","$1-$2-$3",["131","131[13-9]"]],["(...)(...)(....)","$1-$2-$3",["13[2-9]"]],["(..)(..)(...)(....)","$1-$2-$3-$4",["30"]],["(.)(.{3,4})(....)","$1-$2-$3",["2[1-9]"]],["(.)(.{3,4})","$1-$2",["21[0-46-9]"]],["(..)(.{3,4})","$1-$2",["[3-6][1-9]1","[3-6][1-9]1(?:[0-46-9])"]],["(....)(....)","$1-$2",["1(?:5[46-9]|6[04678]|8[0579])","1(?:5(?:44|66|77|88|99)|6(?:00|44|6[16]|70|88)|8(?:00|55|77|99))"]]]],84:[[9,10],[["([17]99)(....)","$1 $2",["[17]99"]],["([48])(....)(....)","$1 $2 $3",["[48]"]],["([235-7].)(....)(...)","$1 $2 $3",["2[025-79]|3[0136-9]|5[2-9]|6[0-46-8]|7[02-79]"]],["(80)(.....)","$1 $2",["80"]],["(69.)(.{4,5})","$1 $2",["69"]],["([235-7]..)(....)(...)","$1 $2 $3",["2[1348]|3[25]|5[01]|65|7[18]"]],["(9.)(...)(..)(..)","$1 $2 $3 $4",["9"]],["(1[2689].)(...)(....)","$1 $2 $3",["1(?:[26]|8[68]|99)"]],["(1[89]00)(.{4,6})","$1 $2",["1[89]0"]]]],86:[[11],[["(80..)(....)","$1 $2",["80[2678]"]],["([48]00)(...)(....)","$1 $2 $3",["[48]00"]],["(.{5,6})","$1",["100|95"]],["(..)(.{5,6})","$1 $2",["(?:10|2.)[19]","(?:10|2.)(?:10|9[56])","(?:10|2.)(?:100|9[56])"]],["(...)(.{5,6})","$1 $2",["[3-9]","[3-9]..[19]","[3-9]..(?:10|9[56])"]],["(.{3,4})(....)","$1 $2",["[2-9]"]],["(21)(....)(.{4,6})","$1 $2 $3",["21"]],["([12].)(....)(....)","$1 $2 $3",["10[1-9]|2[02-9]","10[1-9]|2[02-9]","10(?:[1-79]|8(?:[1-9]|0[1-9]))|2[02-9]"]],["(...)(....)(....)","$1 $2 $3",["3(?:11|7[179])|4(?:[15]1|3[12])|5(?:1|2[37]|3[12]|51|7[13-79]|9[15])|7(?:31|5[457]|6[09]|91)|8(?:[57]1|98)"]],["(...)(...)(....)","$1 $2 $3",["3(?:1[02-9]|35|49|5|7[02-68]|9[1-68])|4(?:1[02-9]|2[179]|[35][2-9]|6[4789]|7.|8[23])|5(?:3[03-9]|4[36]|5[02-9]|6[1-46]|7[028]|80|9[2-46-9])|6(?:3[1-5]|6[0238]|9[12])|7(?:01|[1579]|2[248]|3[04-9]|4[3-6]|6[2368])|8(?:1[236-8]|2[5-7]|3|5[4-9]|7[02-9]|8[3678]|9[1-7])|9(?:0[1-3689]|1[1-79]|[379]|4[13]|5[1-5])"]],["(...)(....)(....)","$1 $2 $3",["1[3-578]"]],["(10800)(...)(....)","$1 $2 $3",["108","1080","10800"]],["(...)(.{7,8})","$1 $2",["950"]]]],90:[[10],[["(...)(...)(....)","$1 $2 $3",["[23]|4(?:[0-35-9]|4[0-35-9])"]],["(...)(...)(....)","$1 $2 $3",["[589]"]],["(444)(.)(...)","$1 $2 $3",["444"]]]],91:[[10],[["(.....)(.....)","$1 $2",["7(?:0[2-9]|[257]|3[057-9]|4[0-389]|6[0-35-9]|8[0-79])|8(?:0[015689]|1[0-57-9]|2[2356-9]|3[0-57-9]|[45]|6[02457-9]|7[1-69]|8[0124-9]|9[02-9])|9","7(?:0(?:2[2-9]|[3-8]|9[0-8])|2(?:[079].|1[089]|2[0-79]|3[0-29]|4[89]|5[047-9]|6[015-9]|8[0-59])|3(?:0[1-9]|[58]|7[3679]|9[689])|4(?:0[1-9]|1[15-9]|[29][89]|39|8[389])|5(?:[034678]|2[03-9]|5[017-9]|9[7-9])|6(?:0[0-27]|1[0-257-9]|2[0-4]|3[19]|5[4589]|[6-9])|7(?:0[2-9]|[1-79]|8[1-9])|8(?:[0-7]|9[013-9]))|8(?:0(?:[01589]|6[67])|1(?:[02-589]|1[0135-9]|7[0-79])|2(?:[236-9]|5[1-9])|3(?:[0357-9]|4[1-9])|[45]|6[02457-9]|7[1-69]|8(?:[0-26-9]|44|5[2-9])|9(?:[035-9]|2[2-9]|4[0-8]))|9"]],["(..)(....)(....)","$1 $2 $3",["11|2[02]|33|4[04]|79|80[2-46]"]],["(...)(...)(....)","$1 $2 $3",["1(?:2[0-249]|3[0-25]|4[145]|[569][14]|7[1257]|8[1346]|[68][1-9])|2(?:1[257]|3[013]|4[01]|5[0137]|6[0158]|78|8[1568]|9[14])|3(?:26|4[1-3]|5[34]|6[01489]|7[02-46]|8[159])|4(?:1[36]|2[1-47]|3[15]|5[12]|6[0-26-9]|7[0-24-9]|8[013-57]|9[014-7])|5(?:1[025]|[36][25]|22|4[28]|5[12]|[78]1|9[15])|6(?:12|[2345]1|57|6[13]|7[14]|80)"]],["(...)(...)(....)","$1 $2 $3",["7(?:12|2[14]|3[134]|4[47]|5[15]|[67]1|88)","7(?:12|2[14]|3[134]|4[47]|5(?:1|5[2-6])|[67]1|88)"]],["(...)(...)(....)","$1 $2 $3",["8(?:16|2[014]|3[126]|6[136]|7[078]|8[34]|91)"]],["(....)(...)(...)","$1 $2 $3",["1(?:[23579]|[468][1-9])|[2-8]"]],["(1600)(..)(....)","$1 $2 $3",["160","1600"]],["(1800)(.{4,5})","$1 $2",["180","1800"]],["(18[06]0)(.{2,4})(....)","$1 $2 $3",["18[06]","18[06]0"]],["(140)(...)(....)","$1 $2 $3",["140"]],["(....)(...)(...)(...)","$1 $2 $3 $4",["18[06]","18(?:0[03]|6[12])"]]]],92:[[10],[["(..)(111)(...)(...)","$1 $2 $3 $4",["(?:2[125]|4[0-246-9]|5[1-35-7]|6[1-8]|7[14]|8[16]|91)1","(?:2[125]|4[0-246-9]|5[1-35-7]|6[1-8]|7[14]|8[16]|91)11","(?:2[125]|4[0-246-9]|5[1-35-7]|6[1-8]|7[14]|8[16]|91)111"]],["(...)(111)(...)(...)","$1 $2 $3 $4",["2[349]|45|54|60|72|8[2-5]|9[2-9]","(?:2[349]|45|54|60|72|8[2-5]|9[2-9]).1","(?:2[349]|45|54|60|72|8[2-5]|9[2-9]).11","(?:2[349]|45|54|60|72|8[2-5]|9[2-9]).111"]],["(..)(.{7,8})","$1 $2",["(?:2[125]|4[0-246-9]|5[1-35-7]|6[1-8]|7[14]|8[16]|91)[2-9]"]],["(...)(.{6,7})","$1 $2",["2[349]|45|54|60|72|8[2-5]|9[2-9]","(?:2[349]|45|54|60|72|8[2-5]|9[2-9]).[2-9]"]],["(3..)(.{7})","$1 $2",["3"]],["([15]...)(.{5,6})","$1 $2",["58[12]|1"]],["(586..)(.....)","$1 $2",["586"]],["([89]00)(...)(..)","$1 $2 $3",["[89]00"]]]],93:[[9],[["([2-7].)(...)(....)","$1 $2 $3",["[2-7]"]]]],94:[[9],[["(..)(.)(.{6})","$1 $2 $3",["[1-689]"]],["(..)(...)(....)","$1 $2 $3",["7"]]]],95:[[8,9,10],[["(.)(...)(.{3,4})","$1 $2 $3",["1|2[45]"]],["(2)(....)(....)","$1 $2 $3",["251"]],["(.)(..)(...)","$1 $2 $3",["16|2"]],["(..)(...)(.{3,4})","$1 $2 $3",["67|81"]],["(..)(..)(.{3,4})","$1 $2 $3",["[4-8]"]],["(9)(...)(.{4,6})","$1 $2 $3",["9(?:2[0-4]|[35-9]|4[13789])"]],["(9)(4....)(....)","$1 $2 $3",["94[0245]"]],["(9)(...)(...)(...)","$1 $2 $3 $4",["925"]]]],98:[[10],[["(21)(.{3,5})","$1 $2",["21"]],["(..)(....)(....)","$1 $2 $3",["[1-8]"]],["(...)(...)(.{3,4})","$1 $2 $3",["9"]],["(...)(..)(.{2,3})","$1 $2 $3",["9"]],["(...)(...)","$1 $2",["9"]]]],211:[[9],[["(...)(...)(...)","$1 $2 $3",[]]]],212:[[9],[["([56]..)(.{6})","$1-$2",["5(?:2[015-7]|3[0-4])|6"]],["([58]...)(.....)","$1-$2",["5(?:2[2-489]|3[5-9])|892","5(?:2(?:[2-48]|90)|3(?:[5-79]|80))|892"]],["(5....)(....)","$1-$2",["5(?:29|38)","5(?:29|38)[89]"]],["(8[09])(.{7})","$1-$2",["8(?:0|9[013-9])"]]]],213:[[9],[["([1-4].)(..)(..)(..)","$1 $2 $3 $4",["[1-4]"]],["([5-8]..)(..)(..)(..)","$1 $2 $3 $4",["[5-8]"]],["(9.)(...)(..)(..)","$1 $2 $3 $4",["9"]]]],216:[[8],[["(..)(...)(...)","$1 $2 $3",[]]]],218:[[9],[["([25679].)(.{7})","$1-$2",[]]]],220:[[7],[["(...)(....)","$1 $2",[]]]],221:[[9],[["(..)(...)(..)(..)","$1 $2 $3 $4",["[379]"]],["(...)(..)(..)(..)","$1 $2 $3 $4",["8"]]]],222:[[8],[["([2-48].)(..)(..)(..)","$1 $2 $3 $4",[]]]],223:[[8],[["(..)(..)(..)(..)","$1 $2 $3 $4",["[246-9]"]],["(....)","$1",["67|74"]]]],224:[[8,9],[["(..)(..)(..)(..)","$1 $2 $3 $4",["3"]],["(...)(..)(..)(..)","$1 $2 $3 $4",["[67]"]]]],225:[[8],[["(..)(..)(..)(..)","$1 $2 $3 $4",[]]]],226:[[8],[["(..)(..)(..)(..)","$1 $2 $3 $4",[]]]],227:[[8],[["(..)(..)(..)(..)","$1 $2 $3 $4",["[289]|09"]],["(08)(...)(...)","$1 $2 $3",["08"]]]],228:[[8],[["(..)(..)(..)(..)","$1 $2 $3 $4",[]]]],229:[[8],[["(..)(..)(..)(..)","$1 $2 $3 $4",[]]]],230:[[7,8],[["([2-46-9]..)(....)","$1 $2",["[2-46-9]"]],["(5...)(....)","$1 $2",["5"]]]],231:[[7,8,9],[["(2.)(...)(...)","$1 $2 $3",["2"]],["([79]..)(...)(...)","$1 $2 $3",["[79]"]],["([4-6])(...)(...)","$1 $2 $3",["[4-6]"]],["(..)(...)(....)","$1 $2 $3",["[38]"]]]],232:[[8],[["(..)(.{6})","$1 $2",[]]]],233:[[9],[["(..)(...)(....)","$1 $2 $3",["[235]"]],["(...)(.....)","$1 $2",["8"]]]],234:[[10],[["([129])(...)(.{3,4})","$1 $2 $3",["[129]"]],["(..)(...)(.{2,3})","$1 $2 $3",["[3-6]|7(?:[1-79]|0[1-9])|8[2-9]"]],["(...)(...)(.{3,4})","$1 $2 $3",["70|8[01]|90[2359]"]],["([78]00)(....)(.{4,5})","$1 $2 $3",["[78]00"]],["([78]00)(.....)(.{5,6})","$1 $2 $3",["[78]00"]],["(78)(..)(...)","$1 $2 $3",["78"]]]],235:[[8],[["(..)(..)(..)(..)","$1 $2 $3 $4",[]]]],236:[[8],[["(..)(..)(..)(..)","$1 $2 $3 $4",[]]]],237:[[8,9],[["([26])(..)(..)(..)(..)","$1 $2 $3 $4 $5",["[26]"]],["(..)(..)(..)(..)","$1 $2 $3 $4",["[23]|88"]],["(800)(..)(...)","$1 $2 $3",["80"]]]],238:[[7],[["(...)(..)(..)","$1 $2 $3",[]]]],239:[[7],[["(...)(....)","$1 $2",[]]]],240:[[9],[["(...)(...)(...)","$1 $2 $3",["[235]"]],["(...)(.{6})","$1 $2",["[89]"]]]],241:[[8],[["(.)(..)(..)(..)","$1 $2 $3 $4",["[2-7]"]],["(..)(..)(..)(..)","$1 $2 $3 $4",["0"]]]],242:[[9],[["(..)(...)(....)","$1 $2 $3",["[02]"]],["(.)(....)(....)","$1 $2 $3",["8"]]]],243:[[9],[["(..)(...)(....)","$1 $2 $3",["12"]],["([89]..)(...)(...)","$1 $2 $3",["8[0-2459]|9"]],["(..)(..)(...)","$1 $2 $3",["88"]],["(..)(.....)","$1 $2",["[1-6]"]]]],244:[[9],[["(...)(...)(...)","$1 $2 $3",[]]]],245:[[7],[["(...)(....)","$1 $2",[]]]],246:[[7],[["(...)(....)","$1 $2",[]]]],247:[[4],[]],248:[[7],[["(...)(...)","$1 $2",["8"]],["(.)(...)(...)","$1 $2 $3",["[246]"]]]],249:[[9],[["(..)(...)(....)","$1 $2 $3",[]]]],250:[[9],[["(2..)(...)(...)","$1 $2 $3",["2"]],["([7-9]..)(...)(...)","$1 $2 $3",["[7-9]"]],["(0.)(..)(..)(..)","$1 $2 $3 $4",["0"]]]],251:[[9],[["([1-59].)(...)(....)","$1 $2 $3",[]]]],252:[[8,9],[["(.)(.{6})","$1 $2",["2[0-79]|[13-5]"]],["(.)(.{7})","$1 $2",["24|[67]"]],["(..)(.{5,7})","$1 $2",["15|28|6[1378]"]],["(69.)(.{6})","$1 $2",["69"]],["(90.)(...)(...)","$1 $2 $3",["90"]]]],253:[[8],[["(..)(..)(..)(..)","$1 $2 $3 $4",[]]]],254:[[9],[["(..)(.{5,7})","$1 $2",["[24-6]"]],["(...)(.{6,7})","$1 $2",["7"]],["(...)(...)(.{3,4})","$1 $2 $3",["[89]"]]]],255:[[9],[["([24].)(...)(....)","$1 $2 $3",["[24]"]],["([67]..)(...)(...)","$1 $2 $3",["[67]"]],["([89]..)(..)(....)","$1 $2 $3",["[89]"]]]],256:[[9],[["(...)(.{6})","$1 $2",["[7-9]|20(?:[013-8]|2[5-9])|4(?:6[45]|[7-9])"]],["(..)(.{7})","$1 $2",["3|4(?:[1-5]|6[0-36-9])"]],["(2024)(.....)","$1 $2",["2024"]]]],257:[[8],[["(..)(..)(..)(..)","$1 $2 $3 $4",[]]]],258:[[9],[["([28].)(...)(.{3,4})","$1 $2 $3",["2|8[2-7]"]],["(80.)(...)(...)","$1 $2 $3",["80"]]]],260:[[9],[["([29].)(.{7})","$1 $2",["[29]"]],["(800)(...)(...)","$1 $2 $3",["8"]]]],261:[[9],[["([23].)(..)(...)(..)","$1 $2 $3 $4",[]]]],262:[[9],[["([268]..)(..)(..)(..)","$1 $2 $3 $4",[]]]],263:[[9,10],[["([49])(...)(.{2,4})","$1 $2 $3",["4|9[2-9]"]],["(7.)(...)(.{3,4})","$1 $2 $3",["7"]],["(86..)(...)(...)","$1 $2 $3",["86[24]"]],["([2356]..)(.{3,5})","$1 $2",["2(?:[278]|0[45]|[49]8)|3(?:08|17|3[78]|[78])|5[15][78]|6(?:[29]8|37|[68][78])"]],["(...)(...)(.{3,4})","$1 $2 $3",["2(?:[278]|0[45]|48)|3(?:08|17|3[78]|[78])|5[15][78]|6(?:[29]8|37|[68][78])|80"]],["([1-356].)(.{3,5})","$1 $2",["1[3-9]|2(?:[1-469]|0[0-35-9]|[45][0-79])|3(?:0[0-79]|1[0-689]|[24-69]|3[0-69])|5(?:[02-46-9]|[15][0-69])|6(?:[0145]|[29][0-79]|3[0-689]|[68][0-69])"]],["([1-356].)(...)(.{3,4})","$1 $2 $3",["1[3-9]|2(?:[1-469]|0[0-35-9]|[45][0-79])|3(?:0[0-79]|1[0-689]|[24-69]|3[0-69])|5(?:[02-46-9]|[15][0-69])|6(?:[0145]|[29][0-79]|3[0-689]|[68][0-69])"]],["([25]...)(.{3,5})","$1 $2",["(?:25|54)8","258[23]|5483"]],["(8...)(.{6})","$1 $2",["86"]],["(80.)(...)(....)","$1 $2 $3",["80"]]]],264:[[9],[["(8.)(...)(....)","$1 $2 $3",["8[1235]"]],["(6.)(.{2,3})(....)","$1 $2 $3",["6"]],["(88)(...)(...)","$1 $2 $3",["88"]],["(870)(...)(...)","$1 $2 $3",["870"]]]],265:[[9],[["(.)(...)(...)","$1 $2 $3",["1"]],["(2..)(...)(...)","$1 $2 $3",["2"]],["(...)(..)(..)(..)","$1 $2 $3 $4",["[1789]"]]]],266:[[8],[["(....)(....)","$1 $2",[]]]],267:[[8],[["(...)(....)","$1 $2",["[2-6]"]],["(7.)(...)(...)","$1 $2 $3",["7"]],["(90)(.....)","$1 $2",["9"]]]],268:[[8],[["(....)(....)","$1 $2",["[027]"]]]],269:[[7],[["(...)(..)(..)","$1 $2 $3",[]]]],290:[[4,5],[]],291:[[7],[["(.)(...)(...)","$1 $2 $3",[]]]],297:[[7],[["(...)(....)","$1 $2",[]]]],298:[[6],[["(.{6})","$1",[]]]],299:[[6],[["(..)(..)(..)","$1 $2 $3",[]]]],350:[[8],[["(...)(.....)","$1 $2",["2"]]]],351:[[9],[["(2.)(...)(....)","$1 $2 $3",["2[12]"]],["([2-46-9]..)(...)(...)","$1 $2 $3",["2[3-9]|[346-9]"]]]],352:[[9],[["(..)(...)","$1 $2",["[2-5]|7[1-9]|[89](?:[1-9]|0[2-9])"]],["(..)(..)(..)","$1 $2 $3",["[2-5]|7[1-9]|[89](?:[1-9]|0[2-9])"]],["(..)(..)(...)","$1 $2 $3",["20"]],["(..)(..)(..)(.{1,2})","$1 $2 $3 $4",["2(?:[0367]|4[3-8])"]],["(..)(..)(..)(...)","$1 $2 $3 $4",["20"]],["(..)(..)(..)(..)(.{1,2})","$1 $2 $3 $4 $5",["2(?:[0367]|4[3-8])"]],["(..)(..)(..)(.{1,4})","$1 $2 $3 $4",["2(?:[12589]|4[12])|[3-5]|7[1-9]|8(?:[1-9]|0[2-9])|9(?:[1-9]|0[2-46-9])"]],["(...)(..)(...)","$1 $2 $3",["70|80[01]|90[015]"]],["(...)(...)(...)","$1 $2 $3",["6"]]]],353:[[9],[["(1)(.{3,4})(....)","$1 $2 $3",["1"]],["(..)(.....)","$1 $2",["2[24-9]|47|58|6[237-9]|9[35-9]"]],["(...)(.....)","$1 $2",["40[24]|50[45]"]],["(48)(....)(....)","$1 $2 $3",["48"]],["(818)(...)(...)","$1 $2 $3",["81"]],["(..)(...)(.{3,4})","$1 $2 $3",["[24-69]|7[14]"]],["([78].)(.{3,4})(....)","$1 $2 $3",["76|8[35-9]"]],["(700)(...)(...)","$1 $2 $3",["70"]],["(....)(...)(...)","$1 $2 $3",["1(?:8[059]|5)","1(?:8[059]0|5)"]]]],354:[[7,8,9],[["(...)(....)","$1 $2",["[4-9]"]],["(3..)(...)(...)","$1 $2 $3",["3"]]]],355:[[9],[["(4)(...)(....)","$1 $2 $3",["4[0-6]"]],["(6[6-9])(...)(....)","$1 $2 $3",["6"]],["(..)(...)(...)","$1 $2 $3",["[2358][2-5]|4[7-9]"]],["(...)(.{3,5})","$1 $2",["[235][16-9]|8[016-9]|[79]"]]]],356:[[8],[["(....)(....)","$1 $2",[]]]],357:[[8],[["(..)(.{6})","$1 $2",[]]]],358:[[6,7,8,9,10,11],[["(...)(.{3,7})","$1 $2",["(?:[1-3]00|[6-8]0)"]],["(..)(.{4,10})","$1 $2",["[14]|2[09]|50|7[135]"]],["(.)(.{4,11})","$1 $2",["[25689][1-8]|3"]]]],359:[[9],[["(2)(.....)","$1 $2",["29"]],["(2)(...)(.{3,4})","$1 $2 $3",["2"]],["(...)(....)","$1 $2",["43[124-7]|70[1-9]"]],["(...)(...)(..)","$1 $2 $3",["43[124-7]|70[1-9]"]],["(...)(..)(...)","$1 $2 $3",["[78]00"]],["(...)(...)(...)","$1 $2 $3",["999"]],["(..)(...)(.{2,3})","$1 $2 $3",["[356]|4[124-7]|7[1-9]|8[1-6]|9[1-7]"]],["(..)(...)(.{3,4})","$1 $2 $3",["48|8[7-9]|9[08]"]]]],370:[[8],[["([34].)(.{6})","$1 $2",["37|4(?:1|5[45]|6[2-4])"]],["([3-6]..)(.....)","$1 $2",["3[148]|4(?:[24]|6[09])|528|6"]],["([7-9]..)(..)(...)","$1 $2 $3",["[7-9]"]],["(5)(2..)(....)","$1 $2 $3",["52[0-79]"]]]],371:[[8],[["([2689].)(...)(...)","$1 $2 $3",[]]]],372:[[7,8],[["([3-79]..)(....)","$1 $2",["[369]|4[3-8]|5(?:[0-2]|5[0-478]|6[45])|7[1-9]","[369]|4[3-8]|5(?:[02]|1(?:[0-8]|95)|5[0-478]|6(?:4[0-4]|5[1-589]))|7[1-9]"]],["(70)(..)(....)","$1 $2 $3",["70"]],["(8000)(...)(...)","$1 $2 $3",["800","8000"]],["([458]...)(.{3,4})","$1 $2",["40|5|8(?:00|[1-5])","40|5|8(?:00[1-9]|[1-5])"]]]],373:[[8],[["(..)(...)(...)","$1 $2 $3",["22|3"]],["([25-7]..)(..)(...)","$1 $2 $3",["2[13-79]|[5-7]"]],["([89]..)(.....)","$1 $2",["[89]"]]]],374:[[8],[["(..)(.{6})","$1 $2",["1|47"]],["(..)(.{6})","$1 $2",["4[139]|[5-7]|9[1-9]"]],["(...)(.....)","$1 $2",["[23]"]],["(...)(..)(...)","$1 $2 $3",["8|90"]]]],375:[[9],[["(..)(...)(..)(..)","$1 $2-$3-$4",["17[0-3589]|2[4-9]|[34]","17(?:[02358]|1[0-2]|9[0189])|2[4-9]|[34]"]],["(...)(..)(..)(..)","$1 $2-$3-$4",["1(?:5[24]|6[235]|7[467])|2(?:1[246]|2[25]|3[26])","1(?:5[24]|6(?:2|3[04-9]|5[0346-9])|7(?:[46]|7[37-9]))|2(?:1[246]|2[25]|3[26])"]],["(....)(..)(...)","$1 $2-$3",["1(?:5[169]|6[3-5]|7[179])|2(?:1[35]|2[34]|3[3-5])","1(?:5[169]|6(?:3[1-3]|4|5[125])|7(?:1[3-9]|7[0-24-6]|9[2-7]))|2(?:1[35]|2[34]|3[3-5])"]],["([89]..)(...)(....)","$1 $2 $3",["8[01]|9"]],["(8..)(....)(....)","$1 $2 $3",["82"]]]],376:[[6],[["(...)(...)","$1 $2",["[346-9]"]],["(180[02])(....)","$1 $2",["1"]]]],377:[[8,9],[["(..)(..)(..)(..)","$1 $2 $3 $4",["9"]],["(..)(...)(...)","$1 $2 $3",["4"]],["(6)(..)(..)(..)(..)","$1 $2 $3 $4 $5",["6"]],["(...)(...)(..)","$1 $2 $3",["8"]]]],378:[[8],[["(..)(..)(..)(..)","$1 $2 $3 $4",["[5-7]"]],["(0549)(.{6})","($1) $2",["0"]],["(.{6})","(0549) $1",["[89]"]]]],379:[[10],[]],380:[[9],[["([3-9].)(...)(....)","$1 $2 $3",["[38]9|4(?:[45][0-5]|87)|5(?:0|6[37]|7[37])|6[36-8]|73|9[1-9]","[38]9|4(?:[45][0-5]|87)|5(?:0|6(?:3[14-7]|7)|7[37])|6[36-8]|73|9[1-9]"]],["([3-689]..)(...)(...)","$1 $2 $3",["3[1-8]2|4[13678]2|5(?:[12457]2|6[24])|6(?:[49]2|[12][29]|5[24])|8[0-8]|90","3(?:[1-46-8]2[013-9]|52)|4(?:[1378]2|62[013-9])|5(?:[12457]2|6[24])|6(?:[49]2|[12][29]|5[24])|8[0-8]|90"]],["([3-6]...)(.....)","$1 $2",["3(?:5[013-9]|[1-46-8])|4(?:[137][013-9]|6|[45][6-9]|8[4-6])|5(?:[1245][013-9]|6[0135-9]|3|7[4-6])|6(?:[49][013-9]|5[0135-9]|[12][13-8])","3(?:5[013-9]|[1-46-8](?:22|[013-9]))|4(?:[137][013-9]|6(?:[013-9]|22)|[45][6-9]|8[4-6])|5(?:[1245][013-9]|6(?:3[02389]|[015689])|3|7[4-6])|6(?:[49][013-9]|5[0135-9]|[12][13-8])"]]]],381:[[8,9],[["([23]..)(.{4,9})","$1 $2",["(?:2[389]|39)0"]],["([1-3].)(.{5,10})","$1 $2",["1|2(?:[0-24-7]|[389][1-9])|3(?:[0-8]|9[1-9])"]],["(6.)(.{6,8})","$1 $2",["6"]],["([89]..)(.{3,9})","$1 $2",["[89]"]],["(7[26])(.{4,9})","$1 $2",["7[26]"]],["(7[08].)(.{4,9})","$1 $2",["7[08]"]]]],382:[[8,9],[["(..)(...)(...)","$1 $2 $3",["[2-57-9]|6[036-9]","[2-57-9]|6(?:[03689]|7(?:[0-8]|9[3-9]))"]],["(67)(9)(...)(...)","$1 $2 $3 $4",["679","679[0-2]"]]]],385:[[8,9],[["(1)(....)(...)","$1 $2 $3",["1"]],["(6[09])(....)(...)","$1 $2 $3",["6[09]"]],["([67]2)(...)(.{3,4})","$1 $2 $3",["[67]2"]],["([2-5].)(...)(.{3,4})","$1 $2 $3",["[2-5]"]],["(9.)(...)(.{3,4})","$1 $2 $3",["9"]],["(9.)(....)(....)","$1 $2 $3",["9"]],["(9.)(.{3,4})(...)(...)","$1 $2 $3 $4",["9"]],["(..)(..)(.{2,3})","$1 $2 $3",["6[0145]|7"]],["(..)(.{3,4})(...)","$1 $2 $3",["6[0145]|7"]],["(80[01])(..)(.{2,3})","$1 $2 $3",["8"]],["(80[01])(.{3,4})(...)","$1 $2 $3",["8"]]]],386:[[8],[["(.)(...)(..)(..)","$1 $2 $3 $4",["[12]|3[4-8]|4[24-8]|5[2-8]|7[3-8]"]],["([3-7].)(...)(...)","$1 $2 $3",["[37][01]|4[0139]|51|6"]],["([89][09])(.{3,6})","$1 $2",["[89][09]"]],["([58]..)(.....)","$1 $2",["59|8[1-3]"]]]],387:[[8,9],[["(..)(...)(...)","$1 $2-$3",["[3-5]"]],["(..)(...)(...)","$1 $2 $3",["6[1-356]|[7-9]"]],["(..)(..)(..)(...)","$1 $2 $3 $4",["6[047]"]]]],389:[[8],[["(2)(...)(....)","$1 $2 $3",["2"]],["([347].)(...)(...)","$1 $2 $3",["[347]"]],["([58]..)(.)(..)(..)","$1 $2 $3 $4",["[58]"]]]],420:[[9],[["([2-9]..)(...)(...)","$1 $2 $3",["[2-8]|9[015-7]"]],["(96.)(...)(...)(...)","$1 $2 $3 $4",["96"]],["(9.)(...)(...)(...)","$1 $2 $3 $4",["9[36]"]]]],421:[[9],[["(2)(...)(...)(..)","$1/$2 $3 $4",["2"]],["([3-5].)(...)(..)(..)","$1/$2 $3 $4",["[3-5]"]],["([689]..)(...)(...)","$1 $2 $3",["[689]"]]]],423:[[7],[["(...)(..)(..)","$1 $2 $3",["[23789]"]],["(...)(...)(...)","$1 $2 $3",["6[56]"]],["(69)(7..)(....)","$1 $2 $3",["697"]]]],500:[[5],[]],501:[[7],[["(...)(....)","$1-$2",["[2-8]"]],["(0)(800)(....)(...)","$1-$2-$3-$4",["0"]]]],502:[[8],[["(....)(....)","$1 $2",["[2-7]"]],["(....)(...)(....)","$1 $2 $3",["1"]]]],503:[[8],[["(....)(....)","$1 $2",["[267]"]],["(...)(....)","$1 $2",["[89]"]],["(...)(....)(....)","$1 $2 $3",["[89]"]]]],504:[[8],[["(....)(....)","$1-$2",[]]]],505:[[8],[["(....)(....)","$1 $2",[]]]],506:[[8],[["(....)(....)","$1 $2",["[24-7]|8[3-9]"]],["(...)(...)(....)","$1-$2-$3",["[89]0"]]]],507:[[8],[["(...)(....)","$1-$2",["[1-57-9]"]],["(....)(....)","$1-$2",["6"]]]],508:[[6],[["([45].)(..)(..)","$1 $2 $3",[]]]],509:[[8],[["(..)(..)(....)","$1 $2 $3",[]]]],590:[[9],[["([56]90)(..)(....)","$1 $2-$3",[]]]],591:[[8],[["([234])(.{7})","$1 $2",["[234]"]],["([67].{7})","$1",["[67]"]]]],592:[[7],[["(...)(....)","$1 $2",[]]]],593:[[8,9],[["(.)(...)(....)","$1-$2-$3",["[247]|[356][2-8]"]],["(..)(...)(....)","$1 $2 $3",["9"]],["(1800)(...)(.{3,4})","$1 $2 $3",["1"]]]],594:[[9],[["(...)(..)(..)(..)","$1 $2 $3 $4",[]]]],595:[[9],[["(..)(.{5,7})","$1 $2",["(?:[26]1|3[289]|4[124678]|7[123]|8[1236])"]],["(...)(.{3,6})","$1 $2",["[2-9]0"]],["(...)(.{6})","$1 $2",["9[1-9]"]],["(..)(...)(....)","$1 $2 $3",["8700"]],["(...)(.{4,6})","$1 $2",["[2-8][1-9]"]]]],596:[[9],[["(...)(..)(..)(..)","$1 $2 $3 $4",[]]]],597:[[7],[["(...)(...)","$1-$2",["[2-4]|5[2-58]"]],["(..)(..)(..)","$1-$2-$3",["56"]],["(...)(....)","$1-$2",["59|[6-8]"]]]],598:[[8],[["(....)(....)","$1 $2",["[24]"]],["(..)(...)(...)","$1 $2 $3",["9[1-9]"]],["(...)(....)","$1 $2",["[89]0"]]]],599:[[7,8],[["(...)(....)","$1 $2",["[13-7]"]],["(9)(...)(....)","$1 $2 $3",["9"]]]],670:[[8],[["(...)(....)","$1 $2",["[2-489]"]],["(....)(....)","$1 $2",["7"]]]],672:[[5,6],[["(..)(....)","$1 $2",["1"]],["(.)(.....)","$1 $2",["3"]]]],673:[[7],[["([2-578]..)(....)","$1 $2",[]]]],674:[[7],[["(...)(....)","$1 $2",[]]]],675:[[7,8],[["(...)(....)","$1 $2",["[13-689]|27"]],["(....)(....)","$1 $2",["20|7"]]]],676:[[7],[["(..)(...)","$1-$2",["[1-6]|7[0-4]|8[05]"]],["(...)(....)","$1 $2",["7[5-9]|8[47-9]"]],["(....)(...)","$1 $2",["0"]]]],677:[[7],[["(..)(.....)","$1 $2",["[7-9]"]]]],678:[[7],[["(...)(....)","$1 $2",["[579]"]]]],679:[[7],[["(...)(....)","$1 $2",["[36-9]"]],["(....)(...)(....)","$1 $2 $3",["0"]]]],680:[[7],[["(...)(....)","$1 $2",[]]]],681:[[6],[["(..)(..)(..)","$1 $2 $3",[]]]],682:[[5],[["(..)(...)","$1 $2",[]]]],683:[[4],[]],685:[[6,7],[["(8..)(.{3,4})","$1 $2",["8"]],["(7.)(.....)","$1 $2",["7"]],["(.....)","$1",["[2-6]"]]]],686:[[8],[]],687:[[6],[["(..)(..)(..)","$1.$2.$3",["[2-46-9]|5[0-4]"]]]],688:[[6],[]],689:[[6,8],[["(..)(..)(..)(..)","$1 $2 $3 $4",["4[09]|8[79]"]],["(..)(..)(..)","$1 $2 $3",["44"]]]],690:[[4],[]],691:[[7],[["(...)(....)","$1 $2",[]]]],692:[[7],[["(...)(....)","$1-$2",[]]]],850:[[10],[["(...)(...)(....)","$1 $2 $3",["1"]],["(.)(...)(....)","$1 $2 $3",["2"]],["(..)(...)(...)","$1 $2 $3",["8"]]]],852:[[8],[["(....)(....)","$1 $2",["[235-7]|[89](?:0[1-9]|[1-9])"]],["(800)(...)(...)","$1 $2 $3",["800"]],["(900)(..)(...)(...)","$1 $2 $3 $4",["900"]],["(900)(.{2,5})","$1 $2",["900"]]]],853:[[8],[["([268]...)(....)","$1 $2",[]]]],855:[[8,9],[["(..)(...)(.{3,4})","$1 $2 $3",["1.[1-9]|[2-9]"]],["(1[89]00)(...)(...)","$1 $2 $3",["1[89]0"]]]],856:[[10],[["(20)(..)(...)(...)","$1 $2 $3 $4",["20"]],["([2-8].)(...)(...)","$1 $2 $3",["2[13]|3[14]|[4-8]"]],["(30)(..)(..)(...)","$1 $2 $3 $4",["30"]]]],880:[[10],[["(2)(.{7})","$1-$2",["2"]],["(..)(.{4,6})","$1-$2",["[3-79]1"]],["(....)(.{3,6})","$1-$2",["1|3(?:0|[2-58]2)|4(?:0|[25]2|3[23]|[4689][25])|5(?:[02-578]2|6[25])|6(?:[0347-9]2|[26][25])|7[02-9]2|8(?:[023][23]|[4-7]2)|9(?:[02][23]|[458]2|6[016])"]],["(...)(.{3,7})","$1-$2",["[3-79][2-9]|8"]]]],886:[[9],[["([2-8])(.{3,4})(....)","$1 $2 $3",["[2-6]|[78][1-9]"]],["([89]..)(...)(...)","$1 $2 $3",["80|9"]],["(70)(....)(....)","$1 $2 $3",["70"]]]],960:[[7],[["(...)(....)","$1-$2",["[3467]|9(?:[1-9]|0[1-9])"]],["(...)(...)(....)","$1 $2 $3",["900"]]]],961:[[7,8],[["(.)(...)(...)","$1 $2 $3",["[13-6]|7(?:[2-57]|62|8[0-7]|9[04-9])|8[02-9]|9"]],["([7-9].)(...)(...)","$1 $2 $3",["[89][01]|7(?:[01]|6[013-9]|8[89]|9[1-3])"]]]],962:[[9],[["(.)(...)(....)","$1 $2 $3",["[2356]|87"]],["(7)(....)(....)","$1 $2 $3",["7[457-9]"]],["(...)(.{5,6})","$1 $2",["70|8[0158]|9"]]]],963:[[9],[["(..)(...)(.{3,4})","$1 $2 $3",["[1-5]"]],["(9..)(...)(...)","$1 $2 $3",["9"]]]],964:[[10],[["(1)(...)(....)","$1 $2 $3",["1"]],["([2-6].)(...)(.{3,4})","$1 $2 $3",["[2-6]"]],["(7..)(...)(....)","$1 $2 $3",["7"]]]],965:[[8],[["(....)(.{3,4})","$1 $2",["[126]|9[04-9]"]],["(...)(.....)","$1 $2",["5[015]|92"]]]],966:[[9],[["([1-467])(...)(....)","$1 $2 $3",["[1-467]"]],["(1.)(...)(....)","$1 $2 $3",["1[1-467]"]],["(5.)(...)(....)","$1 $2 $3",["5"]],["(92..)(.....)","$1 $2",["92"]],["(800)(...)(....)","$1 $2 $3",["80"]],["(811)(...)(.{3,4})","$1 $2 $3",["81"]]]],
967:[[9],[["([1-7])(...)(.{3,4})","$1 $2 $3",["[1-6]|7[24-68]"]],["(7..)(...)(...)","$1 $2 $3",["7[0137]"]]]],968:[[8],[["(2.)(.{6})","$1 $2",["2"]],["(9...)(....)","$1 $2",["9"]],["([58]00)(.{4,6})","$1 $2",["[58]"]]]],970:[[9],[["([2489])(2..)(....)","$1 $2 $3",["[2489]"]],["(5[69].)(...)(...)","$1 $2 $3",["5"]],["(1[78]00)(...)(...)","$1 $2 $3",["1[78]"]]]],971:[[9],[["([2-4679])(...)(....)","$1 $2 $3",["[2-4679][2-8]"]],["(5[0256])(...)(....)","$1 $2 $3",["5"]],["([479]00)(.)(.....)","$1 $2 $3",["[479]0"]],["([68]00)(.{2,9})","$1 $2",["60|8"]]]],972:[[9],[["([2-489])(...)(....)","$1-$2-$3",["[2-489]"]],["([57].)(...)(....)","$1-$2-$3",["[57]"]],["(1)([7-9]..)(...)(...)","$1-$2-$3-$4",["1[7-9]"]],["(1255)(...)","$1-$2",["125"]],["(1200)(...)(...)","$1-$2-$3",["120"]],["(1212)(..)(..)","$1-$2-$3",["121"]],["(1599)(.{6})","$1-$2",["15"]],["(....)","*$1",["[2-689]"]]]],973:[[8],[["(....)(....)","$1 $2",[]]]],974:[[8],[["([28]..)(....)","$1 $2",["[28]"]],["([3-7]...)(....)","$1 $2",["[3-7]"]]]],975:[[8],[["([17]7)(..)(..)(..)","$1 $2 $3 $4",["1|77"]],["([2-8])(...)(...)","$1 $2 $3",["[2-68]|7[246]"]]]],976:[[8],[["([12].)(..)(....)","$1 $2 $3",["[12]1"]],["([12]2.)(.{5,6})","$1 $2",["[12]2[1-3]"]],["([12]...)(.....)","$1 $2",["[12](?:27|[3-5])","[12](?:27|[3-5].)2"]],["(....)(....)","$1 $2",["[57-9]"]],["([12]....)(.{4,5})","$1 $2",["[12](?:27|[3-5])","[12](?:27|[3-5].)[4-9]"]]]],977:[[10],[["(1)(.{7})","$1-$2",["1[2-6]"]],["(..)(.{6})","$1-$2",["1[01]|[2-8]|9(?:[1-69]|7[15-9])"]],["(9..)(.{7})","$1-$2",["9(?:6[013]|7[245]|8)"]]]],992:[[9],[["([349]..)(..)(....)","$1 $2 $3",["[34]7|91[78]"]],["([459].)(...)(....)","$1 $2 $3",["4[48]|5|9(?:1[59]|[0235-9])"]],["(331700)(.)(..)","$1 $2 $3",["331","3317","33170","331700"]],["(....)(.)(....)","$1 $2 $3",["3[1-5]","3(?:[1245]|3(?:[02-9]|1[0-589]))"]]]],993:[[8],[["(..)(..)(..)(..)","$1 $2-$3-$4",["12"]],["(..)(.{6})","$1 $2",["6"]],["(...)(.)(..)(..)","$1 $2-$3-$4",["13|[2-5]"]]]],994:[[9],[["(..)(...)(..)(..)","$1 $2 $3 $4",["(?:1[28]|2(?:[45]2|[0-36])|365)"]],["(..)(...)(..)(..)","$1 $2 $3 $4",["[4-8]"]],["(...)(..)(..)(..)","$1 $2 $3 $4",["9"]]]],995:[[9],[["(...)(..)(..)(..)","$1 $2 $3 $4",["[348]"]],["(...)(...)(...)","$1 $2 $3",["7"]],["(...)(..)(..)(..)","$1 $2 $3 $4",["5"]]]],996:[[9],[["(...)(...)(...)","$1 $2 $3",["[25-7]|31[25]"]],["(....)(.....)","$1 $2",["3(?:1[36]|[2-9])"]],["(...)(...)(.)(...)","$1 $2 $3 $4",["8"]]]],998:[[7,8,9],[["([679].)(...)(..)(..)","$1 $2 $3 $4",[]]]]}},function(e,t,r){e.exports={Blocklist:r(174),Call:r(198),Chat:r(200),Cmd:r(241),Conn:r(242),Contact:r(245),GroupMetadata:r(246),Msg:r(247),MsgInfo:r(248),Mute:r(250),Presence:r(251),ProfilePicThumb:r(252),Props:r(253),RecentEmoji:r(254),EmojiVariant:r(256),Status:r(258),Stream:r(240),Wap:r(203)}},function(e,t,r){var n=r(175),i=r(196),o=n.extend({model:i,handle:function(e){var t=e.shift(),r=t.blocklist,n=_.map(r,function(e){return{id:e}});this.set(n)}});e.exports=new o},function(e,t,r){var n=r(14),i=r(176),o=r(145),a=r(177),s=r(20),c=r(151),d=r(143),u={QUERY:"QUERY",FIND:"FIND",UPDATE:"UPDATE"},l={NONE:"NONE",LOAD:"LOAD"},p=a.extend(i,o,{listenTo:function(e,t,r){if(!_.isObject(e)||_.isEmpty(t)||!_.isFunction(r)){var n=[];throw _.isObject(e)||n.push("obj parameter is not an object"),_.isEmpty(t)&&n.push("event is empty string"),_.isFunction(r)||n.push("callback is not a function"),new Error(n.join(", "))}a.prototype.listenTo.apply(this,arguments)},initialize:function(e){this._config=_.extend({CachePolicy:{id:void 0,policy:l.NONE,delay:0},staleCollection:!1},e),this._inflight={},this.listenTo(this,"add remove reset sort",function(){var e=this._last,t=this.last();(!e&&t||e!==t)&&(this._last=t,this.trigger("change:last",t));var r=this._first,n=this.first();(!r&&n||r!==n)&&(this._first=n,this.trigger("change:first",n))}),this._initializeFromCache(),this._config.staleCollection&&this._initializeStaleCollection()},_initializeFromCache:function(e){var t=this._config.CachePolicy,r=t.id,i=t.policy,o=t.delay,a=t.trigger||"all";this.listenTo(s,"change:stream",function(){if(s.stream===s.STREAM.SYNCING){if(i===l.NONE)return void(_.isUndefined(r)||d.setCollection(r));if(n.log("baseCollection:initFromCache load: "+r)(),this.add(d.getCollection(r)),!_.isNumber(o))return;this._saveToCache=_.debounce(this.saveToCache,o),this.listenTo(this,a,this._saveToCache),this.initializeFromCache()}})},initializeFromCache:function(){},saveToCache:function(){if(Wa.me){var e=this._config.CachePolicy.id;n.log("baseCollection:saveToCache save: "+e)(),d.setCollection(e,this.toJSON())}},_initializeStaleCollection:function(){var e=this;this.listenTo(s,"change:stream",function(){switch(s.stream){case s.STREAM.DISCONNECTED:e.invoke("set","stale",!0);break;case s.STREAM.RESUMING:case s.STREAM.SYNCING:break;case s.STREAM.CONNECTED:s.previousAttributes().stream===s.STREAM.RESUMING&&_.isFunction(e.onResume)&&e.onResume()}})},_query:function(e,t){var r=_.isString(t)?t:JSON.stringify(t),i=e===u.QUERY?void 0:this.get(t),o="force-"+r;return(this._inflight[o]&&e===u.FIND||e===u.UPDATE)&&(r=o),this._inflight[r]?i&&e===u.FIND?Promise.resolve(i):this._inflight[r]:!i||i&&i.stale||e===u.UPDATE?this._inflight[r]=Promise.bind(this).then(function(){return this._serverQuery(e,t)})["finally"](function(){delete this._inflight[r]})["catch"](c.WapDrop,function(e){throw n.log(e.toString(),"orange")(),e})["catch"](_.isString,function(e){n.log("baseCollection:query query promise rejected: "+e)()}):Promise.resolve(i)},_serverQuery:function(e,t){var r;r=e===u.UPDATE?this._update(t):e===u.FIND?this._find(t):this._findQuery(t);var n=this;return r.then(function(e){return n._config.staleCollection&&_.each(_.compact(_.forceArray(e)),function(e){"undefined"==typeof e.stale&&(e.stale=!1)}),n.add(e,{merge:!0})})},findQuery:function(e){return this._query(u.QUERY,e)},find:function(e){return e?this._query(u.FIND,e):(Wa.uploadLogs(n.trace("Called find without an id")),Promise.resolve())},update:function(e){return e?this._query(u.UPDATE,e):(Wa.uploadLogs(n.trace("Called update without an id")),Promise.resolve())},_update:function(e){return this._find(e)},handle:function(e){var t=this._handle(e.shift());this._config.staleCollection&&_.each(_.compact(_.forceArray(t)),function(e){e.stale=!1}),this.add(t,{merge:!0})},gadd:function(e){if(_.isString(e)||_.isNumber(e)){var t={};return t[this.mainIndex]=e,this.get(e)||this.add(t,{merge:!0})}if(e&&e[this.mainIndex])return this.add(e,{merge:!0});var r=_.findKey(Store,this)||"unknown";throw new Error(r+".gadd called without an id attr ("+this.mainIndex+")")},"delete":function(){this.stopListening(this,"all",this._saveToCache),_.invoke(this.models,"stopListening"),_.invoke(this.models,"cancelPendingPromises"),this._inflight={},this.reset()},isStateStale:function(e){var t=this.get(e);return t&&t.stale}});p.CACHE_POLICY=l,e.exports=p},function(e,t){var r=[].slice,n={},i=["first","last","partition","contains","toArray","invoke","pluck","filter","any"];_.each(i,function(e){if(!_[e])throw new Error("attempt to reference non-existant _ method: "+e);n[e]=function(){var t=r.call(arguments);return t.unshift(this.models),_[e].apply(_,t)}});var o=["groupBy","countBy","sortBy","indexBy"];_.each(o,function(e){if(!_[e])throw new Error("attempt to reference non-existant _ method: "+e);n[e]=function(t,r){var n=_.isFunction(t)?t:function(e){return e.get?e.get(t):e[t]};return _[e](this.models,n,r)}}),n.where=function(e,t){return _.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){var r;for(var n in e)if(r=t.get?t.get(n):t[n],e[n]!==r)return!1;return!0})},n.findWhere=function(e){return this.where(e,!0)},e.exports=n},,,,,,,,,,,,,,,,,,,,function(e,t,r){var n=r(197),i=n.extend({Collection:"Blocklist",props:{id:"string"}});e.exports=i},function(e,t,r){var n=r(14),i=r(21),o=r(145),a=i.extend(o,{extraProperties:"allow",session:{_uiObservers:{type:"number","default":0},_promises:{type:"array","default":function(){return[]}},_waitPromise:"object",stale:"boolean"},derived:{isObserved:{deps:["_uiObservers"],fn:function(){return this._uiObservers>0}}},update:function(){return this.getCollection().update(this.id)},find:function(){return this.getCollection().find(this.id)},getCollection:function(){return this.Collection?Store[this.Collection]:n.log("baseState:getCollection Attempting to get a non existing collection","red")()},getp:function(e){if(!_.isString(e))return void 0;for(var t=e.split("."),r=this,n=0;n<t.length;n++){if(!r)throw Error("Path: "+e+" is not defined");r=r.get(t[n])}return r},regCancellablePromise:function(e){var t=this;return this._promises.push(e),e.cancellable()["finally"](function(){t._promises=_.without(t._promises,e)})},hasPendingPromises:function(){return this._promises&&this._promises.length>0||this._waitPromise},cancelPendingPromises:function(){this.hasPendingPromises()&&(this._promises.forEach(function(e){e.cancel()}),this._promises=[]),this._waitPromise&&this.unset("_waitPromise")},waitForPromises:function(){var e=this;if(this._waitPromise)return this._waitPromise;var t=this._promises;return t&&0!==t.length?this._waitPromise=Promise.settle(t)["finally"](function(){e.unset("_waitPromise")}):Promise.resolve(!0)},set:function(e,t){return t&&t.merge&&_.isObject(e)?i.prototype.set.call(this,_.omit(e,_.isUndefined),t):i.prototype.set.call(this,e,t)},"delete":function(){this.stopListening()}});e.exports=a},function(e,t,r){var n=r(175),i=r(199),o=n.extend({model:i,handle:function(e){var t=e.shift();switch(t.type){case"offer":case"accept":case"reject":case"terminate":this.add(t,{merge:!0})}}});e.exports=new o},function(e,t,r){var n=r(14),i=r(197),o=r(144),a=i.extend({Collection:"Call",props:{id:"string",type:"string",from:"string"},initialize:function(){this.listenToAndRun(this,"change:type",this.updateNotification)},updateNotification:function(){n.log("call:"+this.type+" id:"+this.id+" from:"+this.from)(),"offer"===this.type?o.alertCall(this.id,this.from):o.cancelCall(this.id)}});e.exports=a},function(e,t,r){var n=r(14),i=r(175),o=r(201),a=r(203),s=r(150),c=r(144),d=r(151),u=r(234),l=i.extend({model:o,comparator:function(e,t){return e.t?t.t?""+e.t+e.id>""+t.t+t.id?-1:1:-1:1},initialize:function(){i.prototype.initialize.call(this),this.listenTo(this,"change:t",this.sort)},_find:function(e){return Promise.resolve({id:e,createdLocally:!0,noEarlierMsgs:!0})},_findQuery:function(e){var t=this;return a.chatFindQuery(e.retry).then(function(e){return"preempted"===e?Promise.reject("chats preempted"):(t.trigger(Wa.CONST.COLLECTION_HAS_SYNCED),Promise.resolve(e))})},handle:function(e){var t=e.shift(),r=this;if(_.isArray(t)){var i=[],o=[];t.forEach(function(e){if("c.us"===e.id)o.push(e);else{var t=!!r.get(e.id),a=["delete","clear","archive","unarchive"].indexOf(e.type)>-1;t||a?t&&a?o.push(e):n.log("Model:chat:handle received junk chat record: "+JSON.stringify(e))():i.push(e)}}),r.add(i,{merge:!0}),o.forEach(function(e){var t=e.type;if("c.us"===e.id)switch(t){case"clear":n.log("Model:chat:handle:clear:all before: "+e.before)(),r.forEach(function(t){"number"==typeof e.before?t.deleteMsgsOlderThan(e.before):t.deleteMsgs()});break;case"delete":n.log("Model:chat:handle:delete:all")(),r.forEach(function(e){e["delete"]()});break;case"archive":n.log("Model:chat:handle:archive:all")(),r.forEach(function(e){e.archive=!0});break;case"unarchive":n.log("Model:chat:handle:unarchive:all")(),r.forEach(function(e){e.archive=!1});break;default:n.log("Model:chat:handle unknown "+JSON.stringify(e),"red",e)()}else{var i=r.get(e.id);if(!i)return;if("clear"===t)if(e.keys){for(var o=e.keys.length,a=0;o>a;a++){var s=e.keys[a][0],c=e.keys[a][1],d=e.keys[a][2],u=c?Wa.me:e.id,l=c?e.id:Wa.me,p=c?"out":"in",h=Wa.createMsgKey(u,l,s,d,p),f=Store.Msg.get(h);f&&i.removeMsg(f)}var m=e.keys.map(function(e){return e.join("_")}).join(", ");n.log("model:Chat:handle deleted messages: "+e.id+" "+m)()}else"number"==typeof e.before?i.deleteMsgsOlderThan(e.before):i.deleteMsgs(),n.log("model:Chat:handle cleared chat for "+e.id+" before: "+e.before)();else"delete"===t?(i["delete"](),n.log("model:Chat:handle deleted chat for "+e.id)()):"archive"===t?i.archive=!0:"unarchive"===t&&(i.archive=!1)}})}else if("leave"===t.cmd)t.gids.forEach(function(e){var t=r.get(e);t&&t.exit()});else if("update"===t.cmd)t.data.forEach(function(e){if("delete"!==e.type){var t=Store.Contact.get(e.id);t?e.name&&(t.name=e.name):Store.Contact.add({id:e.id,name:e.name})}var i=r.get(e.id);if(!i)return void Store.Chat.add(e);if("clear"===e.type){var o=[];i.msgs.forEach(function(e){o.push(e)}),_.each(o,function(e){e["delete"]()}),i.set({t:e.t,unreadCount:e.unreadCount,createdLocally:!1,archive:e.archive,isReadOnly:e.isReadOnly,modifyTag:e.modifyTag,msgs:[],noEarlierMsgs:!1}),i.mute.setMute(e.muteExpiration),n.log("model:chat:update: cleared chat for "+e.id)()}else"delete"===e.type?(i["delete"](),n.log("model:chat:update: deleted chat for "+e.id)()):(i.set(e,{merge:!0}),i.mute.setMute(e.muteExpiration))});else if("preempt"===t.cmd)Store.Chat.add(t.response,{merge:!0}),this.trigger(Wa.CONST.COLLECTION_HAS_SYNCED);else if("action"===t.cmd){var a=t.id,s=t.data;if("create"===s[0]||"introduce"===s[0]){var d=s[1],u=s[2],l=_.map(u.admins,function(e){return{id:e,isAdmin:!0}}).concat(_.map(u.regulars,function(e){return{id:e,isAdmin:!1}}));Store.GroupMetadata.add({id:a,creation:u.creation,owner:d,participants:l,stale:!1},{merge:!0}),Store.Contact.add({id:a,name:u.subject},{merge:!0});var p=Store.Chat.get(a);if(!p)return;var h=p.msgs.last();if(!h)return;"gp2"===h.type&&"add"===h.subtype&&_.first(h.recipients)===Wa.me&&c.alertNewMsg(h)}else{var f=Store.Chat.get(t.id);f?f.handleGroupAction.apply(f,t.data):n.log("model:chat: unknown chat for action "+JSON.stringify(t),"red")()}}else n.log("model:chat: unknown payload: "+JSON.stringify(t),"red")()},createGroup:function(e,t,r,i){var o=_.pluck(i,"id"),s=a.createGroup(e,o),d=l10n.t("action_group_creating"),l=s.then(function(e){return 200===e.status?l10n.t("action_group_created"):406===e.status?l10n.t("action_group_create_failed")+" "+l10n.t("action_group_create_failed_406"):void 0})["catch"](function(e){throw n.log("models:chatCollection:createGroup dropped","red",e)(),l10n.t("action_group_create_failed")});return c.openToast(React.createElement(u,{id:u.genId(),pendingText:d,actionText:l,retry:this.createGroup.bind(this,e,t,r,i)})),s.then(function(e){if(200===e.status&&!e._duplicate&&t&&r){var i=Store.ProfilePicThumb.gadd(e.gid);return i.setPicture(t,r)}200===e.status&&e._duplicate&&n.log("createGroup failed to set picture.","red")})},sync:function(){return this.findQuery({})["catch"](d.WapDrop,_.noop),Promise.all([s.waitForBBEvent(this,Wa.CONST.COLLECTION_HAS_SYNCED),Store.Msg._hasSynced()])},resyncMessages:function(){n.log("ChatStore:resyncMessages")();var e=this,t=Store.Chat.filter(function(e){return!e.isNewlyCreated()}),r=t.map(function(e){var t=e.id,r={wid:t,archive:e.archive,mute:e.mute.expiration,active:e.active,isReadOnly:e.isReadOnly,modifyTag:e.modifyTag,unreadCount:e.unreadCount},n=Store.Msg.lastReceivedKey[t];if(n){var i=Wa.splitMsgKey(n);r.id=i.id,r.fromMe=i.fromMe.toString(),r.participant=i.participant}return r});return a.resyncMessages(r).then(function(t){return t.status>=400?(n.log("ChatStore:resyncMessages resume error "+t.status,"red")(),Promise.reject(new Error("ChatStore:resyncMessages resume error "+t.status))):(n.log("ChatStore:resyncMessages resume success")(),t.cmd="update",t.checksum&&Store.Contact.resyncContacts(t.checksum),e.handle([t]),Promise.resolve())})["catch"](d.WapDrop,function(e){return n.log("ChatStore:resyncMessages resume dropped","red")(),Promise.reject(e)})}});e.exports=new l},function(e,t,r){function n(e,t,r,n){var o=new FormData;return o.append("from",Wa.widGetUser(Wa.me)),o.append("to",Wa.widGetUser(r)),o.append("file",t,n),i(e,r,o)}function i(e,t,r){return R.loopOnError(b.ShouldLoop,function(t){if(t>4)throw new b.GaveUpRetry("gave up mms upload after "+t+" tries");var n;if(m.state===m.STATE.CONNECTED){var i=Math.floor(1e3*Wa.expBackoff(t,60,void 0,.1));n=Promise.delay(i).then(function(){return m.state===m.STATE.CONNECTED?void 0:R.waitForBBEvent(m,"change:state",_.matches({state:m.STATE.CONNECTED}))})}else n=R.waitForBBEvent(m,"change:state",_.matches({state:m.STATE.CONNECTED}));var a=3e5*(1+t);return n.then(function(){return E.post(e+"?f=j",r).timeout(a,"postMediaToMMSTimeout").then(function(e){if(200===e.status)return o.log("http upload success:"+e.status)(),JSON.parse(e.response);throw o.log("http upload error response: "+e.status)(),new b.ShouldLoop})["catch"](Promise.CancellationError,_.noop)["catch"](Promise.TimeoutError,function(e){throw new b.ShouldLoop})["catch"](function(e){return e instanceof XMLHttpRequestProgressEvent},function(e){throw o.log("http upload error: "+e)(),new b.ShouldLoop})})})}var o=r(14),a=r(197),s=r(202),c=r(230),d=r(231),u=r(237),l=r(238),p=r(239),h=r(170),f=r(144),m=r(20),g=r(240),v=r(203),y=r(143),b=r(151),E=r(19),R=r(150),w=r(234),S={GROUP:"group",BROADCAST:"broadcast",CHAT:"chat"},T=a.extend({Collection:"Chat",props:{id:"string",t:"number",unreadCount:{type:"number","default":0},createdLocally:"boolean",archive:"boolean",isReadOnly:"boolean",modifyTag:"number",muteExpiration:{type:"number","default":0},name:"string"},session:{pendingAction:"number",formattedTitle:"string",active:"boolean",isLoadingMsgs:"boolean",noEarlierMsgs:"boolean",LEMPromise:"any",pausedTimerId:"number",presenceResendTimerId:"number",recording:"boolean",typing:"boolean",unreadDivider:"object",colors:"object",composeText:"string",composeSel:"object",squelch:"number",pendingSeenCount:{type:"number","default":0},markedUnread:"boolean"},collections:{msgs:p},children:{presence:s,contact:d,mute:u,groupMetadata:l},initialize:function(){if(this.presence=Store.Presence.gadd(this.id),this.listenTo(this.presence,"all",this._getEventBubblingHandler("presence")),this.mute=Store.Mute.add({id:this.id,expiration:this.muteExpiration},{merge:!0}),this.listenTo(this.mute,"all",this._getEventBubblingHandler("mute")),this.contact=Store.Contact.gadd(this.id),this.name&&!this.contact.name&&(this.contact.name=this.name),this.listenTo(this.contact,"all",this._getEventBubblingHandler("contact")),this.listenTo(this.contact,"change:formattedName",this.updateTitle),this.isGroup||this.isBroadcast){var e;this.isBroadcast&&!Store.GroupMetadata.get(this.id)&&(e=!0),this.groupMetadata=Store.GroupMetadata.gadd({id:this.id}),this.listenTo(this.groupMetadata,"all",this._getEventBubblingHandler("groupMetadata")),this.listenTo(this.groupMetadata,"change:stale",this.updateReadOnly),this.listenTo(this.groupMetadata.participants,"add remove reset",this.updateReadOnly),this.listenTo(this.groupMetadata.participants,"change:contact.formattedShortName",this.updateTitle),this.updateReadOnly();var t=this.id;this.listenTo(this,"change:isReadOnly",function(){Store.ProfilePicThumb.update(t)["catch"](b.WapDrop,_.noop),Store.GroupMetadata.update(t)["catch"](b.WapDrop,_.noop)}),e&&Store.GroupMetadata.update(t)["catch"](b.WapDrop,_.noop)}else this.listenTo(this.presence,"change:isOnline",this._presenceOnlineChanged);this.updateTitle(),this.listenTo(this.msgs,"add",this.onNewMsg),this._saveAssignedColors=_.debounce(this.saveAssignedColors,1e3),this.listenTo(this,"change:active",this.onActiveUpdate),this.pendingAction=0,this.listenTo(this,"change:pendingAction",this.onPendingActionUpdate)},derived:{kind:function(){return this.isGroup?S.GROUP:this.isBroadcast?S.BROADCAST:this.isUser?S.CHAT:void 0},isGroup:{fn:function(){return Wa.isGroupWid(this.id)}},isBroadcast:{fn:function(){return Wa.isBroadcastWid(this.id)}},isUser:{fn:function(){return Wa.isUserWid(this.id)}},hasUnread:{deps:["unreadCount"],fn:function(){return 0!==this.unreadCount}}},onActiveUpdate:function(){this.isGroup&&this.active&&(this.squelch=-1),this.presence.chatActive=this.active},onPendingActionUpdate:function(){this.pendingAction<0&&(o.log("ERROR: PENDING ACTION NEGATIVE COUNT"),this.pendingAction=0)},updateTitle:function(){this.isBroadcast?this.formattedTitle=this.contact.name||this.groupMetadata.participants.map(function(e){return e.contact.formattedShortName}).join(", "):this.isUser?this.formattedTitle=this.contact.name||Wa.widGetFormattedUser(this.id):this.isGroup&&(this.formattedTitle=this.contact.name)},sendExit:function(){if(!this.isGroup)return Promise.reject(new b.ActionError);var e=v.leaveGroup(this.id),t=l10n.t("action_group_exiting"),r=e.then(function(e){return 200===e.status?l10n.t("action_group_exited"):e.status>=400?l10n.t("action_group_exit_failed"):void 0})["catch"](function(e){return o.log("models:chat:sendExit dropped","red",e)(),l10n.t("action_group_exit_failed")});return f.openToast(React.createElement(w,{id:w.genId(),pendingText:t,actionText:r,retry:this.sendExit.bind(this)})),e.bind(this).then(function(e){200!==e.status||e._duplicate||this.exit()})},canExit:function(){return h.supportsFeature(h.F.GROUP_EXIT)},exit:function(){this.isGroup&&(this.groupMetadata.participants.remove(Wa.me),this.isReadOnly=!0)},sendDelete:function(){var e,t=this.msgs.last(),r=t?Wa.splitMsgKey(t.id):void 0,n=v.sendConversationDelete(this.id,r),i=this.kind;switch(i){case S.GROUP:e=l10n.t("action_group_deleting");break;case S.BROADCAST:e=l10n.t("action_broadcast_deleting");break;case S.CHAT:e=l10n.t("action_chat_deleting")}var a=n.bind(this).then(function(e){if(200===e.status)switch(i){case S.GROUP:return l10n.t("action_group_deleted");case S.BROADCAST:return l10n.t("action_broadcast_deleted");case S.CHAT:return l10n.t("action_chat_deleted")}else if(e.status>=400)switch(i){case S.GROUP:return l10n.t("action_group_delete_failed");case S.BROADCAST:return l10n.t("action_broadcast_delete_failed");case S.CHAT:return l10n.t("action_chat_delete_failed")}})["catch"](function(e){switch(o.log("models:chat:sendDelete dropped","red",e)(),i){case S.GROUP:return l10n.t("action_group_delete_failed");case S.BROADCAST:return l10n.t("action_broadcast_delete_failed");case S.CHAT:return l10n.t("action_chat_delete_failed")}});return f.openToast(React.createElement(w,{id:w.genId(),pendingText:e,actionText:a,retry:this.sendDelete.bind(this)})),n.bind(this).then(function(e){if(200===e.status&&!e._duplicate){var r=this.msgs.last();t===r?this["delete"](!0):this.deleteMsgsBeforeMsgInclusive(t)}})},canDelete:function(){return h.supportsFeature(h.F.DELETE)},sendClear:function(){var e=this.msgs.last(),t=e?Wa.splitMsgKey(e.id):void 0;v.sendConversationClear(this.id,t)},"delete":function(e){this.cancelPendingPromises(),a.prototype["delete"].call(this),this.groupMetadata["delete"](),this.presence["delete"](),Store.Mute.remove(this.id),this.mute["delete"](),this.deleteMsgs(),Store.Chat.remove(this.id),f.clearChat(this)},isDirty:function(){return 0!==this.unreadCount},isNewlyCreated:function(){return!!this.createdLocally&&0===this.msgs.length},onNewMsg:function(e){if(e&&"i"!==e.eventType)if(this.t=e.t,this.archive&&(this.archive=!1),e.isSentByMe||this.presence.handle({id:this.id,participant:e.author,type:"available"}),e.isSentByMe)this.unreadCount=0;else if("d"===e.eventType)this.unreadCount=this.unreadCount+1||1,f.alertNewMsg(e),this.msgs.length<Wa.CONST.MSG_PRELOAD_THRESHOLD&&this.loadEarlierMsgs();else if("s"===e.eventType){if("gp2"===e.type&&"add"===e.subtype&&_.first(e.recipients)===Wa.me&&!this.contact.name)return;f.alertNewMsg(e)}},setArchive:function(e){if(this.archive===e)return Promise.reject(new b.ActionError);var t=this.msgs.last(),r=t?Wa.splitMsgKey(t.id):void 0,n=v.sendConversationArchive(this.id,e,r),i=e?l10n.t("action_chat_archiving"):l10n.t("action_chat_unarchiving"),a=n.then(function(t){return 200===t.status?e?l10n.t("action_chat_archived"):l10n.t("action_chat_unarchived"):t.status>=400?e?l10n.t("action_chat_archive_failed"):l10n.t("action_chat_unarchive_failed"):void 0})["catch"](function(t){return o.log("models:chat:setArchive dropped","red",t)(),e?l10n.t("action_chat_archive_failed"):l10n.t("action_chat_unarchive_failed")});return f.openToast(React.createElement(w,{id:w.genId(),pendingText:i,actionText:a,retry:this.setArchive.bind(this,e)})),n.bind(this).then(function(t){200!==t.status||t._duplicate||(this.archive=e)})},canArchive:function(){return h.supportsFeature(h.F.ARCHIVE)},sendSeen:function(){if(this.markedUnread||0===this.unreadCount)return Promise.resolve();if(!g.available)return this.listenTo(g,"change:available",this.sendSeen),Promise.resolve();this.stopListening(g,"change:available",this.sendSeen);for(var e,t=this.msgs.length-1;t>=0;t--){var r=this.msgs.at(t);if(r&&(!r.isSentByMe||!r.local||r.ack>0)){e=r;break}}var n=this.unreadCount-this.pendingSeenCount;if(0===n)return Promise.resolve();this.pendingSeenCount=this.unreadCount;var i=this,a=function(){i.pendingSeenCount=i.pendingSeenCount-n,i.pendingSeenCount<0&&(o.log("models:chat:sendSeen unread "+i.unreadCount+" pending: "+i.pendingSeenCount+" delta: "+n,"red")(),i.pendingSeenCount=0)},s=e?Wa.splitMsgKey(e.id):void 0;return h.gte([0,4])?v.sendConversationSeen(this.id,s,n).bind(this).then(function(e){return a(),200!==e.status||e._duplicate||this.markSeen(n),e})["catch"](b.WapDrop,function(e){a(),o.log("models:chat:sendConversationSeen dropped","red")()}):(a(),this.markSeen(n),v.sendConversationSeen(this.id,s,n).bind(this).then(function(e){return e})["catch"](b.WapDrop,function(e){o.log("models:chat:sendConversationSeen dropped","red")()}))},markSeen:function(e){e&&"number"==typeof e?e>0&&e<=this.unreadCount?this.unreadCount=this.unreadCount-e:-1===e&&this.unreadCount<=0&&(this.unreadCount=0):this.unreadCount=0,this.markedUnread=!1},markUnread:function(e){e?this.active&&(this.markedUnread=!0):this.markedUnread=!1;var t=e?this.sendUnseen():this.sendSeen(),r=e?l10n.t("action_chat_marking_unread"):l10n.t("action_chat_marking_read"),n=t.then(function(t){return 200===t.status?e?l10n.t("action_chat_marked_unread"):l10n.t("action_chat_marked_read"):t.status>=400?e?l10n.t("action_chat_mark_unread_failed"):l10n.t("action_chat_mark_read_failed"):void 0})["catch"](function(t){return e?l10n.t("action_chat_mark_unread_failed"):l10n.t("action_chat_mark_read_failed")});return f.openToast(React.createElement(w,{id:w.genId(),pendingText:r,actionText:n,retry:this.markUnread.bind(this,e)})),t},canMarkUnseen:function(){return h.supportsFeature(h.F.CHAT_MARK_UNSEEN)},sendUnseen:function(){var e=this,t=this.msgs.last(),r=t?t.id:void 0;return v.sendConversationUnseen(this.id,r).then(function(t){return 200===t.status?e.markUnseen():e.markedUnread=!1,t})},markUnseen:function(){this.active&&(this.markedUnread=!0),this.unreadCount=-1},markRecording:function(){if((this.presence.isOnline||this.isGroup)&&!this.recording){var e=this.id;v.sendChatstateRecording(e).then(function(t){t.status>=400&&o.log("models:chat send presence recording error "+e,"red")()})["catch"](b.WapDrop,_.noop),this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),Wa.CONST.PRESENCE_RESEND_WAIT)}this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.recording=!0,this.typing=!1},markComposing:function(){if((this.presence.isOnline||this.isGroup)&&!this.typing){var e=this.id;v.sendChatstateComposing(e).then(function(t){t.status>=400&&o.log("models:chat send presence composing error "+e,"red")()})["catch"](b.WapDrop,_.noop),this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),Wa.CONST.PRESENCE_RESEND_WAIT)}this.typing=!0,this.pausedTimerId&&clearTimeout(this.pausedTimerId),this.pausedTimerId=_.delay(this.markPaused.bind(this),Wa.CONST.SEND_PAUSED_WAIT)},markPaused:function(){if((this.presence.isOnline||this.isGroup)&&(this.typing||this.recording)){var e=this.id;v.sendChatstatePaused(e).then(function(t){t.status>=400&&o.log("models:chat send presence paused error "+e,"red")()})["catch"](b.WapDrop,_.noop)}this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId")),this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.typing=this.recording=!1},_resendPresence:function(){var e=this.id;if(this.recording)v.sendChatstateRecording(e).then(function(t){t.status>=400&&o.log("models:chat send presence resend recording error "+e,"red")()})["catch"](b.WapDrop,_.noop);else{if(!this.typing)return void this.unset("presenceResendTimerId");v.sendChatstateComposing(e).then(function(t){t.status>=400&&o.log("models:chat send presence resend composing error "+e,"red")()})["catch"](b.WapDrop,_.noop)}this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),Wa.CONST.PRESENCE_RESEND_WAIT)},_messageSent:function(){this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId")),this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.typing=!1},_presenceOnlineChanged:function(){this.presence.isOnline?this._resendPresence():this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId"))},handleGroupAction:function(e,t,r){var n;switch(e){case"subject":return void(this.contact.name=r.subject);case"add":case"promote":case"demote":var i="promote"===e;return n=_.map(r.participants,function(e){return{id:e,isAdmin:i}}),void this.groupMetadata.participants.add(n,{merge:!0});case"remove":return n=this.groupMetadata.participants,void _.each(r.participants,function(e){n.remove(e)});case"modify":return;default:return}},mediaMsgs:function(){return this.msgs.filter(function(e){return e.isMedia})},preload:function(){1===this.msgs.length&&this.loadEarlierMsgs()},loadEarlierMsgs:function(){if(this.LEMPromise)return this.LEMPromise;if(this.noEarlierMsgs)return Promise.resolve();var e=this.msgs.first(),t=this,r={};return e?r=Wa.splitMsgKey(e.id):r.remote=this.id,r.count=Wa.CONST.PAGE_SIZE,this.isLoadingMsgs=!0,this.LEMPromise=this.regCancellablePromise(Store.Msg.findQuery(r)).then(function(e){return e.length<Wa.CONST.PAGE_SIZE&&(t.noEarlierMsgs=!0),e})["catch"](b.WapDrop,_.noop)["catch"](function(e){o.log("chat:loadEarlierMsgs error "+e)()})["catch"](Promise.CancellationError,_.noop)["finally"](function(){t.unset("LEMPromise"),t.unset("isLoadingMsgs")})},canSendDeleteMsg:function(){return h.supportsFeature(h.F.MESSAGE_DELETE)},sendDeleteMsg:function(e){var t=this;if(e&&this.msgs.get(e.id)){var r=v.sendMessageDelete(this.id,[e.id],!0),n=l10n.t("action_message_deleting"),i=r.then(function(e){return 200===e.status?l10n.t("action_message_deleted"):e.status>=400?l10n.t("action_message_delete_failed"):void 0})["catch"](function(e){return o.log("models:chat:sendDeleteMsg dropped","red",e)(),l10n.t("action_message_delete_failed")});return f.openToast(React.createElement(w,{id:w.genId(),pendingText:n,actionText:i,retry:this.sendDeleteMsg.bind(this,e)})),r.then(function(r){if(200===r.status){var n=t.msgs.indexOf(e);n>-1&&t.msgs.at(n)["delete"]()}})}},removeMsg:function(e){var t=this.msgs,r=t.indexOf(e);0>r||(o.log("models:Chat:removeMsg "+e.get("id"))(),t.remove(e),0===t.length&&(o.log("models:Chat:removeMsg 0 messages left, querying...")(),this.loadEarlierMsgs()))},deleteMsgs:function(){for(;this.msgs.length;)this.msgs.at(0)["delete"]();this.unreadCount=0,this.noEarlierMsgs=!0},deleteMsgsOlderThan:function(e){var t=this.msgs,r=_.first(t.models);if(r&&!(r.t>=e)){if(r=_.last(t.models),r.t<e)return void this.deleteMsgs();var n=this.msgs.filter(function(t){return t&&t.t>=e});this.deleteMsgsPartial(n)}},deleteMsgsBeforeMsgInclusive:function(e){if(e){var t=_.indexOf(this.msgs,e);0>t||this.deleteMsgsPartial(_.slice(this.msgs,t+1))}},deleteMsgsPartial:function(e){var t=this.unreadCount;if(this.deleteMsgs(),e.length>0){this.msgs.add(e);var r=t>e.length?e.length:t;this.unreadCount=r,this.noEarlierMsgs=!0}},getFirstMsgWithStatus:function(){return _.find(this.msgs.models,function(e){return!e.isNotification&&(e.isSentByMe||e.type===c.TYPE.PTT)})},getFirstMsgFromMe:function(){return _.find(this.msgs.models,function(e){return!e.isNotification&&e.isSentByMe})},sendMessage:function(e){if(e="undefined"==typeof e?"":e.trim(),
""===e)return Promise.resolve();this._messageSent();var t=this.id,r=Wa.me,n=new c({id:Wa.createMsgKey(r,t,m.tag(),void 0,"out"),body:e,type:"chat",t:Wa.now(),from:r,to:t,self:"out",local:!0,ack:0}),i=Store.Msg.send(n);return this.msgs.add(n),i},sendLocation:function(e,t,r,n){var i=Wa.me,o=this.id,a=this;return Wa.getMapThumb(e,t).then(function(s){var d={id:Wa.createMsgKey(i,o,m.tag(),void 0,"out"),body:Wa.parseDataURL(s).data,type:"location",t:Wa.now(),from:i,to:o,self:"out",lat:e,lng:t,local:!0,ack:0};n&&r&&(d.loc=r,d.url=n);var u=new c(d),l=Store.Msg.send(u);return a.msgs.add(u),l})},sendContact:function(e,t){var r=Wa.me,n=this.id,i=new c({id:Wa.createMsgKey(r,n,m.tag(),void 0,"out"),type:"vcard",body:e,subtype:t,t:Wa.now(),from:r,to:n,self:"out",local:!0,ack:0}),o=Store.Msg.send(i);return this.msgs.add(i),o},sendMedia:function(e){var t=this;e=_.flatten([e],1);var r=[],n=[];e.forEach(function(e){var i=e.file,o=e.type,a=e.duration,s=e.caption,c=t._prepSendMedia(i,o,a,s);r.push(c.preMsg),n.push(c.AVparams)});var i=Promise.reduce(r,function(e,r,i){var o=t._createPendingMsg(r),a=n[i];return o.uploadPromise=a.promise,o.reupload=a.reupload,e.push(o),e},[]).then(function(e){var t=_.invoke(_.pluck(n,"promise"),"reflect");return Promise.reduce(t,function(t,r,n){var i=e[n];return r.isFulfilled()&&r.value()?i.sendMediaMsg(r.value()).then(function(){i.set({urlState:c.URL_STATE.STATUS_200,uploadPromise:null,reupload:null})}):i.unset("uploadPromise"),e},1)});return this.regCancellablePromise(i)["catch"](Promise.CancellationError,function(){_.invoke(r,"cancel"),_.invoke(_.pluck(n,"promise"),"cancel")})},_prepSendMedia:function(e,t,r,i){function o(){return b.regCancellablePromise(Promise.props({blob:p,okdup:y})).then(function(e){var t=e.okdup;if("duplicate"===t.result)return t.data;if("ok"===t.result){var r=t.data;return n(r,e.blob.blob,c,a)}})}var a=e.name,s=Wa.me,c=this.id,d=Wa.createMsgKey(s,c,m.tag(),void 0,"out"),u=Wa.typeFromMimetype(e.type),l=t||u,p=Wa.fileToBlobs(e),h=r?r:Wa.getFileDuration(e),f=p.then(function(e){return Wa.getHash(u,e.dataUrl,e.blob)}),g=Promise.props({blob:p,thumb:Wa.fileToThumb(e),duration:h,key:d,caption:i,msgType:l,file:e,hash:f}),y=f.then(function(e){return v.requestMediaUpload(u,e.hash,e.size)}),b=this,E=o()["catch"](Promise.CancellationError,_.noop);return{preMsg:g,AVparams:{promise:E,reupload:o}}},_createPendingMsg:function(e){var t=Store.Msg.add({id:e.key,body:e.thumb,type:e.msgType,t:Wa.now(),from:Wa.me,isNew:!0,to:this.id,self:"out",url:e.blob.dataUrl,urlState:c.URL_STATE.UPLOADING,duration:e.duration+"",ack:0,local:!0,mimetype:e.file.type,height:e.blob.h,width:e.blob.w,fullHeight:e.blob.h,fullWidth:e.blob.w,size:e.hash.size,caption:e.caption});return this.msgs.add(t)},updateReadOnly:function(){this.isGroup&&!this.groupMetadata.stale&&(this.isReadOnly=!this.groupMetadata.participants.get(Wa.me)),this.isBroadcast&&this.updateTitle()},_updateAssignedColor:function(){if(this.colors){var e=this.groupMetadata.participants;if(0!==e.size){var t=this.colors,r=_.difference(_.keys(t),e.pluck("id").map(Wa.md5));r.forEach(function(e){delete t[e]}),r.length&&this._saveAssignedColors()}}},loadAssignedColors:function(){return this.listenTo(this.groupMetadata.participants,"all",this._updateAssignedColor),y.getGroupParticipantAssignedColor(this.id)||{}},saveAssignedColors:function(){var e=this.colors;e&&y.setGroupParticipantAssignedColor(this.id,e)},assignedColor:function(e){var t,r=this.colors||(this.colors=this.loadAssignedColors()),n=Wa.md5(e);return(t=r[n])?t:(t=_.keys(r).length%Wa.CONST.NUM_COLORS+1,r[n]=t,this._saveAssignedColors(),t)},setSubject:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?"":arguments[0];if(t=t.trim(),!t)return Promise.reject(new b.ActionError);if(t===this.contact.name)return Promise.reject(new b.ActionError);var r=v.changeSubject(this.id,t),n=l10n.t("action_group_renaming"),i=r.then(function(e){return 200===e.status?l10n.t("action_group_renamed",{subject:t}):e.status>=400?l10n.t("action_group_rename_failed"):void 0})["catch"](function(e){return o.log("models:chat:setSubject dropped","red",e)(),l10n.t("action_group_rename_failed")});return f.openToast(React.createElement(w,{id:w.genId(),pendingText:n,actionText:i,retry:this.setSubject.bind(this,t)})),r.then(function(r){200!==r.status||r._duplicate||(e.contact.name=t)})}});T.KIND=S,e.exports=T},function(e,t,r){var n=r(14),i=r(197),o=r(177),a=r(203),s=1500,c=2e3,d=i.extend({props:{id:"string",type:{type:"string",values:["available","unavailable","composing","recording"]},t:{type:"number",allowNull:!0},deny:"boolean"},session:{updateTime:"number",_expireTimerId:0}}),u=o.extend({model:d}),l=i.extend({Collection:"Presence",props:{id:"string"},session:{isOnline:"boolean",stale:["boolean",!1,!0],hasData:["boolean",!1,!1],isSubscribed:["boolean",!1,!1],withholdDisplay:["boolean",!1,!0],forceDisplay:["boolean",!1,!1],chatActive:["boolean",!1,!1],withholdDisplayTimer:"number",forceDisplayTimer:"number"},children:{chatstate:d},collections:{chatstates:u},derived:{isGroup:{fn:function(){return Wa.isGroupWid(this.id)}},isUser:{fn:function(){return Wa.isUserWid(this.id)}}},initialize:function(){this.isGroup?(this.chatstate.set({id:"",type:"unavailable"}),this.listenTo(this.chatstates,"add change",function(){var e,t=!1;this.chatstates.forEach(function(r){"composing"!==r.type&&"recording"!==r.type||e&&!(e.updateTime<r.updateTime)||(e=r),t=t||"unavailable"!==r.type}),this.set({isOnline:t,chatstate:{id:e?e.id:"",type:e?e.type:"unavailable"}})})):(this.chatstate.set({id:this.id}),this.listenTo(this.chatstate,"change:type",function(){this.isOnline="unavailable"!==this.chatstate.type})),this.listenTo(this,"change:chatActive",this.onChatActiveChange)},"delete":function(){i.prototype["delete"].call(this),Store.Presence.remove(this.id),this.chatstate["delete"](),this.chatstates.forEach(function(e){e["delete"]()})},handle:function(e){"undefined"==typeof e.type?e.type=this.chatstate.type||"unavailable":"paused"===e.type&&(e.type="available"),this.isGroup&&"available"!==e.type&&(e.updateTime=Date.now());var t;if(this.isGroup){if(e.id=e.participant,e.participant=void 0,!e.id)return;t=this.chatstates.add(e,{merge:!0})}else t=this.chatstate.set(e);t._expireTimerId&&clearTimeout(t._expireTimerId),"composing"===t.type||"recording"===t.type?t._expireTimerId=_.delay(this._expireComposing,Wa.CONST.PRESENCE_COMPOSING_TIMEOUT,t):t._expireTimerId=0;var r=this.forceDisplay||this.isOnline||this.isUser&&!this.chatstate.deny;this.set({hasData:!0,forceDisplay:r})},_expireComposing:function(e){var t=e.type;"composing"===t||"recording"===t?e.type="available":n.log("models:presence:expireComposing "+t,"red")()},reset:function(){this.hasData=!1,this.isGroup?this.chatstates.forEach(function(e){e.type="unavailable"}):this.isUser&&(this.chatstate.unset("t"),this.chatstate.unset("deny")),this.chatstate.set({id:this.isGroup?"":this.id,type:"unavailable",t:void 0,deny:void 0})},isActive:function(){var e=this.chatstate.type;return this.hasData&&("composing"===e||"recording"===e)},getFormattedString:function(){if(!this.hasData)return null;if(this.isGroup){var e=this.chatstate.id;if(!e)return null;var t=Store.Contact.get(e);if(!t)return null;var r=t.formattedShortName;return"composing"===this.chatstate.type?l10n.t("web_conversation_name_is_composing",{participant:r}):l10n.t("web_conversation_name_is_recording",{participant:r})}if(!this.isUser)return null;var n=this.chatstate;switch(n.type){case"available":return l10n.t("web_conversation_contact_online");case"composing":return l10n.t("web_conversation_is_composing");case"recording":return l10n.t("web_conversation_is_recording");case"unavailable":if(n.deny||!n.t)return null;var i=n.t,o=moment().startOf("day"),a=moment.unix(i).startOf("day"),s=o.diff(a,"days"),c=Wa.formatTimestamp(i);switch(s){case 0:return l10n.t("web_conversation_last_seen_today",{time:c});case 1:return l10n.t("web_conversation_last_seen_yesterday",{time:c});default:return l10n.t("web_conversation_last_seen_date",{date:Wa.formatDateRelative(i),time:c})}}},onChatActiveChange:function(){var e=this.chatActive;e?(this.hasData?this.withholdDisplay=!1:this.withholdDisplayTimer=_.delay(function(e){e.set({withholdDisplay:!1,withholdDisplayTimer:0})},s,this),this.forceDisplayTimer=_.delay(function(e){e.set({forceDisplay:!0,forceDisplayTimer:0})},c,this)):(this.withholdDisplayTimer&&(clearTimeout(this.withholdDisplayTimer),this.withholdDisplayTimer=0),this.forceDisplayTimer&&(clearTimeout(this.forceDisplayTimer),this.forceDisplayTimer=0))},subscribe:function(){return this.isSubscribed?Promise.resolve():this.isUser?this.update():this.isGroup?(this.isSubscribed=!0,Promise.join(this.update(),a.presenceSubscribe(this.id),_.noop).bind(this)["catch"](function(e){return this.isSubscribed=!1,Promise.reject(e)})):Promise.resolve()}});e.exports=l},function(e,t,r){function n(e){return function(t){return"number"==typeof t.status&&t.status>=500?t:void e(t)}}var i,o=r(14),a=r(20),s=r(204),c=r(227),d=r(228),u=r(229),l={setVersion:function(e,t){var r=e[0],n=e[1];o.log("wap:setVersion "+[r,n,t].join("."))(),0===r&&2===n?(s.setSubProtocol(1),i=s):0===r&&3===n?(s.setSubProtocol(3),i=s):0===r&&4===n?(c.setSubProtocol(4),i=c):0===r&&5===n?(d.setSubProtocol(5),i=d):0===r&&6===n?(d.setSubProtocol(6),i=d):0===r&&7===n?(u.setSubProtocol(t),i=u):(o.log("wap:setVersion unknown version. attempting to update","red")(),Wa.uploadLogs("wap_unknown_version",!0)["finally"](Wa.hardRefresh.bind(Wa)))},"delete":function(){return i?i["delete"].apply(this,arguments):void 0},error2412:function(){return i.error2412.apply(this,arguments)},setSharedSecret:function(){return i.setSharedSecret.apply(this,arguments)},dispatch:function(e,t,r){var n=i[e];return"function"!=typeof n?r?Promise.resolve(r):Promise.reject("wap:"+e+":unsupported"):n.apply(this,t)},handle:function(){return i.handle.apply(this,arguments)},queryServerProps:function(){return new Promise(function(e,t){a.sendEphemeral({data:["query","props"],onSend:e,onDrop:t})})},resyncPictures:function(e){return new Promise(function(t,r){a.sendEphemeral({data:["query","resumePic",e],onSend:n(t),onDrop:r})})},sendWamLogs:function(e,t){return new Promise(function(r,n){var i=function(e){return e.status>=400?(o.log("wam buffer send error")(),o.log(e)(),e):void r(e)};a.send({data:["debug","wam",t,e],onSend:i,onDrop:n})})},setRememberMe:function(e){return a.sendBasic({data:["admin","remember",!!e]})},requestMediaUpload:function(e,t,r){return new Promise(function(i,o){var s=function(e){switch(e.status){case 200:i({result:"ok",data:e.url,size:r});break;case 299:i({result:"duplicate",data:e.params,size:r});break;default:o({size:r})}};a.send({data:["action","upload",e,t,r.toString()],onSend:n(s),onDrop:o})})},sendMedia:function(e){return new Promise(function(t,r){var i=_.clone(e),o=function(e){t(_.merge(i,e))};a.send({data:["query","sendMedia",i.url],onSend:n(o),onDrop:r})})},contactFindBroadcast:function(e){return new Promise(function(t,r){a.send({data:["query","contact",e],onSend:n(t),onDrop:r})})},commonGroupsFind:function(e){return new Promise(function(t,r){a.send({data:["query","group","common",e],onSend:t,onDrop:r})})},groupMetadataFind:function(e){return new Promise(function(t,r){a.sendEphemeral({data:["query","GroupMetadata",e],onSend:n(t),onDrop:r})})},groupMetadataFindFromPhone:function(e){return i.groupMetadataFindFromPhone.apply(this,arguments)},lastseenFind:function(e){return new Promise(function(t,r){a.sendEphemeral({data:["query","Presence","lastseen",e],onSend:n(t),onDrop:r})})},profilePicFind:function(e,t){return"ProfilePicThumb"===e?new Promise(function(r,i){a.sendEphemeral({data:["query",e,t],onSend:n(r),onDrop:i})}):void 0},profilePicFindThumbFromPhone:function(e,t){return i.profilePicFindThumbFromPhone.apply(this,arguments)},statusFind:function(e){return new Promise(function(t,r){a.sendEphemeral({data:["query","Status",e],onSend:n(t),onDrop:r})})},sendPing:function(e){return new Promise(function(e,t){a.send({data:["admin","test"],onSend:n(e),onDrop:t})})},requestDeviceUploadLogs:function(){return this.dispatch("requestDeviceUploadLogs",arguments)},resyncMessages:function(){return this.dispatch("resyncMessages",arguments)},resyncReceipts:function(){return this.dispatch("resyncReceipts",arguments)},queryReceivedActions:function(){return this.dispatch("queryReceivedActions",arguments,[])},addParticipant:function(){return this.dispatch("addParticipant",arguments)},changeSubject:function(){return this.dispatch("changeSubject",arguments)},createGroup:function(){return this.dispatch("createGroup",arguments)},leaveGroup:function(){return this.dispatch("leaveGroup",arguments)},removeParticipant:function(){return this.dispatch("removeParticipant",arguments)},promoteParticipant:function(){return this.dispatch("promoteParticipant",arguments)},requestMediaReupload:function(){return this.dispatch("requestMediaReupload",arguments)},sendConversationSeen:function(){return this.dispatch("sendConversationSeen",arguments)},sendConversationUnseen:function(){return this.dispatch("sendConversationUnseen",arguments)},sendConversationClear:function(){return this.dispatch("sendConversationClear",arguments)},sendConversationDelete:function(){return this.dispatch("sendConversationDelete",arguments)},sendConversationArchive:function(){return this.dispatch("sendConversationArchive",arguments)},sendConversationMute:function(){return this.dispatch("sendConversationMute",arguments)},sendMessagePlayed:function(){return this.dispatch("sendMessagePlayed",arguments)},sendMessageDelete:function(){return this.dispatch("sendMessageDelete",arguments)},sendPresenceAvailable:function(){return this.dispatch("sendPresenceUpdate",["available"])},sendPresenceUnavailable:function(){return this.dispatch("sendPresenceUpdate",["unavailable"])},sendChatstateComposing:function(e){return this.dispatch("sendChatstateUpdate",["composing",e])},sendChatstatePaused:function(e){return this.dispatch("sendChatstateUpdate",["paused",e])},sendChatstateRecording:function(e){return this.dispatch("sendChatstateUpdate",["recording",e])},sendSetPicture:function(){return this.dispatch("sendSetPicture",arguments)},deletePicture:function(){return this.dispatch("deletePicture",arguments)},sendSetStatus:function(){return this.dispatch("sendSetStatus",arguments)},sendSetBlock:function(){return this.dispatch("sendSetBlock",arguments)},chatFindQuery:function(){return this.dispatch("chatFindQuery",arguments)},contactFindQuery:function(){return this.dispatch("contactFindQuery",arguments)},msgCreateRecord:function(){return this.dispatch("msgCreateRecord",arguments)},msgFindQuery:function(){return this.dispatch("msgFindQuery",arguments)},queryMsgInfo:function(){return this.dispatch("queryMsgInfo",arguments)},presenceSubscribe:function(){return this.dispatch("presenceSubscribe",arguments)},recentEmojiQuery:function(){return this.dispatch("recentEmojiQuery",arguments)},logoutToken:function(){var e=Wa.secretBundle.encKey.toString(CryptoJS.enc.Base64),t=Wa.secretBundle.macKey.toString(CryptoJS.enc.Base64),r=CryptoJS.enc.Base64.parse(e),n=CryptoJS.enc.Base64.parse(t);return CryptoJS.HmacSHA256(r,n).toString(CryptoJS.enc.Base64)}};e.exports=l},function(e,t,r){function n(e){return function(t){return"number"==typeof t.status&&t.status>=500?t:void e(t)}}function i(e,t){return function(r){if("object"==typeof r&&"number"==typeof r.status){if(401===r.status)throw new C.E401;if(r.status>=500)return r;t(r)}else e(r)}}function o(e,t){return["action",{type:e},t]}function a(e,t){return["query",e,t]}function s(e,t){return e.reduce(function(e,t){return e||t},!1)?void 0:t}function c(e){var t={};if("action"!==D.tag(e))return t;var r=D.attr("add",e),n=D.attr("missing",e),i=D.attr("checksum",e);switch(r){case"after":case"before":case"last":case"relay":case"update":t.add=r}switch(n){case"remove":t.missing=n}return i&&(t.checksum=i),t}function d(e){var t={};if(!_.isArray(e))return t;var r,n,i=e.length;for(n=0;i>n;n++)switch(r=e[n],D.tag(r)){case"broadcast":switch(D.attr("type",r)){case"create":case"add":case"remove":t.msg||(t.msg=[]),t.msg.push(r);break;case"modify":t.bcUpdate||(t.bcUpdate=[]),t.bcUpdate.push(r)}break;case"message":case"groups_v2":case"notification":t.msg||(t.msg=[]),t.msg.push(r);break;case"read":case"log":t.cmd||(t.cmd=[]),t.cmd.push(r);break;case"received":t.ack||(t.ack=[]),t.ack.push(r);break;case"user":t.contact||(t.contact=[]),t.contact.push(r);break;case"chat":switch(D.attr("type",r)){case"mute":t.mute||(t.mute=[]),t.mute.push(r);break;default:t.chat||(t.chat=[]),t.chat.push(r)}break;case"battery":t.battery||(t.battery=[]),t.battery.push(r);break;default:T.log("Wap:groupActionsByType unknown action: "+D.toString(r),"red",r,!0)()}return t}function u(e,t){var r=parseInt(D.attr(t,e),10);return _.isNaN(r)?void 0:r}function l(e){if("chat"!==D.tag(e))return void 0;var t=D.attr("jid",e),r=parseInt(D.attr("t",e),10)||void 0,n=D.attr("type",e),i=parseInt(D.attr("mute",e),10)||void 0,o=parseInt(D.attr("before",e),10)||void 0,a="true"===D.attr("archive",e),c="true"===D.attr("read_only",e),d=parseInt(D.attr("modify_tag",e),10)||void 0,l=D.attr("name",e)||void 0,p=u(e,"count"),h="true"===D.attr("message",e);"ahead"===n&&(n="clear");var f,m=D.children(e);if(_.isArray(m)){f=[];var g,v,y=m.length;for(g=0;y>g;g++)if(v=m[g],"item"===D.tag(v)){var b=D.attr("index",v);b&&f.push([b,"true"===D.attr("owner",v)])}}var E={id:t,t:r,type:n,keys:f,before:o,archive:a,isReadOnly:c,unreadCount:p,muteExpiration:i,modifyTag:d,name:l,pendingMsgs:h},R=[n&&"delete"!==n&&"clear"!==n&&"archive"!==n&&"unarchive"!==n&&"mute"!==n,!n&&!t,a&&n&&"clear"!==n,"clear"!==n&&o&&o>0,"clear"!==n&&f&&f.length>0];return s(R,E)}function p(e){if("user"!==D.tag(e))return void 0;var t=D.attr("jid",e),r=D.attr("name",e),n=D.attr("short",e)||void 0,i=D.attr("type",e)||"in",o={id:t,name:r,type:i,shortName:n},a=[!t,"in"!==i&&"out"!==i&&!!i];return s(a,o)}function h(e){if("read"!==D.tag(e))return void 0;var t=D.attr("jid",e),r={type:"read",jid:t},n=[!t];return s(n,r)}function f(e){if("received"!==D.tag(e))return void 0;var t,r=D.attr("type",e),n=D.attr("id",e),i=D.attr("to",e);switch(r){case"message":t=2;break;case"read":t=3;break;case"played":t=4;break;case"error":t=-1;break;case"pending":default:t=0}var o={cmd:"ack",id:n,ack:t,from:Wa.me,to:i},a=[!n,!i,"message"!==r&&"read"!==r&&"played"!==r&&"error"!==r&&"pending"!==r];return s(a,o)}function m(e){if("broadcast"!==D.tag(e)||"modify"!==D.attr("type",e))return void 0;var t=D.attr("jid",e),r=D.children(e),n=[];if(_.isArray(r)){var i,o,a,c=r.length;for(i=0;c>i;i++)o=r[i],a=D.attr("jid",o),"recipient"===D.tag(o)&&a&&2===a.split("@").length&&"c.us"===a.split("@")[1]&&n.push({id:a})}var d={id:t,participants:n},u=[!t,"broadcast"!==t.split("@")[1],0===n.length];return s(u,d)}function g(e){if("battery"!==D.tag(e))return void 0;var t=Math.min(parseInt(D.attr("value",e),10)||-1,100),r=D.attr("live",e),n={battery:0>t?void 0:t,plugged:r?"true"===r:void 0},i=[0>t&&!r];return s(i,n)}function v(e){return e.from===Wa.me?e.to:e.from}function y(e,t){switch(D.tag(e)){case"message":return b(e,t);case"groups_v2":return R(e);case"broadcast":return w(e);case"notification":return S(e);default:return void 0}}function b(e,t){if("message"!==D.tag(e))return void 0;var r;D.attr("from",e)!==Wa.me||D.attr("to",e)?D.attr("to",e)!==Wa.me||D.attr("from",e)||(r="out"):r="in";var n,i=D.attr("id",e),o=parseInt(D.attr("t",e),10)||0,a=D.attr("to",e)||Wa.me,c=D.attr("from",e)||Wa.me,d="broadcast"===c.split("@")[1],u=D.attr("participant",e),l=d?u:c,p=d?void 0:u,h=d?!1:D.child("broadcast",e)&&c===Wa.me,f="invis"===D.attr("web",e),m=D.attr("notify",e)||"",g=parseInt(D.attr("status",e))||0,v=[],y=D.child("broadcast",e);if("broadcast"===a)return void 0;switch(t){case"fresh":n=1;break;default:n=g>=-1&&4>=g?g:1}if(_.isArray(y)){var b,R=y.length;for(b=0;R>b;b++){var w=y[b],S=D.attr("jid",w);"to"===D.tag(w)&&S&&v.push(S)}}var C,N=[];switch(D.attr("type",e)){case"text":var I=D.dataStr(D.child("body",e))||"";C={id:i,body:I,type:"chat",t:o,notifyName:m,from:l,to:a,self:r,author:p,invis:f,ack:n,broadcast:h,recipients:v},N=[!i,!o,!l,!a];break;case"media":var P,O,M,k,A,L=D.child("media",e),x=D.attr("type",L),$=D.attr("media_key",L);if("retry"===D.attr("reason",L))return void 0;switch(x){case"image":case"video":var U=D.attr("caption",L);P=E(L),O=D.attr("url",L),O=_.isString(O)&&O.indexOf("/u/")>0?void 0:O,M=D.attr("filehash",L),k=parseInt(D.attr("size",L),10)||0,A=D.attr("seconds",L),C={id:i,body:P,type:x,t:o,notifyName:m,from:l,to:a,self:r,author:p,invis:f,ack:n,clientUrl:O,duration:A,broadcast:h,recipients:v,filehash:M,size:k,caption:U,mediaKey:$},N=[!i,!o,!l,!a];break;case"location":var W=D.attr("latitude",L),B=D.attr("longitude",L),j=D.attr("name",L);P=E(L),O=D.attr("url",L),C={id:i,body:P,type:x,t:o,notifyName:m,from:l,to:a,self:r,author:p,invis:f,ack:n,clientUrl:O,loc:j,lat:W,lng:B,broadcast:h,recipients:v},N=[!i,!o,!l,!a,!W||!B];break;case"audio":var F="live"===D.attr("origin",L)?"ptt":x;O=D.attr("url",L),O=_.isString(O)&&O.indexOf("/u/")>0?void 0:O,M=D.attr("filehash",L),k=parseInt(D.attr("size",L),10)||0,A=D.attr("seconds",L),C={id:i,type:F,t:o,notifyName:m,from:l,to:a,self:r,author:p,invis:f,ack:n,clientUrl:O,duration:A,broadcast:h,recipients:v,filehash:M,size:k},N=[!i,!o,!l,!a];break;case"vcard":var G=D.child("vcard",L),Y=D.dataStr(G),H=D.attr("name",G);C={id:i,body:Y,type:x,subtype:H,t:o,notifyName:m,from:l,to:a,self:r,author:p,invis:f,ack:n,broadcast:h,recipients:v},N=[!i,!o,!l,!a,!Y,!H];break;default:T.log("wap:parseMsgMessage: unknown media type: "+D.toString(e),"red",e)()}break;default:T.log("wap:parseMsgMessage: unknown message type: "+D.toString(e),"red",e)()}return s(N,C)}function E(e){return"raw"===D.attr("encoding",e)?I.isByteBuffer(D.children(e))?D.children(e).toBase64():"":D.dataStr(e)}function R(e){if("groups_v2"!==D.tag(e))return void 0;var t,r=parseInt(D.attr("t",e),10)||0,n=D.attr("id",e),i=D.attr("jid",e),o="invis"===D.attr("web",e),a=D.attr("type",e),c=D.attr("author",e),d=D.children(e),u=[];switch(a){case"create":t=D.attr("subject",e);break;case"subject":t=D.attr("subject",e);break;case"picture":t=D.attr("picture",e)}if(_.isArray(d)){var l,p=d.length;for(l=0;p>l;l++){var h=d[l],f=D.attr("jid",h);"participant"===D.tag(h)&&f&&u.push(f)}}var m=_.isString(c)?c.indexOf("s.whatsapp.net"):-1;m>-1&&(c=c.slice(0,m)+"c.us");var g={t:r,id:n,to:i,from:i,author:c,body:t?t.toString():void 0,type:"gp2",subtype:a,invis:o,recipients:u},v=[!n,!r,"subject"!==a&&"add"!==a&&"remove"!==a&&"leave"!==a&&"picture"!==a&&"modify"!==a&&"create"!==a&&"delete"!==a&&"promote"!==a&&"demote"!==a,"subject"===a&&!t,("add"===a||"remove"===a||"leave"===a||"promote"===a||"demote"===a||"modify"===a)&&0===u.length,!i,"string"==typeof i&&"g.us"!==i.split("@")[1]];return s(v,g)}function w(e){if("broadcast"!==D.tag(e))return void 0;var t,r=D.attr("type",e),n=D.attr("id",e),i=parseInt(D.attr("t",e),10)||0,o=D.attr("jid",e);switch(r){case"create":t=parseInt(D.attr("count",e),10)||0;break;case"add":case"remove":t=D.attr("participant",e)}var a={id:n,t:i,type:"broadcast_notification",subtype:r,from:o,to:o,body:t?t.toString():void 0},c=[!n,!i,!o,"string"==typeof o&&"broadcast"!==o.split("@")[1],"create"!==r&&"add"!==r&&"remove"!==r,("add"===r||"remove"===r)&&2!==t.split("@").length];return s(c,a)}function S(e){if("notification"!==D.tag(e))return void 0;var t=D.attr("id",e),r=parseInt(D.attr("t",e),10)||0,n=D.attr("jid",e),i="invis"===D.attr("web",e),o=D.dataStr(e),a="true"===D.attr("owner",e)?Wa.me:n,c="true"===D.attr("owner",e)?n:Wa.me,d={id:t,type:"notification",t:r,invis:i,from:a,to:c,body:o},u=[!t,!r,!n,2!==n.split("@").length];return s(u,d)}var T=r(14),C=r(151),N=r(20),I=r(156),P=r(153),O=r(205),M=new O("01"),k=new O("03"),A=M,D=M.Node,L={DEBUG_LOG:1,QUERY_RESUME:2,QUERY_RECEIPT:3,QUERY_MEDIA:4,QUERY_CHAT:5,QUERY_CONTACTS:6,QUERY_MESSAGES:7,PRESENCE:8,PRESENCE_SUBSCRIBE:9,GROUP:10,READ:11,CHAT:12,RECEIVED:13,PIC:14,STATUS:15,MESSAGE:16},x=0,$={"delete":_.noop,error2412:_.noop,setSubProtocol:function(e){1===e?(A=M,D=M.Node):(A=k,D=k.Node)},setSharedSecret:function(e){function t(e){return CryptoJS.lib.WordArray.create(new Uint8Array(e))}T.log("Wap:saveSharedSecret start")();var r=window.goog.crypt.base64.encodeByteArray,n=window.goog.crypt.base64.decodeStringToByteArray,i=n(e),o=i.slice(0,32),a=r(i.slice(32,64)),s=t(i.slice(64)),c=t(o.concat(i.slice(64))),d=window.e2e.ecc.PrimeCurve.CURVE_25519,u=new window.e2e.ecc.Ecdh(d,Wa.secretBundle.keyPair),l=u.bob(o).secret,p=new window.e2e.Hkdf(new window.e2e.hash.Sha256),h=p.getHKDF(l,[],80),f=t(h.slice(0,32)),m=t(h.slice(32,64)),g=t(h.slice(64,80)),v=CryptoJS.HmacSHA256(c,m).toString(CryptoJS.enc.Base64);if(a!==v)return void T.log("Wap:saveSharedSecret hmac mismatch "+a+" "+v,"red")();var y=CryptoJS.AES.decrypt({ciphertext:s,salt:void 0},f,{iv:g,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),_=I.fromBase64(y.toString(CryptoJS.enc.Base64)),b=_.slice(0,32).toBuffer(),E=_.slice(32,64).toBuffer(),R=CryptoJS.lib.WordArray.create(b),w=CryptoJS.lib.WordArray.create(E);Wa.setSecretKeys("0.1",R,w),T.log("Wap:saveSharedSecret done")()},handle:function(e,t,r){var n,i,o,a,s,u,b,E,R=A.read(e);switch(D.tag(R)){case"response":if(0===r.indexOf("preempt"))switch(D.attr("type",R)){case"chat":if(T.log("bin-recv: "+r+",response,chat","green",R)(),i=D.children(R)||[],_.isArray(i)){for(a=i.length,n=[],o=0;a>o;o++)b=l(i[o]),b&&n.push(b);Store.Chat.handle([{cmd:"preempt",response:n}],t)}break;case"contacts":if(T.log("bin-recv: "+r+",response,contact","green",R)(),i=D.children(R),_.isArray(i)){for(a=i.length,n=[],o=0;a>o;o++)s=p(i[o]),s&&n.push(s);Store.Contact.handle([{cmd:"preempt",checksum:D.attr("checksum",R),response:n}],t)}break;default:T.log("Wap:handle unknown response type: "+D.toString(R,!0),"red",R)()}else T.log("Wap:handle non-preemptive response: "+D.toString(R,!0),"red",R)();break;case"action":var w=c(R),S=d(D.children(R)),C=Object.keys(S);if(_.isArray(C)){var N,I,P,O,M=C.length;if(0===M&&"last"===w.add)Store.Msg.handle([{recent:!0}],t);else for(o=0;M>o;o++){I=C[o],N=S[I];var k,L=N.length;switch(I){case"msg":var x;switch(w.add){case"relay":case"update":x=y(N[0],"relay"),1!==L&&T.log("Wap:handle action msg relay length not 1","red",R)(),x?(T.log("bin-recv: "+[r,"action","msg",w.add,x.type,x.from,x.to,x.id].join(","),"green",R)(),O=v(x),Store.Msg.handle([{meta:{add:w.add},chat:O,msg:x}],t)):T.log("Wap:handle action msg relay dropped","red",N[0])();break;case"last":for(T.log("bin-recv: "+[r,"action","msg","last",N.length].join(","),"green",R)(),P=[],k=0;L>k;k++)x=y(N[k],"last"),x?P.push(x):T.log("Wap:handle action msg last dropped","red",N[k])();if(P.length>0){for(var $={recent:!0},U=0;U<P.length;U++)$[v(P[U])]=P[U];Store.Msg.handle([$],t)}else T.log("Wap:handle action msg last dropped to 0","red")();break;case"before":case"after":if(L>0){for(P=[],k=0;L>k;k++)x=y(N[k],w.add),x?P.push(x):T.log("Wap:handle action msg before/after dropped","red",N[k])();T.log("bin-recv: "+[r,"action","msg",w.add,P.length].join(","),"green",R)(),P.length>0?(O=v(P[0]),Store.Msg.handle([{meta:{add:w.add},chat:O,msgs:P}],t)):T.log("Wap:handle action msg before/after droppped to 0","red")()}else T.log("Wap:handle action msg before/after 0 msgs","red")();break;default:T.log("Wap:handle action msg no meta.add","red",R)()}break;case"cmd":for(k=0;L>k;k++){var W=h(N[k]);if(W){var B=_.values(W).join(",");T.log("bin-recv: "+[r,"action","cmd",B].join(","),"green",R)(),Store.Cmd.handle([W],t)}else T.log("Wap:handle action cmd invalid","red",R)()}break;case"bcUpdate":var j=[];for(k=0;L>k;k++){var F=m(N[k]);F?j.push(F):T.log("Wap:handle action bc update invalid","red",N[k])()}T.log("bin-recv: "+[r,"action","bcUpdate",j.length].join(","),"green",R)(),j.length>0&&Store.GroupMetadata.handle(j,t);break;case"ack":for(k=0;L>k;k++){var G=f(N[k]);G?(T.log("bin-recv: "+[r,"action","ack",G.to,G.id,G.ack].join(","),"green",R)(),Store.Msg.handle([G],t)):T.log("Wap:handle action ack invalid","red",R)()}break;case"contact":for(u=[],k=0;L>k;k++)s=p(N[k]),s?u.push(s):T.log("Wap:handle action contact dropped","red",N[k])();if(T.log("bin-recv: "+[r,"action","contact",u.length,w.missing].join(","),"green",R)(),u.length>0){var Y=[u];(w.missing||w.checksum)&&Y.push(w),Store.Contact.handle(Y,t)}break;case"chat":for(E=[],k=0;L>k;k++)b=l(N[k]),b?E.push(b):T.log("Wap:handle action chat dropped","red",N[k])();T.log("bin-recv: "+[r,"action","chat",E.length].join(","),"green",R)(),E.length>0&&Store.Chat.handle([E],t);break;case"battery":var H=g(N[0]);H?(T.log("bin-recv: "+[r,"action","battery",H.battery,H.plugged].join(","),"green",R)(),Store.Conn.handle([H],t)):T.log("Wap:handle action battery dropped","red",N[0])();break;case"mute":for(E=[],k=0;L>k;k++)b=l(N[k]),b?E.push(b):T.log("Wap:handle action mute dropped","red",N[k])();T.log("bin-recv: "+[r,"action","mute",E.length].join(","),"green",R)(),E.length>0&&Store.Mute.handle(E,t);break;default:T.log("Wap:handle action unknown "+I,"red",R)()}}}break;default:T.log("TODO "+D.toString(R,!0),"red",R,!0)()}return!0},requestDeviceUploadLogs:function(){var e;return new Promise(function(t,r){if(x)return void t();e=++x;var n=o("debug",[["log",void 0,void 0]]),i=t;i.drop=!0,N.send({data:A.write(n),onSend:i,onDrop:r,binaryOpts:{debugString:"debug,log",debugObj:n,metric:L.DEBUG_LOG,ackRequest:!0}})})["finally"](function(){e===x&&(x=0)})},resyncMessages:function(e){return new P(function(t,r){var n=function(e){var r=[],n=A.read(e),i=D.children(n);if(T.log("bin-recv: response,resume","green",n)(),"response"===D.tag(n)&&"resume"===D.attr("type",n)&&_.isArray(i)){var o,a=i.length;for(o=0;a>o;o++){var s=l(i[o]);s&&r.push(s)}}t({checksum:D.attr("checksum",n),data:r})},o=e.map(function(e){var t={jid:e.wid,index:e.id,owner:e.fromMe,archive:(!!e.archive).toString()};return e.mute&&(t.mute=e.mute.toString()),e.active&&(t.active="true"),Wa.isGroupWid(e.wid)&&(t.read_only=(!!e.isReadOnly).toString()),e.modifyTag&&(t.modify_tag=e.modifyTag.toString()),e.unreadCount&&(t.count=e.unreadCount.toString()),["last",t,void 0]}),s=a({type:"resume"},o);N.sendEphemeral({data:A.write(s),onSend:i(n,t),onDrop:r,binaryOpts:{debugString:"query,resume",debugObj:s,metric:L.QUERY_RESUME,ackRequest:!1}})})},resyncReceipts:function(e){return new Promise(function(t,r){var n=function(e){var r=[],n=A.read(e),i=D.children(n);if(T.log("bin-recv: response,receipt","green",n)(),"response"===D.tag(n)&&"receipt"===D.attr("type",n)&&_.isArray(i)){var o,a,s,c=i.length;for(o=0;c>o;o++){a=i[o],s=D.children(a);var d=D.attr("jid",a),u=D.attr("t",a);if("receipt"===D.tag(a)&&d&&u&&_.isArray(s)){var l,p=[],h=s.length;for(l=0;h>l;l++){var f=s[l];if("item"===D.tag(f)){var m=D.attr("index",f),g=parseInt(D.attr("status",f),10)||0;m&&0!==g&&4>=g&&p.push([m,!0,void 0,g])}}p.length>0&&r.push({id:d,t:parseInt(u,10),acks:p})}}}t(r)},o=e.map(function(e){return["last",{jid:e.remote,index:e.id,t:e.t.toString()},void 0]}),s=a({type:"receipt"},o);N.sendEphemeral({data:A.write(s),onSend:i(n,t),onDrop:r,binaryOpts:{debugString:"query,receipt",debugObj:s,metric:L.QUERY_RECEIPT,ackRequest:!1}})})},addParticipant:function(e,t){return new Promise(function(r,i){var a=N.tag(),s=n(r);s.tag=a;var c=["participant",{jid:t},void 0],d=["group",{id:a,jid:e,type:"add",author:Wa.me},[c]],u=o("set",[d]);N.send({data:A.write(u),onSend:s,onDrop:i,binaryOpts:{debugString:"action,group,add_participant",debugObj:u,metric:L.GROUP,ackRequest:!1}})})},changeSubject:function(e,t){return new Promise(function(r,i){var a=N.tag(),s=n(r);s.tag=a;var c=["group",{id:a,jid:e,type:"subject",author:Wa.me,subject:t},void 0],d=o("set",[c]);N.send({data:A.write(d),onSend:s,onDrop:i,binaryOpts:{debugString:"action,group,subject",debugObj:d,metric:L.GROUP,ackRequest:!1}})})},createGroup:function(e,t){return new Promise(function(r,i){var a=N.tag(),s=n(r);s.tag=a;var c=t.map(function(e){return["participant",{jid:e},void 0]});T.log("create group tag","black",a)();var d=["group",{
id:a,type:"create",author:Wa.me,subject:e},c],u=o("set",[d]);N.send({data:A.write(u),onSend:s,onDrop:i,binaryOpts:{debugString:"action,group,create",debugObj:u,metric:L.GROUP,ackRequest:!1}})})},leaveGroup:function(e){return new Promise(function(t,r){var i=N.tag(),a=n(t);a.tag=i;var s=["group",{id:i,jid:e,type:"leave",author:Wa.me},void 0],c=o("set",[s]);N.send({data:A.write(c),onSend:a,onDrop:r,binaryOpts:{debugString:"action,group,delete",debugObj:c,metric:L.GROUP,ackRequest:!1}})})},removeParticipant:function(e,t){return new Promise(function(r,i){var a=N.tag(),s=n(r);s.tag=a;var c=["participant",{jid:t},void 0],d=["group",{id:a,jid:e,type:"remove",author:Wa.me},[c]],u=o("set",[d]);N.send({data:A.write(u),onSend:s,onDrop:i,binaryOpts:{debugString:"action,group,rem_participant",debugObj:u,metric:L.GROUP,ackRequest:!1}})})},requestMediaReupload:function(e){return new Promise(function(t,r){var n=e.id,o=function(e){var r,n=A.read(e);if("response"===D.tag(n)&&"media"===D.attr("type",n)){var i=parseInt(D.attr("code",n))||400,o=D.attr("url",n);i>=500&&502!==i?(T.log("wap:requestMediaReupload:error "+i,"red")(),r={status:i}):200===i&&o?r={status:200,url:o}:200!==i||o?(T.log("wap:requestMediaReupload:error "+i,"red")(),r={status:i}):r={status:400}}else T.log("wap:requestMediaReupload:malformed","red")(),r={status:400};t(r)},s=Wa.splitMsgKey(n),c=a({type:"media",index:s.id,jid:s.remote,owner:s.fromMe.toString()},void 0);N.sendEphemeral({data:A.write(c),onSend:i(o,t),onDrop:r,binaryOpts:{debugString:"query,media",debugObj:c,metric:L.QUERY_MEDIA,ackRequest:!1}})})},sendConversationSeen:function(e,t,r){return new Promise(function(n,i){var a=n,s=o("set",[["read",{jid:e,index:t?t.id:void 0,owner:t?t.fromMe.toString():void 0,count:r&&t?r.toString():void 0},void 0]]);N.sendEphemeral({data:A.write(s),onSend:a,onDrop:i,binaryOpts:{debugString:"action,chat,read, "+JSON.stringify(t)+", "+r,debugObj:s,metric:L.READ,ackRequest:!0}})})},sendConversationDelete:function(e){return new Promise(function(t,r){var n=t,i=o("set",[["chat",{type:"delete",jid:e},void 0]]);N.send({data:A.write(i),onSend:n,onDrop:r,binaryOpts:{debugString:"action,chat,delete",debugObj:i,metric:L.CHAT,ackRequest:!0}})})},sendConversationArchive:function(e,t){return new Promise(function(r,n){var i=r,a=t?"archive":"unarchive",s=o("set",[["chat",{type:a,jid:e},void 0]]);N.send({data:A.write(s),onSend:i,onDrop:n,binaryOpts:{debugString:"action,chat, "+a,debugObj:s,metric:L.CHAT,ackRequest:!0}})})},sendConversationMute:function(e,t){return new Promise(function(r,n){var i=r,a=t?t.toString():void 0,s=o("set",[["chat",{type:"mute",mute:a,jid:e},void 0]]);N.send({data:A.write(s),onSend:i,onDrop:n,binaryOpts:{debugString:"action,chat, "+e+", "+(a?"mute, "+a:"unmute"),debugObj:s,metric:L.CHAT,ackRequest:!0}})})},sendMessagePlayed:function(e){return new Promise(function(t,r){var n=t,i=e.remote,a=e.id,s=o("set",[["received",{type:"played",index:a,from:i},void 0]]);N.send({data:A.write(s),onSend:n,onDrop:r,binaryOpts:{debugString:"action,played, "+i+"_"+a,debugObj:s,metric:L.RECEIVED,ackRequest:!0}})})},profilePicFindThumbFromPhone:function(e,t){return new Promise(function(r,n){var o=function(i){var o=A.read(i);("response"!==D.tag(o)||"preview"!==D.attr("type",o))&&n();var a=D.children(o),s=a&&a[0];if(s||n(),"missing"===D.attr("type",s))r({id:e,tag:void 0,raw:void 0});else{var c,d=D.attr("id",s);if(t&&d===t.tag&&t.raw)c=t.raw;else{var u=D.children(s);c=u?u.toBase64():void 0}r({id:e,tag:d,raw:c})}},s={type:"preview",jid:e};t&&t.tag&&(s.id=t.tag);var c=a(s,[]);N.sendEphemeral({data:A.write(c),onSend:i(o,r),onDrop:n,binaryOpts:{debugString:"query,thumb, "+e,debugObj:c,ackRequest:!1}})})},groupMetadataFindFromPhone:function(e,t){return new Promise(function(t,r){var n=function(r){var n=A.read(r);if("response"!==D.tag(n)||"group"!==D.attr("type",n))return void t({status:"error",info:"bad format: response incorrect"});var i=D.children(n),o=i&&i[0];if(!o)return void t({status:"error",info:"bad format: no group node"});if("missing"===D.attr("type"))return void t({status:"missing"});var a=_.map(D.children(o),function(e){return{id:D.attr("jid",e),isAdmin:"admin"===D.attr("type",e)}});t({status:"ok",data:{id:e,owner:D.attr("creator",o),creation:parseInt(D.attr("create",o),10)||void 0,participants:a,stale:!1}})},o=a({type:"group",jid:e},[]);N.sendEphemeral({data:A.write(o),onSend:i(n,t),onDrop:r,binaryOpts:{debugString:"query,group, "+e,debugObj:o,ackRequest:!1}})})},sendPresenceUpdate:function(e){return["available","unavailable"].indexOf(e)>-1?new Promise(function(t,r){var n=t,i=o("set",[["presence",{type:e},void 0]]);N.sendEphemeral({data:A.write(i),onSend:n,onDrop:r,binaryOpts:{debugString:"action,presence, "+e,debugObj:i,metric:L.PRESENCE,available:"available"===e,ackRequest:!0}})}):void 0},sendChatstateUpdate:function(e,t){return["composing","paused","recording"].indexOf(e)>-1?new Promise(function(r,n){var i=r,a=o("set",[["presence",{type:e,to:t},void 0]]);N.sendEphemeralIgnore({data:A.write(a),onSend:i,onDrop:n,binaryOpts:{debugString:"action,chatstate, "+e,debugObj:a,metric:L.PRESENCE,skipOffline:!0,ackRequest:!1}},!0)}):void 0},sendSetPicture:function(e,t,r){return new Promise(function(i,a){var s=Wa.parseDataURL(t).data,c=Wa.parseDataURL(r).data,d=I.fromBase64(s,!1),u=I.fromBase64(c,!1),l=N.tag(),p=n(i);p.tag=l;var h=["picture",{id:l,jid:e,type:"set"},[["image",void 0,u],["preview",void 0,d]]],f=o("set",[h]);N.send({data:A.write(f),onSend:p,onDrop:a,binaryOpts:{debugString:"action,set_pic, "+e,debugObj:f,metric:L.PIC,ackRequest:!1}})})},deletePicture:function(e){return new Promise(function(t,r){var i=N.tag(),a=n(t);a.tag=i;var s=["picture",{id:i,jid:e,type:"delete"},void 0],c=o("set",[s]);N.send({data:A.write(c),onSend:a,onDrop:r,binaryOpts:{debugString:"action,delete_pic, "+e,debugObj:c,metric:L.PIC,ackRequest:!1}})})},sendSetStatus:function(e){return new Promise(function(t,r){var i=N.tag(),a=n(t);a.tag=i;var s=o("set",[["status",void 0,e]]);N.send({data:A.write(s),onSend:a,onDrop:r,binaryOpts:{debugString:"action,status,set",debugObj:s,metric:L.STATUS,ackRequest:!1}})})},chatFindQuery:function(e){return new Promise(function(t,r){var n=function(e){var r=[],n=A.read(e),i=D.children(n);if("response"===D.tag(n)&&"chat"===D.attr("type",n))if("true"===D.attr("duplicate",n))r="preempted";else if(_.isArray(i)){var o,a=i.length;for(o=0;a>o;o++){var s=l(i[o]);s&&r.push(s)}}t(r)},o=a({type:"chat",kind:e?"retry":void 0},void 0);N.sendEphemeral({data:A.write(o),onSend:i(n,t),onDrop:r,binaryOpts:{debugString:"query,chat, "+e,debugObj:o,metric:L.QUERY_CHAT,ackRequest:!1}})})},contactFindQuery:function(e){return new Promise(function(t,r){var n=function(e){var r=[],n=A.read(e),i=D.children(n);if("response"===D.tag(n)&&"contacts"===D.attr("type",n))if("true"===D.attr("duplicate",n))r="preempted";else if(_.isArray(i)){var o,a=i.length;for(o=0;a>o;o++){var s=p(i[o]);s&&r.push(s)}}t({checksum:D.attr("checksum",n),data:r})},o=a({type:"contacts",kind:e?"retry":void 0},void 0);N.send({data:A.write(o),onSend:i(n,t),onDrop:r,binaryOpts:{debugString:"query,contacts, "+e,debugObj:o,metric:L.QUERY_CONTACTS,ackRequest:!1}})})},msgCreateRecord:function(e,t){var r=this;return new Promise(function(i,a){var s,c,d=e.id;if("chat"===e.type)c=Promise.cast(["message",{type:"text",to:e.to,id:e.id,t:e.t.toString()},[["body",void 0,e.body]]]);else if("location"===e.type)s=e.body?I.fromBase64(e.body,!1):void 0,c=Promise.cast(["message",{type:"media",to:e.to,id:e.id,t:e.t.toString()},[["media",{type:"location",latitude:e.lat||void 0,longitude:e.lng||void 0,name:e.loc&&e.url?e.loc:void 0,url:e.loc&&e.url?e.url:void 0,encoding:e.body?"raw":void 0},s]]]);else if("vcard"===e.type){var u=["vcard",{name:e.subtype},e.body];c=Promise.cast(["message",{type:"media",to:e.to,id:e.id,t:e.t.toString()},[["media",{type:"vcard"},[u]]]])}else s=e.body?I.fromBase64(e.body,!1):void 0,c=(t?r.sendMedia(e.avparams):Promise.resolve({status:200})).then(function(t){return 200===t.status?Promise.cast(["message",{type:"media",to:e.to,id:e.id,t:e.t.toString()},[["media",{encoding:e.body?"raw":void 0,origin:"ptt"===e.type?"live":void 0,seconds:"ptt"===e.type&&e.duration?e.duration.toString():void 0,type:t.type,mimetype:e.mimetype||void 0,size:e.size?e.size.toString():void 0,filehash:t.filehash,url:t.url,duration:t.duration?t.duration.toString():void 0,vcodec:t.vcodec||void 0,width:t.width?t.width.toString():void 0,height:t.height?t.height.toString():void 0,fps:t.fps?t.fps.toString():void 0,vbitrate:t.vbitrate?t.vbitrate.toString():void 0,acodec:t.acodec||void 0,asampfreq:t.asampfreq?t.asampfreq.toString():void 0,asampfmt:t.asampfmt||void 0,abitrate:t.abitrate?t.abitrate.toString():void 0,caption:"video"!==e.type&&"image"!==e.type||!e.caption?void 0:e.caption},s]]]):(T.log("wap:msgCreateRecord:sendMedia error "+t.status,"red")(),Promise.reject())})["catch"](function(){return T.log("wap:msgCreateRecord:sendMedia dropped","red")(),Promise.reject()});c.then(function(t){var r=o("relay",[t]),s=n(i);s.tag=d,s.meta={type:"message",key:Wa.createMsgKey(e.from,e.to,e.id)},N.send({data:A.write(r),onSend:s,onDrop:a,binaryOpts:{debugString:"action,message, "+e.type,debugObj:r,metric:L.MESSAGE,ackRequest:!1}})})["catch"](function(){T.log("wap:msgCreateRecord mPromise error","red")(),a()})})},msgFindQuery:function(e){return new Promise(function(t,r){var n=function(e){var r=[],n=A.read(e),i=D.children(n);if("response"===D.tag(n)&&"message"===D.attr("type",n)&&_.isArray(i)){var o,a=i.length;for(o=0;a>o;o++){var s=y(i[o],"response");s&&r.push(s)}}t(r)},o=a({type:"message",jid:e.remote,count:e.count.toString(),index:e.id,owner:"undefined"==typeof e.fromMe?void 0:e.fromMe.toString()},void 0);N.sendEphemeral({data:A.write(o),onSend:i(n,t),onDrop:r,binaryOpts:{debugString:"query,message, "+e.remote+"_"+e.id+"_"+e.fromMe+"_"+e.count,debugObj:o,metric:L.QUERY_MESSAGES,ackRequest:!1}})})},presenceSubscribe:function(e){return new Promise(function(t,r){var n=t,i=o("set",[["presence",{type:"subscribe",to:e},void 0]]);N.sendEphemeral({data:A.write(i),onSend:n,onDrop:r,binaryOpts:{debugString:"action,presence,subscribe, "+e,debugObj:i,metric:L.PRESENCE_SUBSCRIBE,ackRequest:!0}})})}};e.exports=$},function(e,t,r){function n(e){"number"==typeof e&&(e="v"+e);var t=u[e];t||(i.log("binaryProtocol unknown version: "+e,"red")(),Wa.uploadLogs("bp_unknown_version",!0)["finally"](Wa.hardRefresh.bind(Wa)));var r=t.OutputStream,n=new t.Writer(t.Dictionary),o=t.InputStream,a=new t.Reader(t.Dictionary),s=t.Crypto;this.Node=t.Node,this.read=function(e){var t;try{var r=new o(s.decrypt(e));t=a.readNode(r)}catch(n){i.log("binaryProtocol:read error "+n.stack,"red",void 0,!0)()}return t},this.write=function(e){var t;try{var o=new r;n.writeNode(o,e),t=s.encrypt(o.toBuffer())}catch(a){i.log("binaryProtocol:write error "+a.stack,"red",void 0,!0)()}return t}}var i=r(14),o={OutputStream:r(206),Writer:r(207),InputStream:r(209),Reader:r(210),Dictionary:r(211),Node:r(212),Crypto:r(213)},a={OutputStream:r(214),Writer:r(215),InputStream:r(217),Reader:r(218),Dictionary:r(219),Node:r(220),Crypto:r(221)},s={OutputStream:r(214),Writer:r(215),InputStream:r(217),Reader:r(218),Dictionary:r(222),Node:r(220),Crypto:r(221)},c={OutputStream:r(214),Writer:r(215),InputStream:r(217),Reader:r(218),Dictionary:r(223),Node:r(220),Crypto:r(221)},d={OutputStream:r(214),Writer:r(224),InputStream:r(217),Reader:r(226),Dictionary:r(223),Node:r(220),Crypto:r(221)},u={"01":o,"03":a,"04":s,"05":c,"06":d,v1:c,v2:d};e.exports=n},function(e,t,r){function n(){function e(e){r++,n.push(e)}var t=!1,r=0,n=[];this.pushInt16=function(t){if("number"!=typeof t)throw new Error("invalid int16");e((65280&t)>>8),e((255&t)>>0)},this.pushInt20=function(t){if("number"!=typeof t)throw new Error("invalid int20");e((983040&t)>>16),e((65280&t)>>8),e((255&t)>>0)},this.pushByte=function(t){if("number"!=typeof t||0>t||t>255)throw new Error("invalid byte value: "+t);e(t)},this.pushBytes=function(e){if(!i.isByteBuffer(e))throw new Error("invalid byte buffer");r+=e.limit,n.push(e)},this.pushString=function(e){if("string"!=typeof e)throw new Error("invalid string");r+=i.calculateUTF8Bytes(e),n.push(e)},this.toBuffer=function(){for(var e=new i(r,t),o=n.length,a=0;o>a;a++){var s=n[a];"string"==typeof s?e.writeString(s):i.isByteBuffer(s)?(s.reset(),e.append(s)):e.writeByte(s)}return e.reset(),e.toBuffer(!0)}}var i=r(156);e.exports=n},function(e,t,r){function n(e){var t,r={};for(t=0;t<e.singleByte.length;t++)e.singleByte[t]&&(r[e.singleByte[t]]=t);for(t=0;t<e.doubleByte.length;t++)e.doubleByte[t]&&(r[e.doubleByte[t]]=t+o.SINGLE_BYTE_MAX);this.writeNode=function(e,t){if(t){if(3!==t.length)throw new Error("invalid node");var r=t[1]?2*Object.keys(t[1]).filter(function(e){return!!t[1][e]}).length:0;this.writeListStart(e,1+r+(t[2]?1:0)),this.writeString(e,t[0]),this.writeAttributes(e,t[1]),this.writeChildren(e,t[2])}},this.writeString=function(e,t){if("string"!=typeof t)throw new Error("invalid string");var n,i,a=r[t];if("undefined"==typeof a){var s=t.indexOf("@");if(1>s)this.writeStringRaw(e,t);else{var c=t.substring(0,s),d=t.substring(s+1);this.writeJid(e,c,d)}}else{if(a<o.SINGLE_BYTE_MAX)this.writeToken(e,a);else{var u=a-o.SINGLE_BYTE_MAX,l=u>>8;switch(i=u%256,l){case 0:n=o.DICTIONARY_0;break;case 1:n=o.DICTIONARY_1;break;case 2:n=o.DICTIONARY_2;break;case 3:n=o.DICTIONARY_3;break;default:throw new Error("double byte dictionary token out of range: "+t+" "+a)}}this.writeToken(e,n),this.writeToken(e,i)}},this.writeStringRaw=function(e,t){var r=i.calculateUTF8Bytes(t);r>=256?(e.pushByte(o.BINARY_20),e.pushInt20(r)):(e.pushByte(o.BINARY_8),e.pushByte(r)),e.pushString(t)},this.writeJid=function(e,t,r){e.pushByte(o.JID_PAIR),t?this.writeString(e,t):this.writeToken(e,o.LIST_EMPTY),"c.us"===r&&(r="s.whatsapp.net"),this.writeString(e,r)},this.writeToken=function(e,t){if(245>t)e.pushByte(t);else if(500>=t)throw new Error("invalid token")},this.writeAttributes=function(e,t){if(t)for(var r in t)t[r]&&(this.writeString(e,r),this.writeString(e,t[r]))},this.writeChildren=function(e,t){var r;if(t)if("string"==typeof t)this.writeString(e,t);else if(i.isByteBuffer(t))r=t.limit,r>=256?(e.pushByte(o.BINARY_20),e.pushInt20(r)):(e.pushByte(o.BINARY_8),e.pushByte(r)),e.pushBytes(t);else{if(!_.isArray(t))throw new Error("invalid children");r=t.length,this.writeListStart(e,r);for(var n=0;r>n;n++)this.writeNode(e,t[n])}},this.writeListStart=function(e,t){0===t?e.pushByte(o.LIST_EMPTY):256>t?(e.pushByte(o.LIST_8),e.pushByte(t)):(e.pushByte(o.LIST_16),e.pushInt16(t))}}var i=r(156),o=r(208);e.exports=n},function(e,t){var r={STREAM_END:2,LIST_EMPTY:0,DICTIONARY_0:236,DICTIONARY_1:237,DICTIONARY_2:238,DICTIONARY_3:239,LIST_8:248,LIST_16:249,JID_PAIR:250,BINARY_8:252,BINARY_20:253,SINGLE_BYTE_MAX:256};e.exports=r},function(e,t,r){function n(e){var t=!1,r=i.wrap(e,void 0,t);this.readByte=function(){return r.readUint8()},this.readInt16=function(){return r.readUint16()},this.readInt20=function(){var e=15&r.readUint8(),t=r.readUint8(),n=r.readUint8();return(e<<16)+(t<<8)+n},this.readString=function(e){return r.readString(e,i.METRICS_BYTES)},this.readBytes=function(e){var t=r.copy(r.offset,r.offset+e);return r.offset+=e,t},this.debugInfo=function(){return"offset: "+r.offset+" byte: "+r.readUint8(r.offset)}}var i=r(156);e.exports=n},function(e,t,r){function n(e){var t=e.singleByte,r=e.doubleByte;this.readNode=function(e){var t=e.readByte(),r=this.readListSize(e,t);if(t=e.readByte(),t===i.STREAM_END)throw new Error("unexpected stream end "+e.debugInfo());var n=this.readString(e,t);if(0===r||!n)throw new Error("invalid node. 0 list or empty tag"+e.debugInfo());var o=r-2+r%2>>1,a=this.readAttributes(e,o);if(r%2===1)return[n,a,void 0];var s;if(t=e.readByte(),this.isListTag(t))s=this.readList(e,t);else if(t===i.BINARY_8){var c=e.readByte();s=e.readBytes(c)}else if(t===i.BINARY_20){var d=e.readInt20();s=e.readBytes(d)}else s=this.readString(t);return[n,a,s]},this.isListTag=function(e){return e===i.LIST_EMPTY||e===i.LIST_8||e===i.LIST_16},this.readListSize=function(e,t){if(t===i.LIST_EMPTY)return 0;if(t===i.LIST_8)return e.readByte();if(t===i.LIST_16)return e.readInt16();throw new Error("invalid list size "+e.debugInfo())},this.readString=function(e,t){if(-1===t)throw new Error("invalid start token readString"+e.debugInfo());if(t>2&&236>t){var r=this.getToken(t);return"s.whatsapp.net"===r&&(r="c.us"),r}switch(t){case i.DICTIONARY_0:case i.DICTIONARY_1:case i.DICTIONARY_2:case i.DICTIONARY_3:var n=e.readByte();return this.getTokenDouble(t-i.DICTIONARY_0,n);case i.LIST_EMPTY:return void 0;case i.BINARY_8:var o=e.readByte();return e.readString(o);case i.BINARY_20:var a=e.readInt20();return e.readString(a);case i.JID_PAIR:var s=this.readString(e,e.readByte()),c=this.readString(e,e.readByte());if("undefined"!=typeof s&&"undefined"!=typeof c)return s+"@"+c;if("undefined"!=typeof c)return c;throw new Error("invalid jid "+s+","+c+" "+e.debugInfo());default:throw new Error("invalid string "+e.debugInfo())}},this.getToken=function(e){var r;if(e>=0&&e<t.length&&(r=t[e]),"undefined"==typeof r)throw new Error("invalid token "+e);return r},this.getTokenDouble=function(e,t){var n,i=256*e+t;if(i>=0&&i<r.length&&(n=r[i]),"undefined"==typeof n)throw new Error("invalid double byte token "+e+" "+t);return n},this.readAttributes=function(e,t){for(var r,n,i=t?{}:void 0,o=0;t>o;o++)r=this.readString(e,e.readByte()),n=this.readString(e,e.readByte()),i[r]=n;return i},this.readList=function(e,t){for(var r=[],n=this.readListSize(e,t),i=0;n>i;i++)r.push(this.readNode(e));return r}}var i=r(208);e.exports=n},function(e,t){var r={singleByte:[void 0,void 0,void 0,"200","400","404","500","501","502","action","add","after","archive","author","available","battery","before","body","broadcast","chat","clear","code","composing","contacts","count","create","debug","delete","demote","duplicate","encoding","error","false","filehash","from","g.us","group","groups_v2","height","id","image","in","index","invis","item","jid","kind","last","leave","live","log","media","message","mimetype","missing","modify","name","notification","notify","out","owner","participant","paused","picture","played","presence","preview","promote","query","raw","read","receipt","received","recipient","recording","relay","remove","response","resume","retry","s.whatsapp.net","seconds","set","size","status","subject","subscribe","t","text","to","true","type","unarchive","unavailable","url","user","value","web","width","mute","read_only","admin","creator","short","update","powersave"],doubleByte:[]};e.exports=r},function(e,t,r){function n(e,t){if(!e)return"undefined";var r=i(e[1],t),n=o(e[2],t);return"<"+e[0]+r+(n?">\n"+n+"\n</"+e[0]+">":"/>")}function i(e,t){if(e){var r="";for(var n in e){var i="string"==typeof e[n]?t?"...":'"'+e[n]+'"':e[n];r+=" "+n+"="+i}return r}return""}function o(e,t){return a.isByteBuffer(e)?"<<bin:"+e.limit+">>":"string"==typeof e?t?"<<string:"+e.length+">>":e:_.isArray(e)?e.map(_.partial(n,_,t)).join("\n"):void 0}var a=r(156),s={tag:function(e){return e&&e[0]},attr:function(e,t){return t&&t[1]?t[1][e]:void 0},attrs:function(e){return e[1]},child:function c(e,t){var r=t[2];if(_.isArray(r))for(var n=r.length,i=0;n>i;i++){var c=r[i];if(_.isArray(c)&&c[0]===e)return c}},children:function(e){return e&&e[2]},dataStr:function(e){if(!e)return"";var t=e[2];return"string"==typeof t?t:a.isByteBuffer(t)?t.readString(t.limit,a.METRICS_BYTES,0).string:void 0},toString:n};e.exports=s},function(e,t,r){var n=r(14),i=r(156),o={getKeys:function(){var e=Wa.secretBundle.encKey.toString(CryptoJS.enc.Base64),t=Wa.secretBundle.macKey.toString(CryptoJS.enc.Base64);return{enc:CryptoJS.enc.Base64.parse(e),mac:CryptoJS.enc.Base64.parse(t)}},encrypt:function(e){var t=CryptoJS.lib.WordArray.create(e),r=new Uint32Array(4),n=this.getKeys();window.crypto.getRandomValues(r);var o=CryptoJS.AES.encrypt(t,n.enc,{iv:CryptoJS.lib.WordArray.create(r),mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),a=o.iv.concat(o.ciphertext),s=CryptoJS.HmacSHA256(a,n.mac),c=s.concat(a);return i.fromBase64(c.toString(CryptoJS.enc.Base64)).toBuffer()},decrypt:function(e){var t=i.wrap(e),r=t.slice(t.offset,t.offset+32).toBase64(),o=t.slice(t.offset+32).toBuffer(),a=this.getKeys(),s=CryptoJS.lib.WordArray.create(o),c=CryptoJS.HmacSHA256(s,a.mac).toString(CryptoJS.enc.Base64);if(r!==c)throw n.log("bp:01:decrypt hmac dont match "+r+" "+c,"red")(),new Error("hmac mismatch");var d=t.slice(t.offset+32,t.offset+48).toBuffer(),u=t.slice(t.offset+48).toBuffer(),l=CryptoJS.AES.decrypt({ciphertext:CryptoJS.lib.WordArray.create(u),salt:void 0},a.enc,{iv:CryptoJS.lib.WordArray.create(d),mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7});return i.fromBase64(l.toString(CryptoJS.enc.Base64)).toBuffer()}};e.exports=o},function(e,t,r){function n(){function e(e){r++,n.push(e)}var t=!1,r=0,n=[];this.pushInt16=function(t){if("number"!=typeof t)throw new Error("invalid int16");e((65280&t)>>8),e((255&t)>>0)},this.pushInt20=function(t){if("number"!=typeof t)throw new Error("invalid int20");e((983040&t)>>16),e((65280&t)>>8),e((255&t)>>0)},this.pushInt32=function(t){if("number"!=typeof t)throw new Error("invalid int32");e((4278190080&t)>>24),e((16711680&t)>>16),e((65280&t)>>8),e((255&t)>>0)},this.pushByte=function(t){if("number"!=typeof t||0>t||t>255)throw new Error("invalid byte value: "+t);e(t)},this.pushBytes=function(e){if(!i.isByteBuffer(e))throw new Error("invalid byte buffer");r+=e.limit,n.push(e)},this.pushUint8Array=function(e){if("[object Uint8Array]"!==Object.prototype.toString.call(e))throw new Error("invalid Uint8Array");r+=e.length;for(var t=0;t<e.length;t++)n.push(e[t])},this.pushString=function(e){if("string"!=typeof e)throw new Error("invalid string");r+=i.calculateUTF8Bytes(e),n.push(e)},this.toBuffer=function(){for(var e=new i(r,t),o=n.length,a=0;o>a;a++){var s=n[a];"string"==typeof s?e.writeString(s):i.isByteBuffer(s)?(s.reset(),e.append(s)):e.writeByte(s)}return e.reset(),e.toBuffer(!0)}}var i=r(156);e.exports=n},function(e,t,r){function n(e){var t,r={},n=e.nibbleEncode;for(t=0;t<e.singleByte.length;t++)e.singleByte[t]&&(r[e.singleByte[t]]=t);for(t=0;t<e.doubleByte.length;t++)e.doubleByte[t]&&(r[e.doubleByte[t]]=t+a.SINGLE_BYTE_MAX);this.writeNode=function(e,t){if(t){if(3!==t.length)throw new Error("invalid node");var r=t[1]?2*Object.keys(t[1]).filter(function(e){return!!t[1][e]}).length:0;this.writeListStart(e,1+r+(t[2]?1:0)),this.writeString(e,t[0]),this.writeAttributes(e,t[1]),this.writeChildren(e,t[2])}},this.writeString=function(e,t,n){if("string"!=typeof t)throw new Error("invalid string");var i,o,s=r[t];if("c.us"!==t||n)if("undefined"==typeof s){var c=t.indexOf("@");if(1>c)this.writeStringRaw(e,t);else{var d=t.substring(0,c),u=t.substring(c+1);this.writeJid(e,d,u)}}else{if(s<a.SINGLE_BYTE_MAX)this.writeToken(e,s);else{var l=s-a.SINGLE_BYTE_MAX,p=l>>8;switch(o=l%256,p){case 0:i=a.DICTIONARY_0;break;case 1:i=a.DICTIONARY_1;break;case 2:i=a.DICTIONARY_2;break;case 3:i=a.DICTIONARY_3;break;default:throw new Error("double byte dictionary token out of range: "+t+" "+s)}}this.writeToken(e,i),this.writeToken(e,o)}else this.writeToken(e,r["s.whatsapp.net"])},this.writeStringRaw=function(e,t){var r=o.calculateUTF8Bytes(t);if(r>=4294967296)throw new Error("string too large to encode (len = "+r+"): "+t);r>=1<<20?(e.pushByte(a.BINARY_32),e.pushInt32(r)):r>=256?(e.pushByte(a.BINARY_20),e.pushInt20(r)):(e.pushByte(a.BINARY_8),e.pushByte(r)),e.pushString(t)},this.writeJid=function(e,t,r){if(e.pushByte(a.JID_PAIR),t)try{this.writeNibbles(e,t)}catch(n){i.log("writer:encode-fallback "+n.message,"orange",t,!0)(),this.writeString(e,t)}else this.writeToken(e,a.LIST_EMPTY);this.writeString(e,r)},this.writeToken=function(e,t){if(245>t)e.pushByte(t);else if(500>=t)throw new Error("invalid token")},this.writeAttributes=function(e,t){if(t)for(var r in t)t[r]&&(this.writeString(e,r),this.writeString(e,t[r]))},this.writeChildren=function(e,t){var r;if(t)if("string"==typeof t)this.writeString(e,t,!0);else if(o.isByteBuffer(t)){if(r=t.limit,r>=4294967296)throw new Error("invalid children; too long (len = "+r);r>=1<<20?(e.pushByte(a.BINARY_32),e.pushInt32(r)):r>=256?(e.pushByte(a.BINARY_20),e.pushInt20(r)):(e.pushByte(a.BINARY_8),e.pushByte(r)),e.pushBytes(t)}else{if(!_.isArray(t))throw new Error("invalid children");r=t.length,this.writeListStart(e,r);for(var n=0;r>n;n++)this.writeNode(e,t[n])}},this.writeListStart=function(e,t){0===t?e.pushByte(a.LIST_EMPTY):256>t?(e.pushByte(a.LIST_8),e.pushByte(t)):(e.pushByte(a.LIST_16),e.pushInt16(t))},this.writeNibbles=function(e,t){var r=o.calculateUTF8Bytes(t);if(r>a.NIBBLE_MAX)throw new Error("too many bytes to nibble-encode: len = "+r);var n,i=Math.ceil(r/2),s=[],c=0;r%2>0&&(c=128);var d=c|i;s.push(a.NIBBLE_8),s.push(d);for(var u=Math.floor(r/2),l=0;u>l;l++)n=this.packBytePair(t[2*l],t[2*l+1]),s.push(n);c>0&&(n=this.packBytePair(t[r-1],"\x00"),s.push(n));var p=new Uint8Array(s);e.pushUint8Array(p)},this.packBytePair=function(e,t){if(!n.hasOwnProperty(e))throw new Error("invalid byte to nibble-pack: "+e);if(!n.hasOwnProperty(t))throw new Error("invalid byte to nibble-pack: "+t);var r=n[e],i=n[t];return r<<4|i}}var i=r(14),o=r(156),a=r(216);e.exports=n},function(e,t){var r={STREAM_END:2,LIST_EMPTY:0,DICTIONARY_0:236,DICTIONARY_1:237,DICTIONARY_2:238,DICTIONARY_3:239,LIST_8:248,LIST_16:249,JID_PAIR:250,BINARY_8:252,BINARY_20:253,BINARY_32:254,NIBBLE_8:255,SINGLE_BYTE_MAX:256,NIBBLE_MAX:254};e.exports=r},function(e,t,r){function n(e){var t=!1,r=i.wrap(e,void 0,t);this.readByte=function(){return r.readUint8()},this.readInt16=function(){return r.readUint16()},this.readInt20=function(){var e=15&r.readUint8(),t=r.readUint8(),n=r.readUint8();return(e<<16)+(t<<8)+n},this.readInt32=function(){return r.readUint32()},this.readString=function(e){return r.readString(e,i.METRICS_BYTES)},this.readBytes=function(e){var t=r.copy(r.offset,r.offset+e);return r.offset+=e,t},this.debugInfo=function(){return"offset: "+r.offset+" byte: "+r.readUint8(r.offset)}}var i=r(156);e.exports=n},function(e,t,r){function n(e){var t=e.singleByte,r=e.doubleByte,n=e.nibbleDecode;this.readNode=function(e){var t=e.readByte(),r=this.readListSize(e,t);if(t=e.readByte(),t===i.STREAM_END)throw new Error("unexpected stream end "+e.debugInfo());var n=this.readString(e,t);if(0===r||!n)throw new Error("invalid node. 0 list or empty tag"+e.debugInfo());var o=r-2+r%2>>1,a=this.readAttributes(e,o);if(r%2===1)return[n,a,void 0];var s;if(t=e.readByte(),this.isListTag(t))s=this.readList(e,t);else if(t===i.BINARY_8){var c=e.readByte();s=e.readBytes(c)}else if(t===i.BINARY_20){var d=e.readInt20();s=e.readBytes(d)}else if(t===i.BINARY_32){var u=e.readInt32();s=e.readBytes(u)}else s=this.readString(e,t);return[n,a,s]},this.isListTag=function(e){return e===i.LIST_EMPTY||e===i.LIST_8||e===i.LIST_16},this.readListSize=function(e,t){if(t===i.LIST_EMPTY)return 0;if(t===i.LIST_8)return e.readByte();if(t===i.LIST_16)return e.readInt16();throw new Error("invalid list size "+e.debugInfo())},this.readString=function(e,t){if(-1===t)throw new Error("invalid start token readString"+e.debugInfo());if(t>2&&236>t){var r=this.getToken(t);return"s.whatsapp.net"===r&&(r="c.us"),r}switch(t){case i.DICTIONARY_0:case i.DICTIONARY_1:case i.DICTIONARY_2:case i.DICTIONARY_3:var n=e.readByte();return this.getTokenDouble(t-i.DICTIONARY_0,n);case i.LIST_EMPTY:return void 0;case i.BINARY_8:return e.readString(e.readByte());case i.BINARY_20:return e.readString(e.readInt20());case i.BINARY_32:return e.readString(e.readInt32());case i.JID_PAIR:var o=this.readString(e,e.readByte()),a=this.readString(e,e.readByte());if("undefined"!=typeof o&&"undefined"!=typeof a)return o+"@"+a;if("undefined"!=typeof a)return a;throw new Error("invalid jid "+o+","+a+" "+e.debugInfo());case i.NIBBLE_8:return this.nibblesToBytes(e);default:throw new Error("invalid string "+e.debugInfo())}},this.getToken=function(e){var r;if(e>=0&&e<t.length&&(r=t[e]),"undefined"==typeof r)throw new Error("invalid token "+e);return r},this.getTokenDouble=function(e,t){var n,i=256*e+t;if(i>=0&&i<r.length&&(n=r[i]),"undefined"==typeof n)throw new Error("invalid double byte token "+e+" "+t);return n},this.readAttributes=function(e,t){for(var r,n,i=t?{}:void 0,o=0;t>o;o++)r=this.readString(e,e.readByte()),n=this.readString(e,e.readByte()),i[r]=n;return i},this.readList=function(e,t){for(var r=[],n=this.readListSize(e,t),i=0;n>i;i++)r.push(this.readNode(e));return r},this.nibblesToBytes=function(e){for(var t=e.readByte(),r=t>>7,n=127&t,i="",o=0;n>o;o++){var a=e.readByte(),s=this.unpackBytePair(a);i+=s[0],i+=s[1]}return r&&(i=i.substring(0,i.length-1)),i},this.unpackBytePair=function(e){var t=(240&e)>>4,r=15&e;if(!n.hasOwnProperty(t))throw new Error("invalid nibble to unpack: "+t);if(!n.hasOwnProperty(r))throw new Error("invalid nibble to unpack: "+r);var i=n[t],o=n[r];return[i,o]},this.bytesToString=function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}}var i=r(216);e.exports=n},function(e,t){var r={singleByte:[void 0,void 0,void 0,"200","400","404","500","501","502","action","add","after","archive","author","available","battery","before","body","broadcast","chat","clear","code","composing","contacts","count","create","debug","delete","demote","duplicate","encoding","error","false","filehash","from","g.us","group","groups_v2","height","id","image","in","index","invis","item","jid","kind","last","leave","live","log","media","message","mimetype","missing","modify","name","notification","notify","out","owner","participant","paused","picture","played","presence","preview","promote","query","raw","read","receipt","received","recipient","recording","relay","remove","response","resume","retry","s.whatsapp.net","seconds","set","size","status","subject","subscribe","t","text","to","true","type","unarchive","unavailable","url","user","value","web","width","mute","read_only","admin","creator","short","update","powersave"],doubleByte:[],nibbleEncode:{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,"-":10,".":11,"\x00":15},nibbleDecode:{0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"-",11:".",15:String.fromCharCode("\x00")}};e.exports=r},function(e,t,r){function n(e,t){if(!e)return"undefined";var r=i(e[1],t),n=o(e[2],t);return"<"+e[0]+r+(n?">\n"+n+"\n</"+e[0]+">":"/>")}function i(e,t){if(e){var r="";for(var n in e){var i="string"==typeof e[n]?t?"...":'"'+e[n]+'"':e[n];r+=" "+n+"="+i}return r}return""}function o(e,t){return a.isByteBuffer(e)?"<<bin:"+e.limit+">>":"string"==typeof e?t?"<<string:"+e.length+">>":e:_.isArray(e)?e.map(_.partial(n,_,t)).join("\n"):void 0}var a=r(156),s={tag:function(e){return e&&e[0]},attr:function(e,t){return t&&t[1]?t[1][e]:void 0},attrs:function(e){return e[1]},child:function c(e,t){var r=t[2];if(_.isArray(r))for(var n=r.length,i=0;n>i;i++){var c=r[i];if(_.isArray(c)&&c[0]===e)return c}},children:function(e){return e&&e[2]},dataStr:function(e){if(!e)return"";var t=e[2];return"string"==typeof t?t:a.isByteBuffer(t)?t.readString(t.limit,a.METRICS_BYTES,0).string:void 0},toString:n};e.exports=s},function(e,t,r){var n=r(14),i=r(156),o={getKeys:function(){var e=Wa.secretBundle.encKey.toString(CryptoJS.enc.Base64),t=Wa.secretBundle.macKey.toString(CryptoJS.enc.Base64);return{enc:CryptoJS.enc.Base64.parse(e),mac:CryptoJS.enc.Base64.parse(t)}},encrypt:function(e){var t=CryptoJS.lib.WordArray.create(e),r=new Uint32Array(4),n=this.getKeys();window.crypto.getRandomValues(r);var o=CryptoJS.AES.encrypt(t,n.enc,{iv:CryptoJS.lib.WordArray.create(r),mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),a=o.iv.concat(o.ciphertext),s=CryptoJS.HmacSHA256(a,n.mac),c=s.concat(a);return i.fromBase64(c.toString(CryptoJS.enc.Base64)).toBuffer()},decrypt:function(e){var t=i.wrap(e),r=t.slice(t.offset,t.offset+32).toBase64(),o=t.slice(t.offset+32).toBuffer(),a=this.getKeys(),s=CryptoJS.lib.WordArray.create(o),c=CryptoJS.HmacSHA256(s,a.mac).toString(CryptoJS.enc.Base64);if(r!==c)throw n.log("bp:03:decrypt hmac dont match "+r+" "+c,"red")(),
new Error("hmac mismatch");var d=t.slice(t.offset+32,t.offset+48).toBuffer(),u=t.slice(t.offset+48).toBuffer(),l=CryptoJS.AES.decrypt({ciphertext:CryptoJS.lib.WordArray.create(u),salt:void 0},a.enc,{iv:CryptoJS.lib.WordArray.create(d),mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7});return i.fromBase64(l.toString(CryptoJS.enc.Base64)).toBuffer()}};e.exports=o},function(e,t){var r={singleByte:[void 0,void 0,void 0,"200","400","404","500","501","502","action","add","after","archive","author","available","battery","before","body","broadcast","chat","clear","code","composing","contacts","count","create","debug","delete","demote","duplicate","encoding","error","false","filehash","from","g.us","group","groups_v2","height","id","image","in","index","invis","item","jid","kind","last","leave","live","log","media","message","mimetype","missing","modify","name","notification","notify","out","owner","participant","paused","picture","played","presence","preview","promote","query","raw","read","receipt","received","recipient","recording","relay","remove","response","resume","retry","s.whatsapp.net","seconds","set","size","status","subject","subscribe","t","text","to","true","type","unarchive","unavailable","url","user","value","web","width","mute","read_only","admin","creator","short","update","powersave","checksum","epoch","block","previous","409","replaced","reason","spam","modify_tag"],doubleByte:[],nibbleEncode:{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,"-":10,".":11,"\x00":15},nibbleDecode:{0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"-",11:".",15:String.fromCharCode("\x00")}};e.exports=r},function(e,t){var r={singleByte:[void 0,void 0,void 0,"200","400","404","500","501","502","action","add","after","archive","author","available","battery","before","body","broadcast","chat","clear","code","composing","contacts","count","create","debug","delete","demote","duplicate","encoding","error","false","filehash","from","g.us","group","groups_v2","height","id","image","in","index","invis","item","jid","kind","last","leave","live","log","media","message","mimetype","missing","modify","name","notification","notify","out","owner","participant","paused","picture","played","presence","preview","promote","query","raw","read","receipt","received","recipient","recording","relay","remove","response","resume","retry","s.whatsapp.net","seconds","set","size","status","subject","subscribe","t","text","to","true","type","unarchive","unavailable","url","user","value","web","width","mute","read_only","admin","creator","short","update","powersave","checksum","epoch","block","previous","409","replaced","reason","spam","modify_tag","message_info","delivery","emoji"],doubleByte:[],nibbleEncode:{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,"-":10,".":11,"\x00":15},nibbleDecode:{0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"-",11:".",15:String.fromCharCode("\x00")}};e.exports=r},function(e,t,r){function n(e){var t,r={},n=e.nibbleEncode;for(t=0;t<e.singleByte.length;t++)e.singleByte[t]&&(r[e.singleByte[t]]=t);for(t=0;t<e.doubleByte.length;t++)e.doubleByte[t]&&(r[e.doubleByte[t]]=t+a.SINGLE_BYTE_MAX);this.writeNode=function(e,t){if(t){if(3!==t.length)throw new Error("invalid node");var r=t[1]?2*Object.keys(t[1]).filter(function(e){return!!t[1][e]}).length:0;this.writeListStart(e,1+r+(t[2]?1:0)),this.writeString(e,t[0]),this.writeAttributes(e,t[1]),this.writeChildren(e,t[2])}},this.writeString=function(e,t,n){if("string"!=typeof t)throw new Error("invalid string");var i,o,s=r[t];if("c.us"!==t||n)if("undefined"==typeof s){var c=t.indexOf("@");if(1>c)this.writeStringRaw(e,t);else{var d=t.substring(0,c),u=t.substring(c+1);this.writeJid(e,d,u)}}else{if(s<a.SINGLE_BYTE_MAX)this.writeToken(e,s);else{var l=s-a.SINGLE_BYTE_MAX,p=l>>8;switch(o=l%256,p){case 0:i=a.DICTIONARY_0;break;case 1:i=a.DICTIONARY_1;break;case 2:i=a.DICTIONARY_2;break;case 3:i=a.DICTIONARY_3;break;default:throw new Error("double byte dictionary token out of range: "+t+" "+s)}}this.writeToken(e,i),this.writeToken(e,o)}else this.writeToken(e,r["s.whatsapp.net"])},this.writeStringRaw=function(e,t){var r=o.calculateUTF8Bytes(t);if(r>=4294967296)throw new Error("string too large to encode (len = "+r+"): "+t);r>=1<<20?(e.pushByte(a.BINARY_32),e.pushInt32(r)):r>=256?(e.pushByte(a.BINARY_20),e.pushInt20(r)):(e.pushByte(a.BINARY_8),e.pushByte(r)),e.pushString(t)},this.writeJid=function(e,t,r){if(e.pushByte(a.JID_PAIR),t)try{this.writePackedBytes(e,t)}catch(n){i.log("writer:encode-fallback "+n.message,"orange",t,!0)(),this.writeString(e,t)}else this.writeToken(e,a.LIST_EMPTY);this.writeString(e,r)},this.writeToken=function(e,t){if(245>t)e.pushByte(t);else if(500>=t)throw new Error("invalid token")},this.writeAttributes=function(e,t){if(t)for(var r in t)t[r]&&(this.writeString(e,r),this.writeString(e,t[r]))},this.writeChildren=function(e,t){var r;if(t)if("string"==typeof t)this.writeString(e,t,!0);else if(o.isByteBuffer(t)){if(r=t.limit,r>=4294967296)throw new Error("invalid children; too long (len = "+r);r>=1<<20?(e.pushByte(a.BINARY_32),e.pushInt32(r)):r>=256?(e.pushByte(a.BINARY_20),e.pushInt20(r)):(e.pushByte(a.BINARY_8),e.pushByte(r)),e.pushBytes(t)}else{if(!_.isArray(t))throw new Error("invalid children");r=t.length,this.writeListStart(e,r);for(var n=0;r>n;n++)this.writeNode(e,t[n])}},this.writeListStart=function(e,t){0===t?e.pushByte(a.LIST_EMPTY):256>t?(e.pushByte(a.LIST_8),e.pushByte(t)):(e.pushByte(a.LIST_16),e.pushInt16(t))},this.writePackedBytes=function(e,t){try{this.writePackedBytesImpl(e,t,a.NIBBLE_8)}catch(r){i.log("writer:enc nib fail, try hex "+r.message,"orange",t)(),this.writePackedBytesImpl(e,t,a.HEX_8)}},this.writePackedBytesImpl=function(e,t,r){var n=o.calculateUTF8Bytes(t);if(n>a.PACKED_MAX)throw new Error("too many bytes to nibble-encode: len = "+n);var i,s=Math.ceil(n/2),c=[],d=0;n%2>0&&(d=128);var u=d|s;c.push(r),c.push(u);for(var l=Math.floor(n/2),p=0;l>p;p++)i=this.packBytePair(r,t[2*p],t[2*p+1]),c.push(i);d>0&&(i=this.packBytePair(r,t[n-1],"\x00"),c.push(i));var h=new Uint8Array(c);e.pushUint8Array(h)},this.packBytePair=function(e,t,r){var n,i;switch(e){case a.NIBBLE_8:n=this.packNibble(t),i=this.packNibble(r);break;case a.HEX_8:n=this.packHex(t),i=this.packHex(r);break;default:throw new Error("invalid byte pack type: "+e)}return n<<4|i},this.packNibble=function(e){if(!n.hasOwnProperty(e))throw new Error("invalid byte to nibble-pack: "+e);return n[e]},this.packHex=function(e){switch(e){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"A":case"B":case"C":case"D":case"E":case"F":return parseInt(e,16);case"\x00":return 15;default:throw new Error("packHex:invalid byte: "+e)}}}var i=r(14),o=r(156),a=r(225);e.exports=n},function(e,t){var r={STREAM_END:2,LIST_EMPTY:0,DICTIONARY_0:236,DICTIONARY_1:237,DICTIONARY_2:238,DICTIONARY_3:239,LIST_8:248,LIST_16:249,JID_PAIR:250,HEX_8:251,BINARY_8:252,BINARY_20:253,BINARY_32:254,NIBBLE_8:255,SINGLE_BYTE_MAX:256,PACKED_MAX:254};e.exports=r},function(e,t,r){function n(e){var t=e.singleByte,r=e.doubleByte,n=e.nibbleDecode;this.readNode=function(e){var t=e.readByte(),r=this.readListSize(e,t);if(t=e.readByte(),t===i.STREAM_END)throw new Error("unexpected stream end "+e.debugInfo());var n=this.readString(e,t);if(0===r||!n)throw new Error("invalid node. 0 list or empty tag"+e.debugInfo());var o=r-2+r%2>>1,a=this.readAttributes(e,o);if(r%2===1)return[n,a,void 0];var s;if(t=e.readByte(),this.isListTag(t))s=this.readList(e,t);else if(t===i.BINARY_8){var c=e.readByte();s=e.readBytes(c)}else if(t===i.BINARY_20){var d=e.readInt20();s=e.readBytes(d)}else if(t===i.BINARY_32){var u=e.readInt32();s=e.readBytes(u)}else s=this.readString(e,t);return[n,a,s]},this.isListTag=function(e){return e===i.LIST_EMPTY||e===i.LIST_8||e===i.LIST_16},this.readListSize=function(e,t){if(t===i.LIST_EMPTY)return 0;if(t===i.LIST_8)return e.readByte();if(t===i.LIST_16)return e.readInt16();throw new Error("invalid list size "+e.debugInfo())},this.readString=function(e,t){if(-1===t)throw new Error("invalid start token readString"+e.debugInfo());if(t>2&&236>t){var r=this.getToken(t);return"s.whatsapp.net"===r&&(r="c.us"),r}switch(t){case i.DICTIONARY_0:case i.DICTIONARY_1:case i.DICTIONARY_2:case i.DICTIONARY_3:var n=e.readByte();return this.getTokenDouble(t-i.DICTIONARY_0,n);case i.LIST_EMPTY:return void 0;case i.BINARY_8:return e.readString(e.readByte());case i.BINARY_20:return e.readString(e.readInt20());case i.BINARY_32:return e.readString(e.readInt32());case i.JID_PAIR:var o=this.readString(e,e.readByte()),a=this.readString(e,e.readByte());if("undefined"!=typeof o&&"undefined"!=typeof a)return o+"@"+a;if("undefined"!=typeof a)return a;throw new Error("invalid jid "+o+","+a+" "+e.debugInfo());case i.NIBBLE_8:case i.HEX_8:return this.readPacked8(t,e);default:throw new Error("invalid string "+e.debugInfo())}},this.getToken=function(e){var r;if(e>=0&&e<t.length&&(r=t[e]),"undefined"==typeof r)throw new Error("invalid token "+e);return r},this.getTokenDouble=function(e,t){var n,i=256*e+t;if(i>=0&&i<r.length&&(n=r[i]),"undefined"==typeof n)throw new Error("invalid double byte token "+e+" "+t);return n},this.readAttributes=function(e,t){for(var r,n,i=t?{}:void 0,o=0;t>o;o++)r=this.readString(e,e.readByte()),n=this.readString(e,e.readByte()),i[r]=n;return i},this.readList=function(e,t){for(var r=[],n=this.readListSize(e,t),i=0;n>i;i++)r.push(this.readNode(e));return r},this.readPacked8=function(e,t){for(var r=t.readByte(),n=r>>7,i=127&r,o="",a=0;i>a;a++){var s=t.readByte();o+=this.unpackByte(e,(240&s)>>4),o+=this.unpackByte(e,15&s)}return n&&(o=o.substring(0,o.length-1)),o},this.unpackByte=function(e,t){switch(e){case i.NIBBLE_8:return this.unpackNibble(t);case i.HEX_8:return this.unpackHex(t);default:throw new Error("unpack non-nibble/hex type: "+e)}},this.unpackNibble=function(e){if(!n.hasOwnProperty(e))throw new Error("invalid nibble to unpack: "+e);return n[e]},this.unpackHex=function(e){if(e>=0&&15>=e)return e.toString(16).toUpperCase();throw new Error("invalid hex to unpack: "+e)}}var i=r(225);e.exports=n},function(e,t,r){function n(e){return 0===U&&W++,e||U++,I.log("wap:epochCount: "+U+" epoch: "+W)(),W.toString()}function i(){U>0?U--:I.log("wap:epochRecv: NEGATIVE","red")(),I.log("wap:epochCount: "+U+" epoch: "+W)()}function o(e){return function(t){return t&&"number"==typeof t.status&&t.status>=500?t:(i(),void e(t))}}function a(e,t){return function(r){if("object"==typeof r&&"number"==typeof r.status){if(401===r.status)throw i(),new P.E401;if(r.status>=500)return r;i(),t(r)}else i(),e(r)}}function s(e,t,r){return["action",{type:e,epoch:n(r)},t]}function c(e,t){return e.epoch=n(),["query",e,t]}function d(e,t){return e.reduce(function(e,t){return e||t},!1)?void 0:t}function u(e){var t={};if("action"!==x.tag(e))return t;var r=x.attr("add",e),n=x.attr("missing",e),i=x.attr("checksum",e);switch(r){case"after":case"before":case"last":case"relay":case"update":t.add=r}switch(n){case"remove":t.missing=n}return i&&(t.checksum=i),t}function l(e){var t={};if(!_.isArray(e))return t;var r,n,i=e.length;for(n=0;i>n;n++)switch(r=e[n],x.tag(r)){case"broadcast":switch(x.attr("type",r)){case"create":case"add":case"remove":t.msg||(t.msg=[]),t.msg.push(r);break;case"modify":t.bcUpdate||(t.bcUpdate=[]),t.bcUpdate.push(r)}break;case"message":case"groups_v2":case"notification":t.msg||(t.msg=[]),t.msg.push(r);break;case"read":case"log":t.cmd||(t.cmd=[]),t.cmd.push(r);break;case"received":t.ack||(t.ack=[]),t.ack.push(r);break;case"user":t.contact||(t.contact=[]),t.contact.push(r);break;case"chat":switch(x.attr("type",r)){case"mute":t.mute||(t.mute=[]),t.mute.push(r);break;default:t.chat||(t.chat=[]),t.chat.push(r)}break;case"battery":t.battery||(t.battery=[]),t.battery.push(r);break;default:I.log("Wap:groupActionsByType unknown action: "+x.toString(r),"red",r,!0)()}return t}function p(e,t){var r=parseInt(x.attr(t,e),10);return _.isNaN(r)?void 0:r}function h(e){if("chat"!==x.tag(e))return void 0;var t=x.attr("jid",e),r=parseInt(x.attr("t",e),10)||void 0,n=x.attr("type",e),i=parseInt(x.attr("mute",e),10)||void 0,o=parseInt(x.attr("before",e),10)||void 0,a="true"===x.attr("archive",e),s="true"===x.attr("read_only",e),c=parseInt(x.attr("modify_tag",e),10)||void 0,u=x.attr("name",e)||void 0,l=p(e,"count"),h="true"===x.attr("message",e);"ahead"===n&&(n="clear");var f,m=x.children(e);if(_.isArray(m)){f=[];var g,v,y=m.length;for(g=0;y>g;g++)if(v=m[g],"item"===x.tag(v)){var b=x.attr("index",v);b&&f.push([b,"true"===x.attr("owner",v)])}}var E={id:t,t:r,type:n,keys:f,before:o,archive:a,isReadOnly:s,unreadCount:l,muteExpiration:i,modifyTag:c,name:u,pendingMsgs:h},R=[n&&"delete"!==n&&"clear"!==n&&"archive"!==n&&"unarchive"!==n&&"mute"!==n,!n&&!t,a&&n&&"clear"!==n,"clear"!==n&&o&&o>0,"clear"!==n&&f&&f.length>0];return d(R,E)}function f(e){if("user"!==x.tag(e))return void 0;var t=x.attr("jid",e),r=x.attr("name",e),n=x.attr("short",e)||void 0,i=x.attr("type",e)||"in",o={id:t,name:r,type:i,shortName:n},a=[!t,"in"!==i&&"out"!==i&&!!i];return d(a,o)}function m(e){if("read"!==x.tag(e))return void 0;var t=x.attr("jid",e),r={type:"read",jid:t},n=[!t];return d(n,r)}function g(e){if("received"!==x.tag(e))return void 0;var t,r=x.attr("type",e),n=x.attr("id",e),i=x.attr("to",e);switch(r){case"message":t=2;break;case"read":t=3;break;case"played":t=4;break;case"error":t=-1;break;case"pending":default:t=0}var o={cmd:"ack",id:n,ack:t,from:Wa.me,to:i},a=[!n,!i,"message"!==r&&"read"!==r&&"played"!==r&&"error"!==r&&"pending"!==r];return d(a,o)}function v(e){if("broadcast"!==x.tag(e)||"modify"!==x.attr("type",e))return void 0;var t=x.attr("jid",e),r=x.children(e),n=[];if(_.isArray(r)){var i,o,a,s=r.length;for(i=0;s>i;i++)o=r[i],a=x.attr("jid",o),"recipient"===x.tag(o)&&a&&2===a.split("@").length&&"c.us"===a.split("@")[1]&&n.push({id:a})}var c={id:t,participants:n},u=[!t,"broadcast"!==t.split("@")[1],0===n.length];return d(u,c)}function y(e){if("battery"!==x.tag(e))return void 0;var t=Math.min(parseInt(x.attr("value",e),10)||-1,100),r=x.attr("live",e),n={battery:0>t?void 0:t,plugged:r?"true"===r:void 0},i=[0>t&&!r];return d(i,n)}function b(e){return e.from===Wa.me?e.to:e.from}function E(e,t){switch(x.tag(e)){case"message":return R(e,t);case"groups_v2":return S(e);case"broadcast":return T(e);case"notification":return C(e);default:return void 0}}function R(e,t){if("message"!==x.tag(e))return void 0;var r;x.attr("from",e)!==Wa.me||x.attr("to",e)?x.attr("to",e)!==Wa.me||x.attr("from",e)||(r="out"):r="in";var n,i=x.attr("id",e),o=parseInt(x.attr("t",e),10)||0,a=x.attr("to",e)||Wa.me,s=x.attr("from",e)||Wa.me,c="broadcast"===s.split("@")[1],u=x.attr("participant",e),l=c?u:s,p=c?void 0:u,h=c?!1:x.child("broadcast",e)&&s===Wa.me,f="invis"===x.attr("web",e),m=x.attr("notify",e)||"",g=parseInt(x.attr("status",e))||0,v=[],y=x.child("broadcast",e);if("broadcast"===a)return void 0;switch(t){case"fresh":n=1;break;default:n=g>=-1&&4>=g?g:1}if(_.isArray(y)){var b,E=y.length;for(b=0;E>b;b++){var R=y[b],S=x.attr("jid",R);"to"===x.tag(R)&&S&&v.push(S)}}var T,C=[];switch(x.attr("type",e)){case"text":var N=x.dataStr(x.child("body",e))||"";T={id:i,body:N,type:"chat",t:o,notifyName:m,from:l,to:a,self:r,author:p,invis:f,ack:n,broadcast:h,recipients:v},C=[!i,!o,!l,!a];break;case"media":var P,O,M,k,A,D=x.child("media",e),L=x.attr("type",D),$=x.attr("media_key",D);if("retry"===x.attr("reason",D))return void 0;switch(L){case"image":case"video":var U=x.attr("caption",D);P=w(D),O=x.attr("url",D),O=_.isString(O)&&O.indexOf("/u/")>0?void 0:O,M=x.attr("filehash",D),k=parseInt(x.attr("size",D),10)||0,A=x.attr("seconds",D),T={id:i,body:P,type:L,t:o,notifyName:m,from:l,to:a,self:r,author:p,invis:f,ack:n,clientUrl:O,duration:A,broadcast:h,recipients:v,filehash:M,size:k,caption:U,mediaKey:$},C=[!i,!o,!l,!a];break;case"location":var W=x.attr("latitude",D),B=x.attr("longitude",D),j=x.attr("name",D);P=w(D),O=x.attr("url",D),T={id:i,body:P,type:L,t:o,notifyName:m,from:l,to:a,self:r,author:p,invis:f,ack:n,clientUrl:O,loc:j,lat:W,lng:B,broadcast:h,recipients:v},C=[!i,!o,!l,!a,!W||!B];break;case"audio":var F="live"===x.attr("origin",D)?"ptt":L;O=x.attr("url",D),O=_.isString(O)&&O.indexOf("/u/")>0?void 0:O,M=x.attr("filehash",D),k=parseInt(x.attr("size",D),10)||0,A=x.attr("seconds",D),T={id:i,type:F,t:o,notifyName:m,from:l,to:a,self:r,author:p,invis:f,ack:n,clientUrl:O,duration:A,broadcast:h,recipients:v,filehash:M,size:k},C=[!i,!o,!l,!a];break;case"vcard":var G=x.child("vcard",D),Y=x.dataStr(G),H=x.attr("name",G);T={id:i,body:Y,type:L,subtype:H,t:o,notifyName:m,from:l,to:a,self:r,author:p,invis:f,ack:n,broadcast:h,recipients:v},C=[!i,!o,!l,!a,!Y,!H];break;default:I.log("wap:parseMsgMessage unknown media type: "+x.toString(e),"red",e)()}break;default:I.log("wap:parseMsgMessage unknown message type: "+x.toString(e),"red",e)()}return d(C,T)}function w(e){return"raw"===x.attr("encoding",e)?M.isByteBuffer(x.children(e))?x.children(e).toBase64():"":x.dataStr(e)}function S(e){if("groups_v2"!==x.tag(e))return void 0;var t,r=parseInt(x.attr("t",e),10)||0,n=x.attr("id",e),i=x.attr("jid",e),o="invis"===x.attr("web",e),a=x.attr("type",e),s=x.attr("author",e),c=x.children(e),u=[];switch(a){case"create":t=x.attr("subject",e);break;case"subject":t=x.attr("subject",e);break;case"picture":t=x.attr("picture",e)}if(_.isArray(c)){var l,p=c.length;for(l=0;p>l;l++){var h=c[l],f=x.attr("jid",h);"participant"===x.tag(h)&&f&&u.push(f)}}var m={t:r,id:n,to:i,from:i,author:s,body:t?t.toString():void 0,type:"gp2",subtype:a,invis:o,recipients:u},g=[!n,!r,"subject"!==a&&"add"!==a&&"remove"!==a&&"leave"!==a&&"picture"!==a&&"modify"!==a&&"create"!==a&&"delete"!==a&&"promote"!==a&&"demote"!==a,"subject"===a&&!t,("add"===a||"remove"===a||"leave"===a||"promote"===a||"demote"===a||"modify"===a)&&0===u.length,!i,"string"==typeof i&&"g.us"!==i.split("@")[1]];return d(g,m)}function T(e){if("broadcast"!==x.tag(e))return void 0;var t,r=x.attr("type",e),n=x.attr("id",e),i=parseInt(x.attr("t",e),10)||0,o=x.attr("jid",e);switch(r){case"create":t=parseInt(x.attr("count",e),10)||0;break;case"add":case"remove":t=x.attr("participant",e)}var a={id:n,t:i,type:"broadcast_notification",subtype:r,from:o,to:o,body:t?t.toString():void 0},s=[!n,!i,!o,"string"==typeof o&&"broadcast"!==o.split("@")[1],"create"!==r&&"add"!==r&&"remove"!==r,("add"===r||"remove"===r)&&2!==t.split("@").length];return d(s,a)}function C(e){if("notification"!==x.tag(e))return void 0;var t=x.attr("id",e),r=parseInt(x.attr("t",e),10)||0,n=x.attr("jid",e),i="invis"===x.attr("web",e),o=x.dataStr(e),a="true"===x.attr("owner",e)?Wa.me:n,s="true"===x.attr("owner",e)?n:Wa.me,c={id:t,type:"notification",t:r,invis:i,from:a,to:s,body:o},u=[!t,!r,!n,2!==n.split("@").length];return d(u,c)}function N(e,t,r){return new Promise(function(n,i){var a=O.tag(),c=o(n),d=["participant",{jid:r},void 0],u=["group",{id:a,jid:t,type:e,author:Wa.me},[d]],l=s("set",[u]);O.send({tag:a,data:L.write(l),clientCacheable:!0,onSend:c,onDrop:o(i),binaryOpts:{debugString:"action,group,participant,"+[e,t,r].join(","),debugObj:l,metric:$.GROUP,ackRequest:!1,expires:moment().unix()}})})}var I=r(14),P=r(151),O=r(20),M=r(156),k=r(153),A=r(205),D=new A("04"),L=D,x=D.Node,$={DEBUG_LOG:1,QUERY_RESUME:2,QUERY_RECEIPT:3,QUERY_MEDIA:4,QUERY_CHAT:5,QUERY_CONTACTS:6,QUERY_MESSAGES:7,PRESENCE:8,PRESENCE_SUBSCRIBE:9,GROUP:10,READ:11,CHAT:12,RECEIVED:13,PIC:14,STATUS:15,MESSAGE:16,QUERY_ACTIONS:17,BLOCK:18,QUERY_GROUP:19,QUERY_PREVIEW:20},U=0,W=0,B=0,j={"delete":function(){U=0,W=0},error2412:function(){i()},setSubProtocol:function(e){4===e?(L=D,x=D.Node):(I.log("Wap:setSubProtocol unknown "+e,"red")(),L=D,x=D.Node)},setSharedSecret:function(e){function t(e){return CryptoJS.lib.WordArray.create(new Uint8Array(e))}I.log("Wap:saveSharedSecret start")();var r=window.goog.crypt.base64.encodeByteArray,n=window.goog.crypt.base64.decodeStringToByteArray,i=n(e),o=i.slice(0,32),a=r(i.slice(32,64)),s=t(i.slice(64)),c=t(o.concat(i.slice(64))),d=window.e2e.ecc.PrimeCurve.CURVE_25519,u=new window.e2e.ecc.Ecdh(d,Wa.secretBundle.keyPair),l=u.bob(o).secret,p=new window.e2e.Hkdf(new window.e2e.hash.Sha256),h=p.getHKDF(l,[],80),f=t(h.slice(0,32)),m=t(h.slice(32,64)),g=t(h.slice(64,80)),v=CryptoJS.HmacSHA256(c,m).toString(CryptoJS.enc.Base64);if(a!==v)return void I.log("Wap:saveSharedSecret hmac mismatch "+a+" "+v,"red")();var y=CryptoJS.AES.decrypt({ciphertext:s,salt:void 0},f,{iv:g,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),_=M.fromBase64(y.toString(CryptoJS.enc.Base64)),b=_.slice(0,32).toBuffer(),E=_.slice(32,64).toBuffer(),R=CryptoJS.lib.WordArray.create(b),w=CryptoJS.lib.WordArray.create(E);Wa.setSecretKeys("0.1",R,w),I.log("Wap:saveSharedSecret done")()},handle:function(e,t,r){var n,i,o,a,s,c,d,p,R=L.read(e);switch(x.tag(R)){case"response":if(0===r.indexOf("preempt"))switch(x.attr("type",R)){case"chat":if(I.log("bin-recv: "+r+",response,chat","green",R)(),i=x.children(R)||[],_.isArray(i)){for(a=i.length,n=[],o=0;a>o;o++)d=h(i[o]),d&&n.push(d);Store.Chat.handle([{cmd:"preempt",response:n}],t)}break;case"contacts":if(I.log("bin-recv: "+r+",response,contact","green",R)(),i=x.children(R),_.isArray(i)){for(a=i.length,n=[],o=0;a>o;o++)s=f(i[o]),s&&n.push(s);Store.Contact.handle([{cmd:"preempt",checksum:x.attr("checksum",R),response:n}],t)}break;default:I.log("Wap:handle unknown response type: "+x.toString(R,!0),"red",R)()}else I.log("Wap:handle non-preemptive response: "+x.toString(R,!0),"red",R)();break;case"action":var w=u(R),S=l(x.children(R)),T=Object.keys(S);if(_.isArray(T)){var C,N,P,O,M=T.length;if(0===M&&"last"===w.add)Store.Msg.handle([{recent:!0}],t);else for(o=0;M>o;o++){N=T[o],C=S[N];var k,A=C.length;switch(N){case"msg":var D;switch(w.add){case"relay":case"update":D=E(C[0],"relay"),1!==A&&I.log("Wap:handle action msg relay length not 1","red",R)(),D?(I.log("bin-recv: "+[r,"action","msg",w.add,D.type,D.from,D.to,D.id].join(","),"green",R)(),O=b(D),Store.Msg.handle([{meta:{add:w.add},chat:O,msg:D}],t)):I.log("Wap:handle action msg relay dropped","red",C[0])();break;case"last":for(I.log("bin-recv: "+[r,"action","msg","last",C.length].join(","),"green",R)(),P=[],k=0;A>k;k++)D=E(C[k],"last"),D?P.push(D):I.log("Wap:handle action msg last dropped","red",C[k])();if(P.length>0){for(var $={recent:!0},U=0;U<P.length;U++)$[b(P[U])]=P[U];Store.Msg.handle([$],t)}else I.log("Wap:handle action msg last dropped to 0","red")();break;case"before":case"after":if(A>0){for(P=[],k=0;A>k;k++)D=E(C[k],w.add),D?P.push(D):I.log("Wap:handle action msg before/after dropped","red",C[k])();I.log("bin-recv: "+[r,"action","msg",w.add,P.length].join(","),"green",R)(),P.length>0?(O=b(P[0]),Store.Msg.handle([{meta:{add:w.add},chat:O,msgs:P}],t)):I.log("Wap:handle action msg before/after droppped to 0","red")()}else I.log("Wap:handle action msg before/after 0 msgs","red")();break;default:I.log("Wap:handle action msg no meta.add","red",R)()}break;case"cmd":for(k=0;A>k;k++){var W=m(C[k]);if(W){var B=_.values(W).join(",");I.log("bin-recv: "+[r,"action","cmd",B].join(","),"green",R)(),Store.Cmd.handle([W],t)}else I.log("Wap:handle action cmd invalid","red",R)()}break;case"bcUpdate":var j=[];for(k=0;A>k;k++){var F=v(C[k]);F?j.push(F):I.log("Wap:handle action bc update invalid","red",C[k])()}I.log("bin-recv: "+[r,"action","bcUpdate",j.length].join(","),"green",R)(),j.length>0&&Store.GroupMetadata.handle(j,t);break;case"ack":for(k=0;A>k;k++){var G=g(C[k]);G?(I.log("bin-recv: "+[r,"action","ack",G.to,G.id,G.ack].join(","),"green",R)(),Store.Msg.handle([G],t)):I.log("Wap:handle action ack invalid","red",R)()}break;case"contact":for(c=[],k=0;A>k;k++)s=f(C[k]),s?c.push(s):I.log("Wap:handle action contact dropped","red",C[k])();if(I.log("bin-recv: "+[r,"action","contact",c.length,w.missing].join(","),"green",R)(),c.length>0){var Y=[c];(w.missing||w.checksum)&&Y.push(w),Store.Contact.handle(Y,t)}break;case"chat":for(p=[],k=0;A>k;k++)d=h(C[k]),d?p.push(d):I.log("Wap:handle action chat dropped","red",C[k])();I.log("bin-recv: "+[r,"action","chat",p.length].join(","),"green",R)(),p.length>0&&Store.Chat.handle([p],t);break;case"battery":var H=y(C[0]);H?(I.log("bin-recv: "+[r,"action","battery",H.battery,H.plugged].join(","),"green",R)(),Store.Conn.handle([H],t)):I.log("Wap:handle action battery dropped","red",C[0])();break;case"mute":for(p=[],k=0;A>k;k++)d=h(C[k]),d?p.push(d):I.log("Wap:handle action mute dropped","red",C[k])();I.log("bin-recv: "+[r,"action","mute",p.length].join(","),"green",R)(),p.length>0&&Store.Mute.handle(p,t);break;default:I.log("Wap:handle action unknown "+N,"red",R)()}}}break;default:I.log("TODO "+x.toString(R,!0),"red",R,!0)()}return!0},requestDeviceUploadLogs:function(){var e;return new Promise(function(t,r){if(B)return void t();e=++B;var n=s("debug",[["log",void 0,void 0]]),i=o(t);i.drop=!0,O.send({data:L.write(n),clientCacheable:!0,onSend:i,onDrop:r,binaryOpts:{debugString:"debug,log",debugObj:n,metric:$.DEBUG_LOG,ackRequest:!0}})})["finally"](function(){e===B&&(B=0)})},resyncMessages:function(e){return new k(function(t,r){var n=function(e){var r=[],n=L.read(e),i=x.children(n);if(I.log("bin-recv: response,resume","green",n)(),"response"===x.tag(n)&&"resume"===x.attr("type",n)&&_.isArray(i)){var o,a=i.length;for(o=0;a>o;o++){var s=h(i[o]);s&&r.push(s)}}t({checksum:x.attr("checksum",n),data:r})},i=e.map(function(e){var t={jid:e.wid,index:e.id,owner:e.fromMe,archive:(!!e.archive).toString()};return e.mute&&(t.mute=e.mute.toString()),e.active&&(t.active="true"),Wa.isGroupWid(e.wid)&&(t.read_only=(!!e.isReadOnly).toString()),e.modifyTag&&(t.modify_tag=e.modifyTag.toString()),e.unreadCount&&(t.count=e.unreadCount.toString()),["last",t,void 0]}),s=c({type:"resume"},i);O.sendEphemeral({data:L.write(s),onSend:a(n,t),onDrop:o(r),binaryOpts:{debugString:"query,resume",debugObj:s,metric:$.QUERY_RESUME,ackRequest:!1}})})},resyncReceipts:function(e){return new Promise(function(t,r){var n=function(e){var r=[],n=L.read(e),i=x.children(n);if(I.log("bin-recv: response,receipt","green",n)(),"response"===x.tag(n)&&"receipt"===x.attr("type",n)&&_.isArray(i)){var o,a,s,c=i.length;for(o=0;c>o;o++){a=i[o],s=x.children(a);var d=x.attr("jid",a),u=x.attr("t",a);if("receipt"===x.tag(a)&&d&&u&&_.isArray(s)){var l,p=[],h=s.length;for(l=0;h>l;l++){var f=s[l];if("item"===x.tag(f)){var m=x.attr("index",f),g=parseInt(x.attr("status",f),10)||0;m&&0!==g&&4>=g&&p.push([m,!0,void 0,g])}}p.length>0&&r.push({id:d,t:parseInt(u,10),acks:p})}}}t(r)},i=e.map(function(e){return["last",{jid:e.remote,index:e.id,t:e.t.toString()},void 0]}),s=c({type:"receipt"},i);O.sendEphemeral({data:L.write(s),onSend:a(n,t),onDrop:o(r),binaryOpts:{debugString:"query,receipt",debugObj:s,metric:$.QUERY_RECEIPT,ackRequest:!1}})})},queryReceivedActions:function(e){return new Promise(function(t,r){var n=function(e){var r=[],n=L.read(e),i=x.children(n);if(I.log("bin-recv: response,actions","green",n)(),"response"===x.tag(n)&&"action"===x.attr("type",n))if(_.isArray(i)){var o,a=i.length;for(o=0;a>o;o++){var s=i[o],c=x.attr("id",s),d=parseInt(x.attr("code",s),10)||0;"item"===x.tag(s)&&c&&0!==d&&r.push({id:c,code:d})}}else"true"===x.attr("replaced",n)&&(r="replaced");t(r)},i=e.map(function(e){return["item",{id:e},void 0]}),s=c({type:"action"},i);O.sendEphemeral({data:L.write(s),onSend:a(n,t),onDrop:o(r),binaryOpts:{debugString:"query,actions",debugObj:s,metric:$.QUERY_ACTIONS,ackRequest:!1}})})},changeSubject:function(e,t){return new Promise(function(r,n){var i=O.tag(),a=o(r);a.tag=i;var c=["group",{id:i,jid:e,type:"subject",author:Wa.me,subject:t},void 0],d=s("set",[c]);O.send({data:L.write(d),clientCacheable:!0,onSend:a,onDrop:o(n),binaryOpts:{debugString:"action,group,subject",debugObj:d,metric:$.GROUP,ackRequest:!1,expires:moment().unix()}})})},createGroup:function(e,t){return new Promise(function(r,n){var i=O.tag(),a=o(r);a.tag=i;var c=t.map(function(e){return["participant",{jid:e},void 0]});I.log("create group tag","black",i)();var d=["group",{id:i,type:"create",author:Wa.me,subject:e},c],u=s("set",[d]);O.send({data:L.write(u),clientCacheable:!0,onSend:a,onDrop:o(n),binaryOpts:{debugString:"action,group,create",debugObj:u,metric:$.GROUP,ackRequest:!1,expires:moment().unix()}})})},leaveGroup:function(e){return new Promise(function(t,r){var n=O.tag(),i=o(t);i.tag=n;var a=["group",{id:n,jid:e,type:"leave",author:Wa.me},void 0],c=s("set",[a]);O.send({data:L.write(c),clientCacheable:!0,onSend:i,onDrop:o(r),binaryOpts:{debugString:"action,group,delete",debugObj:c,metric:$.GROUP,ackRequest:!1,expires:moment().unix()}})})},addParticipant:function(e,t){return N("add",e,t)},removeParticipant:function(e,t){return N("remove",e,t)},promoteParticipant:function(e,t){return N("promote",e,t)},requestMediaReupload:function(e){return new Promise(function(t,r){var n=e.id,i=function(e){var r,n=L.read(e);if("response"===x.tag(n)&&"media"===x.attr("type",n)){var i=parseInt(x.attr("code",n))||400,o=x.attr("url",n);i>=500&&502!==i?(I.log("wap:requestMediaReupload:error "+i,"red")(),r={status:i}):200===i&&o?r={status:200,url:o}:200!==i||o?(I.log("wap:requestMediaReupload:error "+i,"red")(),r={status:i}):r={status:400}}else I.log("wap:requestMediaReupload:malformed","red")(),r={status:400};t(r)},s=Wa.splitMsgKey(n),d=c({type:"media",index:s.id,jid:s.remote,owner:s.fromMe.toString()},void 0);O.sendEphemeral({data:L.write(d),onSend:a(i,t),onDrop:o(r),binaryOpts:{debugString:"query,media",debugObj:d,metric:$.QUERY_MEDIA,ackRequest:!1}})})},sendConversationSeen:function(e,t,r){return new Promise(function(n,i){var a=s("set",[["read",{jid:e,index:t?t.id:void 0,owner:t?t.fromMe.toString():void 0,count:r&&t?r.toString():void 0},void 0]]);O.send({data:L.write(a),clientCacheable:!0,onSend:o(n),onDrop:o(i),binaryOpts:{debugString:"action,chat,read,"+JSON.stringify(t)+","+r,debugObj:a,metric:$.READ,ackRequest:!0}})})},sendConversationDelete:function(e,t){return new Promise(function(r,n){var i=s("set",[["chat",{type:"delete",jid:e,index:t?t.id:void 0,owner:t?t.fromMe.toString():void 0},void 0]]);O.send({data:L.write(i),clientCacheable:!0,onSend:o(r),onDrop:o(n),binaryOpts:{debugString:"action,chat,delete",debugObj:i,metric:$.CHAT,ackRequest:!0}})})},sendConversationArchive:function(e,t,r){return new Promise(function(n,i){var a=t?"archive":"unarchive",c=s("set",[["chat",{type:a,jid:e,index:r?r.id:void 0,owner:r?r.fromMe.toString():void 0},void 0]]);O.send({data:L.write(c),clientCacheable:!0,onSend:o(n),onDrop:o(i),binaryOpts:{debugString:"action,chat,"+a,debugObj:c,metric:$.CHAT,ackRequest:!0}})})},sendConversationMute:function(e,t,r){return new Promise(function(n,i){var a=t?t.toString():void 0,c=r?r.toString():void 0,d=s("set",[["chat",{type:"mute",mute:a,previous:c,jid:e},void 0]]);O.send({data:L.write(d),clientCacheable:!0,onSend:o(n),onDrop:o(i),binaryOpts:{debugString:"action,chat,"+e+", "+(a?"mute,"+a:"unmute"),debugObj:d,metric:$.CHAT,ackRequest:!0}})})},sendMessagePlayed:function(e){return new Promise(function(t,r){var n=o(t),i=e.remote,a=e.id,c=s("set",[["received",{type:"played",index:a,from:i},void 0]]);O.send({data:L.write(c),onSend:n,onDrop:o(r),binaryOpts:{debugString:"action,played,"+i+"_"+a,debugObj:c,metric:$.RECEIVED,ackRequest:!0}})})},profilePicFindThumbFromPhone:function(e,t){return new Promise(function(r,n){var i=function(i){var o=L.read(i);("response"!==x.tag(o)||"preview"!==x.attr("type",o))&&n();var a=x.children(o),s=a&&a[0];if(s||n(),"missing"===x.attr("type",s))r({id:e,tag:void 0,raw:void 0});else{var c,d=x.attr("id",s);if(t&&d===t.tag&&t.raw)c=t.raw;else{var u=x.children(s);c=u?u.toBase64():void 0}r({id:e,tag:d,raw:c})}},s={type:"preview",jid:e};t&&t.tag&&(s.id=t.tag);var d=c(s,[]);O.sendEphemeral({data:L.write(d),onSend:a(i,r),onDrop:o(n),binaryOpts:{debugString:"query,thumb,"+e,debugObj:d,metric:$.QUERY_PREVIEW,ackRequest:!1}})})},groupMetadataFindFromPhone:function(e,t){return new Promise(function(t,r){var n=function(r){var n=L.read(r);if("response"!==x.tag(n)||"group"!==x.attr("type",n))return void t({status:"error",
info:"bad format: response incorrect"});var i=x.children(n),o=i&&i[0];if(!o)return void t({status:"error",info:"bad format: no group node"});if("missing"===x.attr("type"))return void t({status:"missing"});var a=_.map(x.children(o),function(e){return{id:x.attr("jid",e),isAdmin:"admin"===x.attr("type",e)}});t({status:"ok",data:{id:e,owner:x.attr("creator",o),creation:parseInt(x.attr("create",o),10)||void 0,participants:a,stale:!1}})},i=c({type:"group",jid:e},[]);O.sendEphemeral({data:L.write(i),onSend:a(n,t),onDrop:o(r),binaryOpts:{debugString:"query,group,"+e,debugObj:i,metric:$.QUERY_GROUP,ackRequest:!1}})})},sendPresenceUpdate:function(e){return["available","unavailable"].indexOf(e)>-1?new Promise(function(t,r){var n=o(t),i=s("set",[["presence",{type:e},void 0]]);O.sendEphemeral({data:L.write(i),onSend:n,onDrop:o(r),binaryOpts:{debugString:"action,presence,"+e,debugObj:i,metric:$.PRESENCE,available:"available"===e,ackRequest:!0}})}):void 0},sendChatstateUpdate:function(e,t){return["composing","paused","recording"].indexOf(e)>-1?new Promise(function(r,n){var i=r,o=s("set",[["presence",{type:e,to:t},void 0]],!0);O.sendEphemeralIgnore({data:L.write(o),onSend:i,onDrop:n,binaryOpts:{debugString:"action,chatstate,"+e,debugObj:o,metric:$.PRESENCE,skipOffline:!0,ackRequest:!1}},!0)}):void 0},sendSetPicture:function(e,t,r){return new Promise(function(n,i){var a=Wa.parseDataURL(t).data,c=Wa.parseDataURL(r).data,d=M.fromBase64(a,!1),u=M.fromBase64(c,!1),l=O.tag(),p=o(n);p.tag=l;var h=["picture",{id:l,jid:e,type:"set"},[["image",void 0,u],["preview",void 0,d]]],f=s("set",[h]);O.send({data:L.write(f),clientCacheable:!0,onSend:p,onDrop:o(i),binaryOpts:{debugString:"action,set_pic,"+e,debugObj:f,metric:$.PIC,ackRequest:!1,expires:moment().unix()}})})},deletePicture:function(e){return new Promise(function(t,r){var n=O.tag(),i=o(t);i.tag=n;var a=["picture",{id:n,jid:e,type:"delete"},void 0],c=s("set",[a]);O.send({data:L.write(c),clientCacheable:!0,onSend:i,onDrop:o(r),binaryOpts:{debugString:"action,delete_pic,"+e,debugObj:c,metric:$.PIC,ackRequest:!1,expires:moment().unix()}})})},sendSetStatus:function(e){return new Promise(function(t,r){var n=o(t),i=s("set",[["status",void 0,e]]);O.send({data:L.write(i),clientCacheable:!0,onSend:n,onDrop:o(r),binaryOpts:{debugString:"action,status,set",debugObj:i,metric:$.STATUS,ackRequest:!1,expires:moment().unix()}})})},sendSetBlock:function(e,t){return new Promise(function(r,n){var i=t.map(function(t){return["user",{jid:t.jid,reason:e&&t.spam?"spam":void 0},void 0]}),a=["block",{type:e?"add":"remove"},i],c=s("set",[a]);O.send({data:L.write(c),clientCacheable:!0,onSend:o(r),onDrop:o(n),binaryOpts:{debugString:"action,block,"+e+","+_.pluck(t,"jid").join(","),debugObj:c,metric:$.BLOCK,ackRequest:!1,expires:moment().unix()}})})},chatFindQuery:function(e){return new Promise(function(t,r){var n=function(e){var r=[],n=L.read(e),i=x.children(n);if("response"===x.tag(n)&&"chat"===x.attr("type",n))if("true"===x.attr("duplicate",n))r="preempted";else if(_.isArray(i)){var o,a=i.length;for(o=0;a>o;o++){var s=h(i[o]);s&&r.push(s)}}t(r)},i=c({type:"chat",kind:e?"retry":void 0},void 0);O.sendEphemeral({data:L.write(i),onSend:a(n,t),onDrop:o(r),binaryOpts:{debugString:"query,chat,"+e,debugObj:i,metric:$.QUERY_CHAT,ackRequest:!1}})})},contactFindQuery:function(e){return new Promise(function(t,r){var n=function(e){var r=[],n=L.read(e),i=x.children(n);if("response"===x.tag(n)&&"contacts"===x.attr("type",n))if("true"===x.attr("duplicate",n))r="preempted";else if(_.isArray(i)){var o,a=i.length;for(o=0;a>o;o++){var s=f(i[o]);s&&r.push(s)}}t({checksum:x.attr("checksum",n),data:r})},i=c({type:"contacts",kind:e?"retry":void 0},void 0);O.send({data:L.write(i),onSend:a(n,t),onDrop:o(r),binaryOpts:{debugString:"query,contacts, "+e,debugObj:i,metric:$.QUERY_CONTACTS,ackRequest:!1}})})},msgCreateRecord:function(e,t){var r=this;return new Promise(function(n,i){var a,c,d=e.id;if("chat"===e.type)c=Promise.cast(["message",{type:"text",to:e.to,id:e.id,t:e.t.toString()},[["body",void 0,e.body]]]);else if("location"===e.type)a=e.body?M.fromBase64(e.body,!1):void 0,c=Promise.cast(["message",{type:"media",to:e.to,id:e.id,t:e.t.toString()},[["media",{type:"location",latitude:e.lat||void 0,longitude:e.lng||void 0,name:e.loc&&e.url?e.loc:void 0,url:e.loc&&e.url?e.url:void 0,encoding:e.body?"raw":void 0},a]]]);else if("vcard"===e.type){var u=["vcard",{name:e.subtype},e.body];c=Promise.cast(["message",{type:"media",to:e.to,id:e.id,t:e.t.toString()},[["media",{type:"vcard"},[u]]]])}else a=e.body?M.fromBase64(e.body,!1):void 0,c=(t?r.sendMedia(e.avparams):Promise.resolve({status:200})).then(function(t){return 200===t.status?Promise.cast(["message",{type:"media",to:e.to,id:e.id,t:e.t.toString()},[["media",{encoding:e.body?"raw":void 0,origin:"ptt"===e.type?"live":void 0,seconds:"ptt"===e.type&&e.duration?e.duration.toString():void 0,type:t.type,mimetype:e.mimetype||void 0,size:e.size?e.size.toString():void 0,filehash:t.filehash,url:t.url,duration:t.duration?t.duration.toString():void 0,vcodec:t.vcodec||void 0,width:t.width?t.width.toString():void 0,height:t.height?t.height.toString():void 0,fps:t.fps?t.fps.toString():void 0,vbitrate:t.vbitrate?t.vbitrate.toString():void 0,acodec:t.acodec||void 0,asampfreq:t.asampfreq?t.asampfreq.toString():void 0,asampfmt:t.asampfmt||void 0,abitrate:t.abitrate?t.abitrate.toString():void 0,caption:"video"!==e.type&&"image"!==e.type||!e.caption?void 0:e.caption},a]]]):(I.log("wap:msgCreateRecord:sendMedia error "+t.status,"red")(),Promise.reject())})["catch"](function(){return I.log("wap:msgCreateRecord:sendMedia dropped","red")(),Promise.reject()});c.then(function(t){var r=s("relay",[t]),a=o(n);a.tag=d,a.meta={type:"message",key:Wa.createMsgKey(e.from,e.to,e.id)},O.send({data:L.write(r),onSend:a,onDrop:o(i),binaryOpts:{debugString:"action,message, "+e.type,debugObj:r,metric:$.MESSAGE,ackRequest:!1}})})["catch"](function(){I.log("wap:msgCreateRecord mPromise error","red")(),i()})})},msgFindQuery:function(e){return new Promise(function(t,r){var n=function(e){var r=[],n=L.read(e),i=x.children(n);if("response"===x.tag(n)&&"message"===x.attr("type",n)&&_.isArray(i)){var o,a=i.length;for(o=0;a>o;o++){var s=E(i[o],"response");s&&r.push(s)}}t(r)},i=c({type:"message",jid:e.remote,count:e.count.toString(),index:e.id,owner:"undefined"==typeof e.fromMe?void 0:e.fromMe.toString()},void 0);O.sendEphemeral({data:L.write(i),onSend:a(n,t),onDrop:o(r),binaryOpts:{debugString:"query,message,"+e.remote+"_"+e.id+"_"+e.fromMe+"_"+e.count,debugObj:i,metric:$.QUERY_MESSAGES,ackRequest:!1}})})},presenceSubscribe:function(e){return new Promise(function(t,r){var n=o(t),i=s("set",[["presence",{type:"subscribe",to:e},void 0]]);O.sendEphemeral({data:L.write(i),onSend:n,onDrop:o(r),binaryOpts:{debugString:"action,presence,subscribe,"+e,debugObj:i,metric:$.PRESENCE_SUBSCRIBE,ackRequest:!0}})})}};e.exports=j},function(e,t,r){function n(e){return 0===B&&j++,e||B++,P.log("wap:epochCount: "+B+" epoch: "+j)(),j.toString()}function i(){B>0?B--:P.log("wap:epochRecv: NEGATIVE","red")(),P.log("wap:epochCount: "+B+" epoch: "+j)()}function o(e){return function(t){return t&&"number"==typeof t.status&&t.status>=500?t:(i(),void e(t))}}function a(e,t){return function(r){if("object"==typeof r&&"number"==typeof r.status){if(401===r.status)throw i(),new O.E401;if(r.status>=500)return r;i(),t(r)}else i(),e(r)}}function s(e,t,r){return["action",{type:e,epoch:n(r)},t]}function c(e,t){return e.epoch=n(),["query",e,t]}function d(e,t){return e.reduce(function(e,t){return e||t},!1)?void 0:t}function u(e){var t={};if("action"!==U.tag(e))return t;var r=U.attr("add",e),n=U.attr("missing",e),i=U.attr("checksum",e);switch(r){case"after":case"before":case"last":case"relay":case"update":t.add=r}switch(n){case"remove":t.missing=n}return i&&(t.checksum=i),t}function l(e){var t={};if(!_.isArray(e))return t;var r,n,i=e.length;for(n=0;i>n;n++)switch(r=e[n],U.tag(r)){case"broadcast":switch(U.attr("type",r)){case"create":case"add":case"remove":t.msg||(t.msg=[]),t.msg.push(r);break;case"modify":t.bcUpdate||(t.bcUpdate=[]),t.bcUpdate.push(r)}break;case"message":case"groups_v2":case"notification":t.msg||(t.msg=[]),t.msg.push(r);break;case"read":case"log":t.cmd||(t.cmd=[]),t.cmd.push(r);break;case"received":t.ack||(t.ack=[]),t.ack.push(r);break;case"user":t.contact||(t.contact=[]),t.contact.push(r);break;case"chat":switch(U.attr("type",r)){case"mute":t.mute||(t.mute=[]),t.mute.push(r);break;default:t.chat||(t.chat=[]),t.chat.push(r)}break;case"battery":t.battery||(t.battery=[]),t.battery.push(r);break;default:P.log("Wap:groupActionsByType unknown action: "+U.toString(r),"red",r,!0)()}return t}function p(e,t){var r=parseInt(U.attr(t,e),10);return _.isNaN(r)?void 0:r}function h(e){if("chat"!==U.tag(e))return void 0;var t=U.attr("jid",e),r=parseInt(U.attr("t",e),10)||void 0,n=U.attr("type",e),i=parseInt(U.attr("mute",e),10)||void 0,o=parseInt(U.attr("before",e),10)||void 0,a="true"===U.attr("archive",e),s="true"===U.attr("read_only",e),c=parseInt(U.attr("modify_tag",e),10)||void 0,u=U.attr("name",e)||void 0,l=p(e,"count"),h="true"===U.attr("message",e);"ahead"===n&&(n="clear");var f,m=U.children(e);if(_.isArray(m)){f=[];var g,v,y=m.length;for(g=0;y>g;g++)if(v=m[g],"item"===U.tag(v)){var b=U.attr("index",v);b&&f.push([b,"true"===U.attr("owner",v),U.attr("participant",v)])}}var E={id:t,t:r,type:n,keys:f,before:o,archive:a,isReadOnly:s,unreadCount:l,muteExpiration:i,modifyTag:c,name:u,pendingMsgs:h},R=[n&&"delete"!==n&&"clear"!==n&&"archive"!==n&&"unarchive"!==n&&"mute"!==n,!n&&!t,a&&n&&"clear"!==n,"clear"!==n&&o&&o>0,"clear"!==n&&f&&f.length>0];return d(R,E)}function f(e){if("user"!==U.tag(e))return void 0;var t=U.attr("jid",e),r=U.attr("name",e),n=U.attr("short",e)||void 0,i=U.attr("type",e)||"in",o={id:t,name:r,type:i,shortName:n},a=[!t,"in"!==i&&"out"!==i&&!!i];return d(a,o)}function m(e){if("read"!==U.tag(e))return void 0;var t=U.attr("jid",e),r="false"===U.attr("type",e),n={type:r?"unread":"read",jid:t},i=[!t];return d(i,n)}function g(e){if("received"!==U.tag(e))return void 0;var t,r=U.attr("type",e),n=U.attr("id",e),i=U.attr("to",e);switch(r){case"message":t=2;break;case"read":t=3;break;case"played":t=4;break;case"error":t=-1;break;case"pending":default:t=0}var o={cmd:"ack",id:n,ack:t,from:Wa.me,to:i},a=[!n,!i,"message"!==r&&"read"!==r&&"played"!==r&&"error"!==r&&"pending"!==r];return d(a,o)}function v(e){if("broadcast"!==U.tag(e)||"modify"!==U.attr("type",e))return void 0;var t=U.attr("jid",e),r=U.children(e),n=[];if(_.isArray(r)){var i,o,a,s=r.length;for(i=0;s>i;i++)o=r[i],a=U.attr("jid",o),"recipient"===U.tag(o)&&a&&2===a.split("@").length&&"c.us"===a.split("@")[1]&&n.push({id:a})}var c={id:t,participants:n},u=[!t,"broadcast"!==t.split("@")[1],0===n.length];return d(u,c)}function y(e){if("battery"!==U.tag(e))return void 0;var t=Math.min(parseInt(U.attr("value",e),10)||-1,100),r=U.attr("live",e),n={battery:0>t?void 0:t,plugged:r?"true"===r:void 0},i=[0>t&&!r];return d(i,n)}function b(e){return e.from===Wa.me?e.to:e.from}function E(e,t){switch(U.tag(e)){case"message":return R(e,t);case"groups_v2":return S(e);case"broadcast":return T(e);case"notification":return C(e);default:return void 0}}function R(e,t){if("message"!==U.tag(e))return void 0;var r;U.attr("from",e)!==Wa.me||U.attr("to",e)?U.attr("to",e)!==Wa.me||U.attr("from",e)||(r="out"):r="in";var n,i=U.attr("id",e),o=parseInt(U.attr("t",e),10)||0,a=U.attr("to",e)||Wa.me,s=U.attr("from",e)||Wa.me,c="broadcast"===s.split("@")[1],u=U.attr("participant",e),l=c?u:s,p=c?void 0:u,h=c?!1:U.child("broadcast",e)&&s===Wa.me,f="invis"===U.attr("web",e),m=U.attr("notify",e)||"",g=parseInt(U.attr("status",e))||0,v=[],y=U.child("broadcast",e);if("broadcast"===a)return void 0;switch(t){case"fresh":n=1;break;default:n=g>=-1&&4>=g?g:1}if(_.isArray(y)){var b,E=y.length;for(b=0;E>b;b++){var R=y[b],S=U.attr("jid",R);"to"===U.tag(R)&&S&&v.push(S)}}var T,C=[];switch(U.attr("type",e)){case"text":var N=U.dataStr(U.child("body",e))||"";T={id:i,body:N,type:"chat",t:o,notifyName:m,from:l,to:a,self:r,author:p,participant:u,invis:f,ack:n,broadcast:h,recipients:v},C=[!i,!o,!l,!a];break;case"media":var I,O,M,k,A,D=U.child("media",e),L=U.attr("type",D),x=U.attr("media_key",D);if("retry"===U.attr("reason",D))return void 0;switch(L){case"image":case"video":var $=U.attr("caption",D);I=w(D),O=U.attr("url",D),O=_.isString(O)&&O.indexOf("/u/")>0?void 0:O,M=U.attr("filehash",D),k=parseInt(U.attr("size",D),10)||0,A=U.attr("seconds",D),T={id:i,body:I,type:L,t:o,notifyName:m,from:l,to:a,self:r,author:p,participant:u,invis:f,ack:n,clientUrl:O,duration:A,broadcast:h,recipients:v,filehash:M,size:k,caption:$,mediaKey:x},C=[!i,!o,!l,!a];break;case"location":var W=U.attr("latitude",D),B=U.attr("longitude",D),j=U.attr("name",D);I=w(D),O=U.attr("url",D),T={id:i,body:I,type:L,t:o,notifyName:m,from:l,to:a,self:r,author:p,participant:u,invis:f,ack:n,clientUrl:O,loc:j,lat:W,lng:B,broadcast:h,recipients:v},C=[!i,!o,!l,!a,!W||!B];break;case"audio":var F="live"===U.attr("origin",D)?"ptt":L;O=U.attr("url",D),O=_.isString(O)&&O.indexOf("/u/")>0?void 0:O,M=U.attr("filehash",D),k=parseInt(U.attr("size",D),10)||0,A=U.attr("seconds",D),T={id:i,type:F,t:o,notifyName:m,from:l,to:a,self:r,author:p,participant:u,invis:f,ack:n,clientUrl:O,duration:A,broadcast:h,recipients:v,filehash:M,size:k},C=[!i,!o,!l,!a];break;case"vcard":var G=U.child("vcard",D),Y=U.dataStr(G),H=U.attr("name",G);T={id:i,body:Y,type:L,subtype:H,t:o,notifyName:m,from:l,to:a,self:r,author:p,participant:u,invis:f,ack:n,broadcast:h,recipients:v},C=[!i,!o,!l,!a,!Y,!H];break;default:P.log("wap:parseMsgMessage unknown media type: "+U.toString(e),"red",e)()}break;default:P.log("wap:parseMsgMessage unknown message type: "+U.toString(e),"red",e)()}return d(C,T)}function w(e){return"raw"===U.attr("encoding",e)?k.isByteBuffer(U.children(e))?U.children(e).toBase64():"":U.dataStr(e)}function S(e){if("groups_v2"!==U.tag(e))return void 0;var t,r=parseInt(U.attr("t",e),10)||0,n=U.attr("id",e),i=U.attr("jid",e),o="invis"===U.attr("web",e),a="true"===U.attr("owner",e),s=U.attr("type",e),c=U.attr("author",e),u=U.children(e),l=U.attr("participant",e),p=[];switch(s){case"create":t=U.attr("subject",e);break;case"subject":t=U.attr("subject",e);break;case"picture":t=U.attr("picture",e)}if(_.isArray(u)){var h,f=u.length;for(h=0;f>h;h++){var m=u[h],g=U.attr("jid",m);"participant"===U.tag(m)&&g&&p.push(g)}}var v={t:r,id:n,to:a?i:Wa.me,from:a?Wa.me:i,author:c,participant:l,body:t?t.toString():void 0,type:"gp2",subtype:s,invis:o,recipients:p},y=[!n,!r,"subject"!==s&&"add"!==s&&"remove"!==s&&"leave"!==s&&"picture"!==s&&"modify"!==s&&"create"!==s&&"delete"!==s&&"promote"!==s&&"demote"!==s,"subject"===s&&!t,("add"===s||"remove"===s||"leave"===s||"promote"===s||"demote"===s||"modify"===s)&&0===p.length,!i,"string"==typeof i&&"g.us"!==i.split("@")[1]];return d(y,v)}function T(e){if("broadcast"!==U.tag(e))return void 0;var t,r,n=U.attr("type",e),i=U.attr("id",e),o=parseInt(U.attr("t",e),10)||0,a=U.attr("jid",e),s="true"===U.attr("owner",e),c=U.attr("participant",e);switch(n){case"create":t=parseInt(U.attr("count",e),10)||0;break;case"add":case"remove":r=U.child("participant",e),r&&(t=U.attr("jid",r))}var u={id:i,t:o,participant:c,type:"broadcast_notification",subtype:n,from:s?Wa.me:a,to:s?a:Wa.me,body:t?t.toString():void 0},l=[!i,!o,!a,"string"==typeof a&&"broadcast"!==a.split("@")[1],"create"!==n&&"add"!==n&&"remove"!==n,("add"===n||"remove"===n)&&2!==t.split("@").length];return d(l,u)}function C(e){if("notification"!==U.tag(e))return void 0;var t=U.attr("id",e),r=parseInt(U.attr("t",e),10)||0,n=U.attr("jid",e),i=U.attr("participant",e),o="invis"===U.attr("web",e),a=U.dataStr(e),s="true"===U.attr("owner",e)?Wa.me:n,c="true"===U.attr("owner",e)?n:Wa.me,u={id:t,type:"notification",t:r,invis:o,from:s,to:c,participant:i,body:a},l=[!t,!r,!n,2!==n.split("@").length];return d(l,u)}function N(e,t,r){return new Promise(function(n,i){var a=M.tag(),c=o(n),d=["participant",{jid:r},void 0],u=["group",{id:a,jid:t,type:e,author:Wa.me},[d]],l=s("set",[u]);M.send({tag:a,data:$.write(l),clientCacheable:!0,onSend:c,onDrop:o(i),binaryOpts:{debugString:"action,group,participant,"+[e,t,r].join(","),debugObj:l,metric:W.GROUP,ackRequest:!1,expires:moment().unix()}})})}function I(e,t,r){return new Promise(function(n,i){var a=s("set",[["chat",{type:e,jid:t,index:r?r.id:void 0,owner:r?r.fromMe.toString():void 0,participant:r?r.participant:void 0},void 0]]);M.send({data:$.write(a),clientCacheable:!0,onSend:o(n),onDrop:o(i),binaryOpts:{debugString:"action,chat,"+[e,(r||"no_msg_key").toString()].join(),debugObj:a,metric:W.CHAT,ackRequest:!0}})})}var P=r(14),O=r(151),M=r(20),k=r(156),A=r(153),D=r(205),L=new D("05"),x=new D("06"),$=L,U=L.Node,W={DEBUG_LOG:1,QUERY_RESUME:2,QUERY_RECEIPT:3,QUERY_MEDIA:4,QUERY_CHAT:5,QUERY_CONTACTS:6,QUERY_MESSAGES:7,PRESENCE:8,PRESENCE_SUBSCRIBE:9,GROUP:10,READ:11,CHAT:12,RECEIVED:13,PIC:14,STATUS:15,MESSAGE:16,QUERY_ACTIONS:17,BLOCK:18,QUERY_GROUP:19,QUERY_PREVIEW:20,QUERY_EMOJI:21,QUERY_MESSAGE_INFO:22},B=0,j=0,F=0,G={"delete":function(){B=0,j=0},error2412:function(){i()},setSubProtocol:function(e){5===e?($=L,U=L.Node):6===e?($=x,U=x.Node):(P.log("Wap:setSubProtocol unknown "+e,"red")(),$=L,U=L.Node)},setSharedSecret:function(e){function t(e){return CryptoJS.lib.WordArray.create(new Uint8Array(e))}P.log("Wap:saveSharedSecret start")();var r=window.goog.crypt.base64.encodeByteArray,n=window.goog.crypt.base64.decodeStringToByteArray,i=n(e),o=i.slice(0,32),a=r(i.slice(32,64)),s=t(i.slice(64)),c=t(o.concat(i.slice(64))),d=window.e2e.ecc.PrimeCurve.CURVE_25519,u=new window.e2e.ecc.Ecdh(d,Wa.secretBundle.keyPair),l=u.bob(o).secret,p=new window.e2e.Hkdf(new window.e2e.hash.Sha256),h=p.getHKDF(l,[],80),f=t(h.slice(0,32)),m=t(h.slice(32,64)),g=t(h.slice(64,80)),v=CryptoJS.HmacSHA256(c,m).toString(CryptoJS.enc.Base64);if(a!==v)return void P.log("Wap:saveSharedSecret hmac mismatch "+a+" "+v,"red")();var y=CryptoJS.AES.decrypt({ciphertext:s,salt:void 0},f,{iv:g,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),_=k.fromBase64(y.toString(CryptoJS.enc.Base64)),b=_.slice(0,32).toBuffer(),E=_.slice(32,64).toBuffer(),R=CryptoJS.lib.WordArray.create(b),w=CryptoJS.lib.WordArray.create(E);Wa.setSecretKeys("0.1",R,w),P.log("Wap:saveSharedSecret done")()},handle:function(e,t,r){var n,i,o,a,s,c,d,p,R=$.read(e);switch(U.tag(R)){case"response":if(0===r.indexOf("preempt"))switch(U.attr("type",R)){case"chat":if(P.log("bin-recv: "+r+",response,chat","green",R)(),i=U.children(R)||[],_.isArray(i)){for(a=i.length,n=[],o=0;a>o;o++)d=h(i[o]),d&&n.push(d);Store.Chat.handle([{cmd:"preempt",response:n}],t)}break;case"contacts":if(P.log("bin-recv: "+r+",response,contact","green",R)(),i=U.children(R),_.isArray(i)){for(a=i.length,n=[],o=0;a>o;o++)s=f(i[o]),s&&n.push(s);Store.Contact.handle([{cmd:"preempt",checksum:U.attr("checksum",R),response:n}],t)}break;default:P.log("Wap:handle unknown response type: "+U.toString(R,!0),"red",R)()}else P.log("Wap:handle non-preemptive response: "+U.toString(R,!0),"red",R)();break;case"action":var w=u(R),S=l(U.children(R)),T=Object.keys(S);if(_.isArray(T)){var C,N,I,O,M=T.length;if(0===M&&"last"===w.add)Store.Msg.handle([{recent:!0}],t);else for(o=0;M>o;o++){N=T[o],C=S[N];var k,A=C.length;switch(N){case"msg":var D;switch(w.add){case"relay":case"update":D=E(C[0],"relay"),1!==A&&P.log("Wap:handle action msg relay length not 1","red",R)(),D?(P.log("bin-recv: "+[r,"action","msg",w.add,D.type,D.from,D.to,D.id].join(","),"green",R)(),O=b(D),Store.Msg.handle([{meta:{add:w.add},chat:O,msg:D}],t)):P.log("Wap:handle action msg relay dropped","red",C[0])();break;case"last":for(P.log("bin-recv: "+[r,"action","msg","last",C.length].join(","),"green",R)(),I=[],k=0;A>k;k++)D=E(C[k],"last"),D?I.push(D):P.log("Wap:handle action msg last dropped","red",C[k])();if(I.length>0){for(var L={recent:!0},x=0;x<I.length;x++)L[b(I[x])]=I[x];Store.Msg.handle([L],t)}else P.log("Wap:handle action msg last dropped to 0","red")();break;case"before":case"after":if(A>0){for(I=[],k=0;A>k;k++)D=E(C[k],w.add),D?I.push(D):P.log("Wap:handle action msg before/after dropped","red",C[k])();P.log("bin-recv: "+[r,"action","msg",w.add,I.length].join(","),"green",R)(),I.length>0?(O=b(I[0]),Store.Msg.handle([{meta:{add:w.add},chat:O,msgs:I}],t)):P.log("Wap:handle action msg before/after droppped to 0","red")()}else P.log("Wap:handle action msg before/after 0 msgs","red")();break;default:P.log("Wap:handle action msg no meta.add","red",R)()}break;case"cmd":for(k=0;A>k;k++){var W=m(C[k]);if(W){var B=_.values(W).join(",");P.log("bin-recv: "+[r,"action","cmd",B].join(","),"green",R)(),Store.Cmd.handle([W],t)}else P.log("Wap:handle action cmd invalid","red",R)()}break;case"bcUpdate":var j=[];for(k=0;A>k;k++){var F=v(C[k]);F?j.push(F):P.log("Wap:handle action bc update invalid","red",C[k])()}P.log("bin-recv: "+[r,"action","bcUpdate",j.length].join(","),"green",R)(),j.length>0&&Store.GroupMetadata.handle(j,t);break;case"ack":for(k=0;A>k;k++){var G=g(C[k]);G?(P.log("bin-recv: "+[r,"action","ack",G.to,G.id,G.ack].join(","),"green",R)(),Store.Msg.handle([G],t)):P.log("Wap:handle action ack invalid","red",R)()}break;case"contact":for(c=[],k=0;A>k;k++)s=f(C[k]),s?c.push(s):P.log("Wap:handle action contact dropped","red",C[k])();if(P.log("bin-recv: "+[r,"action","contact",c.length,w.missing].join(","),"green",R)(),c.length>0){var Y=[c];(w.missing||w.checksum)&&Y.push(w),Store.Contact.handle(Y,t)}break;case"chat":for(p=[],k=0;A>k;k++)d=h(C[k]),d?p.push(d):P.log("Wap:handle action chat dropped","red",C[k])();P.log("bin-recv: "+[r,"action","chat",p.length].join(","),"green",R)(),p.length>0&&Store.Chat.handle([p],t);break;case"battery":var H=y(C[0]);H?(P.log("bin-recv: "+[r,"action","battery",H.battery,H.plugged].join(","),"green",R)(),Store.Conn.handle([H],t)):P.log("Wap:handle action battery dropped","red",C[0])();break;case"mute":for(p=[],k=0;A>k;k++)d=h(C[k]),d?p.push(d):P.log("Wap:handle action mute dropped","red",C[k])();P.log("bin-recv: "+[r,"action","mute",p.length].join(","),"green",R)(),p.length>0&&Store.Mute.handle(p,t);break;default:P.log("Wap:handle action unknown "+N,"red",R)()}}}break;default:P.log("TODO "+U.toString(R,!0),"red",R,!0)()}return!0},requestDeviceUploadLogs:function(){var e;return new Promise(function(t,r){if(F)return void t();e=++F;var n=s("debug",[["log",void 0,void 0]]),i=o(t);i.drop=!0,M.send({data:$.write(n),clientCacheable:!0,onSend:i,onDrop:r,binaryOpts:{debugString:"debug,log",debugObj:n,metric:W.DEBUG_LOG,ackRequest:!0}})})["finally"](function(){e===F&&(F=0)})},resyncMessages:function(e){return new A(function(t,r){var n=function(e){var r=[],n=$.read(e),i=U.children(n);if(P.log("bin-recv: response,resume","green",n)(),"response"===U.tag(n)&&"resume"===U.attr("type",n)&&_.isArray(i)){var o,a=i.length;for(o=0;a>o;o++){var s=h(i[o]);s&&r.push(s)}}t({checksum:U.attr("checksum",n),data:r})},i=e.map(function(e){var t={jid:e.wid,index:e.id,owner:e.fromMe,participant:e.participant,archive:(!!e.archive).toString()};return e.mute&&(t.mute=e.mute.toString()),e.active&&(t.active="true"),Wa.isGroupWid(e.wid)&&(t.read_only=(!!e.isReadOnly).toString()),e.modifyTag&&(t.modify_tag=e.modifyTag.toString()),e.unreadCount&&(t.count=e.unreadCount.toString()),["last",t,void 0]}),s=c({type:"resume"},i);M.sendEphemeral({data:$.write(s),onSend:a(n,t),onDrop:o(r),binaryOpts:{debugString:"query,resume",debugObj:s,metric:W.QUERY_RESUME,ackRequest:!1}})})},resyncReceipts:function(e){return new Promise(function(t,r){var n=function(e){var r=[],n=$.read(e),i=U.children(n);if(P.log("bin-recv: response,receipt","green",n)(),"response"===U.tag(n)&&"receipt"===U.attr("type",n)&&_.isArray(i)){var o,a,s,c=i.length;for(o=0;c>o;o++){a=i[o],s=U.children(a);var d=U.attr("jid",a),u=U.attr("t",a);if("receipt"===U.tag(a)&&d&&u&&_.isArray(s)){var l,p=[],h=s.length;for(l=0;h>l;l++){var f=s[l];if("item"===U.tag(f)){var m=U.attr("index",f),g="true"===U.attr("owner",f),v=parseInt(U.attr("status",f),10)||0,y=U.attr("participant",f);m&&0!==v&&4>=v&&p.push([m,g,y,v])}}p.length>0&&r.push({id:d,t:parseInt(u,10),acks:p})}}}t(r)},i=e.map(function(e){return["last",{jid:e.remote,index:e.id,owner:e.fromMe.toString(),participant:e.participant,t:e.t.toString()},void 0]}),s=c({type:"receipt"},i);M.sendEphemeral({data:$.write(s),onSend:a(n,t),onDrop:o(r),binaryOpts:{debugString:"query,receipt",debugObj:s,metric:W.QUERY_RECEIPT,ackRequest:!1}})})},queryReceivedActions:function(e){return new Promise(function(t,r){var n=function(e){var r=[],n=$.read(e),i=U.children(n);if(P.log("bin-recv: response,actions","green",n)(),"response"===U.tag(n)&&"action"===U.attr("type",n))if(_.isArray(i)){var o,a=i.length;for(o=0;a>o;o++){var s=i[o],c=U.attr("id",s),d=parseInt(U.attr("code",s),10)||0;"item"===U.tag(s)&&c&&0!==d&&r.push({id:c,code:d})}}else"true"===U.attr("replaced",n)&&(r="replaced");t(r)},i=e.map(function(e){return["item",{id:e},void 0]}),s=c({type:"action"},i);M.sendEphemeral({data:$.write(s),onSend:a(n,t),onDrop:o(r),binaryOpts:{debugString:"query,actions",debugObj:s,metric:W.QUERY_ACTIONS,ackRequest:!1}})})},recentEmojiQuery:function(e){return new Promise(function(t,r){var n=function(e){var r=[],n=$.read(e),i=U.children(n);if(P.log("bin-recv: response,emoji","green",n)(),"response"===U.tag(n)&&"emoji"===U.attr("type",n)&&_.isArray(i)){var o,a=i.length;for(o=0;a>o;o++){var s=i[o],c=U.attr("code",s),d=parseFloat(U.attr("value",s))||0;"item"===U.tag(s)&&c&&d&&!isNaN(d)&&r.push({"char":c,weight:d})}}t(r)},i=_.isArray(e)?e.map(function(e){return["item",{code:e["char"],value:e.weight.toString()},void 0]}):void 0,s=c({type:"emoji"},i);M.sendEphemeral({data:$.write(s),onSend:a(n,t),onDrop:o(r),binaryOpts:{debugString:"query,emoji",debugObj:s,metric:W.QUERY_EMOJI,ackRequest:!1}})})},queryMsgInfo:function(e){function t(e){var t,r,n=[];if(_.isArray(e)){t=e.length;for(var i=0;t>i;i++)r=e[i],"item"===U.tag(r)&&U.attr("jid",r)&&U.attr("t",r)&&n.push({id:U.attr("jid",r),t:parseInt(U.attr("t",r),10)||0})}return n}return new Promise(function(r,n){var i=function(e){var n=$.read(e),i={played:[],playedRemaining:0,read:[],readRemaining:0,delivery:[],deliveryRemaining:0};if(P.log("bin-recv: response,msg,info","green",n)(),"response"===U.tag(n)&&"message_info"===U.attr("type",n)){var o=U.child("played",n),a=U.child("read",n),s=U.child("delivery",n),c=U.children(o),d=U.children(a),u=U.children(s),l=parseInt(U.attr("count",n),10)||0;i.played=t(c),i.read=t(d),i.delivery=t(u);var p=l-i.played.length,h=l-i.played.length-i.read.length,f=l-i.played.length-i.read.length-i.delivery.length;i.playedRemaining=0>p?0:p,i.readRemaining=0>h?0:h,i.deliveryRemaining=0>f?0:f}r(i)},s=c({type:"message_info",index:e.id,jid:e.remote},void 0);M.sendEphemeral({data:$.write(s),onSend:a(i,r),onDrop:o(n),binaryOpts:{debugString:["query,msg,info",e.id,e.remote,e.fromMe].join(),debugObj:s,metric:W.QUERY_MESSAGE_INFO,ackRequest:!1}})})},changeSubject:function(e,t){return new Promise(function(r,n){var i=M.tag(),a=o(r);a.tag=i;var c=["group",{id:i,jid:e,type:"subject",author:Wa.me,subject:t},void 0],d=s("set",[c]);M.send({data:$.write(d),clientCacheable:!0,onSend:a,onDrop:o(n),binaryOpts:{debugString:"action,group,subject",debugObj:d,metric:W.GROUP,ackRequest:!1,expires:moment().unix()}})})},createGroup:function(e,t){return new Promise(function(r,n){var i=M.tag(),a=o(r);a.tag=i;var c=t.map(function(e){return["participant",{jid:e},void 0]});P.log("create group tag","black",i)();var d=["group",{id:i,type:"create",author:Wa.me,subject:e},c],u=s("set",[d]);M.send({data:$.write(u),clientCacheable:!0,onSend:a,onDrop:o(n),binaryOpts:{debugString:"action,group,create",debugObj:u,metric:W.GROUP,ackRequest:!1,expires:moment().unix()}})})},leaveGroup:function(e){return new Promise(function(t,r){var n=M.tag(),i=o(t);i.tag=n;var a=["group",{id:n,jid:e,type:"leave",author:Wa.me},void 0],c=s("set",[a]);M.send({data:$.write(c),clientCacheable:!0,onSend:i,onDrop:o(r),binaryOpts:{debugString:"action,group,delete",debugObj:c,metric:W.GROUP,ackRequest:!1,expires:moment().unix()}})})},addParticipant:function(e,t){return N("add",e,t)},removeParticipant:function(e,t){return N("remove",e,t)},promoteParticipant:function(e,t){return N("promote",e,t)},requestMediaReupload:function(e){return new Promise(function(t,r){var n=e.id,i=function(e){var r,n=$.read(e);if("response"===U.tag(n)&&"media"===U.attr("type",n)){var i=parseInt(U.attr("code",n))||400,o=U.attr("url",n);i>=500&&502!==i?(P.log("wap:requestMediaReupload:error "+i,"red")(),r={status:i}):200===i&&o?r={status:200,url:o}:200!==i||o?(P.log("wap:requestMediaReupload:error "+i,"red")(),r={status:i}):r={status:400}}else P.log("wap:requestMediaReupload:malformed","red")(),r={status:400};t(r)},s=Wa.splitMsgKey(n),d=c({type:"media",index:s.id,jid:s.remote,owner:s.fromMe.toString(),participant:s.participant},void 0);M.sendEphemeral({data:$.write(d),onSend:a(i,t),onDrop:o(r),binaryOpts:{debugString:"query,media",debugObj:d,metric:W.QUERY_MEDIA,ackRequest:!1}})})},sendConversationSeen:function(e,t,r){return new Promise(function(n,i){var a=s("set",[["read",{jid:e,index:t?t.id:void 0,owner:t?t.fromMe.toString():void 0,participant:t?t.participant:void 0,count:r&&t?r.toString():void 0},void 0]]);M.send({data:$.write(a),clientCacheable:!0,onSend:o(n),onDrop:o(i),binaryOpts:{debugString:"action,chat,read,"+JSON.stringify(t)+","+r,debugObj:a,metric:W.READ,ackRequest:!0}})})},sendConversationUnseen:function(e,t){return this.sendConversationSeen(e,t,-2)},sendConversationClear:function(e,t){return I("clear",e,t)},sendConversationDelete:function(e,t){return I("delete",e,t)},sendConversationArchive:function(e,t,r){return I(t?"archive":"unarchive",e,r)},sendConversationMute:function(e,t,r){return new Promise(function(n,i){var a=t?t.toString():void 0,c=r?r.toString():void 0,d=s("set",[["chat",{type:"mute",mute:a,previous:c,jid:e},void 0]]);M.send({data:$.write(d),clientCacheable:!0,onSend:o(n),onDrop:o(i),binaryOpts:{debugString:"action,chat,"+e+", "+(a?"mute,"+a:"unmute"),debugObj:d,metric:W.CHAT,ackRequest:!0}})})},sendMessagePlayed:function(e){return new Promise(function(t,r){var n=o(t),i=s("set",[["received",{type:"played",index:e.id,from:e.remote,participant:e.participant},void 0]]);M.send({data:$.write(i),onSend:n,onDrop:o(r),binaryOpts:{debugString:"action,played,"+e.toString(),debugObj:i,metric:W.RECEIVED,ackRequest:!0}})})},sendMessageDelete:function(e,t,r){return new Promise(function(n,i){var a=t.map(function(e){return["item",{index:e.id,owner:e.fromMe.toString(),participant:e.participant},void 0]}),c=s("set",[["chat",{type:"clear",jid:e,media:r.toString()},a]]);M.send({data:$.write(c),clientCacheable:!0,onSend:o(n),onDrop:o(i),binaryOpts:{debugString:"action,msgs,delete,"+[e,r,t.length].join(),debugObj:c,metric:W.CHAT,ackRequest:!0}})})},profilePicFindThumbFromPhone:function(e,t){return new Promise(function(r,n){var i=function(i){var o=$.read(i);("response"!==U.tag(o)||"preview"!==U.attr("type",o))&&n();var a=U.children(o),s=a&&a[0];if(s||n(),"missing"===U.attr("type",s))r({id:e,tag:void 0,raw:void 0});else{var c,d=U.attr("id",s);if(t&&d===t.tag&&t.raw)c=t.raw;else{var u=U.children(s);c=u?u.toBase64():void 0}r({id:e,tag:d,raw:c})}},s={type:"preview",jid:e};t&&t.tag&&(s.id=t.tag);var d=c(s,[]);M.sendEphemeral({data:$.write(d),onSend:a(i,r),onDrop:o(n),binaryOpts:{debugString:"query,thumb,"+e,debugObj:d,metric:W.QUERY_PREVIEW,ackRequest:!1}})})},groupMetadataFindFromPhone:function(e,t){return new Promise(function(t,r){var n=function(r){var n=$.read(r);if("response"!==U.tag(n)||"group"!==U.attr("type",n))return void t({status:"error",info:"bad format: response incorrect"});var i=U.children(n),o=i&&i[0];if(!o)return void t({status:"error",info:"bad format: no group node"});if("missing"===U.attr("type"))return void t({status:"missing"});var a=_.map(U.children(o),function(e){return{id:U.attr("jid",e),isAdmin:"admin"===U.attr("type",e)}});t({status:"ok",data:{id:e,
owner:U.attr("creator",o),creation:parseInt(U.attr("create",o),10)||void 0,participants:a,stale:!1}})},i=c({type:"group",jid:e},[]);M.sendEphemeral({data:$.write(i),onSend:a(n,t),onDrop:o(r),binaryOpts:{debugString:"query,group,"+e,debugObj:i,metric:W.QUERY_GROUP,ackRequest:!1}})})},sendPresenceUpdate:function(e){return["available","unavailable"].indexOf(e)>-1?new Promise(function(t,r){var n=o(t),i=s("set",[["presence",{type:e},void 0]]);M.sendEphemeral({data:$.write(i),onSend:n,onDrop:o(r),binaryOpts:{debugString:"action,presence,"+e,debugObj:i,metric:W.PRESENCE,available:"available"===e,ackRequest:!0}})}):void 0},sendChatstateUpdate:function(e,t){return["composing","paused","recording"].indexOf(e)>-1?new Promise(function(r,n){var i=r,o=s("set",[["presence",{type:e,to:t},void 0]],!0);M.sendEphemeralIgnore({data:$.write(o),onSend:i,onDrop:n,binaryOpts:{debugString:"action,chatstate,"+e,debugObj:o,metric:W.PRESENCE,skipOffline:!0,ackRequest:!1}},!0)}):void 0},sendSetPicture:function(e,t,r){return new Promise(function(n,i){var a=Wa.parseDataURL(t).data,c=Wa.parseDataURL(r).data,d=k.fromBase64(a,!1),u=k.fromBase64(c,!1),l=M.tag(),p=o(n);p.tag=l;var h=["picture",{id:l,jid:e,type:"set"},[["image",void 0,u],["preview",void 0,d]]],f=s("set",[h]);M.send({data:$.write(f),clientCacheable:!0,onSend:p,onDrop:o(i),binaryOpts:{debugString:"action,set_pic,"+e,debugObj:f,metric:W.PIC,ackRequest:!1,expires:moment().unix()}})})},deletePicture:function(e){return new Promise(function(t,r){var n=M.tag(),i=o(t);i.tag=n;var a=["picture",{id:n,jid:e,type:"delete"},void 0],c=s("set",[a]);M.send({data:$.write(c),clientCacheable:!0,onSend:i,onDrop:o(r),binaryOpts:{debugString:"action,delete_pic,"+e,debugObj:c,metric:W.PIC,ackRequest:!1,expires:moment().unix()}})})},sendSetStatus:function(e){return new Promise(function(t,r){var n=o(t),i=s("set",[["status",void 0,e]]);M.send({data:$.write(i),clientCacheable:!0,onSend:n,onDrop:o(r),binaryOpts:{debugString:"action,status,set",debugObj:i,metric:W.STATUS,ackRequest:!1,expires:moment().unix()}})})},sendSetBlock:function(e,t){return new Promise(function(r,n){var i=t.map(function(t){return["user",{jid:t.jid,reason:e&&t.spam?"spam":void 0},void 0]}),a=["block",{type:e?"add":"remove"},i],c=s("set",[a]);M.send({data:$.write(c),clientCacheable:!0,onSend:o(r),onDrop:o(n),binaryOpts:{debugString:"action,block,"+e+","+_.pluck(t,"jid").join(","),debugObj:c,metric:W.BLOCK,ackRequest:!1,expires:moment().unix()}})})},chatFindQuery:function(e){return new Promise(function(t,r){var n=function(e){var r=[],n=$.read(e),i=U.children(n);if("response"===U.tag(n)&&"chat"===U.attr("type",n))if("true"===U.attr("duplicate",n))r="preempted";else if(_.isArray(i)){var o,a=i.length;for(o=0;a>o;o++){var s=h(i[o]);s&&r.push(s)}}t(r)},i=c({type:"chat",kind:e?"retry":void 0},void 0);M.sendEphemeral({data:$.write(i),onSend:a(n,t),onDrop:o(r),binaryOpts:{debugString:"query,chat,"+e,debugObj:i,metric:W.QUERY_CHAT,ackRequest:!1}})})},contactFindQuery:function(e){return new Promise(function(t,r){var n=function(e){var r=[],n=$.read(e),i=U.children(n);if("response"===U.tag(n)&&"contacts"===U.attr("type",n))if("true"===U.attr("duplicate",n))r="preempted";else if(_.isArray(i)){var o,a=i.length;for(o=0;a>o;o++){var s=f(i[o]);s&&r.push(s)}}t({checksum:U.attr("checksum",n),data:r})},i=c({type:"contacts",kind:e?"retry":void 0},void 0);M.send({data:$.write(i),onSend:a(n,t),onDrop:o(r),binaryOpts:{debugString:"query,contacts, "+e,debugObj:i,metric:W.QUERY_CONTACTS,ackRequest:!1}})})},msgCreateRecord:function(e,t){var r=this;return new Promise(function(n,i){var a,c,d=e.id;if("chat"===e.type)c=Promise.cast(["message",{type:"text",to:e.to,id:e.id,t:e.t.toString()},[["body",void 0,e.body]]]);else if("location"===e.type)a=e.body?k.fromBase64(e.body,!1):void 0,c=Promise.cast(["message",{type:"media",to:e.to,id:e.id,t:e.t.toString()},[["media",{type:"location",latitude:e.lat||void 0,longitude:e.lng||void 0,name:e.loc&&e.url?e.loc:void 0,url:e.loc&&e.url?e.url:void 0,encoding:e.body?"raw":void 0},a]]]);else if("vcard"===e.type){var u=["vcard",{name:e.subtype},e.body];c=Promise.cast(["message",{type:"media",to:e.to,id:e.id,t:e.t.toString()},[["media",{type:"vcard"},[u]]]])}else a=e.body?k.fromBase64(e.body,!1):void 0,c=(t?r.sendMedia(e.avparams):Promise.resolve({status:200})).then(function(t){return 200===t.status?Promise.cast(["message",{type:"media",to:e.to,id:e.id,t:e.t.toString()},[["media",{encoding:e.body?"raw":void 0,origin:"ptt"===e.type?"live":void 0,seconds:"ptt"===e.type&&e.duration?e.duration.toString():void 0,type:t.type,mimetype:e.mimetype||void 0,size:e.size?e.size.toString():void 0,filehash:t.filehash,url:t.url,duration:t.duration?t.duration.toString():void 0,vcodec:t.vcodec||void 0,width:t.width?t.width.toString():void 0,height:t.height?t.height.toString():void 0,fps:t.fps?t.fps.toString():void 0,vbitrate:t.vbitrate?t.vbitrate.toString():void 0,acodec:t.acodec||void 0,asampfreq:t.asampfreq?t.asampfreq.toString():void 0,asampfmt:t.asampfmt||void 0,abitrate:t.abitrate?t.abitrate.toString():void 0,caption:"video"!==e.type&&"image"!==e.type||!e.caption?void 0:e.caption},a]]]):(P.log("wap:msgCreateRecord:sendMedia error "+t.status,"red")(),Promise.reject())})["catch"](function(){return P.log("wap:msgCreateRecord:sendMedia dropped","red")(),Promise.reject()});c.then(function(t){var r=s("relay",[t]),a=o(n);a.tag=d,a.meta={type:"message",key:Wa.createMsgKey(e.from,e.to,e.id)},M.send({data:$.write(r),onSend:a,onDrop:o(i),binaryOpts:{debugString:"action,message, "+e.type,debugObj:r,metric:W.MESSAGE,ackRequest:!1}})})["catch"](function(){P.log("wap:msgCreateRecord mPromise error","red")(),i()})})},msgFindQuery:function(e){return new Promise(function(t,r){var n=function(e){var r=[],n=$.read(e),i=U.children(n);if("response"===U.tag(n)&&"message"===U.attr("type",n)&&_.isArray(i)){var o,a=i.length;for(o=0;a>o;o++){var s=E(i[o],"response");s&&r.push(s)}}t(r)},i=c({type:"message",jid:e.remote,count:e.count.toString(),index:e.id,owner:"undefined"==typeof e.fromMe?void 0:e.fromMe.toString(),participant:e.participant},void 0);M.sendEphemeral({data:$.write(i),onSend:a(n,t),onDrop:o(r),binaryOpts:{debugString:"query,message,"+[e.toString(),e.count].join(),debugObj:i,metric:W.QUERY_MESSAGES,ackRequest:!1}})})},presenceSubscribe:function(e){return new Promise(function(t,r){var n=o(t),i=s("set",[["presence",{type:"subscribe",to:e},void 0]]);M.sendEphemeral({data:$.write(i),onSend:n,onDrop:o(r),binaryOpts:{debugString:"action,presence,subscribe,"+e,debugObj:i,metric:W.PRESENCE_SUBSCRIBE,ackRequest:!0}})})}};e.exports=G},function(e,t,r){function n(e){return 0===U&&W++,e||U++,M.log("wap:epochCount: "+U+" epoch: "+W)(),W.toString()}function i(){U>0?U--:M.log("wap:epochRecv: NEGATIVE","red")(),M.log("wap:epochCount: "+U+" epoch: "+W)()}function o(e){return function(t){return t&&"number"==typeof t.status&&t.status>=500?t:(i(),void e(t))}}function a(e,t){return function(r){if("object"==typeof r&&"number"==typeof r.status){if(401===r.status)throw i(),new k.E401;if(r.status>=500)return r;i(),t(r)}else i(),e(r)}}function s(e,t,r){return["action",{type:e,epoch:n(r)},t]}function c(e,t){return e.epoch=n(),["query",e,t]}function d(e,t){return e.reduce(function(e,t){return e||t},!1)?void 0:t}function u(e){var t={};if("action"!==O.tag(e))return t;var r=O.attr("add",e),n=O.attr("missing",e),i=O.attr("checksum",e);switch(r){case"after":case"before":case"last":case"relay":case"update":t.add=r}switch(n){case"remove":t.missing=n}return i&&(t.checksum=i),t}function l(e){var t={};if(!_.isArray(e))return t;var r,n,i=e.length;for(n=0;i>n;n++)switch(r=e[n],O.tag(r)){case"broadcast":switch(O.attr("type",r)){case"create":case"add":case"remove":t.msg||(t.msg=[]),t.msg.push(r);break;case"modify":t.bcUpdate||(t.bcUpdate=[]),t.bcUpdate.push(r)}break;case"message":case"groups_v2":case"notification":t.msg||(t.msg=[]),t.msg.push(r);break;case"read":case"log":t.cmd||(t.cmd=[]),t.cmd.push(r);break;case"received":t.ack||(t.ack=[]),t.ack.push(r);break;case"user":t.contact||(t.contact=[]),t.contact.push(r);break;case"chat":switch(O.attr("type",r)){case"mute":t.mute||(t.mute=[]),t.mute.push(r);break;default:t.chat||(t.chat=[]),t.chat.push(r)}break;case"battery":t.battery||(t.battery=[]),t.battery.push(r);break;default:M.log("Wap:groupActionsByType unknown action: "+O.toString(r),"red",r,!0)()}return t}function p(e,t){var r=parseInt(O.attr(t,e),10);return _.isNaN(r)?void 0:r}function h(e){if("chat"!==O.tag(e))return void 0;var t=O.attr("jid",e),r=parseInt(O.attr("t",e),10)||void 0,n=O.attr("type",e),i=parseInt(O.attr("mute",e),10)||void 0,o=parseInt(O.attr("before",e),10)||void 0,a="true"===O.attr("archive",e),s="true"===O.attr("read_only",e),c=parseInt(O.attr("modify_tag",e),10)||void 0,u=O.attr("name",e)||void 0,l=p(e,"count"),h="true"===O.attr("message",e);"ahead"===n&&(n="clear");var f,m=O.children(e);if(_.isArray(m)){f=[];var g,v,y=m.length;for(g=0;y>g;g++)if(v=m[g],"item"===O.tag(v)){var b=O.attr("index",v);b&&f.push([b,"true"===O.attr("owner",v),O.attr("participant",v)])}}var E={id:t,t:r,type:n,keys:f,before:o,archive:a,isReadOnly:s,unreadCount:l,muteExpiration:i,modifyTag:c,name:u,pendingMsgs:h},R=[n&&"delete"!==n&&"clear"!==n&&"archive"!==n&&"unarchive"!==n&&"mute"!==n,!n&&!t,a&&n&&"clear"!==n,"clear"!==n&&o&&o>0,"clear"!==n&&f&&f.length>0];return d(R,E)}function f(e){if("user"!==O.tag(e))return void 0;var t=O.attr("jid",e),r=O.attr("name",e),n=O.attr("short",e)||void 0,i=O.attr("type",e)||"in",o={id:t,name:r,type:i,shortName:n},a=[!t,"in"!==i&&"out"!==i&&!!i];return d(a,o)}function m(e){if("read"!==O.tag(e))return void 0;var t=O.attr("jid",e),r="false"===O.attr("type",e),n={type:r?"unread":"read",jid:t},i=[!t];return d(i,n)}function g(e){if("received"!==O.tag(e))return void 0;var t,r=O.attr("type",e),n=O.attr("id",e),i=O.attr("to",e);switch(r){case"message":t=2;break;case"read":t=3;break;case"played":t=4;break;case"error":t=-1;break;case"pending":default:t=0}var o={cmd:"ack",id:n,ack:t,from:Wa.me,to:i},a=[!n,!i,"message"!==r&&"read"!==r&&"played"!==r&&"error"!==r&&"pending"!==r];return d(a,o)}function v(e){if("broadcast"!==O.tag(e)||"modify"!==O.attr("type",e))return void 0;var t=O.attr("jid",e),r=O.children(e),n=[];if(_.isArray(r)){var i,o,a,s=r.length;for(i=0;s>i;i++)o=r[i],a=O.attr("jid",o),"recipient"===O.tag(o)&&a&&2===a.split("@").length&&"c.us"===a.split("@")[1]&&n.push({id:a})}var c={id:t,participants:n},u=[!t,"broadcast"!==t.split("@")[1],0===n.length];return d(u,c)}function y(e){if("battery"!==O.tag(e))return void 0;var t=Math.min(parseInt(O.attr("value",e),10)||-1,100),r=O.attr("live",e),n={battery:0>t?void 0:t,plugged:r?"true"===r:void 0},i=[0>t&&!r];return d(i,n)}function b(e){return e.from===Wa.me?e.to:e.from}function E(e,t){switch(O.tag(e)){case"message":return R(e,t);case"groups_v2":return S(e);case"broadcast":return T(e);case"notification":return C(e);default:return void 0}}function R(e,t){if("message"!==O.tag(e))return void 0;var r;O.attr("from",e)!==Wa.me||O.attr("to",e)?O.attr("to",e)!==Wa.me||O.attr("from",e)||(r="out"):r="in";var n,i=O.attr("id",e),o=parseInt(O.attr("t",e),10)||0,a=O.attr("to",e)||Wa.me,s=O.attr("from",e)||Wa.me,c="broadcast"===s.split("@")[1],u=O.attr("participant",e),l=c?u:s,p=c?void 0:u,h=c?!1:O.child("broadcast",e)&&s===Wa.me,f="invis"===O.attr("web",e),m=O.attr("notify",e)||"",g=parseInt(O.attr("status",e))||0,v=[],y=O.child("broadcast",e);if("broadcast"===a)return void 0;switch(t){case"fresh":n=1;break;default:n=g>=-1&&4>=g?g:1}if(_.isArray(y)){var b,E=y.length;for(b=0;E>b;b++){var R=y[b],S=O.attr("jid",R);"to"===O.tag(R)&&S&&v.push(S)}}var T,C=[];switch(O.attr("type",e)){case"text":var N=O.dataStr(O.child("body",e))||"";T={id:i,body:N,type:"chat",t:o,notifyName:m,from:l,to:a,self:r,author:p,participant:u,invis:f,ack:n,broadcast:h,recipients:v},C=[!i,!o,!l,!a];break;case"media":var I,P,k,A,D,L=O.child("media",e),x=O.attr("type",L),$=O.attr("media_key",L);if("retry"===O.attr("reason",L))return void 0;switch(x){case"image":case"video":var U=O.attr("caption",L);I=w(L),P=O.attr("url",L),P=_.isString(P)&&P.indexOf("/u/")>0?void 0:P,k=O.attr("filehash",L),A=parseInt(O.attr("size",L),10)||0,D=O.attr("seconds",L),T={id:i,body:I,type:x,t:o,notifyName:m,from:l,to:a,self:r,author:p,participant:u,invis:f,ack:n,clientUrl:P,duration:D,broadcast:h,recipients:v,filehash:k,size:A,caption:U,mediaKey:$},C=[!i,!o,!l,!a];break;case"location":var W=O.attr("latitude",L),B=O.attr("longitude",L),j=O.attr("name",L);I=w(L),P=O.attr("url",L),T={id:i,body:I,type:x,t:o,notifyName:m,from:l,to:a,self:r,author:p,participant:u,invis:f,ack:n,clientUrl:P,loc:j,lat:W,lng:B,broadcast:h,recipients:v},C=[!i,!o,!l,!a,!W||!B];break;case"audio":var F="live"===O.attr("origin",L)?"ptt":x;P=O.attr("url",L),P=_.isString(P)&&P.indexOf("/u/")>0?void 0:P,k=O.attr("filehash",L),A=parseInt(O.attr("size",L),10)||0,D=O.attr("seconds",L),T={id:i,type:F,t:o,notifyName:m,from:l,to:a,self:r,author:p,participant:u,invis:f,ack:n,clientUrl:P,duration:D,broadcast:h,recipients:v,filehash:k,size:A},C=[!i,!o,!l,!a];break;case"vcard":var G=O.child("vcard",L),Y=O.dataStr(G),H=O.attr("name",G);T={id:i,body:Y,type:x,subtype:H,t:o,notifyName:m,from:l,to:a,self:r,author:p,participant:u,invis:f,ack:n,broadcast:h,recipients:v},C=[!i,!o,!l,!a,!Y,!H];break;default:M.log("wap:parseMsgMessage unknown media type: "+O.toString(e),"red",e)()}break;default:M.log("wap:parseMsgMessage unknown message type: "+O.toString(e),"red",e)()}return d(C,T)}function w(e){return"raw"===O.attr("encoding",e)?D.isByteBuffer(O.children(e))?O.children(e).toBase64():"":O.dataStr(e)}function S(e){if("groups_v2"!==O.tag(e))return void 0;var t,r=parseInt(O.attr("t",e),10)||0,n=O.attr("id",e),i=O.attr("jid",e),o="invis"===O.attr("web",e),a="true"===O.attr("owner",e),s=O.attr("type",e),c=O.attr("author",e),u=O.children(e),l=O.attr("participant",e),p=[];switch(s){case"create":t=O.attr("subject",e);break;case"subject":t=O.attr("subject",e);break;case"picture":t=O.attr("picture",e)}if(_.isArray(u)){var h,f=u.length;for(h=0;f>h;h++){var m=u[h],g=O.attr("jid",m);"participant"===O.tag(m)&&g&&p.push(g)}}var v={t:r,id:n,to:a?i:Wa.me,from:a?Wa.me:i,author:c,participant:l,body:t?t.toString():void 0,type:"gp2",subtype:s,invis:o,recipients:p},y=[!n,!r,"subject"!==s&&"add"!==s&&"remove"!==s&&"leave"!==s&&"picture"!==s&&"modify"!==s&&"create"!==s&&"delete"!==s&&"promote"!==s&&"demote"!==s,"subject"===s&&!t,("add"===s||"remove"===s||"leave"===s||"promote"===s||"demote"===s||"modify"===s)&&0===p.length,!i,"string"==typeof i&&"g.us"!==i.split("@")[1]];return d(y,v)}function T(e){if("broadcast"!==O.tag(e))return void 0;var t,r,n=O.attr("type",e),i=O.attr("id",e),o=parseInt(O.attr("t",e),10)||0,a=O.attr("jid",e),s="true"===O.attr("owner",e),c=O.attr("participant",e);switch(n){case"create":t=parseInt(O.attr("count",e),10)||0;break;case"add":case"remove":r=O.child("participant",e),r&&(t=O.attr("jid",r))}var u={id:i,t:o,participant:c,type:"broadcast_notification",subtype:n,from:s?Wa.me:a,to:s?a:Wa.me,body:t?t.toString():void 0},l=[!i,!o,!a,"string"==typeof a&&"broadcast"!==a.split("@")[1],"create"!==n&&"add"!==n&&"remove"!==n,("add"===n||"remove"===n)&&2!==t.split("@").length];return d(l,u)}function C(e){if("notification"!==O.tag(e))return void 0;var t=O.attr("id",e),r=parseInt(O.attr("t",e),10)||0,n=O.attr("jid",e),i=O.attr("participant",e),o="invis"===O.attr("web",e),a=O.dataStr(e),s="true"===O.attr("owner",e)?Wa.me:n,c="true"===O.attr("owner",e)?n:Wa.me,u={id:t,type:"notification",t:r,invis:o,from:s,to:c,participant:i,body:a},l=[!t,!r,!n,2!==n.split("@").length];return d(l,u)}function N(e,t,r){return new Promise(function(n,i){var a=A.tag(),c=o(n),d=["participant",{jid:r},void 0],u=["group",{id:a,jid:t,type:e,author:Wa.me},[d]],l=s("set",[u]);A.send({tag:a,data:P.write(l),clientCacheable:!0,onSend:c,onDrop:o(i),binaryOpts:{debugString:"action,group,participant,"+[e,t,r].join(","),debugObj:l,metric:$.GROUP,ackRequest:!1,expires:moment().unix()}})})}function I(e,t,r){return new Promise(function(n,i){var a=s("set",[["chat",{type:e,jid:t,index:r?r.id:void 0,owner:r?r.fromMe.toString():void 0,participant:r?r.participant:void 0},void 0]]);A.send({data:P.write(a),clientCacheable:!0,onSend:o(n),onDrop:o(i),binaryOpts:{debugString:"action,chat,"+[e,r.toString()].join(),debugObj:a,metric:$.CHAT,ackRequest:!0}})})}var P,O,M=r(14),k=r(151),A=r(20),D=r(156),L=r(153),x=r(205),$={DEBUG_LOG:1,QUERY_RESUME:2,QUERY_RECEIPT:3,QUERY_MEDIA:4,QUERY_CHAT:5,QUERY_CONTACTS:6,QUERY_MESSAGES:7,PRESENCE:8,PRESENCE_SUBSCRIBE:9,GROUP:10,READ:11,CHAT:12,RECEIVED:13,PIC:14,STATUS:15,MESSAGE:16,QUERY_ACTIONS:17,BLOCK:18,QUERY_GROUP:19,QUERY_PREVIEW:20,QUERY_EMOJI:21,QUERY_MESSAGE_INFO:22},U=0,W=0,B=0,j={"delete":function(){U=0,W=0},error2412:function(){i()},setSubProtocol:function(e){e?(P=new x(e),O=P.Node):(M.log("Wap:setSubProtocol unknown "+e,"red")(),Wa.uploadLogs("07_unknown_version",!0)["finally"](Wa.hardRefresh.bind(Wa)))},setSharedSecret:function(e){function t(e){return CryptoJS.lib.WordArray.create(new Uint8Array(e))}M.log("Wap:saveSharedSecret start")();var r=window.goog.crypt.base64.encodeByteArray,n=window.goog.crypt.base64.decodeStringToByteArray,i=n(e),o=i.slice(0,32),a=r(i.slice(32,64)),s=t(i.slice(64)),c=t(o.concat(i.slice(64))),d=window.e2e.ecc.PrimeCurve.CURVE_25519,u=new window.e2e.ecc.Ecdh(d,Wa.secretBundle.keyPair),l=u.bob(o).secret,p=new window.e2e.Hkdf(new window.e2e.hash.Sha256),h=p.getHKDF(l,[],80),f=t(h.slice(0,32)),m=t(h.slice(32,64)),g=t(h.slice(64,80)),v=CryptoJS.HmacSHA256(c,m).toString(CryptoJS.enc.Base64);if(a!==v)return void M.log("Wap:saveSharedSecret hmac mismatch "+a+" "+v,"red")();var y=CryptoJS.AES.decrypt({ciphertext:s,salt:void 0},f,{iv:g,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),_=D.fromBase64(y.toString(CryptoJS.enc.Base64)),b=_.slice(0,32).toBuffer(),E=_.slice(32,64).toBuffer(),R=CryptoJS.lib.WordArray.create(b),w=CryptoJS.lib.WordArray.create(E);Wa.setSecretKeys("0.1",R,w),M.log("Wap:saveSharedSecret done")()},handle:function(e,t,r){var n,i,o,a,s,c,d,p,R=P.read(e);switch(O.tag(R)){case"response":if(0===r.indexOf("preempt"))switch(O.attr("type",R)){case"chat":if(M.log("bin-recv: "+r+",response,chat","green",R)(),i=O.children(R)||[],_.isArray(i)){for(a=i.length,n=[],o=0;a>o;o++)d=h(i[o]),d&&n.push(d);Store.Chat.handle([{cmd:"preempt",response:n}],t)}break;case"contacts":if(M.log("bin-recv: "+r+",response,contact","green",R)(),i=O.children(R),_.isArray(i)){for(a=i.length,n=[],o=0;a>o;o++)s=f(i[o]),s&&n.push(s);Store.Contact.handle([{cmd:"preempt",checksum:O.attr("checksum",R),response:n}],t)}break;default:M.log("Wap:handle unknown response type: "+O.toString(R,!0),"red",R)()}else M.log("Wap:handle non-preemptive response: "+O.toString(R,!0),"red",R)();break;case"action":var w=u(R),S=l(O.children(R)),T=Object.keys(S);if(_.isArray(T)){var C,N,I,k,A=T.length;if(0===A&&"last"===w.add)Store.Msg.handle([{recent:!0}],t);else for(o=0;A>o;o++){N=T[o],C=S[N];var D,L=C.length;switch(N){case"msg":var x;switch(w.add){case"relay":case"update":x=E(C[0],"relay"),1!==L&&M.log("Wap:handle action msg relay length not 1","red",R)(),x?(M.log("bin-recv: "+[r,"action","msg",w.add,x.type,x.from,x.to,x.id].join(","),"green",R)(),k=b(x),Store.Msg.handle([{meta:{add:w.add},chat:k,msg:x}],t)):M.log("Wap:handle action msg relay dropped","red",C[0])();break;case"last":for(M.log("bin-recv: "+[r,"action","msg","last",C.length].join(","),"green",R)(),I=[],D=0;L>D;D++)x=E(C[D],"last"),x?I.push(x):M.log("Wap:handle action msg last dropped","red",C[D])();if(I.length>0){for(var $={recent:!0},U=0;U<I.length;U++)$[b(I[U])]=I[U];Store.Msg.handle([$],t)}else M.log("Wap:handle action msg last dropped to 0","red")();break;case"before":case"after":if(L>0){for(I=[],D=0;L>D;D++)x=E(C[D],w.add),x?I.push(x):M.log("Wap:handle action msg before/after dropped","red",C[D])();M.log("bin-recv: "+[r,"action","msg",w.add,I.length].join(","),"green",R)(),I.length>0?(k=b(I[0]),Store.Msg.handle([{meta:{add:w.add},chat:k,msgs:I}],t)):M.log("Wap:handle action msg before/after droppped to 0","red")()}else M.log("Wap:handle action msg before/after 0 msgs","red")();break;default:M.log("Wap:handle action msg no meta.add","red",R)()}break;case"cmd":for(D=0;L>D;D++){var W=m(C[D]);if(W){var B=_.values(W).join(",");M.log("bin-recv: "+[r,"action","cmd",B].join(","),"green",R)(),Store.Cmd.handle([W],t)}else M.log("Wap:handle action cmd invalid","red",R)()}break;case"bcUpdate":var j=[];for(D=0;L>D;D++){var F=v(C[D]);F?j.push(F):M.log("Wap:handle action bc update invalid","red",C[D])()}M.log("bin-recv: "+[r,"action","bcUpdate",j.length].join(","),"green",R)(),j.length>0&&Store.GroupMetadata.handle(j,t);break;case"ack":for(D=0;L>D;D++){var G=g(C[D]);G?(M.log("bin-recv: "+[r,"action","ack",G.to,G.id,G.ack].join(","),"green",R)(),Store.Msg.handle([G],t)):M.log("Wap:handle action ack invalid","red",R)()}break;case"contact":for(c=[],D=0;L>D;D++)s=f(C[D]),s?c.push(s):M.log("Wap:handle action contact dropped","red",C[D])();if(M.log("bin-recv: "+[r,"action","contact",c.length,w.missing].join(","),"green",R)(),c.length>0){var Y=[c];(w.missing||w.checksum)&&Y.push(w),Store.Contact.handle(Y,t)}break;case"chat":for(p=[],D=0;L>D;D++)d=h(C[D]),d?p.push(d):M.log("Wap:handle action chat dropped","red",C[D])();M.log("bin-recv: "+[r,"action","chat",p.length].join(","),"green",R)(),p.length>0&&Store.Chat.handle([p],t);break;case"battery":var H=y(C[0]);H?(M.log("bin-recv: "+[r,"action","battery",H.battery,H.plugged].join(","),"green",R)(),Store.Conn.handle([H],t)):M.log("Wap:handle action battery dropped","red",C[0])();break;case"mute":for(p=[],D=0;L>D;D++)d=h(C[D]),d?p.push(d):M.log("Wap:handle action mute dropped","red",C[D])();M.log("bin-recv: "+[r,"action","mute",p.length].join(","),"green",R)(),p.length>0&&Store.Mute.handle(p,t);break;default:M.log("Wap:handle action unknown "+N,"red",R)()}}}break;default:M.log("TODO "+O.toString(R,!0),"red",R,!0)()}return!0},requestDeviceUploadLogs:function(){var e;return new Promise(function(t,r){if(B)return void t();e=++B;var n=s("debug",[["log",void 0,void 0]]),i=o(t);i.drop=!0,A.send({data:P.write(n),clientCacheable:!0,onSend:i,onDrop:r,binaryOpts:{debugString:"debug,log",debugObj:n,metric:$.DEBUG_LOG,ackRequest:!0}})})["finally"](function(){e===B&&(B=0)})},resyncMessages:function(e){return new L(function(t,r){var n=function(e){var r=[],n=P.read(e),i=O.children(n);if(M.log("bin-recv: response,resume","green",n)(),"response"===O.tag(n)&&"resume"===O.attr("type",n)&&_.isArray(i)){var o,a=i.length;for(o=0;a>o;o++){var s=h(i[o]);s&&r.push(s)}}t({checksum:O.attr("checksum",n),data:r})},i=e.map(function(e){var t={jid:e.wid,index:e.id,owner:e.fromMe,participant:e.participant,archive:(!!e.archive).toString()};return e.mute&&(t.mute=e.mute.toString()),e.active&&(t.active="true"),Wa.isGroupWid(e.wid)&&(t.read_only=(!!e.isReadOnly).toString()),e.modifyTag&&(t.modify_tag=e.modifyTag.toString()),e.unreadCount&&(t.count=e.unreadCount.toString()),["last",t,void 0]}),s=c({type:"resume"},i);A.sendEphemeral({data:P.write(s),onSend:a(n,t),onDrop:o(r),binaryOpts:{debugString:"query,resume",debugObj:s,metric:$.QUERY_RESUME,ackRequest:!1}})})},resyncReceipts:function(e){return new Promise(function(t,r){var n=function(e){var r=[],n=P.read(e),i=O.children(n);if(M.log("bin-recv: response,receipt","green",n)(),"response"===O.tag(n)&&"receipt"===O.attr("type",n)&&_.isArray(i)){var o,a,s,c=i.length;for(o=0;c>o;o++){a=i[o],s=O.children(a);var d=O.attr("jid",a),u=O.attr("t",a);if("receipt"===O.tag(a)&&d&&u&&_.isArray(s)){var l,p=[],h=s.length;for(l=0;h>l;l++){var f=s[l];if("item"===O.tag(f)){var m=O.attr("index",f),g="true"===O.attr("owner",f),v=parseInt(O.attr("status",f),10)||0,y=O.attr("participant",f);m&&0!==v&&4>=v&&p.push([m,g,y,v])}}p.length>0&&r.push({id:d,t:parseInt(u,10),acks:p})}}}t(r)},i=e.map(function(e){return["last",{jid:e.remote,index:e.id,owner:e.fromMe.toString(),participant:e.participant,t:e.t.toString()},void 0]}),s=c({type:"receipt"},i);A.sendEphemeral({data:P.write(s),onSend:a(n,t),onDrop:o(r),binaryOpts:{debugString:"query,receipt",debugObj:s,metric:$.QUERY_RECEIPT,ackRequest:!1}})})},queryReceivedActions:function(e){return new Promise(function(t,r){var n=function(e){var r=[],n=P.read(e),i=O.children(n);if(M.log("bin-recv: response,actions","green",n)(),"response"===O.tag(n)&&"action"===O.attr("type",n))if(_.isArray(i)){var o,a=i.length;for(o=0;a>o;o++){var s=i[o],c=O.attr("id",s),d=parseInt(O.attr("code",s),10)||0;"item"===O.tag(s)&&c&&0!==d&&r.push({id:c,code:d})}}else"true"===O.attr("replaced",n)&&(r="replaced");t(r)},i=e.map(function(e){return["item",{id:e},void 0]}),s=c({type:"action"},i);A.sendEphemeral({data:P.write(s),onSend:a(n,t),onDrop:o(r),binaryOpts:{debugString:"query,actions",debugObj:s,metric:$.QUERY_ACTIONS,ackRequest:!1}})})},recentEmojiQuery:function(e){return new Promise(function(t,r){var n=function(e){var r=[],n=P.read(e),i=O.children(n);if(M.log("bin-recv: response,emoji","green",n)(),"response"===O.tag(n)&&"emoji"===O.attr("type",n)&&_.isArray(i)){var o,a=i.length;for(o=0;a>o;o++){var s=i[o],c=O.attr("code",s),d=parseFloat(O.attr("value",s))||0;"item"===O.tag(s)&&c&&d&&!isNaN(d)&&r.push({"char":c,weight:d})}}t(r)},i=_.isArray(e)?e.map(function(e){return["item",{code:e["char"],value:e.weight.toString()},void 0]}):void 0,s=c({type:"emoji"},i);A.sendEphemeral({data:P.write(s),onSend:a(n,t),onDrop:o(r),binaryOpts:{debugString:"query,emoji",debugObj:s,metric:$.QUERY_EMOJI,ackRequest:!1}})})},queryMsgInfo:function(e){function t(e){var t,r,n=[];if(_.isArray(e)){t=e.length;for(var i=0;t>i;i++)r=e[i],"item"===O.tag(r)&&O.attr("jid",r)&&O.attr("t",r)&&n.push({id:O.attr("jid",r),t:parseInt(O.attr("t",r),10)||0})}return n}return new Promise(function(r,n){var i=function(e){var n=P.read(e),i={played:[],playedRemaining:0,read:[],readRemaining:0,delivery:[],deliveryRemaining:0};if(M.log("bin-recv: response,msg,info","green",n)(),"response"===O.tag(n)&&"message_info"===O.attr("type",n)){var o=O.child("played",n),a=O.child("read",n),s=O.child("delivery",n),c=O.children(o),d=O.children(a),u=O.children(s),l=parseInt(O.attr("count",n),10)||0;i.played=t(c),i.read=t(d),i.delivery=t(u);var p=l-i.played.length,h=l-i.played.length-i.read.length,f=l-i.played.length-i.read.length-i.delivery.length;i.playedRemaining=0>p?0:p,i.readRemaining=0>h?0:h,i.deliveryRemaining=0>f?0:f}r(i)},s=c({type:"message_info",index:e.id,jid:e.remote},void 0);A.sendEphemeral({data:P.write(s),onSend:a(i,r),onDrop:o(n),binaryOpts:{debugString:["query,msg,info",e.id,e.remote,e.fromMe].join(),debugObj:s,metric:$.QUERY_MESSAGE_INFO,ackRequest:!1}})})},changeSubject:function(e,t){return new Promise(function(r,n){var i=A.tag(),a=o(r);a.tag=i;var c=["group",{id:i,jid:e,type:"subject",author:Wa.me,subject:t},void 0],d=s("set",[c]);A.send({data:P.write(d),clientCacheable:!0,onSend:a,onDrop:o(n),binaryOpts:{debugString:"action,group,subject",debugObj:d,metric:$.GROUP,ackRequest:!1,expires:moment().unix()}})})},createGroup:function(e,t){return new Promise(function(r,n){var i=A.tag(),a=o(r);a.tag=i;var c=t.map(function(e){return["participant",{jid:e},void 0]});M.log("create group tag","black",i)();var d=["group",{id:i,type:"create",author:Wa.me,subject:e},c],u=s("set",[d]);A.send({data:P.write(u),clientCacheable:!0,onSend:a,onDrop:o(n),binaryOpts:{debugString:"action,group,create",debugObj:u,metric:$.GROUP,ackRequest:!1,expires:moment().unix()}})})},leaveGroup:function(e){return new Promise(function(t,r){var n=A.tag(),i=o(t);i.tag=n;var a=["group",{id:n,jid:e,type:"leave",author:Wa.me},void 0],c=s("set",[a]);A.send({data:P.write(c),clientCacheable:!0,onSend:i,onDrop:o(r),binaryOpts:{debugString:"action,group,delete",debugObj:c,metric:$.GROUP,ackRequest:!1,expires:moment().unix()}})})},addParticipant:function(e,t){return N("add",e,t)},removeParticipant:function(e,t){return N("remove",e,t)},promoteParticipant:function(e,t){return N("promote",e,t)},requestMediaReupload:function(e){return new Promise(function(t,r){var n=e.id,i=function(e){var r,n=P.read(e);if("response"===O.tag(n)&&"media"===O.attr("type",n)){var i=parseInt(O.attr("code",n))||400,o=O.attr("url",n);i>=500&&502!==i?(M.log("wap:requestMediaReupload:error "+i,"red")(),r={status:i}):200===i&&o?r={status:200,url:o}:200!==i||o?(M.log("wap:requestMediaReupload:error "+i,"red")(),r={status:i}):r={status:400}}else M.log("wap:requestMediaReupload:malformed","red")(),r={status:400};t(r)},s=Wa.splitMsgKey(n),d=c({type:"media",index:s.id,jid:s.remote,owner:s.fromMe.toString(),participant:s.participant},void 0);A.sendEphemeral({data:P.write(d),onSend:a(i,t),onDrop:o(r),binaryOpts:{debugString:"query,media",debugObj:d,metric:$.QUERY_MEDIA,ackRequest:!1}})})},sendConversationSeen:function(e,t,r){return new Promise(function(n,i){var a=s("set",[["read",{jid:e,index:t?t.id:void 0,owner:t?t.fromMe.toString():void 0,participant:t?t.participant:void 0,count:r&&t?r.toString():void 0},void 0]]);A.send({data:P.write(a),clientCacheable:!0,onSend:o(n),onDrop:o(i),binaryOpts:{debugString:"action,chat,read,"+JSON.stringify(t)+","+r,debugObj:a,metric:$.READ,ackRequest:!0}})})},sendConversationUnseen:function(e,t){return this.sendConversationSeen(e,t,-2)},sendConversationClear:function(e,t){return I("clear",e,t)},sendConversationDelete:function(e,t){return I("delete",e,t)},sendConversationArchive:function(e,t,r){return I(t?"archive":"unarchive",e,r)},sendConversationMute:function(e,t,r){return new Promise(function(n,i){var a=t?t.toString():void 0,c=r?r.toString():void 0,d=s("set",[["chat",{type:"mute",mute:a,previous:c,jid:e},void 0]]);A.send({data:P.write(d),clientCacheable:!0,onSend:o(n),onDrop:o(i),binaryOpts:{debugString:"action,chat,"+e+", "+(a?"mute,"+a:"unmute"),debugObj:d,metric:$.CHAT,ackRequest:!0}})})},sendMessagePlayed:function(e){return new Promise(function(t,r){var n=o(t),i=s("set",[["received",{type:"played",index:e.id,from:e.remote,participant:e.participant},void 0]]);A.send({data:P.write(i),onSend:n,onDrop:o(r),binaryOpts:{debugString:"action,played,"+e.toString(),debugObj:i,metric:$.RECEIVED,ackRequest:!0}})})},sendMessageDelete:function(e,t,r){return new Promise(function(n,i){var a=t.map(function(e){return["item",{index:e.id,owner:e.fromMe.toString(),participant:e.participant},void 0]}),c=s("set",[["chat",{type:"clear",jid:e,media:r.toString()},a]]);A.send({data:P.write(c),clientCacheable:!0,onSend:o(n),onDrop:o(i),binaryOpts:{debugString:"action,msgs,delete,"+[e,r,t.length].join(),debugObj:c,metric:$.CHAT,ackRequest:!0}})})},profilePicFindThumbFromPhone:function(e,t){return new Promise(function(r,n){var i=function(i){var o=P.read(i);("response"!==O.tag(o)||"preview"!==O.attr("type",o))&&n();var a=O.children(o),s=a&&a[0];if(s||n(),"missing"===O.attr("type",s))r({id:e,tag:void 0,raw:void 0});else{var c,d=O.attr("id",s);if(t&&d===t.tag&&t.raw)c=t.raw;else{var u=O.children(s);c=u?u.toBase64():void 0}r({id:e,tag:d,raw:c})}},s={type:"preview",jid:e};t&&t.tag&&(s.id=t.tag);var d=c(s,[]);A.sendEphemeral({data:P.write(d),onSend:a(i,r),onDrop:o(n),binaryOpts:{debugString:"query,thumb,"+e,debugObj:d,metric:$.QUERY_PREVIEW,ackRequest:!1}})})},groupMetadataFindFromPhone:function(e,t){return new Promise(function(t,r){var n=function(r){var n=P.read(r);if("response"!==O.tag(n)||"group"!==O.attr("type",n))return void t({status:"error",info:"bad format: response incorrect"});var i=O.children(n),o=i&&i[0];if(!o)return void t({status:"error",info:"bad format: no group node"});if("missing"===O.attr("type"))return void t({status:"missing"});var a=_.map(O.children(o),function(e){return{id:O.attr("jid",e),isAdmin:"admin"===O.attr("type",e)}});t({status:"ok",data:{id:e,owner:O.attr("creator",o),creation:parseInt(O.attr("create",o),10)||void 0,participants:a,stale:!1}})},i=c({type:"group",jid:e},[]);A.sendEphemeral({data:P.write(i),onSend:a(n,t),onDrop:o(r),binaryOpts:{debugString:"query,group,"+e,debugObj:i,metric:$.QUERY_GROUP,ackRequest:!1}})})},sendPresenceUpdate:function(e){return["available","unavailable"].indexOf(e)>-1?new Promise(function(t,r){
var n=o(t),i=s("set",[["presence",{type:e},void 0]]);A.sendEphemeral({data:P.write(i),onSend:n,onDrop:o(r),binaryOpts:{debugString:"action,presence,"+e,debugObj:i,metric:$.PRESENCE,available:"available"===e,ackRequest:!0}})}):void 0},sendChatstateUpdate:function(e,t){return["composing","paused","recording"].indexOf(e)>-1?new Promise(function(r,n){var i=r,o=s("set",[["presence",{type:e,to:t},void 0]],!0);A.sendEphemeralIgnore({data:P.write(o),onSend:i,onDrop:n,binaryOpts:{debugString:"action,chatstate,"+e,debugObj:o,metric:$.PRESENCE,skipOffline:!0,ackRequest:!1}},!0)}):void 0},sendSetPicture:function(e,t,r){return new Promise(function(n,i){var a=Wa.parseDataURL(t).data,c=Wa.parseDataURL(r).data,d=D.fromBase64(a,!1),u=D.fromBase64(c,!1),l=A.tag(),p=o(n);p.tag=l;var h=["picture",{id:l,jid:e,type:"set"},[["image",void 0,u],["preview",void 0,d]]],f=s("set",[h]);A.send({data:P.write(f),clientCacheable:!0,onSend:p,onDrop:o(i),binaryOpts:{debugString:"action,set_pic,"+e,debugObj:f,metric:$.PIC,ackRequest:!1,expires:moment().unix()}})})},deletePicture:function(e){return new Promise(function(t,r){var n=A.tag(),i=o(t);i.tag=n;var a=["picture",{id:n,jid:e,type:"delete"},void 0],c=s("set",[a]);A.send({data:P.write(c),clientCacheable:!0,onSend:i,onDrop:o(r),binaryOpts:{debugString:"action,delete_pic,"+e,debugObj:c,metric:$.PIC,ackRequest:!1,expires:moment().unix()}})})},sendSetStatus:function(e){return new Promise(function(t,r){var n=o(t),i=s("set",[["status",void 0,e]]);A.send({data:P.write(i),clientCacheable:!0,onSend:n,onDrop:o(r),binaryOpts:{debugString:"action,status,set",debugObj:i,metric:$.STATUS,ackRequest:!1,expires:moment().unix()}})})},sendSetBlock:function(e,t){return new Promise(function(r,n){var i=t.map(function(t){return["user",{jid:t.jid,reason:e&&t.spam?"spam":void 0},void 0]}),a=["block",{type:e?"add":"remove"},i],c=s("set",[a]);A.send({data:P.write(c),clientCacheable:!0,onSend:o(r),onDrop:o(n),binaryOpts:{debugString:"action,block,"+e+","+_.pluck(t,"jid").join(","),debugObj:c,metric:$.BLOCK,ackRequest:!1,expires:moment().unix()}})})},chatFindQuery:function(e){return new Promise(function(t,r){var n=function(e){var r=[],n=P.read(e),i=O.children(n);if("response"===O.tag(n)&&"chat"===O.attr("type",n))if("true"===O.attr("duplicate",n))r="preempted";else if(_.isArray(i)){var o,a=i.length;for(o=0;a>o;o++){var s=h(i[o]);s&&r.push(s)}}t(r)},i=c({type:"chat",kind:e?"retry":void 0},void 0);A.sendEphemeral({data:P.write(i),onSend:a(n,t),onDrop:o(r),binaryOpts:{debugString:"query,chat,"+e,debugObj:i,metric:$.QUERY_CHAT,ackRequest:!1}})})},contactFindQuery:function(e){return new Promise(function(t,r){var n=function(e){var r=[],n=P.read(e),i=O.children(n);if("response"===O.tag(n)&&"contacts"===O.attr("type",n))if("true"===O.attr("duplicate",n))r="preempted";else if(_.isArray(i)){var o,a=i.length;for(o=0;a>o;o++){var s=f(i[o]);s&&r.push(s)}}t({checksum:O.attr("checksum",n),data:r})},i=c({type:"contacts",kind:e?"retry":void 0},void 0);A.send({data:P.write(i),onSend:a(n,t),onDrop:o(r),binaryOpts:{debugString:"query,contacts, "+e,debugObj:i,metric:$.QUERY_CONTACTS,ackRequest:!1}})})},msgCreateRecord:function(e,t){var r=this;return new Promise(function(n,i){var a,c,d=e.id;if("chat"===e.type)c=Promise.cast(["message",{type:"text",to:e.to,id:e.id,t:e.t.toString()},[["body",void 0,e.body]]]);else if("location"===e.type)a=e.body?D.fromBase64(e.body,!1):void 0,c=Promise.cast(["message",{type:"media",to:e.to,id:e.id,t:e.t.toString()},[["media",{type:"location",latitude:e.lat||void 0,longitude:e.lng||void 0,name:e.loc&&e.url?e.loc:void 0,url:e.loc&&e.url?e.url:void 0,encoding:e.body?"raw":void 0},a]]]);else if("vcard"===e.type){var u=["vcard",{name:e.subtype},e.body];c=Promise.cast(["message",{type:"media",to:e.to,id:e.id,t:e.t.toString()},[["media",{type:"vcard"},[u]]]])}else{a=e.body?D.fromBase64(e.body,!1):void 0;var l="ptt"===e.type?"audio":e.type;c=(t?r.sendMedia(e.avparams):Promise.resolve({status:200,type:l})).then(function(t){return 200===t.status?Promise.cast(["message",{type:"media",to:e.to,id:e.id,t:e.t.toString()},[["media",{encoding:e.body?"raw":void 0,origin:"ptt"===e.type?"live":void 0,seconds:"ptt"===e.type&&e.duration?e.duration.toString():void 0,type:t.type,mimetype:e.mimetype||void 0,size:e.size?e.size.toString():void 0,filehash:t.filehash,url:t.url,duration:t.duration?t.duration.toString():void 0,vcodec:t.vcodec||void 0,width:t.width?t.width.toString():void 0,height:t.height?t.height.toString():void 0,fps:t.fps?t.fps.toString():void 0,vbitrate:t.vbitrate?t.vbitrate.toString():void 0,acodec:t.acodec||void 0,asampfreq:t.asampfreq?t.asampfreq.toString():void 0,asampfmt:t.asampfmt||void 0,abitrate:t.abitrate?t.abitrate.toString():void 0,caption:"video"!==e.type&&"image"!==e.type||!e.caption?void 0:e.caption},a]]]):(M.log("wap:msgCreateRecord:sendMedia error "+t.status,"red")(),Promise.reject())})["catch"](function(){return M.log("wap:msgCreateRecord:sendMedia dropped","red")(),Promise.reject()})}c.then(function(t){var r=s("relay",[t]),a=o(n);a.tag=d,a.meta={type:"message",key:Wa.createMsgKey(e.from,e.to,e.id)},A.send({data:P.write(r),onSend:a,onDrop:o(i),binaryOpts:{debugString:"action,message,"+e.type,debugObj:r,metric:$.MESSAGE,ackRequest:!1}})})["catch"](function(){M.log("wap:msgCreateRecord mPromise error","red")(),i()})})},msgFindQuery:function(e){return new Promise(function(t,r){var n=function(e){var r=[],n=P.read(e),i=O.children(n);if("response"===O.tag(n)&&"message"===O.attr("type",n)&&_.isArray(i)){var o,a=i.length;for(o=0;a>o;o++){var s=E(i[o],"response");s&&r.push(s)}}t(r)},i=c({type:"message",jid:e.remote,count:e.count.toString(),index:e.id,owner:"undefined"==typeof e.fromMe?void 0:e.fromMe.toString(),participant:e.participant},void 0);A.sendEphemeral({data:P.write(i),onSend:a(n,t),onDrop:o(r),binaryOpts:{debugString:"query,message,"+[e.toString(),e.count].join(),debugObj:i,metric:$.QUERY_MESSAGES,ackRequest:!1}})})},presenceSubscribe:function(e){return new Promise(function(t,r){var n=o(t),i=s("set",[["presence",{type:"subscribe",to:e},void 0]]);A.sendEphemeral({data:P.write(i),onSend:n,onDrop:o(r),binaryOpts:{debugString:"action,presence,subscribe,"+e,debugObj:i,metric:$.PRESENCE_SUBSCRIBE,ackRequest:!0}})})}};e.exports=j},function(e,t,r){function n(e,t){return e===t||e+"?x=2"===t||e===t+"?x=2"}var i=r(14),o=r(15),a=r(197),s=r(231),c=r(203),d=r(151),u=r(19),l=r(163),p=r(236),h=r(20),f=r(170),m={NOTIFICATION:"notification",GROUP_NOTIFICATION:"group_notification",GP2:"gp2",BROADCAST_NOTIFICATION:"broadcast_notification",CHAT:"chat",IMAGE:"image",VIDEO:"video",LOCATION:"location",AUDIO:"audio",PTT:"ptt",VCARD:"vcard"},g={INIT:"init",REFRESHING:"refreshing",REFRESH_RETRY:"refresh_retry",URL:"url",STATUS_200:"status_200",STATUS_ERR:"status_err",NO_URL:"no_url",RMR_FETCHING:"rmr_fetching",RMR_ERROR_MISSING:"rmr_error_missing",RMR_ERROR_RETRY:"rmr_error_retry",UPLOADING:"uploading"},v={UPLOADING:"uploading",RETRY:"retry",PHONE_UPLOADING:"phone_uploading"},y=a.extend(p,{Collection:"Msg",props:{id:"msgKey",body:"string",type:{type:"string",values:_.values(m)},subtype:"string",t:"number",notifyName:"string",from:"string",to:"string",author:"string",self:{type:["string"],values:["in","out"],"default":"in"},ack:"number",invis:"boolean",isNew:"boolean",recvFresh:"boolean",clientUrl:"string",url:"string",caption:"string",mimetype:"string",duration:"string",filehash:"string",size:"number",loc:"string",lat:"string",lng:"string",height:"number",width:"number",recipients:"array",broadcast:"boolean",avparams:"object",mediaKey:"string"},session:{fullHeight:"number",fullWidth:"number",urlState:{type:"string",values:_.values(g),"default":g.INIT},isContinuation:"boolean",local:"boolean",urlRetry:{type:"number","default":0},uploadPromise:"object",reupload:"any",resendPromise:"object",ajaxHeadPromise:"object",rmrPromise:"object",rtl:"boolean"},children:{senderObj:s},initialize:function(){this.sender&&(this.senderObj=Store.Contact.gadd({id:this.sender}),this.listenTo(this.senderObj,"all",this._getEventBubblingHandler("senderObj"))),this.isMMS&&this.listenTo(this,"change:needsRefresh change:isObserved",function(){this.isObserved&&this.needsRefresh&&this.initializeMedia()}),this.type===m.CHAT&&(this.rtl="rtl"===Wa.textDir(this.body));var e;(e=Store.Msg.preAck[this.id])&&(i.log("Msg:initialize updating msg with out of order ack",null,e)(),this.updateAck(e.ack),delete Store.Msg.preAck[this.id])},derived:{chat:{fn:function(){return Store.Chat.get(Wa.splitMsgKey(this.id).remote)}},isGroupMsg:{fn:function(){return Wa.isGroupWid(this.from)||Wa.isGroupWid(this.to)}},isSentByMe:{fn:function(){var e=Wa.splitMsgKey(this.id);return"in"===e.self||this.isNotification?!1:this.from===Wa.me}},isNotification:{fn:function(){switch(this.type){case m.GROUP_NOTIFICATION:case m.GP2:case m.BROADCAST_NOTIFICATION:case m.NOTIFICATION:return!0;default:return!1}}},isMedia:{fn:function(){return["image","video","audio"].indexOf(this.type)>-1}},isMMS:{fn:function(){return["image","video","audio","ptt"].indexOf(this.type)>-1}},mmsSrc:{deps:["url"],fn:function(){return Wa.isHttpUrl(this.url)?this.url+"?x=2":this.url}},hasSymbol:{fn:function(){return["image","video","audio","ptt","location","vcard"].indexOf(this.type)>-1}},uploadState:{deps:["ack","uploadPromise"],fn:function(){return this.isSentByMe&&0===this.ack?this.local?this.uploadPromise?v.UPLOADING:v.RETRY:v.PHONE_UPLOADING:!1}},eventType:{deps:["invis"],fn:function(){var e,t,r=this.type,n=this.subtype;return this.isNew?("gp2"===r||"group_notification"===r?"subject"===n?e="n":"add"===n?(t=_.first(this.recipients),e=t===Wa.me?"s":"i"):"remove"===n?(t=_.first(this.recipients),e=t===Wa.me?"n":"i"):e="create"===n?"n":"i":e="broadcast_notification"===r||"notification"===r?"create"===n?"n":"i":this.broadcast?"i":"d",this.invis?"i"===e?"i":"n":e):"i"}},sender:{fn:function(){return this.isSentByMe?this.from:this.isGroupMsg?this.author:this.from}},startOfDay:{fn:function(){return moment.unix(this.t).startOf("day").unix()}},needsRefresh:{deps:["clientUrl","urlState"],fn:function(){return this.clientUrl&&_.contains([g.INIT,g.REFRESH_RETRY],this.urlState)}},containsEmoji:{fn:function(){switch(this.type){case m.CHAT:return this.body&&l.containsEmoji(this.body);case m.IMAGE:return this.caption&&l.containsEmoji(this.caption);default:return!1}}},mayFail:{deps:["isSentByMe","ack"],fn:function(){return this.isSentByMe&&this.ack<=1}},isFailed:{deps:["ack"],fn:function(){return this.ack<0}},vcardWAid:{deps:["type","body"],fn:function(){if(this.type!==m.VCARD)return void 0;var e=this.body.match(/TEL[^\n]+;waid=(\d+):/);return e?e[1]+"@c.us":void 0}}},isTrusted:function(){return this.sender===Wa.me?!0:this.senderObj&&this.senderObj.isMyContact?!0:this.isGroupMsg?this.chat.groupMetadata.trusted:!1},initializeMedia:function(){this.needsRefresh&&Store.Msg.refreshMediaUrl(this)},"delete":function(){a.prototype["delete"].call(this),Store.Msg.remove(this.id),this.chat.msgs.remove(this.id)},displayName:function(e,t){if(!this.sender)return"";if(this.sender===Wa.me)return l10n.t("web_you");var r=this.senderObj,n=e?r.shortName:void 0;if(n)return n;if(r.name)return r.name;var i=t&&this.notifyName?" ~"+this.notifyName:"";return l10n.isRTL()?l10n.embedLTR(Wa.widGetFormattedUser(this.sender))+i:Wa.widGetFormattedUser(this.sender)+i},isSameDay:function(e){return this.startOfDay===e.startOfDay},asDesktopNotification:function(){var e,t,r,n,i="";switch(this.from!==Wa.me&&this.isGroupMsg&&(i=this.displayName()),this.type){case m.CHAT:e=this.body;break;case m.IMAGE:r=o.hasEmoji?"📷 ":"",e=r+(this.caption||l10n.t("web_conversations_most_recent_image"));break;case m.VIDEO:r=o.hasEmoji?"🎥 ":"",n=this.caption||l10n.t("web_conversations_most_recent_video"),e=r+" "+n+" ("+Wa.formatDuration(this.duration)+")";break;case m.PTT:r=o.hasEmoji?"🎤 ":"",e=r+" "+l10n.t("web_conversations_most_recent_voice")+" ("+Wa.formatDuration(this.duration)+")";break;case m.AUDIO:r=o.hasEmoji?"🎵 ":"",e=r+" "+l10n.t("web_conversations_most_recent_audio")+" ("+Wa.formatDuration(this.duration)+")";break;case m.LOCATION:r=o.hasEmoji?"📍 ":"",e=r+(this.loc||l10n.t("web_conversations_most_recent_location"));break;case m.GROUP_NOTIFICATION:case m.GP2:e=Wa.formatGroupNotification(this),i="";break;case m.BROADCAST_NOTIFICATION:t=this.subtype;var a=this.body;e=Wa.formatBroadcastNotification(t,a);break;case m.NOTIFICATION:e=this.body;break;case m.VCARD:r=o.hasEmoji?"👤 ":"",e=r+(this.subType||l10n.t("web_conversations_most_recent_contact"));break;default:e=""}return(i?i+": ":"")+e},msgText:function(){switch(this.type){case m.CHAT:return this.body;case m.IMAGE:return this.caption?this.caption:l10n.t("web_conversations_most_recent_image");case m.VIDEO:return this.caption?this.caption:l10n.t("web_conversations_most_recent_video");case m.PTT:return Wa.formatDuration(this.duration);case m.AUDIO:return l10n.t("web_conversations_most_recent_audio");case m.LOCATION:return this.loc||l10n.t("web_conversations_most_recent_location");case m.GROUP_NOTIFICATION:case m.GP2:return Wa.formatGroupNotification(this);case m.BROADCAST_NOTIFICATION:return Wa.formatBroadcastNotification(this.subtype,this.body);case m.NOTIFICATION:return this.body;case m.VCARD:return l10n.t("web_conversations_most_recent_contact");default:return""}},updateAck:function(e){var t=this.ack;_.isNumber(e)&&("undefined"==typeof t||e>t)?this.ack=e:-1===e&&0===this.ack&&(this.ack=e)},reuploadMedia:function(){if(!this.reupload)return Promise.resolve();if(this.uploadPromise)return this.uploadPromise;var e=this;return this.urlSate=g.UPLOADING,this.uploadPromise=this.reupload().cancellable().then(function(t){return e.sendMediaMsg(t)}).then(function(){e.set({urlState:g.STATUS_200,reupload:null})})["catch"](Promise.CancellationError,_.noop)["finally"](function(){e.unset("uploadPromise")})},sendMediaMsg:function(e){return this.set({avparams:e,filehash:e.filehash,size:parseInt(e.size,10)}),Store.Msg.send(this).then(function(t){return{result:t,avparams:e}})},sendPlayed:function(){if("ptt"===this.type&&!(this.isSentByMe||this.ack>=Wa.CONST.ACK_PLAYED)){var e=this;c.sendMessagePlayed(Wa.splitMsgKey(this.id)).then(function(t){e.ack=Wa.CONST.ACK_PLAYED})["catch"](d.WapDrop,_.noop)}},urlState200:function(e){n(this.url,e)||Wa.isBlobURL(e)?(this.urlState=g.STATUS_200,Wa.isBlobURL(e)&&(this.url=e)):i.log("Msg:status_200 set for wrong url?")()},mediaLoadError:function(e){if(!n(this.url,e))return Promise.resolve();if(!navigator.onLine)return Promise.resolve();if(this.urlRetry>3)return Promise.resolve();this.urlRetry++,this.ajaxHeadPromise&&this.ajaxHeadPromise.cancel();var t,r;return r=this.ajaxHeadPromise=u.head(e).bind(this).timeout(3e4,"mediaLoadErrorTimeout").cancellable().tap(function(){t=r.cancel.bind(r),this.listenToOnce(this,"change:url",t)}).then(function(t){if(404===t.status)return this.requestMediaReupload();if(t.status>=200&&t.status<400){if("application/octet-stream"===t.getResponseHeader("content-type"))return this.requestMediaReupload();this.urlState200(e)}})["catch"](Promise.CancellationError,_.noop)["catch"](Promise.TimeoutError,_.noop)["catch"](_.noop)["finally"](function(){this.stopListening(this,"change:url",t),r===this.ajaxHeadPromise&&this.unset("ajaxHeadPromise")})},requestMediaReupload:function(){return this.set({url:null,urlState:g.RMR_FETCHING}),this.rmrPromise?this.rmrPromise:this.rmrPromise=c.requestMediaReupload(this).bind(this).then(function(e){200===e.status?this.set({clientUrl:e.url,urlState:g.INIT}):404===e.status?this.urlState=g.RMR_ERROR_MISSING:e.status>=400&&(this.urlState=g.RMR_ERROR_RETRY)})["catch"](function(e){throw this.urlState=g.RMR_ERROR_RETRY,e})["finally"](function(){this.unset("rmrPromise")})},forward:function(e){var t=e.id;if(Wa.isUserWid(t)){var r=Store.Contact.get(t);if(r.isBlocked())return Promise.reject(new d.ContactBlocked("Forwarded to contact is blocked",r))}var n,i=this.toJSON(),o=i.type;switch(_.extend(i,{id:Wa.createMsgKey(Wa.me,t,h.tag(),void 0,"out"),t:Wa.now(),from:Wa.me,to:t,self:"out",origin:null,caption:void 0,local:!0,isNew:!0,ack:0}),o){case m.CHAT:n=new y(i);var a=Store.Msg.send(n);return e.msgs.add(n),a;case m.VIDEO:case m.IMAGE:case m.AUDIO:case m.PTT:var s,c=i.filehash,u=i.size,l=i.url;return c&&u||l?(n=new y(i),n.type===m.PTT&&(n.type=m.AUDIO),n.urlState=g.UPLOADING,s=e.msgs.add(n),c&&u?s.reupload=this.forwardMedia(s):s.reupload=this.ensureHashSize(s),s.reuploadMedia()):Promise.reject(new d.MediaMissing);case m.LOCATION:return e.sendLocation(i.lat,i.lng,i.loc,i.clientUrl);case m.VCARD:return e.sendContact(i.body,i.subtype)}},forwardMedia:function(e){var t=this;return function(){return c.requestMediaUpload(e.type,e.filehash,e.size).then(function(r){var n=r.result;return"duplicate"===n?r.data:t.requestMediaReupload().then(function(){switch(t.urlState){case g.RMR_ERROR_MISSING:case g.RMR_ERROR_RETRY:throw new d.MediaMissing}var r=t.clientUrl;if(r)return{filehash:e.filehash,size:e.size,type:e.type,url:r};throw new d.MediaMissing})})}},ensureHashSize:function(e){var t=Wa.buildUrl(this.url,{random:Date.now()}),r=this;return function(){return u.getRetry(t,u.RESP_TYPE.BLOB).then(function(t){return 404===t.status?r.requestMediaReupload().then(function(){var t=r.ensureHashSize(e);return t()}):Wa.getHash("video",null,t.response).then(function(t){e.filehash=r.filehash=t.hash,e.size=r.size=t.size;var n=r.forwardMedia(e);return e.reupload=n,n()})})}},avParams:function(){return this.avparams?this.avparams:{url:this.clientUrl,type:this.type,filehash:this.filehash,duration:this.duration,width:this.fullWidth,height:this.fullHeight}},resend:function(){return this.isMMS&&!f.supportsFeature(f.F.MEDIA_RETRY)?Promise.reject():this.resendPromise?this.resendPromise:(this.urlState=g.UPLOADING,this.resendPromise=Store.Msg.send(this).bind(this).then(function(e){"success"===e?this.urlState=g.INIT:this.urlState=g.NO_URL})["catch"](function(){this.urlState=g.NO_URL})["finally"](function(){this.unset("resendPromise")}))},getMessageInfo:function(){return Store.MsgInfo.find(this)}});y.TYPE=m,y.URL_STATE=g,y.UPLOAD_STATE=v,e.exports=y},function(e,t,r){var n=r(14),i=r(197),o=r(203),a=r(167).XRegExp,s=r(232),c=r(233),d=r(144),u=a("\\p{L}"),l=i.extend({Collection:"Contact",props:{id:"string",name:"string",shortName:"string",type:{type:"string",values:["in","out"],"default":"in"}},session:{pendingAction:"number",checked:"boolean"},derived:{userid:{fn:function(){return this.isUser?Wa.widGetUser(this.id):null}},searchName:{deps:["name"],fn:function(){return this.name?l10n.accentFold(this.name):null}},header:{deps:["name"],fn:function(){if(this.name){var e=this.name.charAt(0).toLowerCase();if(u.test(e)){var t=l10n.removeAccents(e);return l.Collator.compare(t,e)?e:t}return"#"}return void 0}},isMe:{fn:function(){return Wa.me===this.id}},isUser:{fn:function(){return Wa.isUserWid(this.id)}},isGroup:{fn:function(){return Wa.isGroupWid(this.id)}},isBroadcast:{fn:function(){return Wa.isBroadcastWid(this.id)}},formattedShortName:{deps:["shortName","formattedName","id"],fn:function(){return this.id?this.isMe?l10n.t("web_you"):this.shortName||this.formattedName:void 0}},formattedName:{deps:["name","id"],fn:function(){if(!this.id)return void 0;if(this.isMe)return l10n.t("web_you");var e;return this.name||(e=l10n.isRTL()?l10n.embedLTR(Wa.widGetFormattedUser(this.id)):Wa.widGetFormattedUser(this.id)),this.name||e}},formattedUser:{deps:["name","id"],fn:function(){return this.id?this.name?this.name:l10n.isRTL()?l10n.embedLTR(Wa.widGetFormattedUser(this.id)):Wa.widGetFormattedUser(this.id):void 0}},isWAContact:{deps:["type"],fn:function(){return this.isUser&&"in"===this.type}},isMyContact:{deps:["name"],fn:function(){return!!(this.isUser&&this.name&&this.name.length)}}},children:{status:s,profilePicThumb:c},initialize:function(){this.id&&(this.status=Store.Status.gadd(this.id),this.listenTo(this.status,"all",this._getEventBubblingHandler("status")),this.listenTo(d,"locale_change",function(){this.trigger("change:name",this,this.name)}),this.profilePicThumb=Store.ProfilePicThumb.gadd(this.id),this.listenTo(this.profilePicThumb,"all",this._getEventBubblingHandler("profilePicThumb")),this.pendingAction=0,this.listenTo(this,"change:pendingAction",this.onPendingActionUpdate))},onPendingActionUpdate:function(){this.pendingAction<0&&(n.log("ERROR: PENDING ACTION NEGATIVE COUNT"),this.pendingAction=0)},isBlocked:function(){return!!Store.Blocklist.get(this.id)},findCommonGroups:function(){var e=this.id;return new Promise(function(t,r){o.commonGroupsFind(e).then(function(e){if(200===e.status){var i=e.groups.map(function(e){return Store.Chat.get(e)});t(i)}else n.log("models:Contact:findCommonGroups error: "+e.status,"red")(),r(new Error("models:Contact:findCommonGroups error: "+e.status))})})},searchMatch:function(e){return this.searchName?this.searchName.indexOf(e)>-1:e&&this.userid?this.userid.indexOf(e)>-1:!1}});l.setCollator=function(e){l.Collator=window.Intl?window.Intl.Collator([e],{sensitivity:"base"}):{compare:function(e,t){return e.localeCompare(t)}}},l.Comparator=function(e,t){var r=e.id,n=t.id;if(r===Wa.me)return 1;if(n===Wa.me)return-1;var i=e.name,o=t.name;if(!i&&o)return 1;if(i&&!o)return-1;if(i&&o){var a=l.Collator.compare(e.header,t.header);return 0===a?l.Collator.compare(i,o):a}return r&&n?r.localeCompare(n):-1},e.exports=l},function(e,t,r){var n=r(197),i=n.extend({Collection:"Status",props:{id:"string",status:"string"},session:{stale:["boolean",!1,!0]}});e.exports=i},function(e,t,r){var n=r(14),i=r(203),o=r(197),a=r(170),s=r(151),c=r(234),d=r(144),u=o.extend({Collection:"ProfilePicThumb",props:{id:"string",tag:"string",raw:"string"},session:{stale:["boolean",!1,!0]},derived:{img:{deps:["tag","raw"],fn:function(){return this.raw?"data:image/jpeg;base64,"+this.raw:this.tag?Wa.buildUrl(Wa.CONST.PP_URL,{t:"s",u:this.id,i:this.tag}):void 0}},imgFull:{deps:["tag","raw"],fn:function(){return this.raw?void 0:this.tag?Wa.buildUrl(Wa.CONST.PP_URL,{t:"l",u:this.id,i:this.tag}):void 0}}},canSet:function(){return Wa.isGroupWid(this.id)&&a.supportsFeature(a.F.GROUP_SET_PIC)?!0:Wa.isUserWid(this.id)&&this.id===Wa.me&&a.supportsFeature(a.F.SET_PROFILE_PIC)?!0:!1},setPicture:function(e,t){if(!this.canSet())return Promise.reject(new s.ActionError);var r=i.sendSetPicture(this.id,e,t),o=this.id===Wa.me?l10n.t("action_profile_setting"):l10n.t("action_group_icon_setting"),a=r.bind(this)["catch"](function(e){throw n.log("models:ProfilePicThumb:setPicture dropped","red",e)(),this.id===Wa.me?l10n.t("action_profile_set_failed"):l10n.t("action_group_icon_set_failed")}).then(function(e){if(200===e.status)return this.id===Wa.me?l10n.t("action_profile_set"):l10n.t("action_group_icon_set");if(e.status>400)throw this.id===Wa.me?l10n.t("action_profile_set_failed"):l10n.t("action_group_icon_set_failed")});return d.openToast(React.createElement(c,{id:c.genId(),pendingText:o,actionText:a,retry:this.setPicture.bind(this,e,t)})),r.bind(this).then(function(e){200!==e.status||e._duplicate||(this.tag=e.tag)})},canDelete:function(){return Wa.isGroupWid(this.id)&&a.supportsFeature(a.F.GROUP_SET_PIC)&&this.tag?!0:Wa.isUserWid(this.id)&&this.id===Wa.me&&a.supportsFeature(a.F.SET_PROFILE_PIC)&&this.tag?!0:!1},deletePicture:function(){if(!this.canDelete())return Promise.reject(new s.ActionError);var e=i.deletePicture(this.id),t=this.id===Wa.me?l10n.t("action_profile_removing"):l10n.t("action_group_icon_removing"),r=e.bind(this)["catch"](function(e){throw n.log("models:ProfilePicThumb:deletePicture dropped","red",e)(),this.id===Wa.me?l10n.t("action_profile_remove_failed"):l10n.t("action_group_icon_remove_failed")}).then(function(e){if(200===e.status)return this.id===Wa.me?l10n.t("action_profile_removed"):l10n.t("action_group_icon_removed");if(e.status>400)throw this.id===Wa.me?l10n.t("action_profile_remove_failed"):l10n.t("action_group_icon_remove_failed")});return d.openToast(React.createElement(c,{id:c.genId(),pendingText:t,actionText:r,retry:this.deletePicture.bind(this)})),e.bind(this).then(function(e){200!==e.status||e._duplicate||(this.tag=void 0)})}});e.exports=u},function(e,t,r){var n=r(144),i=r(235),o=r(166),a=3e3,s={PENDING:0,SUCCESS:1,FAILURE:-1},c=React.createClass({displayName:"ActionToast",mixins:[i],propTypes:{id:React.PropTypes.string.isRequired,pendingText:React.PropTypes.string.isRequired,actionText:React.PropTypes.instanceOf(Promise).isRequired,retry:React.PropTypes.func},statics:{genId:function(e){return _.uniqueId(e||"action_toast")}},getInitialState:function(){return{text:this.props.pendingText,state:s.PENDING}},componentWillMount:function(){this.props.actionText.bind(this).then(function(e){this.setState({text:e,state:s.SUCCESS})})["catch"](function(e){this.setState({text:e,state:s.FAILURE})})["finally"](function(){this.safeDelay(function(){this.isMounted()&&n.closeToast(this)},a)})},onDismiss:function(){n.closeToast(this)},render:function(){var e,t,r=this.props,n=r.retry,i=r.className;return this.state.state===s.FAILURE&&n.retry&&(t=React.createElement("button",{className:"action",onClick:n.retry},l10n.t("action_try_again"))),this.state.state===s.SUCCESS&&(e=React.createElement("button",{className:"icon icon-x-alt",onClick:this.onDismiss})),React.createElement("div",{className:o("toast",i)},React.createElement("span",null,this.state.text),t,e)}});e.exports=c},function(e,t){var r={getInitialState:function(){return this._timer_mixin_timers={},this._timer_mixin_seq=0,{}},componentWillUnmount:function(){var e=this._timer_mixin_timers;e&&_.values(e).forEach(function(e){e()})},safeIsMounted:function(){return this.isMounted()&&"UNMOUNTING"!==this._compositeLifeCycleState},safeInterval:function(e,t){e=e.bind===Object.getPrototypeOf(e).bind?e.bind(this):e;var r=setInterval(e,t);return this._regTimer(clearInterval.bind(void 0,r))},safeDelay:function(){var e,t=_.toArray(arguments),r=t.shift(),n=t.shift(),i=_.delay(function(n){delete n._timer_mixin_timers[e],r.apply(n,t)},n,this);return e=this._regTimer(clearTimeout.bind(void 0,i))},safeDefer:function(){var e,t=_.toArray(arguments),r=t.shift(),n=_.defer(function(n){delete n._timer_mixin_timers[e],r.apply(n,t)},this);return e=this._regTimer(clearTimeout.bind(void 0,n))},safeDebounce:function(e,t,r){var n,i=this,o=this._timer_mixin_timers,a=function(){delete o[n],e()},s=_.debounce(a,t,r);return function(){n&&delete o[n],s(),n=i._regTimer(s.cancel)}},clearSafeTimeout:function(e){var t=this._timer_mixin_timers[e];t&&t()},clearSafeInterval:function(e){return this.clearSafeTimeout(e)},_regTimer:function(e){var t=this._timer_mixin_timers,r=++this._timer_mixin_seq;return t[r]=function(){delete t[r],e()},r}};e.exports=r},function(e,t,r){var n=r(169),i={dataTypes:{msgKey:{set:function(e){return e instanceof n?{val:e,type:"msgKey"}:void 0},compare:function(e,t,r){return e&&t&&e.toString()===t.toString()}}}};e.exports=i},function(e,t,r){var n=r(14),i=r(197),o=r(203),a=r(144),s=r(170),c=r(151),d=r(234),u=r(162),l=i.extend({props:{id:"string",expiration:{type:"number","default":0}},session:{_unmuteTimer:"string"},derived:{isMuted:{deps:["expiration"],fn:function(){return!!this.expiration}}},initialize:function(){this.expiration&&this.mute(this.expiration)},setMute:function(e,t){(e||this.expiration)&&e!==this.expiration&&(e?this.mute(e,t):this.unmute(t))},mute:function p(e,t){if(!_.isNumber(e))return n.log("models:Mute:mute called with invalid expiration "+e)(),Promise.reject(new c.ActionError);e=Math.round(e),e>2e9&&n.log("models:Mute:mute called with wrong units?"+this.id+" exp:"+e)();var p=function(){this.isMuted&&this._clearUnmuteTimer();var t=e-moment().unix();n.log("models:Mute:mute "+this.id+" duration:"+t)(),this._unmuteTimer=u.setTimeout(this.unmute.bind(this),1e3*e),this.set({expiration:e})}.bind(this);if(t){var r=o.sendConversationMute(this.id,e,this.expiration),i=l10n.t("action_group_muting"),s=r["catch"](function(e){throw n.log("models:Mute:mute dropped","red",e)(),l10n.t("action_group_mute_failed")}).then(function(e){if(200===e.status)return l10n.t("action_group_muted");if(e.status>=400)throw l10n.t("action_group_mute_failed")});return a.openToast(React.createElement(d,{id:d.genId(),pendingText:i,actionText:s,retry:this.mute.bind(this,e,t)})),r.then(function(e){200!==e.status||e._duplicate||p()})}return p(),Promise.resolve()},canMute:function(){return s.supportsFeature(s.F.MUTE)&&Wa.isGroupWid(this.id)},_clearUnmuteTimer:function(){u.clearTimeout(this._unmuteTimer),this.unset("_unmuteTimer"),this.expiration=0},unmute:function h(e){var h=function(){n.log("models:Mute:unmute "+this.id)(),this._clearUnmuteTimer()}.bind(this);if(e){var t=o.sendConversationMute(this.id,!1,this.expiration),r=l10n.t("action_group_unmuting"),i=t["catch"](function(e){throw n.log("models:Mute:unmute dropped","red",e)(),l10n.t("action_group_unmute_failed")}).then(function(e){if(200===e.status)return l10n.t("action_group_unmuted");if(e.status>=400)throw l10n.t("action_group_unmute_failed")});return a.openToast(React.createElement(d,{id:d.genId(),pendingText:r,actionText:i,retry:this.unmute.bind(this,e)})),t.then(function(e){200!==e.status||e._duplicate||h()})}return h(),Promise.resolve()},"delete":function(){i.prototype["delete"].call(this),this._clearUnmuteTimer()}});e.exports=l},function(e,t,r){var n=r(14),i=r(177),o=r(176),a=r(231),s=r(197),c=r(203),a=r(231),d=r(144),u=r(170),l=r(151),p=r(234),h=s.extend({props:{id:"string",isAdmin:"boolean"},children:{contact:a},initialize:function(){this.contact=Store.Contact.gadd({id:this.id}),this.listenTo(this.contact,"all",this._getEventBubblingHandler("contact"))}}),f=i.extend(o,{model:h,comparator:function(e,t){return a.Comparator(e.contact,t.contact)},initialize:function(){this.listenTo(this,"change:contact.name",this.sort),this.listenTo(d,"locale_change",this.sort)},addParticipant:function(e){if(this.get(e.id)||!this.canAdd())return Promise.reject(new l.ActionError);var t=c.addParticipant(this.parent.id,e.id),r=l10n.t("action_participant_adding",{participant:e.formattedShortName}),i=t.then(function(t){return 200===t.status?l10n.t("action_participant_added",{participant:e.formattedShortName}):404===t.status?l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_404"):401===t.status?l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_401"):403===t.status?l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_403"):void 0})["catch"](function(e){throw n.log("models:groupMetadata:participantCollection:addParticipant dropped","red",e)(),l10n.t("action_participant_add_failed")});return d.openToast(React.createElement(p,{id:p.genId(),pendingText:r,actionText:i,retry:this.addParticipant.bind(this,e)})),t},removeParticipant:function(e){if(!this.canRemove(e))return Promise.reject(new l.ActionError);var t=c.removeParticipant(this.parent.id,e.id),r=l10n.t("action_participant_removing",{participant:e.contact.formattedShortName}),i=t.then(function(t){return 200===t.status?l10n.t("action_participant_removed",{participant:e.contact.formattedShortName}):404===t.status?l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_404"):401===t.status?l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_401"):403===t.status?l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_403"):void 0})["catch"](function(e){throw n.log("models:groupMetadata:participantCollection:removeParticipant dropped","red",e)(),l10n.t("action_participant_remove_failed")});return d.openToast(React.createElement(p,{id:p.genId(),pendingText:r,actionText:i,retry:this.removeParticipant.bind(this,e)})),t},promoteParticipant:function(e){if(!this.canPromote(e))return Promise.reject(new l.ActionError);var t=c.promoteParticipant(this.parent.id,e.id),r=l10n.t("action_participant_promoting",{participant:e.contact.formattedShortName}),i=t.then(function(t){return 200===t.status?l10n.t("action_participant_promoted",{participant:e.contact.formattedShortName}):404===t.status?l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_404"):401===t.status?l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_401"):403===t.status?l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_403"):void 0;
})["catch"](function(e){throw n.log("models:groupMetadata:participantCollection:removeParticipant dropped","red",e)(),l10n.t("action_participant_promote_failed")});return d.openToast(React.createElement(p,{id:p.genId(),pendingText:r,actionText:i,retry:this.promoteParticipant.bind(this,e)})),t},canAdd:function(){return u.supportsFeature(u.F.GROUP_ADD_PARTICIPANT)&&this.iAmAdmin()?!0:!1},canPromote:function(e){return u.supportsFeature(u.F.GROUP_PROMOTE_PARTICIPANT)&&e?Wa.me===e.id?!1:this.iAmAdmin()?e.isAdmin?!1:!0:!1:!1},canRemove:function(e){return u.supportsFeature(u.F.GROUP_REMOVE_PARTICIPANT)&&e?Wa.me===e.id?!1:this.iAmAdmin()?!0:!1:!1},iAmMember:function(){return 1===this.where({id:Wa.me}).length},iAmAdmin:function(){return 1===this.where({id:Wa.me,isAdmin:!0}).length}}),m=s.extend({Collection:"GroupMetadata",props:{id:"string",creation:"number",owner:"string"},session:{stale:["boolean",!1,!0],trusted:"boolean"},collections:{participants:f},"delete":function(){s.prototype["delete"].call(this),Store.GroupMetadata.remove(this.id),this.participants.invoke("delete"),this.participants.stopListening(),this.participants.reset()},canSetSubject:function(){return u.supportsFeature(u.F.GROUP_SET_SUBJECT)&&this.participants.iAmMember()?!0:!1},initialize:function(){this.listenTo(this.participants,"change:isAdmin change:contact.isMyContact sort remove reset",this.isTrusted),this.listenTo(this,"change:owner",this.isTrusted)},isTrusted:function(){if(!this.owner)return this.trusted=!1;if(this.owner===Wa.me)return this.trusted=!0;var e=Store.Contact.get(this.owner);if(e&&e.isMyContact)return this.trusted=!0;for(var t=this.participants.models,r=0,n=t.length;n>r;++r){var i=t[r];if(i.isAdmin&&i.id!==Wa.me&&i.contact.isMyContact)return this.trusted=!0}return this.trusted=!1}});e.exports=m},function(e,t,r){var n=r(175),i=r(230),o=n.extend({model:i,add:function(){var e=n.prototype.add.apply(this,arguments);return Store.Msg.add(e,arguments[1]),this.trigger("bulk_add",e),e}});e.exports=o},function(e,t,r){function n(){switch(c.state){case c.STATE.TIMEOUT:return h.TIMEOUT;case c.STATE.OPENING:return c.online?h.OPENING:h.OFFLINE;case c.STATE.PAIRING:return c.hasSynced?h.RESUMING:h.PAIRING;case c.STATE.CONNECTED:return c.stream!==c.STREAM.CONNECTED?c.hasSynced?h.NORMAL:h.SYNCING:h.NORMAL;case c.STATE.UNLAUNCHED:case c.STATE.PROXYBLOCK:default:return h.NORMAL}}function i(){if(!Wa.knowsPhone()&&c.state!==c.STATE.PROXYBLOCK)return f.QR;var e=c.hasSynced;switch(c.state){case c.STATE.PROXYBLOCK:return f.PROXYBLOCK;case c.STATE.CONFLICT:return f.CONFLICT;case c.STATE.UNLAUNCHED:return f.SYNCING;case c.STATE.UNPAIRED_IDLE:case c.STATE.UNPAIRED:return f.QR;case c.STATE.OPENING:if(!c.online&&!c.hasSynced)return f.OFFLINE;default:return e||c.stream===c.STREAM.CONNECTED?f.MAIN:f.SYNCING}}function o(e,t){switch(t){case m.SHOW:return e;case m.HIDE:return c.hasSynced?h.NORMAL:h.CONNECTING;case m.OBSCURE:switch(e){case h.OPENING:case h.PAIRING:case h.SYNCING:case h.RESUMING:return h.CONNECTING;default:return e}}}var a=r(14),s=r(197),c=r(20),d=r(151),u=r(203),l=r(161),p=r(155),h={OFFLINE:"OFFLINE",OPENING:"OPENING",PAIRING:"PAIRING",SYNCING:"SYNCING",RESUMING:"RESUMING",CONNECTING:"CONNECTING",NORMAL:"NORMAL",TIMEOUT:"TIMEOUT"},f={QR:"QR",MAIN:"MAIN",SYNCING:"SYNCING",OFFLINE:"OFFLINE",CONFLICT:"CONFLICT",PROXYBLOCK:"PROXYBLOCK"},m={SHOW:"SHOW",OBSCURE:"OBSCURE",HIDE:"HIDE"},g=3e3,v=s.extend({extraProperties:"reject",session:{info:{type:"string",values:_.values(h),"default":h.NORMAL},obscurity:{type:"string",values:_.values(m),"default":m.HIDE},mode:{type:"string",values:_.values(f),"default":f.SYNCING},needsUpdate:"boolean",couldForce:"boolean",uiActive:"boolean",available:["boolean",!1,!0],unavailableShiftTimer:"object",unobscureShiftTimer:"object",timeoutTimer:"object",phoneActive:"boolean",phoneAuthed:["boolean",!1,!1]},derived:{displayInfo:{deps:["info","obscurity"],fn:function(){return o(this.info,this.obscurity)}}},initialize:function(){this.unavailableShiftTimer=new p(this,this.markUnavailable),this.unobscureShiftTimer=new p(this,this.unobscure),this.listenTo(c,"change:state change:stream change:hasSynced change:online",this.onSocketUpdate),this.listenTo(this,"change:available",this.onAvailableUpdate),this.listenTo(this,"change:phoneAuthed",this.onPhoneAuthedUpdate),this.listenTo(this,"change:info change:displayInfo change:mode",_.debounce(this.onSelfUpdate)),this.listenTo(this,"change:info",this.updateWamLog),this.listenTo(this,"change:available change:uiActive",this.updateCouldForce.bind(this,!1)),document.addEventListener("visibilitychange",this.updateCouldForce.bind(this,!1)),this.updateCouldForce(!1)},"delete":function(){},INFO:h,MODE:f,handle:function(e){switch(e[0]){case"awake":this.phoneActive=!1,this.phoneActive=!0;break;case"asleep":this.phoneActive=!1;break;case"update":l.update(e[1],e[2]);break;default:a.log("Stream:handle unknown cmd "+e[0],"red",e)()}},markAvailable:function(){this.unavailableShiftTimer.cancel(),this.available=!0},markUnavailable:function(e){e?this.unavailableShiftTimer.before(e):(this.unavailableShiftTimer.cancel(),this.available=!1)},onSelfUpdate:function(){Wa.allowBackButton(this.mode!==f.MAIN),this.displayInfo===h.TIMEOUT?this.timeoutTimer=WamLog.startTimer("WsTimeout"):this.timeoutTimer&&(this.timeoutTimer.end(),this.unset("timeoutTimer")),a.log("Stream:onSelfUpdate mode:"+this.mode+(" info:"+this.info+" view:"+this.displayInfo))()},onSocketUpdate:function(){var e={},t=c.previousAttributes();t.stream!==c.stream&&c.stream===c.STREAM.DISCONNECTED&&(e.phoneActive=!1);var r=n();if(e.info=r,e.mode=i(),e.phoneAuthed=c.stream!==c.STREAM.DISCONNECTED,r===h.NORMAL)this.unobscureShiftTimer.cancel(),e.obscurity=m.HIDE;else if(r===h.OFFLINE)this.unobscureShiftTimer.cancel(),e.obscurity=m.OBSCURE;else switch(this.obscurity){case m.HIDE:this.unobscureShiftTimer.before(Wa.CONST.DIAGNOSTIC_DELAY);break;case m.OBSCURE:this.unobscureShiftTimer.before(g);break;case m.SHOW:}this.set(e)},unobscure:function(){this.obscurity=m.SHOW},onPhoneAuthedUpdate:function(){this.phoneAuthed&&(this.sendAvailability(!0),Store.RecentEmoji.sync())},onAvailableUpdate:function(){a.log("Stream:onAvailableUpdate user "+(this.available?"available":"unavailable"))(),this.sendAvailability(!1)},sendAvailability:function(e){(e||this.uiActive)&&(this.available?u.sendPresenceAvailable()["catch"](d.WapDrop,_.noop):u.sendPresenceUnavailable()["catch"](d.WapDrop,_.noop))},updateCouldForce:function(){this.couldForce=!this.uiActive||!this.available&&document.hidden},updateWamLog:function(){var e=this.info===h.NORMAL;WamLog.streamInfoChange(this.info,c.socketSequence,e),e&&this.stopListening(null,"change:info",this.updateWamLog)}});e.exports=new v},function(e,t,r){var n=r(14),i=r(151),o={handle:function(e){var t=e.shift();switch(t.type){case"const":Wa.CONST[t.key]=t.value;break;case"read":case"unread":var r=Store.Chat.get(t.jid);r&&("read"===t.type?r.markSeen():"unread"===t.type&&r.markUnseen());break;case"picture":Store.ProfilePicThumb.imageChanged(t.jid,t.tag);break;case"log":Wa.uploadLogs("server-requested");break;case"privacy":t.jid?(Store.Presence.update(t.jid)["catch"](i.WapDrop,_.noop),Store.ProfilePicThumb.update(t.jid)["catch"](i.WapDrop,_.noop),Store.Status.update(t.jid)["catch"](i.WapDrop,_.noop)):n.log("Store:Cmd:handle:privacy no jid","red",t)()}}};e.exports=o},function(e,t,r){var n=r(14),i=r(175),o=r(243),a=r(203),s=r(143),c=r(170),d=i.extend({model:o,handle:function(e){var t,r=e.shift();if(r.id=1,r.protoVersion){c.setVersion(r.protoVersion);var i=r.features||{},o=c.setFeatures(i);t=!!o.KEY_PARTICIPANT,a.setVersion(r.protoVersion,r.binVersion),Store.Stream.handle(["awake"])}if(r.initial){c.setPlatform(r.platform),s.setLogoutToken(r.browserToken),r.hasOwnProperty("is24h")&&Wa.updateConnSettings(r);var d=r.ref,u=r.serverToken,l=r.clientToken,p=r.connected;d&&p&&u&&s.setRefTokCookies(d,u),s.setLoginTokens({client:l,server:u}),r.secret&&a.setSharedSecret(r.secret),"true"!==r.isResponse&&Wa.saveCurrentSecretBundle(),"iw"===r.lg&&(r.lg="he"),r.wid&&(Wa.setMe(r.wid),Store.Contact.gadd(r.wid))}else{var h=this.get(1);h&&h.connected&&t&&(n.log("models:Conn:participantChange:to:"+c.supportsFeature("KEY_PARTICIPANT"))(),Wa.hardRefresh())}this.add(r,{merge:!0})}});e.exports=new d},function(e,t,r){var n=r(197),i=r(143),o=r(244),a={ANDROID:"android",BB:"bb",BBX:"bbx",IPAD:"ipad",IPHONE:"iphone",IPOD:"ipod",S40:"s40",SYMBIAN:"symbian",WP7:"wp7"},s=n.extend({Collection:"Conn",props:{id:"number",ref:"string",refTTL:"number",refId:"number",wid:"string",connected:"boolean",clientToken:"string",serverToken:"string",secret:"string",isResponse:"string",battery:"number",plugged:"boolean",lc:"string",lg:"string",is24h:"boolean",platform:"string"},derived:{isBatteryLow:{deps:["battery","plugged"],fn:function(){return _.isNumber(this.battery)&&!this.plugged&&this.battery<=Wa.CONST.BATTERY_LOW_THRESHOLD_1}},scaledBatteryLevel:{deps:["battery"],fn:function(){return _.isNumber(this.battery)?Math.round(this.battery/10):void 0}},refExpiry:{deps:["ref","refTTL"],fn:function(){return Date.now()+this.refTTL}},locale:{deps:["lg","lc"],fn:function(){return this.lg?this.lc?this.lg+"-"+this.lc:this.lg:null}},platformField:{deps:["platform"],fn:function(){return"wp7"===this.platform?o.ENUM_PLATFORM_TYPE.WP:this.platform?o.ENUM_PLATFORM_TYPE[this.platform.toUpperCase()]||o.ENUM_PLATFORM_TYPE.UNKNOWN:o.ENUM_PLATFORM_TYPE.UNKNOWN}}},initialize:function(){this.listenTo(this,"change:locale",function(e,t){i.setLangPref(t),l10n.init(t)})}});s.PLATFORMS=a,e.exports=s},function(e,t){var r=function(e,t){this.type=e,this.code=t},n={COUNTER:1,TIMER:2,GAUGE:3,DIMENSION_INT:4,DIMENSION_FLOAT:4,DIMENSION_STRING:5},i={TYPES:n,metric:{WebcAvailableDuration:new r(n.TIMER,388),WebcConnectEnd:new r(n.TIMER,332),WebcConnectStart:new r(n.TIMER,331),WebcCryptoDone:new r(n.TIMER,377),WebcCryptoExecuting:new r(n.TIMER,376),WebcCryptoFetching:new r(n.TIMER,375),WebcDomComplete:new r(n.TIMER,341),WebcDomContentLoadedEventEnd:new r(n.TIMER,340),WebcDomContentLoadedEventStart:new r(n.TIMER,339),WebcDomInteractive:new r(n.TIMER,338),WebcDomLoading:new r(n.TIMER,337),WebcDomainLookupEnd:new r(n.TIMER,330),WebcDomainLookupStart:new r(n.TIMER,329),WebcExeDone:new r(n.TIMER,378),WebcExeStart:new r(n.TIMER,380),WebcFetchStart:new r(n.TIMER,328),WebcLoadEventEnd:new r(n.TIMER,343),WebcLoadEventStart:new r(n.TIMER,342),WebcPageLoadT:new r(n.TIMER,322),WebcRedirectCount:new r(n.GAUGE,350),WebcRedirectEnd:new r(n.TIMER,327),WebcRedirectStart:new r(n.TIMER,326),WebcRequestStart:new r(n.TIMER,334),WebcResourceDuration:new r(n.TIMER,345),WebcResponseEnd:new r(n.TIMER,336),WebcResponseStart:new r(n.TIMER,335),WebcSecureConnectionStart:new r(n.TIMER,333),WebcStreamInfoDuration:new r(n.TIMER,387),WebcUnloadEventEnd:new r(n.TIMER,325),WebcUnloadEventStart:new r(n.TIMER,324),WebcWsAttempts:new r(n.GAUGE,356),WebcWsNormal:new r(n.TIMER,355),WebcWsOpenT:new r(n.TIMER,369),WebcWsOpening:new r(n.TIMER,352),WebcWsPairing:new r(n.TIMER,353),WebcWsSyncing:new r(n.TIMER,354),WebcWsTimeoutT:new r(n.TIMER,372)},dimension:{AppIsBetaRelease:new r(n.DIMENSION_INT,10),AppVersion:new r(n.DIMENSION_STRING,8),BrowserVersion:new r(n.DIMENSION_STRING,147),DeviceName:new r(n.DIMENSION_STRING,6),Event:new r(n.DIMENSION_INT,43),Platform:new r(n.DIMENSION_INT,5),WebcAppcacheStatus:new r(n.DIMENSION_INT,314),WebcAvailable:new r(n.DIMENSION_INT,322),WebcCached:new r(n.DIMENSION_INT,282),WebcEnv:new r(n.DIMENSION_INT,316),WebcNavigation:new r(n.DIMENSION_INT,295),WebcPhonePlatform:new r(n.DIMENSION_INT,353),WebcQrCode:new r(n.DIMENSION_INT,300),WebcResourceCached:new r(n.DIMENSION_INT,284),WebcResourceName:new r(n.DIMENSION_STRING,283),WebcStreamInfo:new r(n.DIMENSION_INT,320),WebcStreamMode:new r(n.DIMENSION_INT,321)},ENUM_PLATFORM_TYPE:{IPHONE:1,ANDROID:2,BB:3,BBX:7,S40:4,SYMBIAN:5,WP:6,WEBCLIENT:8,OSMETA:11,TEST:9,UNKNOWN:10},ENUM_WEBC_APPCACHE_STATUS_CODE:{UNCACHED:0,IDLE:1,CHECKING:2,DOWNLOADING:3,UPDATEREADY:4,OBSOLETE:5},ENUM_WEBC_ENV_CODE:{PROD:0,INTERN:1,DEV:2},ENUM_WEBC_NAVIGATION_TYPE:{NAVIGATE_NEXT:0,RELOAD:1,BACK_FORWARD:2,UNDEFINED:255},ENUM_WEBC_STREAM_INFO_CODE:{OFFLINE:0,OPENING:1,PAIRING:2,SYNCING:3,RESUMING:4,CONNECTING:5,NORMAL:6,TIMEOUT:7},ENUM_WEBC_STREAM_MODE_CODE:{QR:0,MAIN:1,SYNCING:2,OFFLINE:3,CONFLICT:4,PROXYBLOCK:5},ENUM_EVENT:{WEBC_AVAILABLE_CHANGE:68,WEBC_PAGE_LOAD:59,WEBC_RESOURCE_LOAD:60,WEBC_STREAM_INFO_CHANGE:66,WEBC_STREAM_MODE_CHANGE:67,WEBC_WS_OPEN:64,WEBC_WS_TIMEOUT:65}};e.exports=i},function(e,t,r){var n=r(14),i=r(175),o=r(231),a=r(150),s=r(203),c=r(144),d=r(151),u=i.extend({model:o,comparator:o.Comparator,_sort:_.debounce(function(){return i.prototype.sort.call(this)},1e3),_silentSort:_.debounce(function(){return i.prototype.sort.call(this,{silent:!0})},1e3),sort:function(e){return e&&e.slient?this._silentSort():this._sort()},initialize:function(){i.prototype.initialize.call(this,{CachePolicy:{id:"contact_collection",policy:i.CACHE_POLICY.NONE}}),this.checksum=void 0,this.listenTo(c,"locale_change",this.sort),this.listenTo(this,"change:name",this.sort)},"delete":function(){i.prototype["delete"].call(this),delete this.checksum},getFilteredContacts:function(){return this.filter(function(e){return e.name&&!e.isMe&&e.isWAContact})},_find:function(e){var t=this.get(e);return t?t:{id:e}},_findQuery:function(e){var t=this;return s.contactFindQuery(e.retry).then(function(e){return"preempted"===e?Promise.reject("contacts preempted"):(t.trigger(Wa.CONST.COLLECTION_HAS_SYNCED),e.checksum&&(t.checksum=e.checksum,n.log("Store:Contact:query update checksum "+e.checksum)()),Promise.resolve(e.data))})},handle:function(e){function t(e){var t=r.get(e.id);e.name?r.add(e,{merge:!0}):t&&t.unset("name")}var r=this,i=e.shift();if(_.isArray(i)){var o=e.shift();if(o&&"remove"===o.missing){var a={};i.forEach(function(e){a[e.id]=!0}),r.forEach(function(e){var t=e.get("id");Wa.isUserWid(t)&&!a[t]&&e.set("name")})}o&&o.checksum&&(r.checksum=o.checksum,n.log("Store:Contact:handle update checksum "+o.checksum)()),i.forEach(t)}else"preempt"===i.cmd?(this.add(i.response,{merge:!0}),i.checksum&&(r.checksum=i.checksum,n.log("Store:Contact:handle update checksum "+i.checksum)()),this.trigger(Wa.CONST.COLLECTION_HAS_SYNCED)):n.log("Store:Contact:handle unknown: "+JSON.stringify(i),"red")()},sync:function(){return this.findQuery({})["catch"](d.WapDrop,_.noop),a.waitForBBEvent(this,Wa.CONST.COLLECTION_HAS_SYNCED)},resyncContacts:function(e){"undefined"!=typeof this.checksum&&"undefined"!=typeof e&&(this.checksum!==e?this.findQuery({retry:!0}).then(function(e){if(_.isArray(e)){n.log("Store:Contact:resync success")();var t,r,i={};for(r=0;r<e.length;r++)t=e[r],i[t.id]=t;for(r=0;r<this.length;r++)t=this.at(r),i[t.id]||t.unset("name")}else n.log("Store.Contact.resync error "+JSON.stringify(e),"red",e)()})["catch"](d.WapDrop,_.noop):n.log("Store:Contact:resync checksum match")())}});e.exports=new u},function(e,t,r){var n=r(14),i=r(175),o=r(238),a=r(203),s=r(151),c=i.extend({model:o,initialize:function(){i.prototype.initialize.call(this,{staleCollection:!0})},onResume:function(){_.union(Store.Chat.where({active:!0}).filter(function(e){return e.isGroup||e.isBroadcast}),Store.Chat.where({isBroadcast:!0})).forEach(function(e){Store.GroupMetadata.find(e.id)["catch"](s.WapDrop,_.noop)})},_find:function(e){var t=this;if(Wa.isGroupWid(e)){var r=Store.Chat.get(e);return r&&r.isReadOnly?a.groupMetadataFindFromPhone(e).then(function(t){return"ok"===t.status?t.data:"missing"===t.status?void _.defer(function(){Store.Chat.get(e)["delete"]()}):"error"===t.status?(n.log("model:GroupMetadata:find error "+t.info,"red")(),Promise.reject(new Error("model:GroupMetadata:find error"))):void 0}):a.groupMetadataFind(e).then(function(r){if(r.status>=400)return{id:e,stale:!1};var n=[],i=t.get(e);return i?i.participants.set(r.participants):n=r.participants,t.updateSubject(e,r.subject),{id:r.id,owner:r.owner,creation:r.creation,participants:n,stale:!1}})}return Wa.isBroadcastWid(e)?a.contactFindBroadcast(e).then(function(t){if(200===t.status){var r=Store.GroupMetadata.get(e);if(r&&!r.stale)return Promise.resolve(r);var i=[];return r?r.participants.set(t.recipients):i=t.recipients,Promise.resolve({id:e,stale:!1,participants:i})}return 404===t.status?Promise.reject("False broadcast list query."):(n.log("models:GroupMetadataCollection:_find:bclist error: "+t.status,"red")(),Promise.reject(new Error("models:GroupMetadataCollection:_find:bclist error: "+t.status)))}):(n.log("groupMetadata:find trying to fetch non-group/bclist wid "+e)(),Promise.reject(new Error("groupMetadata:find trying to fetch non-group/bclist wid "+e)))},_handle:function(e){return e},updateSubject:function(e,t){_.isString(t)&&Store.Contact.find(e).then(function(e){e.name||(e.name=t)})}});e.exports=new c},function(e,t,r){function n(e,t,r){var n=[],i=[];return t.forEach(function(t){t.id=Wa.createMsgKey(t.from,t.to,t.id,t.participant,t.self),Wa.isBroadcastWid(e)&&delete t.broadcast,t.recvFresh||t.clientUrl||(t.urlState=h.URL_STATE.NO_URL),"ptt"===t.type&&!t.id.fromMe&&t.ack<0&&(t.ack=0);var o=Store.Msg.get(t.id);if(o){void 0===o.clientUrl&&t.clientUrl&&o.set({urlState:h.URL_STATE.INIT}),t.ack<o.ack&&delete t.ack;for(var a in t)t.hasOwnProperty(a)&&"undefined"==typeof t[a]&&delete t[a];o.set(t),r.isHistory&&o.recvFresh&&(d.log("model:Msg:handle:processMM dup "+o.id,"red")(),i.push(o.toJSON()))}else r.update||n.push(t)}),0===n.length&&0===i.length?Promise.resolve([]):Promise.join(Wa.fillInThumbnailDims(n),Store.Chat.find(e),function(n,o){Store.Msg.add(n,{merge:!0});var a="after"===r.add;if(s(t,n,i,o,a),a&&Wa.isBroadcastWid(e)&&n.forEach(function(t){if("broadcast_notification"===t.type){var r=Store.GroupMetadata.get(e);"add"===t.subtype?r.participants.add({id:t.body},{merge:!0}):"remove"===t.subtype&&r.participants.remove(t.body),o.groupMetadata.stale=!1}else t.recvFresh&&c(t)}),p.supportsFeature(p.F.RECENT_EMOJI_SYNC)&&!Store.RecentEmoji.syncDue)for(var d=0;d<n.length;d++){var u=Store.Msg.get(n[d].id);if(u.isNew&&u.isSentByMe&&u.containsEmoji){Store.RecentEmoji.periodicSync();break}}return n})}function i(e){return new Promise(function(t,r){var n=e.map(function(e){return[e.clientUrl,e.from.split("@")[0],e.to.split("@")[0],e.t]});m.send({data:["query","refreshMedia",n],onSend:t,onDrop:r})}).then(function(t){if(200===t.status){var r=t.data;return r.length!==e.length?(d.log("Msg:refreshMedia returned length differs from orig","red")(),Promise.reject("Msg:refreshMedia returned length differs from orig")):(r.forEach(function(t){var r=e.shift(),n=r.duration||t.d;n=n?n.toString():void 0;var i={url:t.url,urlState:t.url?h.URL_STATE.URL:h.URL_STATE.NO_URL,mimetype:t.mt,duration:n};"image"===r.type&&(i.fullWidth=t.w,i.fullHeight=t.h),r.set(i)}),e)}return d.log("Msg:refreshMedia error "+t.status,"red")(),Promise.reject("Msg:refreshMedia error "+t.status)})}function o(e,t,r){var n=t.msgs.length,i=_.isArray(e)?e:[e],o=i.map(function(e){return Store.Msg.get(e.id)});if(r?t.msgs.add(o):t.msgs.add(o,{at:0}),r||0===n){var a=_.last(o).id,s=Wa.splitMsgKey(a).remote;Store.Msg.lastReceivedKey[s]=a}if(r||0===n||!Store.Msg.lastReceivedReceipt[t.id])for(var c=o.length,d=c-1;d>=0;d--){var u=o[d],l=Wa.splitMsgKey(u.id);if(l.fromMe&&!u.isNotification){Store.Msg.updateLastReceipt(l.remote,u.t);break}}}function a(e,t,r,n){var i,o,a,s={},c={},d=r.length;if(0===d)return t;for(i=0;d>i;i++)o=r[i],c[o.id]=o;for(d=t.length,i=0;d>i;i++)o=t[i],s[o.id]=o;var u=[];for(d=e.length,i=0;d>i;i++)o=e[i],s[o.id]&&u.push(s[o.id]),c[o.id]&&(u.push(c[o.id]),a=Store.Msg.get(o.id),a&&(n.removeMsg(a),a.unset("recvFresh")));return u}function s(e,t,r,n,i){var s=a(e,t,r,n);o(s,n,i)}function c(e){function t(t){var r=Wa.createMsgKey(e.from,t,n.id);if(!Store.Msg.some(_.matches({id:r}))){var i=Wa.clone(e);i.to=t,i.id=r,i.broadcast=!0,Store.Msg.add(i,{merge:!0}),Store.Chat.find(t).then(function(e){o(i,e,!0)})}}var r,n=Wa.splitMsgKey(e.id);if(!e.invis)if(e.recipients&&0!==e.recipients.length)r=e.recipients,e.recipients.forEach(t);else{var i=Store.GroupMetadata.get(n.remote);i?(r=Wa.clone(i.participants),_.pluck(r,"id").forEach(t)):d.log("model:msgs:broadcastFanout no group_metadata rec for bclist, cant fanout: "+n.remote)()}return r}var d=r(14),u=r(175),l=r(151),p=r(170),h=r(230),f=r(150),m=r(20),g=r(203),v=u.extend({model:h,initialize:function(){u.prototype.initialize.call(this),this.lastReceivedKey={},this.lastReceivedReceipt={},this.refreshMediaPromises={},this.preAck={},this.pendingAdd={},this.listenTo(m,"change:stream",function(){m.stream===m.STREAM.DISCONNECTED&&(this.preAck={})})},_findQuery:function(e){var t=this;return g.msgFindQuery(e).then(function(r){return r.status>=400?(d.log("model:Msg:findQuery error "+r.status)(),Promise.reject(r.status)):(r.forEach(function(e){e.invis=!0}),t.processMultipleMessages(e.remote,r,{add:"before"}))})},handle:function(e){function t(e,t){var r=Wa.createMsgKey(i.from,e,t,void 0,"out"),o=n.get(r);if(o){o.updateAck(i.ack),n.updateLastReceipt(Wa.splitMsgKey(r).remote,i.t);var a=Wa.splitMsgKey(r).remote;Wa.isUserWid(a)&&(Store.MsgInfo.update(t,i.from,e,i.ack,a,i.t),Wa.isBroadcastWid(i.broadcast)&&Store.MsgInfo.update(t,i.from,i.broadcast,i.ack,a,i.t))}else d.log("Msg:out of order ack",null,i)(),n.preAck[r]=i}var r,n=this,i=e.shift();if("ack"===i.cmd){var o=[i.to];if(Wa.isBroadcastWid(i.to)&&1===i.ack){var a=Store.GroupMetadata.get(i.to);a&&Array.prototype.push.apply(o,_.pluck(a.participants.toArray(),"id"))}return o.forEach(function(e){t(e,i.id)}),!0}if("acks"===i.cmd)return i.id.forEach(function(e){t(i.to,e)}),!0;if(i.msg)return i.msg.recvFresh=!0,i.msg.isNew=!0,this.processMultipleMessages(i.chat,[i.msg],{add:"after",update:"update"===i.meta.add}),!0;if(i.msgs){var s=i.msgs.length;if(!s)return!1;var c=i.meta;c.isHistory=!0;for(var u=0;s>u;u++)r=i.msgs[u],r.invis=!0;return this.processMultipleMessages(i.chat,i.msgs,c),!0}if(i.recent){delete i.recent,this.trigger(Wa.CONST.COLLECTION_HAS_SYNCED);for(var l in i)r=i[l],r.invis=!0,this.processMultipleMessages(l,[r],{add:"before"})}else d.log("************** Msg else clause. something strange is going on")()},_hasSynced:function(){return f.waitForBBEvent(this,Wa.CONST.COLLECTION_HAS_SYNCED)},"delete":function(){u.prototype["delete"].call(this),this.lastReceivedKey={},this.lastReceivedReceipt={},this.preAck={},this.refreshMediaPromises={}},send:function(e){return new Promise(function(t,r){var n=e.id,i=Wa.splitMsgKey(n),o=e.toJSON();if(e.isNew=!0,!e.isGroupMsg){var a=Store.Contact.get(e.to);if(a.isBlocked())return void r(new l.ContactBlocked("Contact is blocked",a))}if(Wa.isBroadcastWid(o.to))var s=c(o);delete o.status,delete o.mimetype,delete o.height,delete o.width,delete o.recipients,delete o.chat,delete o.broadcast,delete o.ack,delete o.invis,delete o.filehash,delete o.recvFresh,Wa.isHttpUrl(e.url)||delete o.url;for(var u in o)(null===o[u]||"undefined"==typeof o[u])&&delete o[u];o.id=i.id,e.isMMS&&(o.avparams=e.avParams()),g.msgCreateRecord(o,e.local).then(function(r){if(200===r.status){var o=i.remote,a=i.fromMe&&i.remote===Wa.me?3:r.data?r.data.ack:1;e.updateAck(a),Store.Msg.lastReceivedKey[o]=n,Store.Msg.updateLastReceipt(o,r.t),Wa.isBroadcastWid(o)&&(s?s.forEach(function(e){var t=Wa.createMsgKey(Wa.me,e.id,i.id),r=Store.Msg.get(t);r&&(r.ack=1,Store.Msg.lastReceivedKey[e]=t,Store.Msg.updateLastReceipt(e,r.t))}):d.log("model:msg:createRecord bclist server ack, no recipients")()),t("success")}})["catch"](function(e){throw t("dropped"),d.log("model:msg:createRecord dropped msg: "+o.id,"red")(),e})})},resyncReceipts:function(){d.log("Msg:resyncReceipts")();var e=[];for(var t in Store.Msg.lastReceivedReceipt){var r,n=Store.Chat.get(t);if(r=n?p.gte([0,5])?n.getFirstMsgWithStatus():n.getFirstMsgFromMe():void 0){var i=Wa.splitMsgKey(r.get("id"));i.t=Store.Msg.lastReceivedReceipt[t],e.push(i)}else d.log("Msg:resyncReceipts wid in lastReceivedReceipt, but no msg: "+t,"red")()}return 0===e.length?Promise.resolve():g.resyncReceipts(e).then(function(e){_.isArray(e)?(d.log("Msg:resyncReceipts success")(),e.forEach(function(e){Store.Msg.updateLastReceipt(e.id,e.t),e.acks.forEach(function(t){if(4===t.length){var r=t[1],n=r?Wa.me:e.id,i=r?e.id:Wa.me,o=Wa.createMsgKey(n,i,t[0],t[2]),a=Store.Msg.get(o);a&&a.updateAck(t[3])}else d.log("Msg:resyncReceipts invalid response: "+JSON.stringify(t),"red")()})})):d.log("Msg:resyncReceipts error","red",e)()})["catch"](l.LogoutDrop,l.EphemeralDrop,l.BrowserReplacedDrop,_.noop)["catch"](function(){throw d.log("Msg:resyncReceipts dropped","red")(),new Error("Msg:resyncReceipts dropped")})},updateLastReceipt:function(e,t){var r=this.lastReceivedReceipt[e];(!r||t>r)&&(this.lastReceivedReceipt[e]=t)},refreshMediaUrl:function(e){if(Wa.isEncryptedMediaURL(e.clientUrl))e.set({url:null,urlState:h.URL_STATE.REFRESHING}),setTimeout(function(){e.set({url:e.clientUrl,urlState:h.URL_STATE.URL})},0);else{if(this.refreshMediaPromises[e.id])return;this.refreshMediaPromises[e.id]=e,this._refreshMedia()}},_refreshMedia:_.debounce(function(){var e=_.where(this.refreshMediaPromises,{needsRefresh:!0});0!==e.length&&(e.forEach(function(e){e.set({url:null,urlState:h.URL_STATE.REFRESHING})}),i(_.clone(e)).bind(this)["catch"](function(t){_.forEach(e,function(e){e.urlState=h.URL_STATE.REFRESH_RETRY})})["finally"](function(){_.forEach(e,function(e){delete this.refreshMediaPromises[e.id]}.bind(this))}))},500),processMultipleMessages:function(e,t,r){var i,o=this.pendingAdd[e],a=this;return i=o?o.then(function(){return n(e,t,r)}):n(e,t,r),i["finally"](function(){a.pendingAdd[e]===i&&(a.pendingAdd[e]=null)}),this.pendingAdd[e]=i}});e.exports=new v},function(e,t,r){var n=r(14),i=r(175),o=r(230),a=r(249),s=r(20),c=r(203),d=i.extend({model:a,initialize:function(){i.prototype.initialize.call(this,{staleCollection:!0})},_initializeStaleCollection:function(){var e=this;this.listenTo(s,"change:stream",function(){s.stream===s.STREAM.DISCONNECTED&&e.forEach(function(e){e.settled||e.set("stale",!0)})})},_find:function(e){return e.isSentByMe?c.queryMsgInfo(Wa.splitMsgKey(e.id)).then(function(t){return t.status>=400?(n.log("model:MsgInfo:findQuery error "+t.status)(),Promise.reject(t.status)):(t.id=e.id,t.isPTT=e.type===o.TYPE.PTT,Promise.resolve(t))}):Promise.reject("message not sent by me")},update:function(e,t,r,i,o,a){var s,c,d=Wa.createMsgKey(t,r,e,o),u=this.get(d),l=Wa.isUserWid(Wa.splitMsgKey(d).remote);if(u)switch(i){case 4:if(s=u.played.get(o),s||(u.played.add({id:o,t:a}),u.playedRemaining-=1),l)break;case 3:if(c=u.read.filter(function(e){return e.id===o}),u.read.remove(c),3===i&&(u.read.add({id:o,t:a}),0===c.length&&(u.readRemaining-=1)),l)break;case 2:c=u.delivery.filter(function(e){return e.id===o}),u.delivery.remove(c),2===i&&(u.delivery.add({id:o,t:a}),0===c.length&&(u.deliveryRemaining-=1));break;default:n.log("model:MsgInfo:handle ack err: "+i,"red",arguments)()}},handle:function(e){var t=this,r=e.shift();switch(r.cmd){case"ack":this.update(r.id,r.from,r.to,r.ack,r.participant,r.t);break;case"acks":r.id.forEach(function(e){t.update(e,r.from,r.to,r.ack,r.participant,r.t)})}}});e.exports=new d},function(e,t,r){var n=r(197),i=r(236),o=r(231),a=r(177),s=r(176),c=n.extend({props:{id:"id",t:"number"},children:{contact:o},initialize:function(){this.contact=Store.Contact.gadd({id:this.id}),this.listenTo(this.contact,"all",this._getEventBubblingHandler("contact"))},getCollection:function(){return this.collection}}),d=a.extend(s,{model:c,comparator:function(e,t){return e.t<t.t?1:-1},isStateStale:function(e){var t=this.get(e);return t&&t.stale}}),u=n.extend(i,{Collection:"MsgInfo",props:{id:"msgKey",isPTT:"boolean",playedRemaining:{type:"number","default":0},readRemaining:{type:"number","default":0},deliveryRemaining:{type:"number","default":0}},collections:{played:d,read:d,delivery:d},derived:{settled:{deps:["isPTT","playedRemaining","readRemaining"],fn:function(){return this.isPTT?!this.playedRemaining:!this.readRemaining}}}});e.exports=u},function(e,t,r){var n=r(14),i=r(175),o=r(237),a=r(143),s="global_mute",c=!0,d=!0,u=i.extend({model:o,initialize:function(){i.prototype.initialize.call(this,{CachePolicy:{id:"mute",policy:i.CACHE_POLICY.LOAD,delay:1e3}})},initializeFromCache:function(){var e=a.getGlobalSounds();this.setGlobalSounds(e);var t=a.getGlobalNotifications();this.setGlobalNotifications(t)},saveToCache:function(){if(Wa.me){var e=this._config.CachePolicy.id;n.log("models:mute:cache-save: "+e)(),a.setCollection(e,[this.globalMute().toJSON()])}},globalMute:function(){var e=this.get(s);return e?e:this.add({id:s})},getGlobalSounds:function(){return c},setGlobalSounds:function(e){c=e,a.setGlobalSounds(e)},getGlobalNotifications:function(){return d},setGlobalNotifications:function(e){d=e,a.setGlobalNotifications(e)},handle:function(e){for(var t=0;t<e.length;t++){var r=e[t],n=Store.Chat.get(r.id);n&&"mute"===r.type&&n.mute.setMute(r.muteExpiration)}}});e.exports=new u},function(e,t,r){var n=r(14),i=r(175),o=r(202),a=r(203),s=r(240),c=r(151),d=i.extend({model:o,initialize:function(){i.prototype.initialize.call(this,{staleCollection:!0}),this.listenTo(s,"change:phoneActive",this.onPresenceSubscribabilityChange)},_find:function(e){var t=this.gadd(e);return t.isUser?(t.isSubscribed=!0,a.presenceSubscribe(e)["catch"](function(e){return t.isSubscribed=!1,Promise.reject(e)})["catch"](c.WapDrop,_.noop),a.lastseenFind(e).then(function(r){return 423===r.status?{id:e,stale:!0,hasData:!1}:401===r.status?(t.handle({id:e,deny:!0}),{id:e}):(r.id=e,t.handle(r),{id:e})})):Promise.resolve({id:e})},handle:function(e){var t=e.shift();if(t.id===Wa.me)"unavailable"===t.type?this.forEach(function(e){"unavailable"===e.type||e.stale||this.add({id:e.id,type:"unavailable",t:t.t,stale:!1},{merge:!0})}.bind(this)):n.log('models:presence:handle for self is not "unavailable" !')();else{var r=this.get(t.id);r&&("unsubscribe"===t.type?r.set({isSubscribed:!1,stale:!0}):(r.handle(t),r.stale=!1))}},onPresenceSubscribabilityChange:function(){s.phoneActive?Store.Chat.forEach(function(e){e.active&&e.presence.isUser&&e.presence.update()["catch"](c.WapDrop,_.noop)}):this.forEach(function(e){e.reset(),e.set({stale:!0,isSubscribed:!1})})}});e.exports=new d},function(e,t,r){var n=r(14),i=r(175),o=r(233),a=r(143),s=r(203),c=r(151),d=r(240),u=r(20),l=i.extend({model:o,initialize:function(){i.prototype.initialize.call(this,{staleCollection:!0,CachePolicy:{id:"profile_pic_thumb",trigger:"change:tag change:raw",policy:i.CACHE_POLICY.LOAD,delay:5e3}}),this.listenTo(d,"change:phoneActive",function(){d.phoneActive&&this.onPhoneActive()})},get:function(e){var t=i.prototype.get.call(this,e);if(!_.isString(e))return t;var r=i.prototype.get.call(this,Wa.md5(e));if(r){if(this.remove(r,{silent:!0}),t)return t;var n=r.toJSON();return n.id=e,this.add(n,{silent:!0})}return t?t:void 0},saveToCache:function(){if(Wa.me){var e=this._config.CachePolicy.id,t=this.models.filter(function(e){return Wa.isWid(e.id)});t=t.map(function(e){return e=e.toJSON(),e.id=Wa.md5(e.id),e}),n.log("models:profilePic:cache-save: "+e)(),a.setCollection(e,t)}},onPhoneActive:function(){if(u.stream===u.STREAM.CONNECTED){var e=[];this.forEach(function(t){t._uiObservers&&t.stale&&(t.tag||t.unset("tag",{silent:!0}),e.push(t.toJSON()))}),this.resyncPictures(e)}},onResume:function(){var e=this.filter(_.property("_uiObservers")).map(function(e){return e.tag||e.unset("tag",{silent:!0}),e.toJSON()});this.resyncPictures(e)},_find:function(e){var t=Store.Chat.get(e);return t&&t.isReadOnly?s.profilePicFindThumbFromPhone(e,this.get(e)):s.profilePicFind("ProfilePicThumb",e).then(function(t){return 401===t.status?{id:e,raw:void 0,tag:""}:423===t.status?{id:e,stale:!0}:t.status>=400?{id:e}:"undefined"==typeof t.status?{id:e,tag:t.tag,raw:void 0}:void 0})["catch"](c.WapDrop,function(){return{id:e,stale:!0}})},imageChanged:function(e,t){var r=Store.ProfilePicThumb.get(e);r&&("remove"===t?r.unset("tag"):r.tag!==t&&r.update()["catch"](c.WapDrop,_.noop))},resyncPictures:function(e){return 0===e.length?Promise.resolve():s.resyncPictures(e).then(function(e){
if(423===e.status)n.log("ProfilePicThumbStore:resyncPictures blocked","orange")();else{if(e.status>=400)throw n.log("ProfilePicThumbStore:resyncPictures error","red")(),new Error("ProfilePicThumbStore:resyncPictures error");if(!_.isArray(e))throw n.log("ProfilePicThumbStore:resyncPictures unknown reply","red",e)(),new Error("ProfilePicThumbStore:resyncPictures unknown reply");n.log("ProfilePicThumbStore:resyncPictures success")(),e.forEach(function(e){var t=Store.ProfilePicThumb.get(e.id);t&&t.set({tag:e.tag,raw:void 0,stale:!1})})}})["catch"](c.WapDrop,_.noop)["catch"](function(e){throw n.log("ProfilePicThumbStore:resyncPictures dropped: "+e,"red")(),new Error("ProfilePicThumbStore:resyncPictures dropped: "+e)})}});e.exports=new l},function(e,t,r){function n(e){return"number"==typeof e&&e>0?e-1:Wa.CONST.MAX_GROUP_SIZE}function i(e){return"number"==typeof e&&e>0?1024*e*1024:Wa.CONST.MAX_MEDIA_UPLOAD_SIZE}function o(e){var t;for(t in c)if("undefined"!=typeof e[t]){var r,n,i=c[t];_.isArray(i)?(r=i[0],n=i[1](e[t])):(r=i,n=e[t]),Wa.CONST[r]=n}for(t in s.F)"undefined"!=typeof e[t]&&s.setFeature(t,!!e[t])}var a=r(203),s=r(170),c={imageMaxEdge:"IMG_MAX_EDGE",maxParticipants:["MAX_GROUP_SIZE",n],maxSubject:"MAX_SUBJECT_LENGTH",media:["MAX_MEDIA_UPLOAD_SIZE",i]},d={handle:function(e){var t=e.shift();"number"==typeof t.status&&t.status>=400||o(t)},fetch:function(){return a.queryServerProps().then(function(e){"number"==typeof e.status&&e.status>=400||o(e)})}};e.exports=d},function(e,t,r){var n=r(14),i=r(175),o=r(255),a=r(203),s=r(151),c=r(163),d=r(170),u=i.extend({model:o,comparator:function(e,t){return e.weight>t.weight?-1:1},initialize:function(){i.prototype.initialize.call(this,{CachePolicy:{id:"recent_emoji_collection",policy:i.CACHE_POLICY.LOAD,delay:2e3}}),this.listenTo(this,"change:weight change:length",this.sortTrimScale),this.dirty=!1,this.syncDue=!1},"delete":function(){i.prototype["delete"].call(this),this.dirty=!1,this.syncDue=!1},_findQuery:function(e){return d.supportsFeature(d.F.RECENT_EMOJI_SYNC)?a.recentEmojiQuery(e?this.toArray():void 0).then(function(e){return _.isArray(e)?(e.forEach(function(e){e["char"]=c.normalizeEmoji(e["char"])}),Promise.resolve(e)):(n.log("models:recentEmoji:findQuery error","red",e)(),Promise.reject("recent emoji fetch error"))}):Promise.reject("gk recent emoji sync unsupported")},sync:function(){return this.findQuery(this.dirty)["catch"](s.WapDrop,_.noop)["finally"](function(){this.dirty=!1}.bind(this))},_sync:_.throttle(function(e,t){e.sync()["finally"](t)},Wa.CONST.EMOJI_SYNC_DELAY,{leading:!1}),periodicSync:function(){d.supportsFeature(d.F.RECENT_EMOJI_SYNC)&&(n.log("models:recentEmoji:periodicSync due:"+this.syncDue+" dirty: "+this.dirty)(),this.syncDue=!0,this._sync(this,function(){this.syncDue=!1}.bind(this)))},sortTrimScale:function(){var e=this.length;e&&(this.sort(),e>30&&this.remove(this.models.slice(30)),_.first(this.models).weight<10&&_.last(this.models).weight>.01||this.forEach(function(t,r){t.weight=1+3*((e-r)/e)}))},increment:function(e){this.forEach(function(t){t["char"]===e?t.weight+=1:t.weight*=.9,t.weight=Math.round(1e3*t.weight)/1e3}),this.get(e)||this.add({"char":e,weight:1}),this.dirty=!0,this.periodicSync()}});e.exports=new u},function(e,t,r){var n=r(197),i=n.extend({idAttribute:"char",props:{"char":"string",weight:"number"}});e.exports=i},function(e,t,r){var n=r(175),i=r(257),o=r(163),a=n.extend({model:i,initialize:function(){n.prototype.initialize.call(this,{CachePolicy:{id:"emoji_variant_collection",policy:n.CACHE_POLICY.LOAD,delay:1e3}})},setVariant:function(e,t){var r=o.skinToneEmojis[e];if(!r)throw new Error("attempt to store variantless emoji");this.gadd({"char":r,variant:t})},getVariant:function(e){if(o.skinToneEmojis[e]){var t=this.get(e);return t?t.variant:null}throw new Error("attempt to get variantless emoji")}});e.exports=new a},function(e,t,r){var n=r(197),i=n.extend({idAttribute:"char",props:{"char":"string",variant:"string"}});e.exports=i},function(e,t,r){var n=r(14),i=r(175),o=r(232),a=r(203),s=r(151),c=r(240),d=r(20),u=r(144),l=r(170),p=r(234),h=i.extend({model:o,initialize:function(){i.prototype.initialize.call(this,{staleCollection:!0}),this.listenTo(c,"change:phoneActive",function(){c.phoneActive&&this.onPhoneActive()})},onPhoneActive:function(){d.stream===d.STREAM.CONNECTED&&this.onResume()},onResume:function(){this.filter(_.property("_uiObservers")).forEach(function(e){Store.Status.find(e.id)["catch"](s.WapDrop,_.noop)})},_find:function(e){return a.statusFind(e).then(function(t){return _.isNumber(t.status)?423===t.status?{id:e,stale:!0,status:""}:t.status>=400?{id:e,status:""}:void 0:{id:e,status:t.status}})["catch"](s.WapDrop,function(){return{id:e,stale:!0,status:""}})},_handle:function(e){return e},canSetMyStatus:function(){return l.supportsFeature(l.F.SET_STATUS)},setMyStatus:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];if(e=e.trim(),!e)return Promise.reject(new s.ActionError);if(!this.canSetMyStatus())return Promise.reject(new s.ActionError);var t=a.sendSetStatus(e),r=l10n.t("action_status_setting"),i=t.then(function(e){return 200===e.status?l10n.t("action_status_set"):e.status>=400?l10n.t("action_status_set_failed"):void 0})["catch"](function(e){throw n.log("models:statusCollection:setMyStatus dropped","red",e)(),l10n.t("action_status_set_failed")});return u.openToast(React.createElement(p,{id:p.genId(),pendingText:r,actionText:i,retry:this.setMyStatus.bind(this,e)})),t.bind(this).then(function(t){200!==t.status||t._duplicate||(this.get(Wa.me).status=e)})}});e.exports=new h},function(e,t,r){function n(){h.on("js_halt_detected",this._haltDetected,this)}function i(e,t){this.startT=Math.round(window.performance.now()),this.metric=e,this.timerID=t}function o(){if(window.performance&&window.performance.timing&&window.performance.navigation){var e=window.performance.timing,t=window.performance.navigation,r={},n=e.navigationStart,i=e.loadEventEnd-e.navigationStart;if(0>i)return d.log("wam:logPageLoad delayed","blue")(),void _.delay(o,1e4);var a,s=["unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"];s.forEach(function(t){a=e[t],r[t]=a?a-n:void 0});var c=e.fetchStart===e.domainLookupEnd,p=!v.SYNCING;u.createEvent(l.WebcPageLoad,{WebcPageLoadT:i,WebcUnloadEventStart:r.unloadEventStart,WebcUnloadEventEnd:r.unloadEventEnd,WebcRedirectStart:r.redirectStart,WebcRedirectEnd:r.redirectEnd,WebcFetchStart:r.fetchStart,WebcDomainLookupStart:r.domainLookupStart,WebcDomainLookupEnd:r.domainLookupEnd,WebcConnectStart:r.connectStart,WebcConnectEnd:r.connectEnd,WebcSecureConnectionStart:r.secureConnectionStart,WebcRequestStart:r.requestStart,WebcResponseStart:r.responseStart,WebcResponseEnd:r.responseEnd,WebcDomLoading:r.domLoading,WebcDomInteractive:r.domInteractive,WebcDomContentLoadedEventStart:r.domContentLoadedEventStart,WebcDomContentLoadedEventEnd:r.domContentLoadedEventEnd,WebcDomComplete:r.domComplete,WebcLoadEventStart:r.loadEventStart,WebcLoadEventEnd:r.loadEventEnd,WebcAppcacheStatus:window.applicationCache?window.applicationCache.status:void 0,WebcCached:c,WebcNavigation:t.type,WebcRedirectCount:t.redirectCount,WebcWsOpening:v.OPENING,WebcWsPairing:v.PAIRING,WebcWsSyncing:v.SYNCING,WebcWsNormal:v.NORMAL,WebcWsAttempts:v.socketSequence,WebcQrCode:p,WebcExeStart:g.exeStart,WebcExeDone:g.exeDone})}}function a(){if(window.performance.getEntriesByType){var e,t=window.performance.getEntriesByType("resource"),r=document.createElement("a");t.forEach(function(t){r.href=t.name,e=r.pathname+r.search+r.hash,u.createEvent(l.WebcResourceLoad,{WebcResourceName:e,WebcResourceDuration:Math.round(t.duration),WebcResourceCached:t.domainLookupEnd===t.fetchStart})})}}function s(e){return f+e+m}function c(e){return l[f+e]}var d=r(14),u=r(260),l=r(262),p=r(244),h=r(144),f="Webc",m="T",g={},v={},y={};n.prototype={_haltDetected:function(e){_.forIn(y,function(t,r){y[r]=t+e})},exeTiming:function(e){g=e},streamInfoChange:function(e,t,r){var n=Math.round(window.performance.now());v[e]=n,r&&(v.socketSequence=t,o(),a(),u.enableRotate())},startTimer:function(e){var t=_.uniqueId("wamTimer"+e),r=new i(e,t);return y[t]=r,r},logPhonePlatform:function(e){var t;t="wp7"===e?p.ENUM_PLATFORM_TYPE.WP:e?p.ENUM_PLATFORM_TYPE[e.toUpperCase()]||p.ENUM_PLATFORM_TYPE.UNKNOWN:p.ENUM_PLATFORM_TYPE.UNKNOWN,u.makeDimension(p.dimension.WebcPhonePlatform,t)}},i.prototype={end:function(){var e=window.performance.now();delete y[this.timerID];var t=Math.max(Math.floor(e-this.startT),0);if(!_.isNull(t)&&!isNaN(t)){var r=c(this.metric);if(_.isUndefined(r))return void d.log("wamTimer:end no event for "+this.metric)();var n={};n[s(this.metric)]=t,u.createEvent(r,n)}},cancel:function(){delete y[this.timerID]}},e.exports=new n},function(e,t,r){function n(e){I="";var t=w.dimension.Event;t.value=e.eventID,i(t);var r=f();_.forIn(_.omit(e,"eventID"),function(e,t){e.type>=w.TYPES.DIMENSION_INT?i(e):o(e)}),t.value=null,i(t),g(I,r)}function i(e){var t=arguments.length<=1||void 0===arguments[1]?f():arguments[1];_.isBoolean(e.value)&&(e.value=e.value?1:0),_.isUndefined(e.value)&&(e.value=Number.NaN);var r=e.type===w.TYPES.DIMENSION_STRING,n="["+e.type+","+e.code+","+t+",";r||(e.value=isNaN(e.value)?null:e.value),n+=r?e.value.length+',"'+e.value+'"':e.value,n+="],",I+=n}function o(e){var t=arguments.length<=1||void 0===arguments[1]?f():arguments[1];if(!_.isUndefined(e.value)&&!_.isNull(e.value)){_.isBoolean(e.value)&&(e.value=e.value?1:0);var r="["+e.type+","+e.code+","+t+","+(isNaN(e.value)?null:e.value)+"],";I+=r}}function a(e,t){var r,n,i,o;t.forEach(function(t){if(3===t.length)r=t[0],n=t[1],i=t[2],e.writeString(r),e.writeByte(n),e.writeInt32(i);else if(n=t[0],o=t[1],i=t[2],e.writeByte(n),e.writeByte(o),e.writeByte(o>>8),e.writeByte(o>>16),e.writeInt32(i),4===t.length){var a=t[3];_.isNull(a)&&(a=Number.NaN),e.writeDouble(a)}else{var s=R.encode(t[4]);e.writeInt16(E.calculateUTF8Bytes(s)),e.writeUTF8String(s)}})}function s(){var e=S.getWamLastRotate(),t=Date.now()-e>y.WAM_ROTATE_INTERVAL;(!e||t)&&c()}function c(){S.setWamStatus(T),v.log("wam:rotate","blue")();var e=1<<19,t=!0,r=m();if(!r)return v.log("wam:rotate empty buffer","red")(),void S.setWamStatus(C);r=r.substring(0,r.length-1),r+="]";try{var n=JSON.parse(r),i=new E(e,t);a(i,n),i.flip();var o=i.toBase64(),s=f();b.sendWamLogs(o,s)}catch(c){v.log("wam:rotate error "+c.message)(),v.log("wam:toParse="+r)()}finally{S.setWamStatus(C),S.setWamLastRotate(Date.now()),S.setWamBuffer()}}function d(e,t){var r=arguments.length<=2||void 0===arguments[2]?f():arguments[2];e.value=t,i(e,r)}function u(e){var t=arguments.length<=1||void 0===arguments[1]?f():arguments[1];_.forIn(e,function(e,r){d(w.dimension[r],e,t)})}function l(e,t){var r=Wa.getBrowserInfo(),n=Store.Conn.get(1),i=n?n.platformField:w.ENUM_PLATFORM_TYPE.UNKNOWN,o={AppVersion:y.VERSION_STR,BrowserVersion:r.ua,DeviceName:r.os,WebcPhonePlatform:i,WebcEnv:w.ENUM_WEBC_ENV_CODE.PROD};if(e)return"";var a=_.omit(o,function(e,t){return P[t]===e});return _.isEmpty(a)?"":(I="",u(a),v.log("wam:initCachedDimensions: dimensions changed","black",I)(),P=o,S.setWamDimensionCache(o),I)}function p(e){return I='[["WASTATS",1,'+e+"],",d(w.dimension.Platform,w.ENUM_PLATFORM_TYPE.WEBCLIENT,e),u(P,e),I}function h(){var e=m();if(!e)return void v.log("wam:possibleRotate empty buffer")();if(e.length>y.WAM_MAX_BUFFER_SIZE)v.log("wam:possibleRotate buffer full")(),c();else{if(!N)return;v.log("wam:possibleRotate")()}var t=S.getWamStatus();if(null!==t){if(t!==C)return void c();S.setWamStatus()}s()}function f(){return Math.floor(Date.now()/1e3)}function m(){return S.getWamBuffer()}function g(e,t){try{var r=S.getWamBuffer(),n=l(!r,t);r||(v.log("wam:appendToBuffer writing header")(),r=p(t)),S.setWamBuffer(r+n+e)}catch(i){v.log("wam:appendToBuffer error:"+i.message)(),c()}}var v=r(14),y=r(4),b=r(203),E=r(156),R=r(261),w=r(244),S=r(143),T=(r(151),r(19),r(150),"pending"),C="completed",N=!1,I="",P=S.getWamDimensionCache()||{},O={createEvent:function(e,t){var r=new e;_.forIn(t,function(e,t){r[t].value=e}),n(r),h()},enableRotate:function(){N=!0,h()},makeDimension:d};e.exports=O},function(e,t,r){var n;(function(e,i){!function(o){function a(e){for(var t,r,n=[],i=0,o=e.length;o>i;)t=e.charCodeAt(i++),t>=55296&&56319>=t&&o>i?(r=e.charCodeAt(i++),56320==(64512&r)?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--)):n.push(t);return n}function s(e){for(var t,r=e.length,n=-1,i="";++n<r;)t=e[n],t>65535&&(t-=65536,i+=_(t>>>10&1023|55296),t=56320|1023&t),i+=_(t);return i}function c(e,t){return _(e>>t&63|128)}function d(e){if(0==(4294967168&e))return _(e);var t="";return 0==(4294965248&e)?t=_(e>>6&31|192):0==(4294901760&e)?(t=_(e>>12&15|224),t+=c(e,6)):0==(4292870144&e)&&(t=_(e>>18&7|240),t+=c(e,12),t+=c(e,6)),t+=_(63&e|128)}function u(e){for(var t,r=a(e),n=r.length,i=-1,o="";++i<n;)t=r[i],o+=d(t);return o}function l(){if(y>=v)throw Error("Invalid byte index");var e=255&g[y];if(y++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function p(){var e,t,r,n,i;if(y>v)throw Error("Invalid byte index");if(y==v)return!1;if(e=255&g[y],y++,0==(128&e))return e;if(192==(224&e)){var t=l();if(i=(31&e)<<6|t,i>=128)return i;throw Error("Invalid continuation byte")}if(224==(240&e)){if(t=l(),r=l(),i=(15&e)<<12|t<<6|r,i>=2048)return i;throw Error("Invalid continuation byte")}if(240==(248&e)&&(t=l(),r=l(),n=l(),i=(15&e)<<18|t<<12|r<<6|n,i>=65536&&1114111>=i))return i;throw Error("Invalid UTF-8 detected")}function h(e){g=a(e),v=g.length,y=0;for(var t,r=[];(t=p())!==!1;)r.push(t);return s(r)}var f="object"==typeof t&&t,m=("object"==typeof e&&e&&e.exports==f&&e,"object"==typeof i&&i);(m.global===m||m.window===m)&&(o=m);var g,v,y,_=String.fromCharCode,b={version:"2.0.0",encode:u,decode:h};n=function(){return b}.call(t,r,t,e),!(void 0!==n&&(e.exports=n))}(this)}).call(t,r(157)(e),function(){return this}())},function(e,t,r){var n=r(244),i={WebcPageLoad:function(){this.eventID=n.ENUM_EVENT.WEBC_PAGE_LOAD,this.WebcAppcacheStatus=n.dimension.WebcAppcacheStatus,this.WebcCached=n.dimension.WebcCached,this.WebcNavigation=n.dimension.WebcNavigation,this.WebcQrCode=n.dimension.WebcQrCode,this.WebcConnectEnd=n.metric.WebcConnectEnd,this.WebcConnectStart=n.metric.WebcConnectStart,this.WebcDomComplete=n.metric.WebcDomComplete,this.WebcDomContentLoadedEventEnd=n.metric.WebcDomContentLoadedEventEnd,this.WebcDomContentLoadedEventStart=n.metric.WebcDomContentLoadedEventStart,this.WebcDomInteractive=n.metric.WebcDomInteractive,this.WebcDomLoading=n.metric.WebcDomLoading,this.WebcDomainLookupEnd=n.metric.WebcDomainLookupEnd,this.WebcDomainLookupStart=n.metric.WebcDomainLookupStart,this.WebcExeDone=n.metric.WebcExeDone,this.WebcExeStart=n.metric.WebcExeStart,this.WebcFetchStart=n.metric.WebcFetchStart,this.WebcLoadEventEnd=n.metric.WebcLoadEventEnd,this.WebcLoadEventStart=n.metric.WebcLoadEventStart,this.WebcPageLoadT=n.metric.WebcPageLoadT,this.WebcRedirectCount=n.metric.WebcRedirectCount,this.WebcRedirectEnd=n.metric.WebcRedirectEnd,this.WebcRedirectStart=n.metric.WebcRedirectStart,this.WebcRequestStart=n.metric.WebcRequestStart,this.WebcResponseEnd=n.metric.WebcResponseEnd,this.WebcResponseStart=n.metric.WebcResponseStart,this.WebcSecureConnectionStart=n.metric.WebcSecureConnectionStart,this.WebcUnloadEventEnd=n.metric.WebcUnloadEventEnd,this.WebcUnloadEventStart=n.metric.WebcUnloadEventStart,this.WebcWsAttempts=n.metric.WebcWsAttempts,this.WebcWsNormal=n.metric.WebcWsNormal,this.WebcWsOpening=n.metric.WebcWsOpening,this.WebcWsPairing=n.metric.WebcWsPairing,this.WebcWsSyncing=n.metric.WebcWsSyncing},WebcResourceLoad:function(){this.eventID=n.ENUM_EVENT.WEBC_RESOURCE_LOAD,this.WebcResourceCached=n.dimension.WebcResourceCached,this.WebcResourceName=n.dimension.WebcResourceName,this.WebcResourceDuration=n.metric.WebcResourceDuration},WebcWsOpen:function(){this.eventID=n.ENUM_EVENT.WEBC_WS_OPEN,this.WebcWsOpenT=n.metric.WebcWsOpenT},WebcWsTimeout:function(){this.eventID=n.ENUM_EVENT.WEBC_WS_TIMEOUT,this.WebcWsTimeoutT=n.metric.WebcWsTimeoutT}};e.exports=i},function(e,t,r){function n(e){return S[parseInt(e,10)]}function i(e){e=e||Wa&&Wa.originalUrl||window.location.href||"";var t=e.split("/%F0%9F%8C%90/");return t.length>1?_.first(t[1].split("/")):void 0}var o=r(14),a=r(15),s=r(231),c=r(264),d=r(265),u=r(144),l=r(266),p=r(167).XRegExp,h=r(267),f="en",m="en-GB",g=document.documentElement.getAttribute("dir"),v=document.getElementById("style").getAttribute("href"),y={en:r(269)},b={LTR:"ltr",RTL:"rtl"},E=r(270),R=["ar","fa","ur","he","dv","ku"],w=["ar","fa"],S="٠١٢٣٤٥٦٧٨٩".split(""),T=p("\\p{M}","g");s.setCollator(f),e.exports={_locales:[f],init:function(e){var t=[];if(this._addLocale(e,t),this._addLocale(i(),t),navigator.languages){var n=this;_.forEach(navigator.languages,function(e){n._addLocale(e,t)})}this._addLocale(navigator.language,t),this._addLocale(f,t);var a=t.filter(function(e){return!y[e]}),c=a.map(function(e){return e=E[e],e?r(271)("./"+e+"/translation.json")():Promise.reject("Non-existent language requested.")}),d=this.curDir();return Promise.all(c).bind(this).then(function(e){a.forEach(function(t,r){y[t]=e[r]}),this._locales=t;var r=_.first(this._locales).replace("_","-").toLowerCase();s.setCollator(r),moment.locale([_.first(this._locales),m]);var n=R.indexOf(_.first(this._locales))>-1?b.RTL:b.LTR;if(n!==g){if(this._loadedStyle&&d===g)return this._switchStyleDir(d,n),u.localeChange(),o.log("i10n:init Locale Updated: "+this._locales.join(":"))(),this._locales;var i=window.performance.now();return this._loadStyle().bind(this).then(function(e){this._loadedStyle=e;var t=window.performance.now();this._switchStyleDir(d,n);var r=window.performance.now();return o.log("i10n:init style fetching:"+(t-i)+"ms")(),o.log("i10n:init style executing:"+(r-t)+"ms")(),u.localeChange(),o.log("i10n:init Locale Updated: "+this._locales.join(":"))(),this._locales})}return this._switchStyleDir(d,n),u.localeChange(),o.log("i10n:init Locale Updated: "+this._locales.join(":"))(),this._locales})["catch"](function(){return this._locales=[f],s.setCollator(f),moment.locale([_.first(this._locales),m]),this._switchStyleDir(d,b.LTR),u.localeChange(),o.log("i10n:init Failed to fetch locales","red",t)(),this._locales})},_switchStyleDir:function(e,t){if(e!==t){var r=document.getElementById("style");t===g?(e!==g&&this._loadedStyle&&(this._loadedStyle.unuse(),a.isGecko&&r.setAttribute("href",v)),r.removeAttribute("disabled"),document.documentElement.setAttribute("dir",t)):(a.isGecko&&r.setAttribute("href",""),r.setAttribute("disabled","true"),document.documentElement.setAttribute("dir",t),this._loadedStyle.use())}},_loadStyle:function(){var e=this;return new Promise(function(t,n){g===b.RTL?r.e(74,function(){e._loadedStyle=r(420),t(e._loadedStyle)}):r.e(75,function(){e._loadedStyle=r(431),t(e._loadedStyle)})})},_addLocale:function(e,t){if(e){var r=e.replace("-","_").toLowerCase();E[r]&&(r=E[r],r=r.replace("-","_").toLowerCase());var n=t.indexOf(r);0>n&&this.isLocaleSupported(e)&&t.push(r);var i=r.split("_");if(!(i.length<0)){var o=_.first(i),a=t.indexOf(o);0>a&&this.isLocaleSupported(o)&&t.push(o)}}},isLocaleSupported:function(e){try{return!!e&&(!window.Intl||_.isArray(window.Intl.Collator.supportedLocalesOf([e])))&&!!E[e.replace("-","_").toLowerCase()]}catch(t){return!1}},lng:function(){var e=_.first(this._locales);return E[e]||e},isRTL:function(){return R.indexOf(_.first(this._locales))>=0},curDir:function(){return document.documentElement.getAttribute("dir")===b.RTL?b.RTL:b.LTR},embedDir:function(e){return"ltr"===Wa.textDir(e)?this.embedLTR(e):this.embedRTL(e)},forceDir:function(e){return"ltr"===Wa.textDir(e)?this.forceLTR(e):this.forceRTL(e)},embedLTR:function(e){return"‪"+e+"‬"},embedRTL:function(e){return"‫"+e+"‬"},forceLTR:function(e){return"‎"+e},forceRTL:function(e){return"‏"+e},hasT:function(e,t){for(var r,n,i=t&&t._plural?t._plural:void 0,o=0;o<this._locales.length;o++)if(r=e+this.getPluralExt(this._locales[o],i),n=y[this._locales[o]],n[r])return!0;return!1},t:function(e,t){for(var r,n,i="",o=t&&t._plural?t._plural:void 0,a=0;a<this._locales.length&&(r=e+this.getPluralExt(n=this._locales[a],o),!(i=y[n][r]));a++);for(r in t){if(!t.hasOwnProperty(r))return void 0;i=i.replace("__"+r+"__",this.n(t[r],n))}return i},isHindiNumerals:function(e){return w.indexOf(e||this._locales[0])>-1},n:function(e,t){return this.isHindiNumerals(t)?e.toString().replace(/[0-9]/g,n):e},numAndPunc:function(e){return this.isHindiNumerals()?this.embedLTR(this.n(e).replace(/./g,this.forceLTR)):e},filesize:function(e){return this.n(c(e,{round:0,suffixes:{B:this.t("filesize_byte"),kB:this.t("filesize_kilobyte"),MB:this.t("filesize_megabyte"),GB:this.t("filesize_gigabyte")}}))},getPluralExt:function(e,t){if(!t)return"";var r=d[e];if(!r)return"";var n=r.plurals(t),i=r.numbers[n];return 1===i?"":2===r.numbers.length&&2===i?"_plural":"_plural_"+i},removeAccents:function(e){return h(l.nfkd(e||"").replace(T,""))},accentFold:function(e){return this.removeAccents(e).toLowerCase()}}},,function(e,t){e.exports={ach:{name:"Acholi",numbers:[1,2],plurals:function(e){return Number(e>1)}},af:{name:"Afrikaans",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ak:{name:"Akan",numbers:[1,2],plurals:function(e){return Number(e>1)}},am:{name:"Amharic",numbers:[1,2],plurals:function(e){return Number(e>1)}},an:{name:"Aragonese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ar:{name:"Arabic",numbers:[0,1,2,3,11,100],plurals:function(e){return Number(0===e?0:1==e?1:2==e?2:e%100>=3&&10>=e%100?3:e%100>=11?4:5)}},arn:{name:"Mapudungun",numbers:[1,2],plurals:function(e){return Number(e>1)}},ast:{name:"Asturian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ay:{name:"Aymará",numbers:[1],plurals:function(e){return 0}},az:{name:"Azerbaijani",numbers:[1,2],plurals:function(e){return Number(1!=e)}},be:{name:"Belarusian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&4>=e%10&&(10>e%100||e%100>=20)?1:2)}},bg:{name:"Bulgarian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},bn:{name:"Bengali",numbers:[1,2],plurals:function(e){return Number(1!=e)}},bo:{name:"Tibetan",numbers:[1],plurals:function(e){return 0}},br:{name:"Breton",numbers:[1,2],plurals:function(e){return Number(e>1)}},bs:{name:"Bosnian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&4>=e%10&&(10>e%100||e%100>=20)?1:2)}},ca:{name:"Catalan",numbers:[1,2],plurals:function(e){return Number(1!=e)}},cgg:{name:"Chiga",numbers:[1],plurals:function(e){return 0}},cs:{name:"Czech",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e>=2&&4>=e?1:2)}},csb:{name:"Kashubian",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e%10>=2&&4>=e%10&&(10>e%100||e%100>=20)?1:2)}},cy:{name:"Welsh",numbers:[1,2,3,8],plurals:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)}},da:{name:"Danish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},de:{name:"German",numbers:[1,2],plurals:function(e){return Number(1!=e)}},dz:{name:"Dzongkha",numbers:[1],plurals:function(e){return 0}},el:{name:"Greek",numbers:[1,2],plurals:function(e){return Number(1!=e)}},en:{name:"English",numbers:[1,2],plurals:function(e){return Number(1!=e)}},eo:{name:"Esperanto",numbers:[1,2],plurals:function(e){return Number(1!=e)}},es:{name:"Spanish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},es_ar:{name:"Argentinean Spanish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},et:{name:"Estonian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},eu:{name:"Basque",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fa:{name:"Persian",numbers:[1],plurals:function(e){return 0}},fi:{name:"Finnish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fil:{name:"Filipino",numbers:[1,2],plurals:function(e){return Number(e>1)}},fo:{name:"Faroese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fr:{name:"French",numbers:[1,2],plurals:function(e){return Number(e>1)}},fur:{name:"Friulian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fy:{name:"Frisian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ga:{name:"Irish",numbers:[1,2,3,7,11],plurals:function(e){return Number(1==e?0:2==e?1:7>e?2:11>e?3:4)}},gd:{name:"Scottish Gaelic",numbers:[1,2,3,20],plurals:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&20>e?2:3)}},gl:{name:"Galician",numbers:[1,2],plurals:function(e){return Number(1!=e)}},gu:{name:"Gujarati",numbers:[1,2],plurals:function(e){return Number(1!=e)}},gun:{name:"Gun",numbers:[1,2],plurals:function(e){return Number(e>1)}},ha:{name:"Hausa",numbers:[1,2],plurals:function(e){return Number(1!=e)}},he:{name:"Hebrew",numbers:[1,2],plurals:function(e){return Number(1!=e)}},hi:{name:"Hindi",numbers:[1,2],plurals:function(e){return Number(1!=e)}},hr:{name:"Croatian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&4>=e%10&&(10>e%100||e%100>=20)?1:2)}},hu:{name:"Hungarian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},hy:{name:"Armenian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ia:{name:"Interlingua",numbers:[1,2],plurals:function(e){return Number(1!=e)}},id:{name:"Indonesian",numbers:[1],plurals:function(e){return 0}},is:{name:"Icelandic",numbers:[1,2],plurals:function(e){return Number(e%10!=1||e%100==11)}},it:{name:"Italian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ja:{name:"Japanese",numbers:[1],plurals:function(e){return 0}},jbo:{name:"Lojban",numbers:[1],plurals:function(e){return 0}},jv:{name:"Javanese",numbers:[0,1],plurals:function(e){return Number(0!==e)}},ka:{name:"Georgian",numbers:[1],plurals:function(e){return 0}},kk:{name:"Kazakh",numbers:[1],plurals:function(e){return 0}},km:{name:"Khmer",numbers:[1],plurals:function(e){return 0}},kn:{name:"Kannada",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ko:{name:"Korean",numbers:[1],plurals:function(e){return 0}},ku:{name:"Kurdish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},kw:{name:"Cornish",numbers:[1,2,3,4],plurals:function(e){return Number(1==e?0:2==e?1:3==e?2:3)}},ky:{name:"Kyrgyz",numbers:[1],plurals:function(e){return 0}},lb:{name:"Letzeburgesch",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ln:{name:"Lingala",numbers:[1,2],plurals:function(e){return Number(e>1)}},lo:{name:"Lao",numbers:[1],plurals:function(e){return 0}},lt:{name:"Lithuanian",numbers:[1,2,10],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(10>e%100||e%100>=20)?1:2)}},lv:{name:"Latvian",numbers:[0,1,2],plurals:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)}},mai:{name:"Maithili",numbers:[1,2],plurals:function(e){return Number(1!=e)}},mfe:{name:"Mauritian Creole",numbers:[1,2],plurals:function(e){return Number(e>1)}},mg:{name:"Malagasy",numbers:[1,2],plurals:function(e){return Number(e>1)}},mi:{name:"Maori",numbers:[1,2],plurals:function(e){return Number(e>1)}},mk:{name:"Macedonian",numbers:[1,2],plurals:function(e){return Number(1==e||e%10==1?0:1)}},ml:{name:"Malayalam",numbers:[1,2],plurals:function(e){return Number(1!=e)}},mn:{name:"Mongolian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},mnk:{name:"Mandinka",numbers:[0,1,2],plurals:function(e){return Number(0===e?0:1==e?1:2)}},mr:{name:"Marathi",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ms:{name:"Malay",numbers:[1],plurals:function(e){return 0}},mt:{name:"Maltese",numbers:[1,2,11,20],plurals:function(e){return Number(1==e?0:0===e||e%100>1&&11>e%100?1:e%100>10&&20>e%100?2:3)}},nah:{name:"Nahuatl",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nap:{name:"Neapolitan",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nb:{name:"Norwegian Bokmal",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ne:{name:"Nepali",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nl:{name:"Dutch",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nn:{name:"Norwegian Nynorsk",numbers:[1,2],plurals:function(e){return Number(1!=e)}},no:{name:"Norwegian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nso:{name:"Northern Sotho",numbers:[1,2],plurals:function(e){return Number(1!=e)}},oc:{name:"Occitan",numbers:[1,2],plurals:function(e){return Number(e>1)}},or:{name:"Oriya",numbers:[2,1],plurals:function(e){return Number(1!=e)}},pa:{name:"Punjabi",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pap:{name:"Papiamento",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pl:{name:"Polish",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e%10>=2&&4>=e%10&&(10>e%100||e%100>=20)?1:2)}},pms:{name:"Piemontese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ps:{name:"Pashto",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pt:{name:"Portuguese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pt_br:{name:"Brazilian Portuguese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},rm:{name:"Romansh",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ro:{name:"Romanian",numbers:[1,2,20],plurals:function(e){return Number(1==e?0:0===e||e%100>0&&20>e%100?1:2)}},ru:{name:"Russian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&4>=e%10&&(10>e%100||e%100>=20)?1:2)}},sah:{name:"Yakut",numbers:[1],plurals:function(e){return 0}},sco:{name:"Scots",numbers:[1,2],plurals:function(e){return Number(1!=e)}},se:{name:"Northern Sami",numbers:[1,2],plurals:function(e){return Number(1!=e)}},si:{name:"Sinhala",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sk:{name:"Slovak",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e>=2&&4>=e?1:2)}},sl:{name:"Slovenian",numbers:[5,1,2,3],plurals:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)}},so:{name:"Somali",numbers:[1,2],plurals:function(e){return Number(1!=e)}},son:{name:"Songhay",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sq:{name:"Albanian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sr:{name:"Serbian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&4>=e%10&&(10>e%100||e%100>=20)?1:2)}},su:{name:"Sundanese",numbers:[1],plurals:function(e){return 0}},sv:{name:"Swedish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sw:{name:"Swahili",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ta:{name:"Tamil",numbers:[1,2],plurals:function(e){return Number(1!=e)}},te:{name:"Telugu",numbers:[1,2],plurals:function(e){return Number(1!=e)}},tg:{name:"Tajik",numbers:[1,2],plurals:function(e){return Number(e>1)}},th:{name:"Thai",numbers:[1],plurals:function(e){return 0}},ti:{name:"Tigrinya",numbers:[1,2],plurals:function(e){return Number(e>1)}},tk:{name:"Turkmen",numbers:[1,2],plurals:function(e){return Number(1!=e)}},tr:{name:"Turkish",numbers:[1,2],plurals:function(e){return Number(e>1)}},tt:{name:"Tatar",numbers:[1],plurals:function(e){return 0}},ug:{name:"Uyghur",numbers:[1],plurals:function(e){return 0}},uk:{name:"Ukrainian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&4>=e%10&&(10>e%100||e%100>=20)?1:2)}},ur:{name:"Urdu",numbers:[1,2],plurals:function(e){return Number(1!=e)}},uz:{name:"Uzbek",numbers:[1,2],plurals:function(e){return Number(e>1)}},vi:{name:"Vietnamese",numbers:[1],plurals:function(e){return 0}},wa:{name:"Walloon",numbers:[1,2],plurals:function(e){return Number(e>1)}},wo:{name:"Wolof",numbers:[1],plurals:function(e){return 0}},yo:{name:"Yoruba",numbers:[1,2],plurals:function(e){return Number(1!=e)}},zh:{name:"Chinese",numbers:[1],plurals:function(e){return 0}}}},,,,function(e,t){e.exports={action_try_again:"Try again.",action_profile_setting:"Setting profile photo",action_profile_set:"Profile photo set",action_profile_set_failed:"Couldn't set profile photo.",
action_status_setting:"Changing status",action_status_set:"Status changed",action_status_set_failed:"Couldn't change status.",action_status_empty:"Status can't be empty",action_profile_removing:"Removing profile photo",action_profile_removed:"Profile photo removed",action_profile_remove_failed:"Couldn't remove profile photo.",action_chat_deleting:"Deleting chat",action_chat_deleted:"Chat deleted",action_chat_delete_failed:"Couldn't delete chat.",action_chat_archiving:"Archiving chat",action_chat_archived:"Chat archived",action_chat_archive_failed:"Couldn't archive chat.",action_chat_unarchiving:"Unarchiving chat",action_chat_unarchived:"Chat unarchived",action_chat_unarchive_failed:"Couldn't unarchive chat.",action_chat_marking_read:"Marking as read",action_chat_marked_read:"Marked as read",action_chat_mark_read_failed:"Mark as read failed",action_chat_marking_unread:"Marking as unread",action_chat_marked_unread:"Marked as unread",action_chat_mark_unread_failed:"Mark as unread failed",action_group_deleting:"Deleting group",action_group_deleted:"Group deleted",action_group_delete_failed:"Couldn't delete group.",action_broadcast_deleting:"Deleting broadcast list",action_broadcast_deleted:"Broadcast list deleted",action_broadcast_delete_failed:"Couldn't delete broadcast list.",action_participant_adding:"Adding __participant__",action_participant_added:"__participant__ added",action_participant_add_failed:"Couldn't add __participant__.",action_participant_removing:"Removing __participant__",action_participant_removed:"__participant__ removed",action_participant_remove_failed:"Couldn't remove __participant__.",action_participant_promoting:"Making __participant__ a group admin",action_participant_promoted:"__participant__ is now a group admin",action_participant_promote_failed:"Couldn't make __participant__ an admin.",action_participant_failed_401:"You're not an admin.",action_participant_failed_403:"You're not a participant.",action_participant_failed_404:"This group has ended.",action_group_creating:"Creating group",action_group_created:"Created group",action_group_create_failed:"Couldn't create group.",action_group_create_failed_406:"Please enter a shorter subject.",action_group_create_failed_participant:"Can't add more than __max__ participants",action_group_subject_empty:"Group subject can't be empty",action_group_icon_setting:"Setting group icon",action_group_icon_set:"Group icon set",action_group_icon_set_failed:"Couldn't set group icon.",action_group_icon_removing:"Removing group icon",action_group_icon_removed:"Group icon removed",action_group_icon_remove_failed:"Couldn't remove group icon.",action_group_exiting:"Exiting group",action_group_exited:"Exited group",action_group_exit_failed:"Couldn't exit group.",action_group_renaming:"Renaming group",action_group_renamed:"Group renamed to __subject__",action_group_rename_failed:"Couldn't rename group.",action_group_muting:"Muting group",action_group_muted:"Group muted",action_group_mute_failed:"Couldn't mute group.",action_group_unmuting:"Unmuting group",action_group_unmuted:"Group unmuted",action_group_unmute_failed:"Couldn't unmute group.",action_message_deleting:"Deleting message",action_message_deleted:"Message deleted",action_message_delete_failed:"Couldn't delete message",delete_message:"Delete message",intro_title:"Keep your phone connected",intro_connection:"WhatsApp Web connects to your phone to sync messages. To reduce data usage, connect your phone to Wi-Fi.",enumeration_comma:", ",archive_chat:"Archive chat",unarchive_chat:"Unarchive chat",mark_unread_chat:"Mark as unread",mark_read_chat:"Mark as read",forward_message:"Forward message",forward_message_to:"Forward message to",confirm_forward_to_group:"Forward to “__chat__”?",confirm_forward_to_contact:"Forward to __chat__?",message_author:"Message __author__",message:"Message",message_info:"Message info",message_info_played_by:"Played by",message_info_played:"Played",message_info_read_by:"Read by",message_info_read:"Read",message_info_delivered_to:"Delivered to",message_info_delivered:"Delivered",message_info_remaining:"__count__ remaining",message_info_remaining_plural:"__count__ remaining",copy_text:"Copy text",web_archive_broadcast:"Archive broadcast list",web_unarchive_broadcast:"Unarchive broadcast list",conversation_archived:"Conversation archived",broadcast_archived:"Broadcast list archived",group_archived:"Group archived",web_undo:"undo",web_menuitem_groupchat:"New group",web_menuitem_new:"New chat",menuitem_profile_status:"Profile & status",menuitem_send_logs:"Send logs",menuitem_help:"Help",menuitem_keep_me_signed_in:"Keep me signed in",menuitem_notification_sounds:"Notification sounds",menuitem_notifications:"Notifications",menuitem_logout:"Log out",menuitem_remove:"Remove",menuitem_make_group_admin:"Make group admin",menutitle_attach:"Attach",menutitle_menu:"Menu",web_settings_faq:"FAQ",if_unchecked_you_will_be_logged_out_afterawhile:"You'll be logged out after several minutes of inactivity",change_group_icon:"Change group icon",add_group_icon:"Add group icon",change_profile_photo:"Change profile photo",add_profile_photo:"Add profile photo",adjust_image:"Drag the image to adjust",done_adjusting:"Done",remove_profile_photo:"Remove your profile photo?",remove_group_icon:"Remove this group's icon?",delete_message_confirmation:"Delete message?",confirm_remove_group_participant:"Remove __participant__ from “__subject__” group?",confirm_add_group_participant:"Add __participant__ to “__subject__” group?",confirm_promote_group_participant:"Make __participant__ an admin for “__subject__” group?",remove:"Remove",conversation_unarchived:"Conversation unarchived",conversation_archive_failed:"Conversation archive failed",conversation_unarchive_failed:"Conversation unarchive failed",web_status:"Status",web_delete:"Delete",web_exit:"Exit",subject:"Subject",group_subject:"Group Subject",web_contact_phone:"Phone",web_group_creation_time:"Created __when__",group_participant_hint:"Type contact name",new_chat_flow_title:"New chat",new_group_flow_title:"New group",add_group_participants_title:"Add group participants",add_group_participant:"Add participant",already_added_to_group:"Already added to group",web_contact_info:"Contact info",broadcast_list_info:"Broadcast list info",web_group_info:"Group info",web_groups_participation_you_and_name:"Your groups with __user__",web_participants_title:"Participants",web_recipients_title:"Recipients",web_participants_count:"__count__ of __max__",cant_load_whatsapp:"Can't Load WhatsApp Web",computer_behind_proxy:"Your computer is connected to a network that prevents WhatsApp Web from working correctly",missing_photo_title:"Photo Unavailable",missing_photo_text:"Can’t view this photo because it's no longer on your phone.",missing_photo_forward_text:"Can’t forward this photo because it's no longer on your phone.",missing_video_title:"Video Unavailable",missing_video_text:"Can’t play this video because it's no longer on your phone.",missing_video_forward_text:"Can’t forward this video because it's no longer on your phone.",missing_audio_title:"Voice Message Unavailable",missing_audio_text:"Can’t play this Voice Message because it's no longer on your phone.",missing_audio_forward_text:"Can’t forward this Voice Message because it's no longer on your phone.",err_unsent_forward_title:"Can’t Forward Message",err_unsent_forward_text:"Make sure your message finishes sending and displays a checkmark before forwarding to another chat.",retry_upload_photo_title:"Couldn’t Send Photo",retry_upload_photo_text:"Open WhatsApp on your phone and resend this photo",retry_upload_video_title:"Couldn’t Send Video",retry_upload_video_text:"Open WhatsApp on your phone and resend this video",retry_upload_audio_title:"Couldn’t Send Voice Message",retry_upload_audio_text:"Open WhatsApp on your phone and resend this Voice Message",guide_desktop_notifications_title:"Allow notifications",guide_desktop_notifications_description:"To get notifications for new messages, click “Allow” above.",guide_desktop_notifications_description_firefox:"To get notifications for new messages, select “Always show notifications” from the prompt below the URL bar.",guide_desktop_camera_title:"Allow camera",guide_desktop_camera_description:"To take photos, click “Allow” above to give WhatsApp Web access to your computer's camera.",guide_desktop_camera_description_firefox:"To take photos, WhatsApp Web needs access to your computer’s camera. Select “Always share” from the prompt below the URL bar.",guide_desktop_mic_title:"Allow microphone",guide_desktop_mic_description:"To record Voice Messages, click “Allow” above to give WhatsApp Web access to your computer's microphone.",guide_desktop_mic_description_firefox:"To record Voice Messages, WhatsApp Web needs access to your computer’s microphone. Select “Always share” from the prompt below the URL bar. Note: selecting “Share selected device” won’t let you record Voice Messages.",guide_desktop_camera_fail_description:"To take photos, WhatsApp Web needs access to your computer's camera. Click __chrome_media_error__ in the URL bar and choose “Always allow web.whatsapp.com to access your camera.”",guide_desktop_camera_fail_description_firefox:"To take photos, WhatsApp Web needs access to your computer’s camera. Click __firefox_lock__ in the URL bar and set “Use the Camera” to “Allow.”",guide_desktop_camera_fail_description_opera:"To take photos, WhatsApp Web needs access to your computer’s camera. Click __opera_media__ in the URL bar and click “Clear This Setting and Reload.”",guide_desktop_mic_fail_description:"To record Voice Messages, WhatsApp Web needs access to your microphone. Click __chrome_media_error__ in the URL bar and choose “Always allow web.whatsapp.com to access your microphone.”",guide_desktop_mic_fail_description_firefox:"To record Voice Messages, WhatsApp Web needs access to your computer’s microphone. Click __firefox_lock__ in the URL bar and set “Use the Microphone” to “Allow.”",guide_desktop_mic_fail_description_opera:"To record Voice Messages, WhatsApp Web needs access to your computer’s microphone. Click __opera_media__ in the URL bar and click “Clear This Setting and Reload.”",guide_desktop_camera_missing_title:"Camera Not Found",guide_desktop_camera_missing_description:"You can’t take a photo because it looks like your computer doesn’t have a camera. Try connecting one or if you have one connected, try restarting your browser.",guide_desktop_mic_missing_title:"Microphone Not Found",guide_desktop_mic_missing_description:"You can’t record a Voice Message because it looks like your computer doesn’t have a microphone. Try connecting one or if you have one connected, try restarting your browser.",guide_help_title:"Help",guide_help_faq:"Click FAQ for help using WhatsApp Web.",guide_help_description_android:"To contact support, open WhatsApp on your phone and tap Menu – Settings – Help – Contact us.",guide_help_description_symbian:"To contact support, open WhatsApp on your phone and select Options – About – Contact support.",guide_help_description_bb:"To contact support, open WhatsApp on your phone and tap Settings – About – Contact support.",guide_help_description_bbx:"To contact support, open WhatsApp on your phone and swipe down from the top of the screen – Settings – Contact support.",guide_help_description_wp7:"To contact support, open WhatsApp on your phone and tap menu (three dots at the bottom of the screen) – Settings – About – Contact support.",guide_help_description_s40:"To contact support, open WhatsApp on your phone – swipe up from bottom – Settings – About – Options – Contact support.",guide_help_description_iphone:"To contact support, open WhatsApp on your phone and tap Settings – About – Contact Us.",turn_off_all_desktop_notifications_for:"Turn off all desktop notifications for:",learn_more:"Learn more",ok_got_it:"OK, got it",web_view:"View",web_preview_msg:"Preview",add_a_caption:"Add a caption…",add_media:"Add media",drag_media_here:"Drag media here",view_photo:"View photo",take_photo:"Take photo",remove_photo:"Remove photo",upload_photo:"Upload photo",invalid_media_files:"WhatsApp Web doesn't support the type of image or video you tried adding. Try adding a different one.",image_too_big:"The image you tried adding is larger than the 16MB limit. Try adding a different one.",video_too_big:"The video you tried adding is larger than the 16MB limit. Try adding a different one.",option_select_mute:"Turn off alerts and sounds for…",option_desktop_notifications:"Desktop Alerts",option_sounds:"Sounds",web_menuitem_mute_off:"Cancel mute",web_menuitem_mute:"Mute",group_muted:"Group muted",web_mute_time:"Mute group for…",web_list_info:"Broadcast list info",click_here_for_group_info:"click here for group info",click_here_for_user_info:"click here for contact info",web_delete_contact_dialog_title:"Delete chat with “__name__”?",web_delete_group_dialog_title:"Delete “__groupName__” group?",web_exit_group_dialog_title:"Exit “__groupName__” group?",delete_chat_dialog_title:"Delete chat with “__name__”?",delete_list_dialog_title:"Delete broadcast list?",are_you_sure:"Are you sure?",next_button:"Next",previous_button:"Previous",save_button:"Save",edit_button:"Edit",web_exit_group:"Exit group",web_delete_group:"Delete group",delete_chat:"Delete chat",web_delete_list:"Delete broadcast list",conversation_deleted:"Conversation deleted",broadcast_deleted:"Broadcast list deleted",group_deleted:"Group deleted",unread_message_count:"__count__ unread message",unread_message_count_plural:"__count__ unread messages",web_chats:"Chats",web_recent_chats:"Chats",web_groups:"Groups",web_contacts:"Contacts",web_conversation_is_composing:"typing…",web_conversation_is_recording:"recording audio…",web_conversation_contact_online:"online",web_conversation_name_is_composing:"__participant__ is typing…",web_conversation_name_is_recording:"__participant__ is recording audio…",web_conversations_most_recent_image:"Photo",web_conversations_most_recent_audio:"Audio",web_conversations_most_recent_voice:"Voice message",web_conversations_most_recent_video:"Video",web_conversations_most_recent_contact:"Contact",web_conversations_most_recent_location:"Location",search_no_chats_or_contacts:"No chats or contacts found",no_chats:"No chats",no_contacts:"No contacts",no_groups:"No groups",chat_archived:"Archived",all_chats_archived:"All chats are archived",web_group_admin:"Group Admin",contact_status_loading:"Loading status…",retry_now:"Retry Now",retake:"Retake",web_cancel:"Cancel",web_ok:"OK",web_close:"Close",web_share:"Share",web_button_download:"Download",trying_to_reach_phone:"Trying to reach phone",connecting_to_whatsapp:"Connecting to WhatsApp",connecting_to_whatsapp_or_phone:"Connecting",connecting:"Connecting…",updating_whatsapp_web_title:"Updating",updating_whatsapp_web:"WhatsApp Web is out of date. Updating now…",retrying:"Retrying…",retrying_in:"Retrying in __duration__…",loading_messages:"loading messages…",load_earlier_messages:"load earlier messages…",resend_message:"Click to resend",click_to_save_esc_to_cancel:"Click to save, ESC to cancel",web_today_at:"today at __time__",web_yesterday_at:"yesterday at __time__",web_time_at:"__date__ at __time__",web_conversation_last_seen_today:"last seen today at __time__",web_conversation_last_seen_yesterday:"last seen yesterday at __time__",web_conversation_last_seen_date:"last seen __date__ at __time__",web_you:"You",web_today:"today",web_yesterday:"yesterday",retrying_in_some_seconds:"Retrying in __number__ second…",retrying_in_some_seconds_plural:"Retrying in __number__ seconds…",web_you_created_list_unnamed:"You created a broadcast list with __count__ recipient",web_you_created_list_unnamed_plural:"You created a broadcast list with __count__ recipients",web_list_recipient_added:"__name__ added to the list",web_list_recipient_removed:"__name__ removed from the list",web_group_subject_changed_by_you:"You changed the subject to “__subject__”",web_group_subject_changed_by_name:"__name__ changed the subject to “__subject__”",web_group_participant_added_name:"__name__ was added",web_group_participant_added_you:"You were added",web_group_participant_removed_name:"__name__ was removed",web_group_participant_removed_you:"You were removed",web_group_participant_left_name:"__name__ left",web_group_participant_left_you:"You left",web_group_participant_changed_number:"__name__ changed from __old_number__ to __new_number__",web_group_participant_changed_number_unknown_name:"__name__ changed to __new_number__",web_group_participants_name_added_names:"__name__ added __participants__",web_group_participants_you_added_names:"You added __participants__",web_group_participants_name_removed_names:"__name__ removed __participants__",web_group_participants_you_removed_names:"You removed __participants__",web_group_participants_name_added_you:"__name__ added you",web_group_participants_name_removed_you:"__name__ removed you",web_group_participant_promoted_names:"__participants__ is now an admin",web_group_participant_promoted_names_plural:"__participants__ are now admins",web_group_participant_demoted_names:"__participants__ is no longer an admin",web_group_participant_demoted_names_plural:"__participants__ are no longer admins",web_group_participant_promoted_you:"You're now an admin",web_group_participant_demoted_you:"You're no longer an admin",web_group_created_by_you:"You created group “__subject__”",web_group_created_by_name:"__name__ created group “__subject__”",web_group_created_by_you_no_subject:"You created this group",web_group_created_by_name_no_subject:"__name__ created this group",web_group_ended_you:"You ended this group",web_group_ended_name:"__name__ ended this group",web_photo_changed_by:"__name__ changed this group's icon",web_photo_removed_by:"__name__ deleted this group's icon",web_photo_changed_by_you:"You changed this group's icon",web_photo_removed_by_you:"You deleted this group's icon",web_mute_8hours:"8 Hours",web_mute_1week:"1 Week",web_mute_1year:"1 Year",mute_1hour:"1 Hour",mute_1day:"1 Day",mute_1week:"1 Week",global_muted:"Alerts and sounds off",global_muted_1hour:"Alerts and sounds off for 1 hour",global_muted_1day:"Alerts and sounds off for 1 day",global_muted_1week:"Alerts and sounds off for 1 week",global_notification_sounds_on:"Notification sounds on",global_notification_sounds_off:"Notification sounds off",global_unmuted:"Notifications enabled",global_unmute:"Alerts and sounds off. Click to restore.",web_cannot_send_not_a_group_participant:"You can't send messages to this group because you're no longer a participant.",web_cannot_send_to_blocked_contact_1:"Can't send a message to blocked contact __contact__.",type_a_message:"Type a message",whatsapp_web:"WhatsApp Web",default_group_message_notification_title:"WhatsApp group message",incoming_call_notification_title:"WhatsApp Call from __name__",incoming_call_notification_text:"Check your phone to answer",default_contact_message_notification_title:"WhatsApp message",search_or_start_new_chat:"Search or start new chat",search_contacts:"Search contacts",search:"Search…",update_available:"Update Available",click_to_update_whatsapp_web:"Click to update WhatsApp Web",phone_battery_low:"Phone Battery Low",charge_phone_description:"Charge your phone to keep using WhatsApp Web",computer_not_connected:"Computer Not Connected",make_sure_computer_active_internet_connection:"Make sure your computer has an active Internet connection",check_internet_connection:"No Internet connection",phone_not_connected:"Phone Not Connected",make_sure_phone_active_internet_connection:"Make sure your phone has an active Internet connection.",enable_desktop_notifications:"Turn on desktop notifications",get_notified_of_new_messages:"Get Notified of New Messages",phone_has_another_active_webclient_session:"WhatsApp Web is open on another computer or browser. Click “Use Here” to use WhatsApp Web in this window.",whatsapp_web_is_open_in_another_window:"WhatsApp Web is open in another window. Click “Use Here” to use WhatsApp Web in this window.",button_use_here:"Use Here",open_whatsapp:"Open WhatsApp",click_to_reload_qr_code:"Click to reload QR code",scan_code_with_phone_to_login:"Use WhatsApp on your phone to scan the code",reduce_data_usage_connect_phone_to_wifi:"To reduce data usage, connect your phone to Wi-Fi",android:"Android",android_login_path:"Open WhatsApp — Menu — WhatsApp Web",blackberry:"BlackBerry",blackberry_login_path:"Open WhatsApp — Chats — Menu key — WhatsApp Web",windows_phone:"Windows Phone",windows_phone_login_path:"Open WhatsApp — Menu — WhatsApp Web",nokia_symbian_s60:"Nokia S60",nokia_symbian_s60_login_path:"Open WhatsApp — Menu — WhatsApp Web",nokia_s40:"Nokia S40",nokia_s40_login_path:"Open WhatsApp – Swipe up from bottom of screen – WhatsApp Web",bb10:"BlackBerry 10",bb10_login_path:"Open WhatsApp — Swipe down from top of screen — WhatsApp Web",iphone:"iPhone",iphone_login_path:"Open WhatsApp — Settings — WhatsApp Web",login_hint_version:"Requires the latest version of WhatsApp",message_too_large_title:"Message Too Long",message_too_large_text:"The message you’re pasting is too long. Try shortening it or sending it in multiple parts.",video_playback_not_supported:"Your browser doesn’t support video playback.",audio_playback_not_supported:"Your browser doesn’t support audio playback.",whatsapp_web_meta_description:"Quickly send and receive WhatsApp messages right from your computer.",whatsapp_web_description:"Send and receive WhatsApp messages right from your computer.",whatsapp_web_requirements:"We recommend using WhatsApp Web with one of the following browsers:",whatsapp_web_supports:"WhatsApp Web also supports:",update_safari:"Update Safari",get_safari:"Safari (MacOS 10.8+ Only)",get_google_chrome:"Google Chrome",update_google_chrome:"Update Google Chrome",get_mozilla_firefox:"Mozilla Firefox",update_mozilla_firefox:"Update Mozilla Firefox",get_opera:"Opera",whatsapp_safari_version:"WhatsApp Web works with Safari 7.1+",whatsapp_safari_instructions:"To use WhatsApp Web, update Safari or use __chrome_homepage__, __firefox_homepage__, or __opera_homepage__.",whatsapp_safari_limited_title:"Using Safari",whatsapp_safari_limited:"To use all of WhatsApp Web's features like photo capturing and Voice Message recording, we recommend using __chrome_homepage__, __firefox_homepage__ or __opera_homepage__.",whatsapp_firefox_version:"WhatsApp Web works with Mozilla Firefox 30+",whatsapp_firefox_instructions:"To use WhatsApp Web, update Firefox or use __chrome_homepage__, __safari_homepage__, or __opera_homepage__.",whatsapp_chrome_version:"WhatsApp Web works with Google Chrome 36+",whatsapp_chrome_instructions:"To use WhatsApp Web, update Chrome or use __firefox_homepage__, __safari_homepage__, or __opera_homepage__.",filesize_byte:"B",filesize_kilobyte:"kB",filesize_megabyte:"MB",filesize_gigabyte:"GB",confirm_closing_webclient:"You are closing WhatsApp Web.",confirm_logout:"Log out?",some_of_your_messages_are_still_sending:"Some of your messages are still sending."}},function(e,t){e.exports={ar:"ar",az:"az",bg:"bg",bn:"bn",ca:"ca",cs:"cs",da:"da",de:"de",el:"el",en:"en",es:"es",et:"et",fa:"fa",fi:"fi",fil:"fil",fr:"fr",gu:"gu",he:"he",hi:"hi",hr:"hr",hu:"hu",id:"id",it:"it",ja:"ja",lt:"lt",lv:"lv",mk:"mk",ms:"ms",nb:"nb",nl:"nl",pl:"pl",pt:"pt",pt_br:"pt-BR",pt_zz:"pt-BR",ro:"ro",ru:"ru",sl:"sl",sq:"sq",sr:"sr",sv:"sv",sw:"sw",ta:"ta",th:"th",tr:"tr",uk:"uk",uz:"uz",vi:"vi",zh_cn:"zh-CN",zh_hk:"zh-TW",zh_sg:"zh-CN",zh_tw:"zh-TW"}},function(e,t,r){function n(e){return r(i(e))}function i(e){return o[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var o={"./af/translation.json":272,"./ar/translation.json":275,"./az/translation.json":277,"./be/translation.json":279,"./bg/translation.json":281,"./bn/translation.json":283,"./bs/translation.json":285,"./ca/translation.json":287,"./cs/translation.json":289,"./da/translation.json":291,"./de/translation.json":293,"./el/translation.json":295,"./en/translation.json":297,"./es/translation.json":298,"./et/translation.json":300,"./eu/translation.json":302,"./fa/translation.json":304,"./fi/translation.json":306,"./fil/translation.json":308,"./fr/translation.json":310,"./gl/translation.json":312,"./gu/translation.json":314,"./he/translation.json":316,"./hi/translation.json":318,"./hr/translation.json":320,"./hu/translation.json":322,"./id/translation.json":324,"./is/translation.json":326,"./it/translation.json":328,"./ja/translation.json":330,"./ka/translation.json":332,"./kk/translation.json":334,"./km/translation.json":336,"./kn/translation.json":338,"./ko/translation.json":340,"./ky/translation.json":342,"./lo/translation.json":344,"./lt/translation.json":346,"./lv/translation.json":348,"./mk/translation.json":350,"./ml/translation.json":352,"./mr/translation.json":354,"./ms/translation.json":356,"./my/translation.json":358,"./nb/translation.json":360,"./ne/translation.json":362,"./nl/translation.json":364,"./nn/translation.json":366,"./pa/translation.json":368,"./pl/translation.json":370,"./ps/translation.json":372,"./pt-BR/translation.json":374,"./pt-ZZ/translation.json":376,"./pt/translation.json":378,"./ro/translation.json":380,"./ru/translation.json":382,"./si/translation.json":384,"./sk/translation.json":386,"./sl/translation.json":388,"./sq/translation.json":390,"./sr/translation.json":392,"./sv/translation.json":394,"./sw/translation.json":396,"./ta/translation.json":398,"./te/translation.json":400,"./th/translation.json":402,"./tr/translation.json":404,"./uk/translation.json":406,"./ur/translation.json":408,"./uz/translation.json":410,"./vi/translation.json":412,"./zh-CN/translation.json":414,"./zh-TW/translation.json":416,"./zu/translation.json":418};n.keys=function(){return Object.keys(o)},n.resolve=i,e.exports=n,n.id=271},function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(1,function(t){e(r(274))})})}},,,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(2,function(t){e(r(276))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(3,function(t){e(r(278))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(4,function(t){e(r(280))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(5,function(t){e(r(282))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(6,function(t){e(r(284))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(7,function(t){e(r(286))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(8,function(t){e(r(288))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(9,function(t){e(r(290))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(10,function(t){e(r(292))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(11,function(t){e(r(294))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(12,function(t){e(r(296))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){!function(t){e(r(269))}(r)})}},function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(13,function(t){e(r(299))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(14,function(t){e(r(301))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(15,function(t){e(r(303))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(16,function(t){e(r(305))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(17,function(t){e(r(307))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(18,function(t){e(r(309))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(19,function(t){e(r(311))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(20,function(t){e(r(313))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(21,function(t){e(r(315))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(22,function(t){e(r(317))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(23,function(t){e(r(319))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(24,function(t){e(r(321))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(25,function(t){e(r(323))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(26,function(t){e(r(325))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(27,function(t){e(r(327))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(28,function(t){e(r(329))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(29,function(t){e(r(331))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(30,function(t){e(r(333))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(31,function(t){e(r(335))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(32,function(t){e(r(337))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(33,function(t){e(r(339))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(34,function(t){e(r(341))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(35,function(t){e(r(343))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(36,function(t){e(r(345))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(37,function(t){e(r(347))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(38,function(t){e(r(349))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(39,function(t){e(r(351))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(40,function(t){e(r(353))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(41,function(t){e(r(355))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(42,function(t){e(r(357))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(43,function(t){e(r(359))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(44,function(t){e(r(361))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(45,function(t){e(r(363))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(46,function(t){e(r(365))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(47,function(t){e(r(367))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(48,function(t){e(r(369))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(49,function(t){e(r(371))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(50,function(t){e(r(373))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(51,function(t){e(r(375))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(52,function(t){e(r(377))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(53,function(t){e(r(379))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(54,function(t){e(r(381))})})}},,function(e,t,r){
var n=r(273);e.exports=function(){return new n(function(e){r.e(55,function(t){e(r(383))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(56,function(t){e(r(385))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(57,function(t){e(r(387))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(58,function(t){e(r(389))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(59,function(t){e(r(391))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(60,function(t){e(r(393))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(61,function(t){e(r(395))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(62,function(t){e(r(397))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(63,function(t){e(r(399))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(64,function(t){e(r(401))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(65,function(t){e(r(403))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(66,function(t){e(r(405))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(67,function(t){e(r(407))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(68,function(t){e(r(409))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(69,function(t){e(r(411))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(70,function(t){e(r(413))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(71,function(t){e(r(415))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(72,function(t){e(r(417))})})}},,function(e,t,r){var n=r(273);e.exports=function(){return new n(function(e){r.e(73,function(t){e(r(419))})})}},,,,,,,,,,,,,,,function(e,t,r){function n(){var e=Store.Conn.get(1);if(!e)return!1;if(!e.connected)return!1;var t=r(574),n=Store.Msg.any(function(e){return 0===e.ack&&e.local&&e.isSentByMe}),i=Store.Chat.any(function(e){return!!e.composeText});return n||i||t.hasText}var i=r(14),o=r(434),a=r(442),s=r(444),c=r(445),d=r(446),u=r(443),l=r(447),p=r(4),h=r(144),f=r(595),m=r(596),g=r(20),v=r(240),y=r(150),b=r(467),E=r(435),R=r(438),w=r(143),S=r(579),T=r(162),C=r(161),N={INIT:"init",PING:"ping",PONG:"pong",TAKEOVER:"local-takeover"},I=6e5,P=React.createClass({displayName:"App",mixins:[b,E,R],statics:{hasPending:n},getInitialState:function(){return this.regNativeListener(window,"beforeunload",this.unloadMutex),this.regNativeListener(window,"unload",this.unloadMutex),this.regNativeListener(window,"storage",this.storagePong),{mode:v.mode,updating:!1,anotherSession:!1,takingOver:!1,day:moment().format("l"),locale:_.first(l10n._locales)}},clearMutexTimer:function(){this.updateMutexTimerID&&T.clearTimeout(this.updateMutexTimerID)},updateMutex:function(){this.clearMutexTimer();var e=Date.now();w.setMutex(this.ourMutex=N.INIT+"_"+e),this.updateMutexTimerID=T.setTimeout(this.updateMutex,e+I)},unloadMutex:function(){var e=w.getMutex();e&&this.ourMutex&&e.indexOf(this.ourMutex)>-1&&w.removeMutex()},componentWillMount:function(){var e=Wa.missingCapabilities();if(e.length>0){var t=p.CAPABILITY_URL+"?missing="+e.join(",");window.location.replace?window.location.replace(t):window.location.href=t}this.addObserver(C,"change:mode",this.onUpdaterModeChange),this.addObserver(v,"change:mode",this.onStreamModeChange);var r=this;this.regCmd("locale_change",function(){i.log("App:componentWillMount:rerenderUI locale change")(),r.setState({locale:_.first(l10n._locales)})}),S.loadInitialAssets().then(function(){i.log("App:componentWillMount:loadInitialAssets")()}),this.registerYesterdayTimer(),this.init(0)},registerYesterdayTimer:function(){var e=this;T.setTimeout(function(){i.log("App:registerYesterdayTimer:rerenderUI relative timestamps")(),e.setState({day:moment().format("l")}),e.registerYesterdayTimer()},moment().endOf("day").valueOf())},onStreamModeChange:function(){this.setState({mode:v.mode})},onUpdaterModeChange:function(){C.mode===C.Mode.IDLE||g.hasSynced||this.setState({updating:!0})},init:function(e){var t=this;if(e+=1,e>3)return void this.setState({takingOver:!1,anotherSession:!0});var r=w.getNoTakeover();w.setNoTakeover(),g.preload(),this.pingForOtherLocalSession().then(function(n){n?(w.maybeMigrate(),t.updateMutex(),g.launch(!r),t.setState({takingOver:!1,anotherSession:!1})):r?t.setState({takingOver:!1,anotherSession:!0}):t.takeoverLocal(e)})},pingForOtherLocalSession:function(){var e=w.getMutex();if(e){e+="";var t=1e4;if(e.indexOf("_")>0&&(e=parseInt(_.last(e.split("_")),10),_.isFinite(e))){var r=Date.now()-1.5*I;r>e&&(i.log("app:pingForOtherLocalSession stale mutex")(),t=1e3)}var n=y.waitForEvent(window,"storage",w.mutexFilter).timeout(t,"waitForOtherLocalSessionTimeout")["return"](!1)["catch"](Promise.TimeoutError,function(e){return!0});return w.setMutex(N.PING+Math.random()),n}return Promise.resolve(!0)},storagePong:function(e){if(w.mutexFilter(e)){var t=w.parseMutex(e.newValue);t===N.TAKEOVER?(this.clearMutexTimer(),g.exitLoop(),w.localTakeoverSuccess(),this.setState({takingOver:!1,anotherSession:!0})):0===t.indexOf(N.PING)&&w.setMutex(N.PONG+Math.random())}},takeoverLocal:function(e){if(w.compareVersion()<0)return i.log("app:takeoverLocal stale client: "+w._version()+" ls: "+w._getLSVersion())(),document.location.reload(!0);if(w.getMutex()){this.setState({takingOver:!0});var t=this;y.waitForEvent(window,"storage",w.takeoverFilter).timeout(3e4,"takeoverLocalTimeout").then(function(r){var n=w.parseTakeover(r.newValue);w.getRememberMe()||w._setAllKeyValues(n),w.removeMutex(),t.init(e)})["catch"](Promise.TimeoutError,function(r){w.removeMutex(),t.init(e)}),w.setMutex(N.TAKEOVER)}else this.init(e)},getRenderKey:function(){return[this.state.locale,this.state.day].join("-")},onMouseDown:function(e){h.windowMouseDown(e)},onClick:function(e){h.windowClick(e)},render:function(){var e,t="app-wrapper";if(this.state.updating)e=React.createElement(u,{body:l10n.t("updating_whatsapp_web"),title:l10n.t("updating_whatsapp_web_title")});else if(this.state.anotherSession){var r,n;if(this.state.takingOver)r=_.noop,n=l10n.t("connecting");else{var p=this;r=function(){p.takeoverLocal(0)},n=l10n.t("button_use_here")}e=React.createElement(u,{body:l10n.t("whatsapp_web_is_open_in_another_window"),cancelLabel:l10n.t("web_close"),onCancel:window.open.bind(window,"http://www.whatsapp.com/","_self"),defaultLabel:n,onDefault:r})}else switch(this.state.mode){case v.MODE.QR:e=[React.createElement(f,{key:"modal-manager"}),React.createElement(o,{key:"qr-code"})];break;case v.MODE.SYNCING:e=React.createElement(a,null);break;case v.MODE.OFFLINE:e=React.createElement(s,null);break;case v.MODE.PROXYBLOCK:e=React.createElement(c,null);break;case v.MODE.CONFLICT:e=React.createElement(d,null);break;case v.MODE.MAIN:e=[React.createElement(f,{key:"modal-manager"}),React.createElement(m,{type:"menu",key:"context-menu-manager"}),React.createElement(m,{type:"tooltip",key:"tooltip-manager"}),React.createElement(l,{key:"main",conn:Store.Conn.get(1)})],t+=" app-wrapper-main";break;default:i.log("app:render Error invalid App state",this.state.mode)()}return React.createElement("div",{className:t,onMouseDownCapture:this.onMouseDown,onClickCapture:this.onClick,key:this.getRenderKey()},e)}});e.exports=P},function(e,t,r){var n=r(20),i=r(143),o=r(435),a=r(203),s=r(436),c=r(4),d=r(144),u=r(437),l=r(243),p=r(153),h=r(166),f=r(440),m=window.QRCode,g=React.createClass({displayName:"QRCode",mixins:[o],getInitialState:function(){return{rememberMe:i.getRememberMe(),expired:n.state===n.STATE.UNPAIRED_IDLE,offline:!n.online,refValid:n.state===n.STATE.UNPAIRED}},componentDidMount:function(){this.addObserver(n,"change:state change:online",this.onStateChange)},onStateChange:function(){this.setState({offline:!n.online,expired:n.state===n.STATE.UNPAIRED_IDLE,refValid:n.state===n.STATE.UNPAIRED})},onQRExpiry:function(){this.setState({ref:void 0}),n.poke()},onRememberMeChange:function(e){n.isIncognito||a.setRememberMe(e.target.checked)["catch"](_.noop),i.setRememberMe(e.target.checked),this.setState({rememberMe:i.getRememberMe()})},render:function(){var e=Store.Conn.get(1),t=void 0;t=this.state.offline?React.createElement(v,{conn:e},React.createElement("button",{className:"qr-button",key:"expiry"},React.createElement("div",{className:"icon icon-connection-l-light"}),l10n.t("check_internet_connection"))):this.state.expired?React.createElement(v,{conn:e},React.createElement("button",{className:"qr-button",key:"expiry",onClick:this.onQRExpiry},React.createElement("div",{className:"qr-container"},React.createElement("div",{className:"icon icon-refresh-l-light"}),l10n.t("click_to_reload_qr_code")))):this.state.refValid?React.createElement(v,{conn:e}):React.createElement("div",{className:"qrcode"},React.createElement(s,null));var r=this.state.rememberMe?null:React.createElement("div",{className:"remember-me-tip"},l10n.t("if_unchecked_you_will_be_logged_out_afterawhile"));return React.createElement("div",{id:"wrapper"},React.createElement("div",{id:"window"},React.createElement("div",{className:"entry-main"},t,React.createElement("div",{className:"entry-text"},React.createElement("div",{className:"entry-title"},l10n.t("whatsapp_web")),React.createElement("div",{className:"entry-subtitle"},l10n.t("scan_code_with_phone_to_login")),React.createElement("div",{className:"entry-controls"},React.createElement("div",{className:"toggle"},React.createElement(f,{transitionName:"fade_sifo"},r),React.createElement("label",null,React.createElement("input",{type:"checkbox",name:"rememberMe",checked:this.state.rememberMe,onChange:this.onRememberMeChange}),l10n.t("menuitem_keep_me_signed_in"))),React.createElement("div",{className:"hint"},l10n.t("reduce_data_usage_connect_phone_to_wifi"))))),React.createElement("div",{id:"platforms"},React.createElement("ul",{className:"list entry-platforms"},React.createElement(y,{platform:"android",path:l10n.t("android_login_path"),name:l10n.t("android")}),React.createElement(y,{platform:"iphone",path:l10n.t("iphone_login_path"),name:l10n.t("iphone")}),React.createElement(y,{platform:"wp",path:l10n.t("windows_phone_login_path"),name:l10n.t("windows_phone")}),React.createElement(y,{platform:"bb",path:l10n.t("blackberry_login_path"),name:l10n.t("blackberry")}),React.createElement(y,{platform:"bb10",path:l10n.t("bb10_login_path"),name:l10n.t("bb10")}),React.createElement(y,{platform:"s60",path:l10n.t("nokia_symbian_s60_login_path"),name:l10n.t("nokia_symbian_s60")}),React.createElement(y,{platform:"s40",path:l10n.t("nokia_s40_login_path"),name:l10n.t("nokia_s40")})),React.createElement("p",{className:"hint"},l10n.t("login_hint_version")))))}}),v=React.createClass({displayName:"QR",mixins:[o],propTypes:{conn:React.PropTypes.instanceOf(l),children:React.PropTypes.element},getInitialState:function(){return{data:this.getData(),disableCursor:!1}},componentDidMount:function(){this.props.conn&&this.addObserver(this.props.conn,"change:ref",this.createData),this.initialize(this.state.data)},componentWillReceiveProps:function(e){var t=e.conn,r=this.props.conn;t!==r&&(r&&this.removeObserver(r,this.createData),t?this.addObserverAndRun(t,this.createData):this.setState({data:void 0}))},componentWillUpdate:function(e,t){t.data!==this.state.data&&this.initialize(t.data)},initialize:function(e){if(e){var t=this.getDOMNode();this.qr?this.qr.makeCode(e):this.qr=new m(t,{text:e,colorDark:"#122e31",width:c.QR_EDGE,height:c.QR_EDGE,correctLevel:m.CorrectLevel.L}),t.removeAttribute("title"),t.setAttribute("data-ref",e)}},createData:function(){this.setState({data:this.getData()})},getData:function(){var e=this.props.conn;if(!e||e.connected)return void 0;var t=e.ref,r=Wa.generateSecretBundle(),n=Wa.getBrowserId();return t+","+r+","+n},copy:function(){var e=window.getSelection();e.selectAllChildren(document.getElementById("qr-code-copy")),document.execCommand("copy"),d.closeModal()},onMouseMove:function(e){var t=this;this.state.disableCursor&&this.setState({disableCursor:!1}),this.disableCursorPromise&&this.disableCursorPromise.cancel(),this.disableCursorPromise=p.delay(1e3).cancellable().then(function(e){t.isMounted()&&t.setState({disableCursor:!0})})["catch"](Promise.CancellationError,_.noop)["finally"](function(){t.isMounted()&&(t.disableCursorPromise=void 0)})},onMouseLeave:function(e){this.disableCursorPromise&&this.disableCursorPromise.cancel()},onContextMenu:function(e){e.stopPropagation(),e.preventDefault(),d.openModal(React.createElement(u,{onOK:this.copy,okText:"Copy to Clibboard"},React.createElement("span",{id:"qr-code-copy"},this.state.data)))},render:function(){var e=this.props.children,t=h("qrcode",{idle:!!e}),r={};this.state.disableCursor&&!e&&(r.cursor="none");var n=null;return React.createElement("div",{className:t,onContextMenu:n,style:r,onMouseMove:this.onMouseMove,onMouseLeave:this.onMouseLeave},React.createElement(f,{transitionName:"scale"},e),React.createElement("span",{className:"icon icon-logo"}))}}),y=React.createClass({displayName:"LoginPlatform",propTypes:{platform:React.PropTypes.oneOf(["android","iphone","bb","wp","bb10","s60","s40"]).isRequired,name:React.PropTypes.string.isRequired,path:React.PropTypes.string.isRequired},render:function(){var e="icon icon-platform icon-platform-"+this.props.platform;return React.createElement("li",{className:"list-item entry-platform"},React.createElement("span",{className:e,title:this.props.name}),React.createElement("div",null,React.createElement("div",{className:"entry-platform-title"},this.props.name),React.createElement("div",{className:"entry-platform-text"},this.props.path)))}});e.exports=g},function(e,t,r){var n=r(109),i={componentWillMount:function(){this._observer=n.createEmitter()},getInitialState:function(){return{_observedStateIndex:0}},addObserver:function(e,t,r){if(!this._isObservable(e))throw Error("Attempting to observe non-observable object");this._observer.listenTo(e,t,this._cbWrapper(r)),e.isState&&e._uiObservers++},addObserverAndRun:function(e,t,r){this.addObserver(e,t,r);var n=this._cbWrapper(r);n(e,t)},removeObserver:function(e,t){if(!this._isObservable(e))throw Error("Attempting to observe non-observable object");this._observer.stopListening(e,t),e.isState&&e._uiObservers--},_cbWrapper:function(e){var t=this;return function(){return t.isMounted()?_.isFunction(e)?e.apply(t,arguments):t.setState({_observedStateIndex:t.state._observedStateIndex+1}):void 0}},_isObservable:function(e){return e?_.isFunction(e.trigger):!1},componentWillUnmount:function(){var e=this._observer._listeningTo;for(var t in e){var r=e[t];r.isState&&r._uiObservers--}this._observer.stopListening()}};e.exports=i},function(e,t,r){function n(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(166),a=20,s=React.createClass({displayName:"Spinner",propTypes:{size:React.PropTypes.number.isRequired,stroke:React.PropTypes.number.isRequired},getDefaultProps:function(){return{size:65,stroke:4}},shouldComponentUpdate:function(e,t){return!1},render:function(){var e=this.props,t=e.size,r=e.stroke,s=e.className,c=n(e,["size","stroke","className"]),d={width:t,height:t},u=2*a+r,l="0 0 "+u+" "+u;return React.createElement("svg",i({className:o("spinner-container",s),style:d,viewBox:l},c),React.createElement("circle",{className:"path",cx:u/2,cy:u/2,r:a,fill:"none",strokeWidth:r}))}});e.exports=s},function(e,t,r){var n=r(438),i=React.createClass({displayName:"ConfirmPopup",mixins:[n],propTypes:{classes:React.PropTypes.string,onCancel:React.PropTypes.func,cancelText:React.PropTypes.string,onOK:React.PropTypes.func,okText:React.PropTypes.string,children:React.PropTypes.node.isRequired,title:React.PropTypes.node,a8n:React.PropTypes.string},getDefaultProps:function(){return{classes:"",cancelText:l10n.t("web_cancel"),okText:l10n.t("web_ok")}},componentDidMount:function(){if(this.props.onOK){var e=this;this.regNativeListener(window,"keydown",function(t){13===t.keyCode&&(t.stopPropagation(),t.preventDefault(),e.props.onOK())})}},render:function(){var e=this.props.onOK?React.createElement("button",{"data-a8n":Wa.a8n("popup-controls-ok"),className:"btn-plain btn-default popup-controls-item",onClick:this.props.onOK},this.props.okText):null,t=this.props.onCancel?React.createElement("button",{className:"btn-plain popup-controls-item",onClick:this.props.onCancel},this.props.cancelText):null,r=this.props.title?React.createElement("div",{"data-a8n":Wa.a8n("popup-title"),className:"popup-title"},this.props.title):null;return React.createElement("div",{className:"backdrop"},React.createElement("div",{className:"popup-container"},React.createElement("div",{className:"popup "+this.props.classes},React.createElement("div",{className:"popup-body"},r,React.createElement("div",{"data-a8n":Wa.a8n("popup-contents"),className:"popup-contents"},this.props.children)),React.createElement("div",{className:"popup-controls"},t,e))))}});e.exports=i},function(e,t,r){var n=r(14),i=r(439),o={_nativeEventSafeIsMounted:function(){return this.isMounted()&&"UNMOUNTING"!==this._compositeLifeCycleState},getEvents:function(){return this._events||(this._events=[]),this._events},regNativeListener:function(e,t,r,n){if(!_.isFunction(r))throw Error("handler is not a function");t=i.prefix(t,e);var o=this,a=function(){return o._nativeEventSafeIsMounted()?r.apply(null,arguments):void 0};this.getEvents().push({src:e,evnt:t,handler:r,fn:a,capture:n}),this.isMounted()&&e.addEventListener(t,a,n)},unregNativeListener:function(e,t,r,o){t=i.prefix(t,e);var a=_.matches({src:e,evnt:t,handler:r,capture:o}),s=_.find(this.getEvents(),a);s?(this._events=_.without(this._events,s),s.src.removeEventListener(s.evnt,s.fn,s.capture)):n.log("nativeEventMixin:unregNativeListener unreg could not find event:"+t,"red")()},unregisterListeners:function(){this._events&&(this.getEvents().forEach(function(e){e.src.removeEventListener(e.evnt,e.fn,e.capture)}),delete this._events)},componentDidMount:function(){this._events&&this.getEvents().forEach(function(e){e.src.addEventListener(e.evnt,e.fn,e.capture)})},componentWillUnmount:function(){this.unregisterListeners()}};e.exports=o},function(e,t){var r="animation",n="transition",i={_normalize:function(e,t,r){var n=e.toLowerCase().indexOf(t),i=e.slice(0,n).toLowerCase();return 0===e.indexOf(t)?i+e.slice(n)+r.toLowerCase():i+e.slice(n)+r},prefix:function(e,t){var i;return 0===e.indexOf(r)?(i=e.substring(r.length),this._normalize(window.Modernizr.prefixed(r),r,i)):0===e.indexOf(n)?(i=e.substring(n.length),this._normalize(window.Modernizr.prefixed(n),n,i)):window.Modernizr.prefixed(e,t,!1)||e}};e.exports=i},function(e,t,r){var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=r(14),o=r(441),a=r(144),s=React.addons.TransitionGroup,c=React.createClass({displayName:"VelocityTransitionGroupChild",propTypes:{transitionName:React.PropTypes.string.isRequired,delay:React.PropTypes.number},_getTransition:function(){return o[this.props.transitionName]||i.log("TransitionName "+this.props.transitionName+" wasn't found in VelocityTransitionGroupChild transitions.")(),o[this.props.transitionName]||o["default"]},componentWillEnter:function(e){var t=this._getTransition();this.animateTransitions(t.enter)["finally"](this._cbWrapper(e))},componentWillLeave:function(e){var t=this._getTransition();this.animateTransitions(t.leave)["finally"](this._cbWrapper(e))},_cbWrapper:function(e){var t=this;return function(){return t.isMounted()&&_.isFunction(e)?e():void 0}},animateTransitions:function(e){var t=this._getTransition();if(!t||!e)return Promise.resolve();var r=this.getDOMNode(),n=this.props.delay,o=_.omit(t,"leave","enter"),s={},c=React.Children.only(this.props.children);e=_.filter(_.forceArray(e),function(e){if(_.isString(e.selector)||s[e.selector]){var t=r.querySelectorAll(e.selector);if(!t.length)return!1;s[e.selector]=t}return!0}),c.props.staggerDelay||n||_.forEach(e,function(e){if(!e.delay&&!o.delay){var t=e.selector?s[e.selector]:r;_.forEach(e.props,function(e,r){_.isArray(e)&&Velocity.hook(t,r,e[1])})}}),a.setUiBusy(!0);var d=this;return Promise.map(e,function(e){var t=e.selector?s[e.selector]:r,a=Velocity(t,e.props,{easing:e.easing||o.easing||"easeInSine",duration:e.duration||o.duration||0,delay:c.props.staggerDelay||n||e.delay||o.delay||0,queue:o.queue||!1,stagger:e.stagger||!1,drag:e.drag||!1});return a?a.then(function(){o.cleanOnComplete&&(_.isArray(t)?_.forEach(t,function(e){e.removeAttribute("style")}):t.removeAttribute("style"))}):(i.log("VelocityTransitionGroup:animationTransitions:error "+d.props.transitionName)(),Promise.resolve())})["finally"](function(){a.setUiBusy(!1)})},componentWillUnmount:function(){var e=this.getDOMNode();Velocity(e,"stop")},render:function(){return React.Children.only(this.props.children)}}),d=React.createClass({displayName:"VelocityTransitionGroup",propTypes:{transitionName:React.PropTypes.string.isRequired,delay:React.PropTypes.number},_wrapChild:function(e){return React.createElement(c,{delay:this.props.delay,transitionName:this.props.transitionName},e)},render:function(){return React.createElement(s,n({childFactory:this._wrapChild},this.props))}});e.exports=d},function(e,t){var r=[.1,.82,.25,1],n=[.69,0,.79,.14],i=[.84,.07,.93,.46];Velocity.RegisterEffect("attach.Down",{defaultDuration:300,calls:[[{opacity:[1,0],translateY:["0%","-100%"],scaleX:[1,.3],scaleY:[1,.3]},1,{easing:[300,22]}]]}),Velocity.RegisterEffect("attach.Up",{defaultDuration:300,easing:r,calls:[[{opacity:[0,1],translateY:["-200%","0%"],scaleX:[.3,1],scaleY:[.3,1]},1,{easing:[300,40]}]]}),Velocity.RegisterEffect("dropdown.Down",{defaultDuration:200,easing:r,calls:[[{opacity:[1,0],translateY:["0%","-15px"]},1,{easing:r}]]});var o={pop:{duration:200,easing:i,enter:{props:{scaleX:[1,.5],scaleY:[1,.5],opacity:[1,0]}},leave:{props:{scaleX:[.5,1],scaleY:[.5,1],opacity:[0,1]}}},slide:{duration:200,eaing:r,enter:{props:"slideDown"},leave:{props:"slideUp"}},scaleY:{duration:200,easing:r,enter:{props:{scaleY:[1,0],transformOrigin:"center"}},leave:{props:{scaleY:[0,1],transformOrigin:"center"}}},scale:{duration:500,easing:r,enter:{props:{scaleX:[1,0],scaleY:[1,0]}},leave:{props:{scaleX:[0,1],scaleY:[0,1]}}},fade:{duration:200,easing:r,enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},"fade-fast":{easing:"ease",enter:{props:{opacity:[1,0]},duration:150},leave:{props:{opacity:[0,1]},duration:100}},fade_sifo:{enter:{props:{opacity:[1,0]},duration:250},leave:{props:{opacity:[0,1]},duration:100}},capture:{enter:{props:{opacity:[1,0]},duration:350},leave:[{selector:".snapshot",props:"transition.bounceDownOut",duration:700},{selector:".webcam",props:{opacity:[0,1]},duration:100,easing:"ease"}]},butterbar:{enter:{props:"slideDown",easing:r,duration:700},leave:{props:"slideUp",easing:n,duration:350}},modal:{enter:[{props:{opacity:[1,0]},duration:300,easing:"easeOut"},{selector:".popup",props:{scaleX:[1,0],scaleY:[1,0],opacity:[1,1]},easing:[.19,.73,.28,1],delay:180,duration:200},{selector:".popup",props:{opacity:[0,0]},duration:180}],leave:[{props:{opacity:[0,1]},duration:300,easing:n,delay:100},{selector:".popup",props:{scaleX:[0,1],scaleY:[0,1]},easing:n,duration:200}]},"modal-flow":{enter:[{selector:".backdrop",props:{opacity:[1,0]},duration:300,easing:"easeOut"},{selector:".popup",props:{scaleX:[1,0],scaleY:[1,0],opacity:[1,1]},easing:[.19,.73,.28,1],delay:180,duration:200},{selector:".popup",props:{opacity:[0,0]},duration:180}],leave:[{selector:".backdrop",props:{opacity:[0,1]},duration:300,easing:n,delay:100},{selector:".popup",props:{scaleX:[0,1],scaleY:[0,1]},easing:n,duration:200}]},"flow-transition-modal-push":{duration:300,easing:r,enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},"flow-transition-modal-pop":{duration:300,easing:r,enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},"flow-transition-drawer-push":{duration:300,easing:r,enter:{props:{translateX:["0%","100%"]}},leave:{props:{translateX:["-100%","0%"]}}},"flow-transition-drawer-pop":{duration:300,easing:r,enter:{props:{translateX:["0%","-100%"]}},leave:{props:{translateX:["100%","0%"]}}},"drawer-left":{enter:[{props:{translateX:["0%","-100%"]},duration:300,easing:r},{selector:".drawer-title",props:{translateX:[0,-50],opacity:[1,0]},duration:500,easing:"easeOut"}],leave:[{props:{translateX:["-100%","0%"]},duration:300,easing:n}]},"drawer-left-rtl":{enter:[{props:{translateX:["0%","100%"]},duration:300,easing:r},{selector:".drawer-title",props:{translateX:[0,50],opacity:[1,0]},duration:500,easing:"easeOut"}],leave:[{props:{translateX:["100%","0%"]},duration:300,easing:n}]},dropdown:{duration:300,easing:r,enter:[{selector:".menu-item",props:"dropdown.Down",delay:50,duration:375,stagger:25,drag:!0},{props:{scale:[1,0]}},{props:{opacity:[1,0]},duration:100}],leave:{props:{scaleX:[0,1],scaleY:[0,1],opacity:[0,1]}}},"dropdown-picker":{duration:300,easing:r,enter:[{selector:".menu-item",props:{opacity:[1,0]},delay:50,duration:200},{selector:".nib",props:{opacity:[1,0],rotateZ:["45deg"],translateY:["0%","-100%"]}},{props:{scale:[1,0]}},{props:{opacity:[1,0]},duration:100}],leave:[{selector:".menu-item",props:{opacity:[1,0]},duration:100},{selector:".nib",props:{opacity:[1,0]},duration:150},{props:{scaleX:[0,1],scaleY:[0,1],opacity:[0,1]}}]},"profile-viewer":{duration:500,easing:[.1,1.03,.28,.99],leave:[{delay:400,props:{opacity:[0,1]}},{selector:".profile-viewer",props:{borderRadius:["50%","0%"]}}]},"media-viewer":{duration:500,easing:[.1,1.03,.28,.99],leave:{selector:".media-viewer",delay:100,props:{opacity:[0,1]}}},menu:{duration:700,enter:{selector:".menu-icons-item",props:"attach.Down",stagger:30,drag:!0},leave:{selector:".menu-icons-item",props:"attach.Up",stagger:30,drag:!0}},emoji:{duration:300,easing:r,enter:{props:{height:[234,0]}},leave:{props:{height:[0,234]}}},ptt:{enter:[{selector:".btn-border",easing:"easeInOut",props:{scaleX:[1,.5],scaleY:[1,.5],opacity:[1,0]},duration:250,delay:100},{selector:".ptt-counter",easing:"easeInOut",props:{scaleX:[1,.8],scaleY:[1,.8],opacity:[1,0]},duration:250,delay:100},{props:{opacity:[1,0]},duration:150,easing:r}],leave:[{selector:".btn-border",easing:r,props:{scaleX:[.5,1],scaleY:[.5,1],opacity:[0,1]},duration:250},{selector:".ptt-counter",easing:r,props:{scaleX:[.5,1],scaleY:[.5,1],opacity:[0,1]},duration:250},{props:{opacity:[0,1]},duration:300,easing:r}]},"slide-left":{duration:300,easing:r,enter:{props:{translateX:["0%","100%"]}},leave:{props:{translateX:["100%","0%"]}}},"slide-left-rtl":{duration:300,easing:r,enter:{props:{translateX:["0%","-100%"]}},leave:{props:{translateX:["-100%","0%"]}}},"slide-forward":{duration:200,easing:[.19,.93,.18,.99],enter:{props:{translateX:["0%","100%"]}},leave:{props:{translateX:["-100%","0%"]}}},"slide-back":{duration:200,easing:[.19,.93,.18,.99],enter:{props:{translateX:["0%","-100%"]}},leave:{props:{translateX:["100%","0%"]}}},"media-slide-forward":{duration:200,easing:[.19,.93,.18,.99],enter:[{selector:".media-element-container",props:{translateX:["0%","100%"]}},{selector:".media-caption",props:{opacity:["1","0"],translateX:["0%","100%"]}}],leave:[{selector:".media-element-container",props:{translateX:["-100%","0%"]}},{selector:".media-caption",props:{opacity:["0","1"],translateX:["-100%","0%"]}}]},"media-slide-back":{duration:200,easing:[.19,.93,.18,.99],enter:[{selector:".media-element-container",props:{translateX:["0%","-100%"]}},{selector:".media-caption",props:{opacity:["1","0"],translateX:["0%","-100%"]}}],leave:[{selector:".media-element-container",props:{translateX:["100%","0%"]}},{selector:".media-caption",props:{opacity:["0","1"],translateX:["100%","0%"]}}]},"pop-fast":{duration:75,easing:[.14,.62,.33,.9],enter:{props:{width:["20px","5px"],opacity:[1,.5]}},leave:{props:{width:["5px","20px"],opacity:[0,1]}}},"toast-transition":{duration:300,easing:r,cleanOnComplete:!0,enter:{props:{translateY:["0%","100%"],opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},"slide-up-down":{duration:300,easing:r,enter:{props:{translateY:["0%","100%"]}},leave:{props:{translateY:["100%","0%"]}}},"slide-up":{duration:300,easing:r,enter:{props:{translateY:["0%","100%"]}},leave:{props:{translateY:["100%","0%"]}}},"slide-down":{duration:300,easing:r,enter:{props:{translateY:["0%","100%"]}},leave:{props:{translateY:["100%","0%"]}}},none:{},btn:{duration:300,easing:r,enter:{props:{scale:[1,0],opacity:[1,0]}},leave:{props:{scale:[0,1],opacity:[0,1]}}},pop_delay:{duration:300,enter:[{props:"transition.expandIn",delay:500,easing:r},{props:{opacity:[0,0]},duration:500}],leave:{props:"transition.expandOut",easing:n}},"media-caption":{enter:[{props:{opacity:[0,0],translateY:["100%","100%"]},duration:200},{props:{opacity:[1,0],translateY:["0%","100%"]},easing:r,delay:200,duration:300}],leave:{props:{opacity:[0,1]},easing:"ease",duration:300}},"media-scale":{enter:[{selector:".media-caption",props:{opacity:[0,0],translateY:["100%","100%"]},duration:200},{selector:".media-caption",props:{opacity:[1,0],translateY:["0%","100%"]},easing:r,delay:200,duration:300},{selector:".media-element-container",props:{opacity:[0,0]},duration:200},{selector:".media-element-container",props:{opacity:[1,0],scale:[1,.625],display:"flex"},delay:200,duration:300,easing:r}],leave:[{selector:".media-caption",props:{opacity:[0,1]},easing:"ease",duration:300},{selector:".media-element-container",props:{opacity:[0,1],scale:[.5,1],display:"flex"},delay:0,duration:200,easing:n}]},"thumb-scale":{duration:400,easing:r,enter:{props:"transition.expandIn"},leave:{props:"transition.expandOut"}},"default":{duration:300,enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}}};e.exports=o},function(e,t,r){var n=r(436),i=r(20),o=r(240),a=r(235),s=r(435),c=r(443),d=React.createClass({displayName:"Startup",mixins:[a,s],getInitialState:function(){return{retriable:!1}},componentWillMount:function(){this.addObserver(o,"change:displayInfo"),this.addObserver(i,"change:retryTimestamp",this.retried)},retried:function(){this.clearSafeTimeout(this.timeout),delete this.timeout,this.clearSafeInterval(this.interval),delete this.interval,this.setState({retriable:!1}),this.startTimeout()},componentDidMount:function(){this.startTimeout()},startTimeout:function(){this.timeout=this.safeDelay(this.allowRetry,3e3)},allowRetry:function(){this.setState({retriable:!0}),this.interval=this.safeInterval(this.forceUpdate,1e3)},retry:function(e){i.poke(),this.retried()},logout:function(e){i.logout()},render:function(){var e,t,r,a,s,d;switch(o.displayInfo){case o.INFO.OPENING:e=l10n.t("connecting_to_whatsapp"),t=l10n.t("make_sure_computer_active_internet_connection"),s=this.logout;break;case o.INFO.PAIRING:case o.INFO.TIMEOUT:e=l10n.t("trying_to_reach_phone");var u=window.open.bind(window,"http://www.whatsapp.com/faq/web/28080002","_blank");t=React.createElement("span",null,l10n.t("make_sure_phone_active_internet_connection")," ",React.createElement("span",{className:"action",onClick:u},l10n.t("learn_more"))),s=this.logout;break;case o.INFO.SYNCING:case o.INFO.CONNECTING:return React.createElement("div",{id:"startup"},React.createElement(n,null));default:return null}if(d=this.state.retriable)if(r=i.retryTimestamp-Date.now(),1>r)a=l10n.t("retrying");else if(6e4>r){var l=Math.ceil(r/1e3);a=l10n.t("retrying_in_some_seconds",{number:l,_plural:l})}else a=l10n.t("retrying_in",{duration:moment.duration(r).humanize()});else a=l10n.t("retrying");
return React.createElement(c,{title:e,body:a,tip:t,defaultLabel:l10n.t("retry_now"),onDefault:d?this.retry:_.noop,cancelLabel:s?l10n.t("menuitem_logout"):null,onCancel:s})}});e.exports=d},function(e,t){var r=React.createClass({displayName:"ErrorDialog",propTypes:{title:React.PropTypes.node,body:React.PropTypes.node.isRequired,tip:React.PropTypes.node,cancelLabel:React.PropTypes.node,onCancel:React.PropTypes.func,defaultLabel:React.PropTypes.node,onDefault:React.PropTypes.func},render:function(){var e=this.props.tip?React.createElement("div",{className:"popup-contents"},this.props.body,React.createElement("hr",null),React.createElement("div",{className:"text text-tip"},this.props.tip)):React.createElement("div",{className:"popup-contents"},this.props.body),t=this.props.title?React.createElement("div",{className:"popup-title",dir:"auto"},this.props.title):null,r=[];return this.props.onCancel&&this.props.cancelLabel&&r.push(React.createElement("button",{className:"btn-plain popup-controls-item",onClick:this.props.onCancel,key:"secondary"},this.props.cancelLabel)),this.props.onDefault&&this.props.defaultLabel&&r.push(React.createElement("button",{className:"btn-plain btn-default popup-controls-item",onClick:this.props.onDefault,key:"primary"},this.props.defaultLabel)),r.length&&(r=React.createElement("div",{className:"popup-controls"},r)),React.createElement("div",null,React.createElement("div",{className:"backdrop backdrop-transparent"},React.createElement("div",{className:"popup-container"},React.createElement("div",{className:"popup"},React.createElement("div",{className:"popup-body"},t,e),r))))}});e.exports=r},function(e,t,r){var n=r(443),i=React.createClass({displayName:"Offline",render:function(){return React.createElement(n,{title:l10n.t("computer_not_connected"),body:l10n.t("make_sure_computer_active_internet_connection")})}});e.exports=i},function(e,t,r){function n(){window.open("https://www.whatsapp.com/faq/web/28080002#proxies","_blank")}var i=r(443),o=React.createClass({displayName:"Proxied",render:function(){return React.createElement(i,{title:l10n.t("cant_load_whatsapp"),body:l10n.t("computer_behind_proxy"),defaultLabel:l10n.t("learn_more"),onDefault:n})}});e.exports=o},function(e,t,r){var n=r(20),i=r(443),o=React.createClass({displayName:"Conflict",render:function(){return React.createElement(i,{body:l10n.t("phone_has_another_active_webclient_session"),cancelLabel:l10n.t("menuitem_logout"),onCancel:n.logout.bind(n),defaultLabel:l10n.t("button_use_here"),onDefault:n.takeover.bind(n)})}});e.exports=o},function(e,t,r){var n=r(14),i=r(15),o=r(4),a=r(20),s=r(240),c=r(143),d=r(448),u=r(526),l=r(527),p=r(243),h=r(577),f=r(437),m=r(578),g=r(591),v=r(467),y=r(235),b=r(438),E=r(594),R=r(144),w=r(151),S=r(150),T=r(162),C=React.createClass({displayName:"Main",mixins:[v,b,y],propTypes:{conn:React.PropTypes.instanceOf(p).isRequired},getInitialState:function(){return{conversation:void 0,drawerActive:!1}},componentWillMount:function(){this.regCmd("open_chat",this.handleOpenChat),this.regCmd("clear_chat",this.handleClearChat),this.regNativeListener(window,"focus",this.windowGainedFocus),this.regNativeListener(window,"blur",this.windowLostFocus),s.uiActive=!0,s.markAvailable()},componentWillUnmount:function(){s.uiActive=!1,this.clearIdleMonitor(),this.clearServerPropsQueryLoop()},componentDidMount:function(){if(this.beginIdleMonitor(!0),this.beginServerPropsQueryLoop(),i.isSafari){var e=c.getNUX(o.NUX.SAFARI_LIMITED_SUPPORT);(!e||e<e.maxViews)&&(this.safeDelay(function(){var e=l10n.t("whatsapp_safari_limited").replace("__chrome_homepage__",o.BROWSER_LINK.CHROME).replace("__firefox_homepage__",o.BROWSER_LINK.FIREFOX).replace("__opera_homepage__",o.BROWSER_LINK.OPERA);R.openModal(React.createElement(f,{onOK:R.closeModal.bind(R),okText:l10n.t("ok_got_it")},React.createElement("div",{dangerouslySetInnerHTML:{__html:e}})))},250),c.setNUX(o.NUX.SAFARI_LIMITED_SUPPORT,{views:1,maxViews:1}))}},windowGainedFocus:function(){s.markAvailable();var e=this.state.conversation;e&&e.isUser&&e.presence.subscribe()["catch"](w.WapDrop,_.noop)},windowLostFocus:function(){s.markUnavailable(o.SEND_UNAVAILABLE_WAIT)},beginIdleMonitor:function(e){var t=this;e=e?o.IDLE_TIMEOUT:0,this.idleMonitor=S.loopOnError(w.ShouldLoop,function(){return Promise.delay(e).then(function(){s.markUnavailable(3e4);var e=[S.waitForEvent(document,"mousemove"),S.waitForEvent(document,"scroll"),S.waitForEvent(document,"keydown"),S.waitForEvent(window,"focus"),S.waitForEvent(window,"blur"),S.waitForEvent(window,"resize")];return Promise.any(e).timeout(o.IDLE_TIMEOUT_WAIT,"idleMonitorTimeout")["finally"](function(){e.forEach(function(e){e["catch"](Promise.CancellationError,_.noop),e.cancel()})})}).then(function(){throw s.markAvailable(),e=o.IDLE_TIMEOUT,new w.ShouldLoop})}).cancellable()["catch"](Promise.CancellationError,_.noop)["catch"](Promise.TimeoutError,function(){c.getRememberMe()?t.beginIdleMonitor():(n.log("main:beginIdleMonitor logout due to inactivity")(),a.logout())})["finally"](function(){delete t.idleMonitor})},clearIdleMonitor:function(){this.idleMonitor&&this.idleMonitor.cancel()},beginServerPropsQueryLoop:function(){var e=this;this.serverPropsQueryLoop=T.setTimeout(function(){Store.Props.fetch()["catch"](w.WapDrop,_.noop),e.beginServerPropsQueryLoop()},moment().add("1","days").valueOf())},clearServerPropsQueryLoop:function(){T.clearTimeout(this.serverPropsQueryLoop)},handleRightDrawer:function(e){if(this.setState({drawerActive:!!e}),this.refs.chatlist&&this.refs.container&&this.refs.conversation){var t=this.refs.chatlist.getDOMNode(),r=this.refs.conversation.getDOMNode(),n=this.refs.container.getDOMNode(),i=r.clientWidth/(n.clientWidth-t.clientWidth);Velocity(r,{scaleX:[1,i]},{duration:300,easing:[.1,.82,.25,1]})}},handleClearChat:function(e){this.state.conversation===e&&this.setState({conversation:void 0})},handleOpenChat:function(e){this.state.converstion!==e&&this.setState({conversation:e})},onKeyPress:function(e){},render:function(){var e=this.state.conversation,t=this.state.drawerActive?"app three":"app two";i.isSafari&&(t+=" safari-fix");var r=e?React.createElement(l,{ref:"conversation",key:e.id,chat:e}):React.createElement(E,null);return React.createElement("div",{className:t,ref:"container"},React.createElement(m,null),React.createElement(g,null),React.createElement(u,null),React.createElement(h,{onRightDrawer:this.handleRightDrawer}),React.createElement(d,{ref:"chatlist"}),r)}});e.exports=C},function(e,t,r){var n=r(435),i=r(449),o=r(503),a=r(508),s=r(524),c=r(525),d=r(438),u=React.addons.PureRenderMixin,l=React.createClass({displayName:"ChatlistPanel",mixins:[n,d,u],propTypes:{stripped:React.PropTypes.bool,onSelect:React.PropTypes.func},getInitialState:function(){return{searchText:""}},getFilteredContacts:function(){var e=this.state.searchText;if(!e)return[];e=l10n.accentFold(e);var t=Store.Contact.getFilteredContacts();return t.filter(function(t){var r=t.searchMatch(e),n=Store.Chat.get(t.get("id")),i=n&&!n.isNewlyCreated()?!0:!1;return r&&!i})},getFilteredChats:function(){var e=this.state.searchText;return e?(e=l10n.accentFold(e),Store.Chat.filter(function(t){return t.contact.searchMatch(e)&&!t.isNewlyCreated()})):Store.Chat.filter(function(e){return!e.get("archive")&&!e.isNewlyCreated()})},getEmptyChatlistState:function(){var e=this.getFilteredContacts().length,t=this.getFilteredChats().length,r=!(e||t);if(r){if(this.state.searchText)return s.EMPTY_SEARCH;var n=Store.Chat.filter(function(e){return!e.isNewlyCreated()});return n.length?s.ALL_ARCHIVED:s.EMPTY_LIST}},componentWillMount:function(){this.addObserver(Store.Chat,"sort remove change:archive")},onSearch:function(e){this.setState({searchText:e})},onStopSearch:function(){this.setState({searchText:""})},render:function(){var e,t;if(t=this.getEmptyChatlistState())e=React.createElement(s,{state:t});else{var r=this.props.onSelect?this.props.onSelect:void 0;e=React.createElement(a,{isSearching:!!this.state.searchText,chats:this.getFilteredChats(),onClick:this.onStopSearch,onSelect:r,stripped:this.props.stripped,contacts:this.getFilteredContacts()})}var n=this.props.stripped?null:[React.createElement(i,{key:"ChatHeader"}),React.createElement(c,{key:"ButterBar"})];return React.createElement("div",{className:"pane pane-list",id:"side"},n,React.createElement(o,{searchText:this.state.searchText,onSearch:this.onSearch,searchType:o.CHATLIST}),React.createElement("div",{ref:"panel",className:"pane-body pane-list-body",id:"pane-side"},e))}});e.exports=l},function(e,t,r){var n=r(14),i=r(20),o=r(243),a=r(450),s=r(451),c=r(491),d=r(437),u=r(494),l=r(504),p=r(143),h=r(457),f=r(458),m=r(475),g=r(144),v=r(477),y=r(507),_=y.MenuBarItem,b=y.MenuBar,E=r(170),R=r(493),w=r(440),S="global_mute",T=React.createClass({displayName:"ChatlistHeader",mixins:[v],getDefaultProps:function(){return{muteId:S}},getInitialState:function(){return Store.Mute.globalMute(),{isMuted:this.async("muteId.Mute.isMuted")}},onNewChat:function(){g.openDrawer(React.createElement(u,{type:a.DRAWER_LEFT}))},onProfile:function(){g.openDrawer(React.createElement(s,{type:a.DRAWER_LEFT,id:Wa.me}))},onUnmute:function(){Store.Mute.globalMute().unmute(),g.openToast(React.createElement(R,{msg:l10n.t("global_unmuted"),id:R.genId()}))},render:function(){var e=null;return this.state.isMuted&&(e=React.createElement(_,{icon:"dnd",title:l10n.t("global_unmute"),onClick:this.onUnmute,key:"btn-dnd"})),React.createElement("header",{className:"pane-header pane-list-header"},React.createElement("div",{className:"pane-list-user"},React.createElement(m,{id:Wa.me,onClick:this.onProfile})),React.createElement("div",{className:"pane-list-controls"},React.createElement(b,{key:"chatlist-header"},React.createElement(w,{transitionName:"btn"},e,React.createElement(_,{a8n:"menu-bar-chat",icon:"chat",title:l10n.t("web_menuitem_new"),onClick:this.onNewChat}),React.createElement(_,{a8n:"menu-bar-menu",icon:"menu",title:l10n.t("menutitle_menu")},React.createElement(C,null))))))}});e.exports=T;var C=React.createClass({displayName:"ChatlistHeaderDropdown",getInitialState:function(){return{rememberMe:p.getRememberMe()}},onCreateGroup:function(){g.openDrawer(React.createElement(l,{type:a.DRAWER_LEFT}))},onProfile:function(){g.openDrawer(React.createElement(s,{type:a.DRAWER_LEFT,id:Wa.me}))},onHelp:function(){Wa.uploadLogs("help-page-opened");var e,t,r=Store.Conn.at(0);switch(r&&(e=r.platform),e=e||"unknown"){case o.PLATFORMS.ANDROID:t=l10n.t("guide_help_description_android");break;case o.PLATFORMS.BB:t=l10n.t("guide_help_description_bb");break;case o.PLATFORMS.BBX:t=l10n.t("guide_help_description_bbx");break;case o.PLATFORMS.WP7:t=l10n.t("guide_help_description_wp7");break;case o.PLATFORMS.SYMBIAN:t=l10n.t("guide_help_description_symbian");break;case o.PLATFORMS.S40:t=l10n.t("guide_help_description_s40");break;case o.PLATFORMS.IPHONE:t=l10n.t("guide_help_description_iphone");break;default:n.log("chatlistHeader:onHelp unknown platform: "+e)()}var i=function(){g.closeModal(),window.open("http://www.whatsapp.com/faq/web","_blank")};g.openModal(React.createElement(d,{title:l10n.t("guide_help_title"),onOK:g.closeModal.bind(g),okText:l10n.t("ok_got_it"),onCancel:i,cancelText:l10n.t("web_settings_faq")},l10n.t("guide_help_faq")+" "+t))},onUploadLogs:function(){Wa.uploadLogs()},onDisconnect:function(){var e=Store.Msg.any(function(e){return 0===e.ack&&e.local&&e.isSentByMe});return e?void g.openModal(React.createElement(d,{title:l10n.t("confirm_logout"),onOK:function(){return i.logout()},okText:l10n.t("menuitem_logout"),onCancel:function(){return g.closeModal()},cancelText:l10n.t("web_cancel")},l10n.t("some_of_your_messages_are_still_sending"))):i.logout()},onNotifications:function(){g.openModal(React.createElement(c,null))},render:function(){var e=E.supportsFeature(E.F.GROUP_CREATE)?React.createElement(f,{a8n:"mi-new-group menu-item",action:this.onCreateGroup,shortcut:"g"},l10n.t("web_menuitem_groupchat")):null;return React.createElement(h,{type:h.Type.DROPDOWN_MENU,flipOnRTL:!0,key:"ChatlistHeader",direction:{x:h.Direction.X.LEFT}},e,React.createElement(f,{a8n:"mi-profile-status menu-item",action:this.onProfile},l10n.t("menuitem_profile_status")),React.createElement(f,{a8n:"mi-notifications menu-item",action:this.onNotifications},l10n.t("menuitem_notifications")),React.createElement(f,{a8n:"mi-help menu-item",action:this.onHelp},l10n.t("menuitem_help")),React.createElement(f,{a8n:"mi-logout menu-item",action:this.onDisconnect,shortcut:"q"},l10n.t("menuitem_logout")))}})},function(e,t,r){function n(e,t){return e&&t&&e.component&&e.component.isMounted&&e.component.isMounted()&&e.component.getDOMNode().contains(t)}var i=r(144),o=r(15),a={TOOLTIP:"tooltip",MENU:"menu",MODAL:"modal",DRAWER_LEFT:"drawer_left",DRAWER_MID:"drawer_mid",DRAWER_RIGHT:"drawer_right",PTT:"ptt_recorder",BASE:"base",MEDIA_VIEWER:"media_viewer",STATUS_INPUT:"status_input",ADVANCED_INPUT:"advanced_input",SUBJECT_INPUT:"subject_input",COMPOSE_INPUT:"compose_input",CAPTION_INPUT:"caption_input",IGNORE_ANY:"any",IGNORE_CONTEXT:"contextmenu",_stack:[],_base:null,_events:!1,push:function(e,t,r,n,i){var o;(o=this.find(t))&&(this._stack=_.without(this._stack,o)),o={component:e,type:t,popable:!!r,maintainFocus:!!i,parent:n},this._stack.push(o),this._focus()},pop:function(e,t){if(this._stack.length){var r;if(r=e?this.find(e):_.last(this._stack)){var n=this._deps(r.component);n.push(r),this._close(n,t)}}},popDependents:function(e){this._close(this._deps(e))},stealFocus:function(e){for(var t,r=function(t){return t.maintainFocus&&t.type!==e};t=_.find(this._stack,r);){var n=this._deps(t.component);n.push(t),this._close(n)}},_close:function(e,t){var r=this._stack;e.forEach(function(e){e.index=_.findIndex(r,e)}),e=e.sort(function(e,t){return t.index-e.index});var n=this;e.forEach(function(e){n.unregBubbleTrap(e),r=_.without(r,e),_.isFunction(e.component.close)&&e.component.close(e.type,t)}),this._stack=r,this._focus(t)},_deps:function(e){var t=this,r=_.filter(this._stack,{parent:e});return _.flatten(r,_.chain(r).pluck("component").map(function(e){return t._deps(e)}).value())},setBase:function(e){this._base={component:e,type:this.BASE},this._focus()},top:function(){return _.last(this._stack)||this._base},find:function(e){return _.find(this._stack,{type:e})},_focus:function(e){var t=this.top();t&&t.popable?this.regListeners():this.unregListeners(),t&&_.isFunction(t.component.focus)&&t.component.isMounted()&&t.component.focus(t.type,e)},regListeners:function(){this._events||(window.addEventListener("DOMMouseScroll",this.maybePreventDefault,!0),window.addEventListener("mousewheel",this.maybePreventDefault,!0),i.on("window_mousedown",this.onMouseDown),window.addEventListener("resize",this.onResize,!0),this._events=!0)},unregListeners:function(){this._events&&(window.removeEventListener("DOMMouseScroll",this.maybePreventDefault,!0),window.removeEventListener("mousewheel",this.maybePreventDefault,!0),i.off("window_mousedown",this.onMouseDown),window.removeEventListener("resize",this.onResize,!0),this._events=!1)},regBubbleTrap:function(e){if(e.parent&&e.parent.getDOMNode){var t=e.parent.getDOMNode();t.addEventListener("click",this.stopEvent),t.addEventListener("contextmenu",this.stopEvent)}},unregBubbleTrap:function(e){if(e.parent&&e.parent.getDOMNode){var t=e.parent.getDOMNode();t.removeEventListener("click",this.stopEvent),t.removeEventListener("contextmenu",this.stopEvent)}},stopEvent:function(e){e.preventDefault(),e.stopPropagation()},maybePreventDefault:function(e){return n(this.top(),e.target)?!0:(e.preventDefault(),void e.stopPropagation())},maintainFocus:function(e){var t=_.findLast(this._stack,{maintainFocus:!0});t&&t.component.focus&&(n(t,e.target)||(e.preventDefault(),t.component.focus()))},onMouseDown:function(e){this.unregEatClick();var t=e.target,r=_.last(this._stack);if(n(r,t))return void this.maintainFocus(e);var i="click";e.button>0&&(i="contextmenu");for(var o=!0;t!==document;){var s=t.getAttribute("data-ignore-capture");if(s){if(s===a.IGNORE_ANY||s===i){o=!1;break}break}t=t.parentNode}this.pop(),this.maintainFocus(e),o&&this.regEatClick()},regEatClick:function(){i.on("window_click",this.onClick),i.on("window_mousedown",this.unregEatClick)},unregEatClick:function(){i.off("window_click",this.onClick),i.off("window_mousedown",this.unregEatClick)},onClick:function(e){o.isGecko&&"click"===e.type&&e.button>0||(this.unregEatClick(),e.defaultPrevented||(e.preventDefault(),e.stopPropagation()))},onResize:function(e){for(var t=this.top();t&&t.popable;)this.pop(),t=this.top()}};"maybePreventDefault stopEvent onMouseDown regEatClick unregEatClick onClick onResize".split(/ /).forEach(function(e){a[e]=a[e].bind(a)}),window.addEventListener("keydown",function(e){27===e.keyCode&&(e.stopPropagation(),e.preventDefault(),a.pop())}),e.exports=a},function(e,t,r){var n=r(452),i=r(453),o=r(454),a=r(455),s=r(456),c=r(437),d=r(144),u=r(477),l=r(490),p=r(450),h=r(4),f=React.createClass({displayName:"ProfileDrawer",mixins:[u],propTypes:{id:React.PropTypes.string.isRequired},getInitialState:function(){return{status:this.async("id.Status.status")||l10n.t("contact_status_loading"),imgFull:this.async("id.ProfilePicThumb.imgFull"),pendingStatus:!1,pendingPhoto:!1}},validateStatus:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return!!e.trim()},onSetStatusError:function(){d.openModal(React.createElement(c,{onOK:d.closeModal.bind(d),okText:l10n.t("web_ok")},l10n.t("action_status_empty")))},onSetStatus:function(e){if(Store.Status.canSetMyStatus()){var t=Store.Status.get(this.props.id).status;this.state.status!==t&&(this.setState({pendingStatus:!0}),Store.Status.setMyStatus(this.state.status).bind(this)["finally"](function(){this.isMounted()&&this.setState({status:Store.Status.get(this.props.id).status,pendingStatus:!1})}))}},onBack:function(){d.closeDrawer(this.props.type)},onStatusChange:function(e){this.setState({status:e.target.value})},onCancelStatus:function(){this.setState({status:Store.Status.get(this.props.id).status})},onImageSet:function(e,t){var r=Store.ProfilePicThumb.get(this.props.id);this.setState({pendingPhoto:!0});var n;n=e&&t?r.setPicture(e,t):r.deletePicture(),n.bind(this).then(function(){this.isMounted()&&this.setState({pendingPhoto:!1})})},render:function(){var e=Store.ProfilePicThumb.get(this.props.id),t=e.canSet()||e.canDelete()?s.Type.PROFILE:s.Type.NO_EDIT,r=React.createElement(s,{type:t,id:this.props.id,pending:this.state.pendingPhoto,startImage:this.state.imgFull,onImageSet:this.onImageSet});return React.createElement(n,{onCancel:this.onBack,id:"profile"},React.createElement(i,{a8n:"drawer-title-profile",title:l10n.t("menuitem_profile_status"),onBack:this.onBack,type:i.Type.SMALL}),React.createElement(a,null,React.createElement("div",{className:"drawer-section drawer-scale drawer-section-photo"},r),React.createElement(o,{a8n:"col-main-profile",title:l10n.t("web_status"),classes:"animate-enter1"},React.createElement(l,{id:p.STATUS_INPUT,value:this.state.status,editable:Store.Status.canSetMyStatus(),pending:this.state.pendingStatus,showRemaining:!0,validate:this.validateStatus,maxLength:h.MAX_STATUS_LENGTH,onChange:this.onStatusChange,onSave:this.onSetStatus,onError:this.onSetStatusError,onCancel:this.onCancelStatus}))))}});e.exports=f},function(e,t,r){function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var i=r(166),o=React.createClass({displayName:"Drawer",propTypes:{children:React.PropTypes.node.isRequired,id:React.PropTypes.string,variant:React.PropTypes.string,noContainer:React.PropTypes.bool,position:React.PropTypes.oneOf(["right","left"]),onDragLeave:React.PropTypes.func,onDrop:React.PropTypes.func,onDragOver:React.PropTypes.func},getDefaultProps:function(){return{position:"left"}},statics:{RIGHT:"right",LEFT:"left"},getInitialState:function(){return{isDragging:!1}},isDragDropDrawer:function(){return this.props.onDragOver&&this.props.onDragLeave&&this.props.onDrop},onDragOver:function(e){e.preventDefault(),this.isDragDropDrawer()&&!this.state.isDragging&&(this.props.onDragOver(e),this.setState({isDragging:!0}))},onDrop:function(e){e.preventDefault(),e.stopPropagation(),this.setState({isDragging:!1}),this.props.onDrop(e)},onDragLeave:function(e){e.preventDefault(),e.stopPropagation(),this.state.isDragging&&(this.setState({isDragging:!1}),this.props.onDragLeave(e))},render:function(){var e,t=this.props,r=i("drawer",n({},"drawer-"+t.id,!!t.id));if(this.isDragDropDrawer()){var o=this.state.isDragging?{}:{display:"none"};e=React.createElement("div",{key:"mask",className:"drag-drop-mask",style:o,onDragLeave:this.onDragLeave,onDrop:this.onDrop})}if(t.noContainer)return React.createElement("div",{className:r,onDragOver:this.onDragOver},e,t.children);var a,s=i("drawer-container",(a={},n(a,"drawer-container-"+t.id,!!t.id),n(a,"drawer-container-"+t.position,!!t.position),n(a,"drawer-container-"+t.variant,!!t.variant),a));return React.createElement("div",{className:s,onDragOver:this.onDragOver},e,React.createElement("div",{className:r},t.children))}});e.exports=o},function(e,t,r){var n=r(166),i=r(450),o={SMALL:"small",LARGE:"large",POPUP:"popup",OFFSET:"offset"},a=React.createClass({displayName:"DrawerHeader",propTypes:{children:React.PropTypes.node,title:React.PropTypes.string,onBack:React.PropTypes.func,onCancel:React.PropTypes.func,a8n:React.PropTypes.string,type:React.PropTypes.oneOf(_.values(o)).isRequired},render:function(){var e=this.props,t=e.title,r=e.onBack,a=e.onCancel,s=e.type,c=e.children,d=null;if(t){var u=void 0,l={textAlign:"initial"};s===o.SMALL?(u={fontWeight:400,fontSize:16,lineHeight:"21px"},l.width=54):s===o.LARGE?(u={fontWeight:500,fontSize:19,lineHeight:"19px"},l.width=54):(u={fontWeight:500,fontSize:19,lineHeight:"19px"},l.width=48,l.opacity=.7);var p=n("icon btn-close-drawer",{"icon-back":s===o.SMALL,"icon-back-light":s!==o.SMALL}),h=r?React.createElement("span",{className:p,"data-a8n":Wa.a8n("btn-closer-drawer"),"data-ignore-capture":i.IGNORE_ANY,onClick:r}):null,f=n("icon btn-close-drawer",{"icon-x":s===o.SMALL,"icon-x-light":s!==o.SMALL}),m=a?React.createElement("span",{className:f,"data-a8n":Wa.a8n("btn-closer-drawer"),"data-ignore-capture":i.IGNORE_ANY,onClick:a}):null;d=React.createElement("div",{className:"drawer-title",style:u},React.createElement("div",{style:l,className:"drawer-title-action"},h,m),React.createElement("span",{"data-a8n":Wa.a8n(this.props.a8n),className:"drawer-title-body"},t))}var g=n({"drawer-header":s===o.LARGE,"drawer-header-small":s===o.SMALL,"drawer-header-offset":s===o.OFFSET,"drawer-header-popup":s===o.POPUP});return React.createElement("header",{className:g},d,c)}});a.Type=o,e.exports=a},function(e,t,r){function n(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(166),a=React.createClass({displayName:"DrawerSection",propTypes:{children:React.PropTypes.node.isRequired,title:React.PropTypes.node,subtitle:React.PropTypes.node,expands:React.PropTypes.bool.isRequired,classes:React.PropTypes.string,onMouseDown:React.PropTypes.func,noContainer:React.PropTypes.bool,a8n:React.PropTypes.string},getDefaultProps:function(){return{expands:!1,noContainer:!1}},render:function(){var e=this.props,t=e.children,r=e.title,a=e.subtitle,s=e.expands,c=e.classes,d=e.onMouseDown,u=e.noContainer,l=n(e,["children","title","subtitle","expands","classes","onMouseDown","noContainer"]),p=o(c,{"drawer-section-expand":!!s,"drawer-section":!s,well:!!r});if(!r)return React.createElement("div",{className:p},t);var h=a?React.createElement("div",{className:"col-side"},a):null,f=t;if(!u){var m=o("drawer-section-body",{"drawer-section-body-expand":!!s,chatlist:!!s});f=React.createElement("div",{className:m},t)}return React.createElement("div",i({className:p,onMouseDown:d},l),React.createElement("div",{className:"drawer-section-title title-underlined"},React.createElement("div",{"data-a8n":Wa.a8n(this.props.a8n),className:"col-main"},r),h),f)}});e.exports=a},function(e,t,r){var n=r(166),i=React.createClass({displayName:"DrawerBody",propTypes:{expands:React.PropTypes.bool},getDefaultProps:function(){return{expands:!1}},render:function(){var e=n("drawer-body","drawer-editable",{"drawer-body-flex":"flex"===this.props.type}),t=this.props.expands?React.createElement("div",{className:"drawer-body-filler"}):null;return React.createElement("div",{className:e},this.props.children,t)}});e.exports=i},function(e,t,r){var n=r(14),i=r(457),o=r(458),a=r(459),s=r(473),c=r(464),d=r(474),u=r(478),l=r(489),p=r(436),h=r(437),f=r(450),m=r(144),g=r(4),v=r(166),y=r(440),b=200,E=1.3,R=2,w={GROUP:"group",PROFILE:"profile",NO_EDIT:"no_edit"},S=React.createClass({displayName:"PhotoPicker",propTypes:{startImage:React.PropTypes.string,type:React.PropTypes.oneOf(_.values(w)).isRequired,id:React.PropTypes.string,pending:React.PropTypes.bool,onImageSet:React.PropTypes.func.isRequired},statics:{Type:w},getInitialState:function(){return{img:this.props.startImage,left:0,top:0,isEditing:!1,hover:!1,contextActive:!1}},componentWillReceiveProps:function(e){this.props.startImage!==e.startImage&&this.setState({img:e.startImage,isEditing:!1})},cropImage:function(){if(!this.refs.img)return Promise.reject();var e=this.refs.img.getDOMNode(),t=this.state.scale,r=Math.abs(this.state.left/t),n=Math.abs(this.state.top/t),i=b/t,o=i;i>g.MAX_PIC_SIDE?o=g.MAX_PIC_SIDE:i<g.MIN_PIC_SIDE&&(o=g.MIN_PIC_SIDE);var a;return new Promise(function(t,s){u.crop(e.src,r,n,i,i,o,o).then(function(e){return a=e,u.crop(a.url,0,0,g.PROF_PIC_THUMB_SIDE,g.PROF_PIC_THUMB_SIDE)}).then(function(e){t({thumb:e.url,full:a.url})})})},onZoomIn:function(){var e=this.state.scale*E;e>=R||this.setState({scale:e})},onZoomOut:function(){var e=this.state.scale/E;this.state.minScale>=e&&(e=this.state.minScale),this.setState({scale:e})},onCrop:function(){this.cropImage().bind(this).then(function(e){this.props.onImageSet(e.thumb,e.full)})["catch"](function(){this.setState({img:this.props.startImage,isEditing:!1})})},onDragEnd:function(e,t){this.setState({left:e,top:t})},onUpload:function(e){var t=this.refs.imageInput.getDOMNode();return t.click(),!0},removeImage:function(){this.props.onImageSet(),m.closeModal()},onRemove:function(e){var t=this.props.type===w.GROUP?l10n.t("remove_group_icon"):l10n.t("remove_profile_photo");m.openModal(React.createElement(h,{onOK:this.removeImage,okText:l10n.t("remove"),onCancel:m.closeModal.bind(m),cancelText:l10n.t("web_cancel")},t))},onView:function(){var e=this.refs.imageContainer.getDOMNode(),t=function(t){t(e)};m.openModal(React.createElement(s,{contact:Store.Contact.get(this.props.id),getZoomNode:t}),"profile-viewer")},onImageTake:function(e){this.createAndSetImage(e)},onImagePick:function(e){f.pop(f.MENU);var t=e.target.files[0];return t?(this.createAndSetImage(t),void(e.target.value="")):!1},createAndSetImage:function(e){var t=this;u.resizeAndOrient(e,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY).then(function(e){var r=new Image;r.onload=function(){var n,i=r.width,o=r.height;n=o>i?b/i:b/o,t.setState({img:e.url,isEditing:!0,scale:n,minScale:b/Math.min(i,o)})},r.src=e.url})["catch"](function(e){n.log("PhotoPicker:createAndSetImage:error "+e,"red",e)()})},onImageClick:function(e){if(this.props.type===w.NO_EDIT)return void this.onView();if(!this.state.isEditing){e.stopPropagation(),e.preventDefault();var t=[];this.props.id&&t.push(React.createElement(o,{key:"view",action:this.onView},l10n.t("view_photo"))),navigator.getUserMedia&&t.push(React.createElement(a,{key:"take",onImageTake:this.onImageTake})),t.push(React.createElement(o,{key:"upload",action:this.onUpload},l10n.t("upload_photo"))),this.state.img&&t.push(React.createElement(o,{key:"remove",action:this.onRemove},l10n.t("remove_photo"))),m.openContextMenu(t,{onClose:this.contextClose,type:i.Type.DROPDOWN,event:e}),this.setState({contextActive:!0})}},contextClose:function(){this.setState({contextActive:!1})},onMouseEnter:function(e){this.setState({hover:!0})},onMouseLeave:function(e){this.setState({hover:!1})},onLoad:function(e){var t=e.target.clientWidth,r=e.target.clientHeight;this.setState({imageSize:{width:t,height:r}})},render:function(){var e;if(this.state.img&&this.state.isEditing){var t={width:b,height:b};e=React.createElement(l,{ref:"img",container:t,onStop:this.onDragEnd,scale:this.state.scale},React.createElement("img",{className:"avatar-original",src:this.state.img}))}else this.state.img&&(e=React.createElement(c,{type:c.TYPES.COVER,size:this.state.imageSize},React.createElement(d,{src:this.state.img,style:{height:"100%",width:"100%"},onLoad:this.onLoad})));var r;(this.props.pending||!this.state.isEditing&&this.state.img&&!this.state.imageSize)&&(r=React.createElement("div",{className:"avatar-spinner-container"},React.createElement(p,{size:50,stroke:3})));var n=null;if(!this.props.pending&&this.props.type!==w.NO_EDIT&&(!this.state.img||this.state.imageSize)&&(!this.state.img||this.state.contextActive||!this.state.isEditing&&this.state.hover)){var i;switch(this.props.type){case"group":i=this.state.img?l10n.t("change_group_icon"):l10n.t("add_group_icon");break;case"profile":i=this.state.img?l10n.t("change_profile_photo"):l10n.t("add_profile_photo")}n=React.createElement("div",{className:"avatar-overlay",key:"avatar-overlay"},React.createElement("span",{className:"icon icon-camera-light"}),React.createElement("div",{"data-a8n":Wa.a8n("avatar-text"),className:"avatar-overlay-text"},i))}var o,a,s=v("avatar","avatar-l","draggable-container",{"icon-group-default":this.props.type===w.GROUP,"icon-user-default":this.props.type===w.PROFILE});this.state.isEditing&&(o=React.createElement("div",{className:"avatar-picker-controls",key:"zoom-controls"},React.createElement("button",{className:"icon icon-plus",onClick:this.onZoomIn}),React.createElement("button",{className:"icon icon-minus",onClick:this.onZoomOut})),a=React.createElement("div",{className:"tip-container tip-avatar-picker",key:"tip-controls"},React.createElement("div",{className:"tip"},React.createElement("div",{className:"tip-body"},l10n.t("adjust_image")),React.createElement("div",{className:"tip-controls"},React.createElement("button",{className:"button",onClick:this.onCrop},l10n.t("done_adjusting"))))));var u=this.props.pending||!this.state.imageSize&&this.state.img?_.noop:this.onImageClick;return React.createElement("div",{className:"avatar-picker"},React.createElement("div",{className:s,onClick:u,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,ref:"imageContainer"},e,React.createElement(y,{transitionName:"fade"},r,n)),React.createElement(y,{transitionName:"fade"},o),React.createElement(y,{transitionName:"slide"},a),React.createElement("input",{ref:"imageInput",type:"file","data-ignore-capture":f.IGNORE_ANY,accept:"image/gif,image/jpeg,image/jpg,image/png",style:{display:"none"},onChange:this.onImagePick}))}});e.exports=S},function(e,t,r){var n=r(439),i=r(438),o=r(166),a={X:{LEFT:"left",RIGHT:"right"},Y:{TOP:"top",BOTTOM:"bottom"}},s={DROPDOWN:"dropdown",DROPDOWN_MENU:"dropdown_menu",MENU:"menu",PICKER:"picker",EMOJI_PICKER:"emoji_picker"},c=React.createClass({displayName:"Menu",mixins:[i],propTypes:{children:React.PropTypes.node.isRequired,origin:React.PropTypes.shape({x:React.PropTypes.number,y:React.PropTypes.number}),type:React.PropTypes.oneOf(_.values(s)).isRequired,direction:React.PropTypes.shape({x:React.PropTypes.oneOf(_.values(a.X)),y:React.PropTypes.oneOf(_.values(a.Y))}).isRequired,flipOnRTL:React.PropTypes.bool,classes:React.PropTypes.string},statics:{Direction:a,Type:s},getDefaultProps:function(){return{type:s.DROPDOWN,direction:{x:a.X.RIGHT,y:a.Y.BOTTOM}}},getInitialState:function(){return{showShortcuts:!1}},componentWillMount:function(){this.regNativeListener(window,"keydown",this.onKeyDown),
this.regNativeListener(window,"keyup",this.onKeyUp)},getStyle:function(){var e=this.props,t={},r=e.direction.x,i=e.direction.y;this.props.flipOnRTL&&l10n.isRTL()&&(r=r===a.X.LEFT?a.X.RIGHT:a.X.LEFT);var o=r===a.X.RIGHT?a.X.LEFT:a.X.RIGHT,s=i===a.Y.TOP?a.Y.BOTTOM:a.Y.TOP;return t[n.prefix("transformOrigin")]=s+" "+o,e.origin?(r===a.X.RIGHT?t.left=e.origin.x:t.right=window.innerWidth-e.origin.x,i===a.Y.BOTTOM?t.top=e.origin.y:t.bottom=window.innerHeight-e.origin.y,_.merge(t,e.style)):_.merge(t,e.style)},onKeyDown:function(e){e.metaKey&&this.setState({showShortcuts:!0})},onKeyUp:function(e){this.state.showShortcuts&&!e.metaKey&&this.setState({showShortcuts:!1})},render:function(){var e=this.props,t=o({dropdown:e.type===s.DROPDOWN,"dropdown dropdown-right":e.type===s.DROPDOWN_MENU,"menu menu-icons":e.type===s.MENU,"dropdown-picker k context-menu":e.type===s.PICKER,"dropdown dropdown-emoji":e.type===s.EMOJI_PICKER,inverse:(e.type===s.PICKER||e.type===s.EMOJI_PICKER)&&e.direction.x===a.X.LEFT,"inverse-vertical":e.type===s.EMOJI_PICKER&&e.direction.y===a.Y.TOP,"shortcut-active":this.state.showShortcuts});this.props.classes&&(t+=" "+this.props.classes);var r=e.type===s.MENU||e.type===s.EMOJI_PICKER?e.children:React.createElement("ul",null,e.children),n=e.type===s.PICKER||e.type===s.EMOJI_PICKER?React.createElement("div",{className:"nib"}):null;return React.createElement("div",{className:t,style:this.getStyle(),ref:"menu"},r,n)}});e.exports=c},function(e,t,r){var n=r(438),i=r(450),o=React.createClass({displayName:"MenuItem",mixins:[n],propTypes:{shortcut:React.PropTypes.string,action:React.PropTypes.func.isRequired,a8n:React.PropTypes.string},componentWillMount:function(){},onKeyDown:function(e){if(e.metaKey){var t=this.props.shortcut;t&&e.key===t+""&&(e.preventDefault(),this.onSelect(e))}},onSelect:function(e){this.props.action(e)||e.target&&e.target.hasAttribute("data-ignore-capture")?e.stopPropagation():i.pop(i.MENU)},render:function(){var e=null,t=_.isString(this.props.children)?this.props.children:null;return React.createElement("li",{"data-a8n":Wa.a8n(this.props.a8n),className:"menu-item menu-shortcut",onClick:this.onSelect},React.createElement("a",{className:"ellipsify",title:t},this.props.children),e)}});e.exports=o},function(e,t,r){var n=r(450),i=r(151),o=r(144),a=r(458),s=r(460),c=r(472),d=React.createClass({displayName:"TakePhotoMenuItem",propTypes:{onImageTake:React.PropTypes.func.isRequired},onCapture:function(){n.pop(n.MENU);var e=this,t=new Promise(function(r,n){navigator.getUserMedia({video:!0},function(n){o.closeModal(),r(n),t.isResolved()&&o.openModal(React.createElement(s,{stream:n,onSend:e.props.onImageTake}))},function(e){var r=_.isString(e)?e:e.name,a=i.GUM[r]||i.GUM.GUMError;n(new a),t&&t.isResolved()&&o.closeModal()})}).bind(this).timeout(1500,"waitForGUMTakePhotoTimeout").then(function(e){o.openModal(React.createElement(s,{stream:e,onSend:this.props.onImageTake}))})["catch"](Promise.TimeoutError,function(e){o.openModal(React.createElement(c,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_description",type:c.TYPE.GUIDE_ALLOW}))})["catch"](i.GUM.PermissionDeniedError,function(){o.openModal(React.createElement(c,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_fail_description",type:c.TYPE.GUIDE_UNBLOCK}))})["catch"](i.GUM.GUMError,function(){o.openModal(React.createElement(c,{title:"guide_desktop_camera_missing_title",desc:"guide_desktop_camera_missing_description",type:c.TYPE.GUIDE_NONE}))})},render:function(){return React.createElement(a,{action:this.onCapture},l10n.t("take_photo"))}});e.exports=d},function(e,t,r){var n=r(461),i=r(462),o=r(144),a=React.createClass({displayName:"CaptureModal",propTypes:{onSend:React.PropTypes.func.isRequired,stream:React.PropTypes.object.isRequired},onCancel:function(){o.closeModal()},onSend:function(e){this.props.onSend(e.file),this.onCancel()},render:function(){return React.createElement(n,{type:n.BOX},React.createElement(i,{onBack:this.onCancel,caption:!1,onSend:this.onSend,stream:this.props.stream,noContainer:!0}))}});e.exports=a},function(e,t,r){function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var i=r(166),o=React.createClass({displayName:"Modal",propTypes:{type:React.PropTypes.oneOf(["compact","box","tower"]),classes:React.PropTypes.string,title:React.PropTypes.string,children:React.PropTypes.node.isRequired},getDefaultProps:function(){return{classes:"",type:"compact"}},statics:{COMPACT:"compact",BOX:"box",TOWER:"tower"},render:function(){var e=this.props.title?React.createElement("div",{className:"popup-title",dir:"auto"},this.props.title):null,t=i("popup",this.props.classes,n({},"popup-"+this.props.type,this.props.type!==o.COMPACT));return React.createElement("div",{className:"backdrop"},React.createElement("div",{className:"popup-container"},React.createElement("div",{className:t},React.createElement("div",{className:"popup-body"},e,React.createElement("div",{className:"popup-contents"},this.props.children)))))}});e.exports=o},function(e,t,r){var n=r(14),i=r(463),o=r(464),a=r(235),s=r(438),c=r(452),d=r(453),u=r(455),l=r(166),p=r(465),h=r(450),f=r(4),m=r(440),g={ANIMATING:"animating",LOADING:"loading",RECORDING:"active",SENDING:"sending"},v=React.createClass({displayName:"CaptureDrawer",mixins:[s,a],propTypes:{noContainer:React.PropTypes.bool,stream:React.PropTypes.object.isRequired,caption:React.PropTypes.bool,onBack:React.PropTypes.func.isRequired,onSend:React.PropTypes.func.isRequired},statics:{State:g},getInitialState:function(){return{state:g.ANIMATING,img:void 0,url:void 0}},componentDidMount:function(){this.safeDelay(function(){this.setState({state:g.LOADING,url:window.URL.createObjectURL(this.props.stream)})},300)},componentWillUnmount:function(){if(this.state.url){var e=this.props.stream;if(_.isFunction(e.stop))e.stop();else for(var t=e.getTracks(),r=0;r<t.length;r++)t[r].stop();window.URL.revokeObjectURL(this.state.url)}},onCapture:function(e){var t=document.createElement("canvas");if(this.refs.video){var r=this.refs.video.getDOMNode();t.height=r.videoHeight,t.width=r.videoWidth;var n=t.getContext("2d");n.translate(t.width,0),n.scale(-1,1),n.drawImage(r,0,0,r.videoWidth,r.videoHeight);var i=t.toDataURL("image/jpeg");this.setState({state:g.SENDING,img:i})}},onVideoLoaded:function(e){this.setState({state:g.RECORDING,videoSize:{width:e.target.videoWidth,height:e.target.videoHeight}})},onRetake:function(e){this.setState({state:g.RECORDING,caption:void 0})},onSend:function(e){this.props.onSend({file:window.dataURLtoBlob(this.state.img),caption:this.state.caption})},onCaptionChange:function(e){this.setState({caption:e.target.value})},render:function(){var e,t,r,a;switch(this.state.state){case g.ANIMATING:break;case g.LOADING:case g.RECORDING:var s=l("capture-video",{"capture-video-inactive":this.state.state===g.LOADING});r=React.createElement("div",{key:"webcam"},React.createElement(o,{type:o.TYPES.COVER,size:this.state.videoSize},React.createElement(i,{className:s,autoPlay:!0,ref:"video",className:"media-viewer-img webcam",onPlay:this.onVideoLoaded,src:this.state.url}))),e=React.createElement("div",{className:"drawer-controls fade",key:"btn-capture"},React.createElement("button",{className:"btn btn-round btn-l",onClick:this.onCapture},React.createElement("span",{className:"icon icon-camera-light"})));break;case g.SENDING:var v={backgroundImage:"url("+this.state.img+")"};r=React.createElement("div",{key:"snapshot"},React.createElement(o,{type:o.TYPES.COVER,size:this.state.videoSize},React.createElement("div",{className:"capture-image snapshot",style:v})));var y=this.props.noContainer?"icon icon-checkmark-light-l":"icon icon-send-light";e=React.createElement("div",{className:"drawer-controls btn-send",key:"btn-send"},React.createElement("button",{className:"btn btn-round btn-l","data-ignore-capture":h.IGNORE_ANY,onClick:this.onSend},React.createElement("span",{className:y}))),t=React.createElement("div",{className:"drawer-header-action",onClick:this.onRetake},React.createElement("span",{className:"icon icon-refresh-light"}),l10n.t("retake")),a=React.createElement(p,{id:h.CAPTION_INPUT,ref:"emojiInput",editable:!0,value:this.state.caption,floating:!1,maxLength:f.MAX_CAPTION_LENGTH,showRemaining:!0,placeholder:l10n.t("add_a_caption"),onEnter:this.onSend,onChange:this.onCaptionChange});break;default:n.log("captureDrawer:render Unhandled video capture state "+this.state.state)()}var _=void 0;_=this.props.caption?React.createElement("div",{className:"media-collection"},React.createElement(m,{transitionName:"media-caption",className:"media-caption"},a),React.createElement(m,{transitionName:"pop_delay"},e)):React.createElement("div",{className:"media-collection-no-caption"},React.createElement(m,{transitionName:"pop_delay"},e));var b=this.props.noContainer?d.Type.POPUP:d.Type.OFFSET;return React.createElement(c,{key:"attach-capture-modal",position:"right",id:"capture",variant:"noheader",noContainer:this.props.noContainer},React.createElement(d,{title:l10n.t("take_photo"),type:b,onCancel:this.props.onBack},t),React.createElement(u,null,React.createElement("div",{className:"media-body"},React.createElement("div",{className:"media-body-container"},React.createElement(m,{transitionName:"capture"},r))),_))}});e.exports=v},function(e,t,r){var n=r(438),i=React.addons.PureRenderMixin,o=React.createClass({displayName:"Video",mixins:[n,i],propTypes:{src:React.PropTypes.string.isRequired,onPlay:React.PropTypes.func},componentDidMount:function(){var e=this.getDOMNode(),t=this;this.regNativeListener(e,"playing",function(r){e.videoHeight&&e.videoWidth||(e.pause(),e.play()),e.videoHeight&&e.videoWidth&&t.props.onPlay(r)})},render:function(){return React.createElement("video",this.props)}});e.exports=o},function(e,t,r){function n(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(438),a=r(166),s={COVER:"cover",SCALE_DOWN:"scaleDown"},c=React.createClass({displayName:"ObjectFit",mixins:[o],propTypes:{children:React.PropTypes.node.isRequired,type:React.PropTypes.oneOf(_.values(s)).isRequired,size:React.PropTypes.shape({width:React.PropTypes.number.isRequired,height:React.PropTypes.number.isRequired})},statics:{TYPES:s},getInitialState:function(){return{style:this.props.size,className:"object-fit",computed:!1}},componentDidMount:function(){if(!this.shouldUseNativeObjectFit()){this.initialize();var e=this;this.regNativeListener(window,"resize",function(){e.initialize()})}},componentWillReceiveProps:function(e){this.initialize(e)},initialize:function(e){this.shouldUseNativeObjectFit()||(e=e||this.props,e.size&&this.setState(this[e.type](e.size.width,e.size.height)))},shouldUseNativeObjectFit:function(){return!1},cover:function(e,t){var r=this.getDOMNode(),n=r.clientWidth,i=r.clientHeight,o=e,a=t,s=0,c=0;return o!==n&&(a*=n/o,o=n,a>i&&(s=i/2-a/2)),i>a&&(o*=i/a,a=i,o>n&&(c=n/2-o/2)),{style:{width:o,height:a,top:s,left:c,position:"absolute"},className:"object-fit object-fit-cover",computed:!0}},scaleDown:function(e,t){var r=this.getDOMNode(),n=r.clientWidth,i=r.clientHeight,o=t,a=e;return o>i&&(o=i,a=e*(i/t)),a>n&&(a=n,o=t*(n/e)),{style:{width:a,height:o},className:"object-fit object-fit-scaledown",computed:!0}},render:function(){var e=this.props,t=e.children,r=(e.size,e.type,e.className),o=n(e,["children","size","type","className"]);if(this.shouldUseNativeObjectFit())return React.createElement("div",{className:"native-scale-down"},t);var s=a(this.state.className,r),c=this.state.computed?this.state.style:{visibility:"hidden"};return React.createElement("div",i({},o,{className:s}),React.createElement("div",{style:c},t))}});e.exports=c},function(e,t,r){var n=r(466),i=r(468),o=r(471),a=r(440),s=r(144),c=r(457),d=r(450),u=r(166),l=React.createClass({displayName:"AdvancedInput",propTypes:{id:React.PropTypes.string,editable:React.PropTypes.bool,value:React.PropTypes.string,maxLength:React.PropTypes.number,showRemaining:React.PropTypes.bool,selection:React.PropTypes.object,onEnter:React.PropTypes.func,onChange:React.PropTypes.func,onCancel:React.PropTypes.func,onSelectionChange:React.PropTypes.func,multiline:React.PropTypes.bool,placeholder:React.PropTypes.string,floating:React.PropTypes.bool,parent:React.PropTypes.object},getDefaultProps:function(){return{placeholder:"",floating:!0,multiline:!0,showRemaining:!1,editable:!1}},getInitialState:function(){return{active:!1}},componentDidMount:function(){this.regWithUIManager()},componentDidUpdate:function(e){!e.editable&&this.props.editable?this.regWithUIManager():e.editable&&!this.props.editable&&this.unregWithUIManager()},regWithUIManager:function(){this.props.id&&this.props.editable&&d.push(this.props.parent||this,this.props.id,!0,null,!0)},unregWithUIManager:function(){this.props.id&&d.pop(this.props.id),d.popDependents(this)},componentWillUnmount:function(){this.unregWithUIManager()},onEmoji:function(e){this.refs.inputLine.replaceSelection(e)},onFocus:function(){this.props.id&&d.stealFocus(this.props.id),this.setState({active:!0})},onBlur:function(){this.setState({active:!1})},restoreFocus:function(){this.refs.inputLine.restoreFocus()},onEmojiPicker:function(e){e&&(e.preventDefault(),e.stopPropagation());var t=React.createElement(i,{onEmoji:this.onEmoji});this.props.id&&this.regWithUIManager(),s.openContextMenu(t,{anchor:e.target,parent:this,menuDirection:{y:c.Direction.Y.TOP},type:c.Type.EMOJI_PICKER}),this.restoreFocus()},close:function(){this.props.onCancel&&this.props.onCancel()},focus:function(){this.restoreFocus()},preventBlur:function(e){e.preventDefault(),e.stopPropagation(),this.restoreFocus()},render:function(){var e=u("input-emoji input-advanced",{active:this.state.active,"static":!this.props.editable}),t=this.props.editable?React.createElement("button",{className:"icon icon-emoji-input",onClick:this.onEmojiPicker}):null,r=this.props.floating?this.props.placeholder:void 0,i=this.props.value||this.props.floating?void 0:this.props.placeholder;return React.createElement("div",{className:e,onMouseDown:this.preventBlur},React.createElement(o,{placeholder:r,hasText:!!this.props.value},React.createElement("div",{className:"input-main"},React.createElement(n,{ref:"inputLine",value:this.props.value,className:"input-line",placeholder:i,onChange:this.props.onChange,onEnter:this.props.onEnter,editable:this.props.editable,maxLength:this.props.maxLength,showRemaining:this.props.showRemaining,onFocus:this.onFocus,onBlur:this.onBlur}),React.createElement(a,{transitionName:"pop",className:"btn-input"},t))))}});e.exports=l},function(e,t,r){var n=r(467),i=r(438),o=r(235),a=r(163),s=r(15),c=r(168),d=r(166),u=React.createClass({displayName:"EmojiInput",mixins:[n,i,o],propTypes:{editable:React.PropTypes.bool,value:React.PropTypes.string,selection:React.PropTypes.object,className:React.PropTypes.string,placeholder:React.PropTypes.string,onKeyPress:React.PropTypes.func,onEnter:React.PropTypes.func,onChange:React.PropTypes.func,onFocus:React.PropTypes.func,onBlur:React.PropTypes.func,onMouseDown:React.PropTypes.func,onSelectionChange:React.PropTypes.func,maxLength:React.PropTypes.number,showRemaining:React.PropTypes.bool,multiline:React.PropTypes.bool},getDefaultProps:function(){return{editable:!0,value:""}},getInitialState:function(){return this.value=this.props.value||"",this.length=Wa.multibyteLength(this.value),this.selection=this.props.selection,null},componentWillReceiveProps:function(e){if(e.value!==this.value&&(this.setNewValue(e.value||"",!1),this.updateDOM(),this.safeDefer(this.restoreFocus.bind(this,!0))),this.props.editable!==e.editable){var t=this.refs.input.getDOMNode();t.contentEditable=e.editable,e.editable&&this._disableObjectResize()}},restoreFocus:function(e){if(this.props.editable){var t=this.refs.input.getDOMNode();if(t.blur(),t.focus(),this.selection&&!e)this.restoreSelection(this.selection);else{var r=window.getSelection();r.selectAllChildren(t),r.collapseToEnd()}this.safeDefer(this.saveSelection)}},componentDidMount:function(){this.safeDefer(this.restoreFocus),this.props.editable&&this._disableObjectResize(),this.setRemaining()},_disableObjectResize:function(){s.isGecko&&document.execCommand("enableObjectResizing",!1,!1)},limitLength:function(e){var t=this.props.maxLength;if(!t)return e;e=e||"";var r=this.selectionLength(),n=r+t-Wa.multibyteLength(this.value);return n>0?Wa.multibyteSubstr(e,0,n):""},onMouseDown:function(e){e.stopPropagation(),this.regNativeListener(window,"mouseup",this.onWindowMouseUp),this.props.onMouseDown&&this.props.onMouseDown(e)},onWindowMouseUp:function(){this.unregNativeListener(window,"mouseup",this.onWindowMouseUp),this.safeDefer(this.saveSelection)},onContextMenu:function(e){e.stopPropagation()},onKeyUp:function(e){if(s.isTrident&&this.onInput(e),"Backspace"===e.key||"Delete"===e.key){var t=this.refs.input.getDOMNode();switch(t.innerHTML){case"\n":case"\r\n":case"<br>":t.innerHTML="",this.value=""}}this.safeDefer(this.saveSelection)},onKeyPress:function(e){if(s.isTrident&&this.onInput(e),!this.props.onKeyPress||(this.props.onKeyPress(e),!e.defaultPrevented)){this.props.multiline||"Enter"!==e.key||(e.preventDefault(),this.props.onEnter&&this.props.onEnter(e));var t=this.limitLength(c.ucs2.encode([e.charCode]));t.length||e.preventDefault()}},onInput:function(e){var t=this.refs.input.getDOMNode();this.setNewValue(a.NodeToEmoji(t),!0)},setNewValue:function(e,t){if(e!==this.value){if(e&&!this.value){var r=this.refs.placeholder;r&&(r.getDOMNode().style.display="none")}else if(this.value&&!e){var r=this.refs.placeholder;r&&(r.getDOMNode().style.display="")}this.value=e,this.length=Wa.multibyteLength(e),t&&this.props.onChange&&this.props.onChange({target:{value:e}}),this.setRemaining(),this.safeDefer(this.saveSelection)}},setRemaining:function(){this.props.showRemaining&&this.props.maxLength&&(this.refs.counter.getDOMNode().innerHTML=this.props.maxLength-this.length)},updateDOM:function(){var e=a.emojiToHTML(_.escape(this.value)),t=this.refs.input.getDOMNode();t.innerHTML!==e&&(t.innerHTML=e),this.setRemaining()},selectionLength:function(){if(!this.props.editable)return 0;var e=this.refs.input.getDOMNode();e.focus();var t=window.getSelection();if(t.rangeCount){var r=t.getRangeAt(0);return Wa.multibyteLength(a.NodeToEmoji(r.cloneContents()))}return 0},saveSelection:function(){var e=this.getSelection();_.isEqual(e,this.prevSelection)||(this.props.onSelectionChange&&this.props.onSelectionChange(e),this.prevSelection=this.selection,this.selection=e)},isCollapsed:function(){if(this.isMounted()){var e=this.refs.input.getDOMNode();if(document.activeElement!==e)return null;var t=window.getSelection();return t.isCollapsed}},getCursor:function(){if(this.isMounted()){var e=this.refs.input.getDOMNode();if(document.activeElement!==e)return null;var t=window.getSelection(),r=t.anchorNode,n=t.anchorOffset,i=e.childNodes,o=0;e===r&&(r=i[n]);for(var a=0;a<i.length;a++){var s=i[a];if(s===r)return o+n;s.nodeType===window.Node.ELEMENT_NODE?o+=s.alt.length:s.nodeType===window.Node.TEXT_NODE&&(o+=s.length)}return o}},getSelection:function(){if(!this.isMounted())return null;var e=this.refs.input.getDOMNode();if(document.activeElement!==e)return null;for(var t=window.getSelection(),r=t.anchorNode,n=t.anchorOffset,i=t.focusNode,o=t.focusOffset,a=e.childNodes,s=-1,c=-1,d=!1,u=!1,l=0;l<a.length;l++){var p=a[l];if(p===r&&(s=l,d=!0),p===i&&(c=l,u=!0),d&&u)break}return{anchor:{index:s,offset:n},focus:{index:c,offset:o}}},restoreSelection:function(e){var t,r,n,i,o,a,c=this.refs.input.getDOMNode(),d=c.childNodes;-1===e.anchor.index?(t=c,n=e.anchor.offset,o=0):(t=d[e.anchor.index],n=e.anchor.index,o=e.anchor.offset),-1===e.focus.index?(r=c,i=e.focus.offset,a=0):(r=d[e.focus.index],i=e.focus.index,a=e.focus.offset);var u;u=n===i?a>=o?"forward":"reverse":n>i?"reverse":"forward";var l=window.getSelection();if(t&&r)try{var p=document.createRange();return void(s.isTrident?("forward"===u?(p.setStart(t,e.anchor.offset),p.setEnd(r,e.focus.offset)):(p.setStart(r,e.focus.offset),p.setEnd(t,e.anchor.offset)),l.removeAllRanges(),l.addRange(p)):(p.setStart(t,e.anchor.offset),l.removeAllRanges(),l.addRange(p),l.extend(r,e.focus.offset)))}catch(h){l.selectAllChildren(c),l.collapseToEnd()}else l.selectAllChildren(c),l.collapseToEnd()},onCut:function(e){s.isTrident&&this.onInput(e)},onPaste:function(e){e.preventDefault();var t=s.isTrident?"text":"text/plain",r=e.clipboardData.getData(t);this.pasteText(r)},pasteText:function(e){e&&(this.props.maxPaste&&e.length>this.props.maxPaste?this.props.onMaxPasteExceeded():this.replaceSelection(e))},replaceSelection:function(e){if(this.props.editable&&(this.refs.input.getDOMNode().focus(),e=this.limitLength(e),0!==e.length)){this.props.multiline||(e=e.replace(/\n+/g," ").replace(/(\r\n)+/g," "));var t=a.emojiToHTML(_.escape(e));s.isTrident?this.replaceSelectionTrident(t):document.execCommand("insertHTML",!1,t),this.onInput(),this.safeDefer(this.saveSelection)}},replaceSelectionTrident:function(e){var t=window.getSelection();if(t.getRangeAt&&t.rangeCount){var r=t.getRangeAt(0);r.deleteContents();var n=document.createElement("div");n.innerHTML=e;for(var i,o,a=document.createDocumentFragment();i=n.firstChild;)o=a.appendChild(i);r.insertNode(a),o&&(r=r.cloneRange(),r.setStartAfter(o),r.collapse(!0),t.removeAllRanges(),t.addRange(r))}},shouldComponentUpdate:function(){return!1},render:function(){var e=a.emojiToHTML(_.escape(this.value)),t=this.props.className?"input "+this.props.className:"input",r=this.props.showRemaining?React.createElement("span",{className:"input-counter",ref:"counter"}):null,n=d("input-emoji",{"input-remaining":this.props.showRemaining}),i=this.props.placeholder&&!this.props.value?React.createElement("div",{className:"input-placeholder",ref:"placeholder"},this.props.placeholder):null;return React.createElement("div",{className:n},i,React.createElement("div",{dangerouslySetInnerHTML:{__html:e},dir:"auto",ref:"input",contentEditable:this.props.editable,className:t,onInput:this.onInput,onPaste:this.onPaste,onCut:this.onCut,onKeyUp:this.onKeyUp,onKeyPress:this.onKeyPress,onMouseDown:this.onMouseDown,onContextMenu:this.onContextMenu,onFocus:this.props.onFocus,onBlur:this.props.onBlur}),r)}});e.exports=u},function(e,t,r){var n=r(144),i={getCmds:function(){return this._cmds||(this._cmds=[]),this._cmds},regCmd:function(e,t){if(!_.isFunction(t))throw Error("handler is not a function");this.getCmds().push({cmd:e,handler:t}),this.isMounted()&&n.on(e,t)},unregCmd:function(e,t){n.off(e,t),this._cmds=_.reject(this._cmds,_.matches({cmd:e,handler:t}))},registerCmds:function(){this._cmds&&this.getCmds().forEach(function(e){n.on(e.cmd,e.handler)})},unregisterCmds:function(){this._cmds&&(this.getCmds().forEach(function(e){n.off(e.cmd,e.handler)}),delete this._cmds)},componentDidMount:function(){this.registerCmds()},componentWillUnmount:function(){this.unregisterCmds()}};e.exports=i},function(e,t,r){var n=r(143),i=r(435),o=r(438),a=r(235),s=r(467),c=r(163),d=r(469),u=r(470),l=r(144),p=r(458),h=r(457),f=r(450),m=r(440),g={RECENT:"recent",PEOPLE:"people",NATURE:"nature",THINGS:"things",PLACES:"places",SYMBOLS:"symbols"},v=[""].concat(c.skinToneVariations),y=React.createClass({displayName:"EmojiPanel",propTypes:{onEmoji:React.PropTypes.func.isRequired},getInitialState:function(){var e=Store.RecentEmoji.length>0?g.RECENT:g.PEOPLE,t=n.getLastEmojiTab();return _.values(g).indexOf(t)>-1&&(e=t),{selected:e}},componentWillUnmount:function(){n.setLastEmojiTab(this.state.selected)},onSelectTab:function(e){var t=_.values(g).indexOf(this.state.selected),r=_.values(g).indexOf(e),n=r>t?"right":"left";this.setState({selected:e,direction:n})},onEmoji:function(e){this.props.onEmoji(e),Store.RecentEmoji.increment(e)},render:function(){var e=React.createElement("div",{className:"emoji-panel-body",key:"emoji-"+this.state.selected},React.createElement(b,{tab:this.state.selected,onEmoji:this.onEmoji})),t=[{css:"icon-emoji-recent",tab:g.RECENT},{css:"icon-emoji-people",tab:g.PEOPLE},{css:"icon-emoji-nature",tab:g.NATURE},{css:"icon-emoji-things",tab:g.THINGS},{css:"icon-emoji-places",tab:g.PLACES},{css:"icon-emoji-symbols",tab:g.SYMBOLS}],r=this;t=t.map(function(e){var t=React.createElement("button",{className:"menu-item"+(r.state.selected===e.tab?" active":""),onClick:r.onSelectTab.bind(null,e.tab),key:e.tab},React.createElement("span",{className:"icon "+e.css}));return t});var n="right"===this.state.direction?"slide-forward":"slide-back";return React.createElement("div",{className:"emoji-panel k"},React.createElement("div",{className:"menu-tabs menu-tabs-emoji emoji-panel-header","data-active-tab":this.state.selected},t),React.createElement(m,{transitionName:n},e))}});e.exports=y;var b=React.createClass({displayName:"EmojiTab",mixins:[i,a,o,s],propTypes:{tab:React.PropTypes.oneOf(_.values(g)).isRequired,onEmoji:React.PropTypes.func.isRequired},getInitialState:function(){return this.props.tab===g.RECENT?{recent:Store.RecentEmoji.models.map(function(e){return c.emojiMap[e["char"]]}),variants:{}}:void 0},componentDidMount:function(){var e=this;this.addObserver(Store.EmojiVariant,"add remove change:variant",function(){e.forceUpdate()})},componentWillUnmount:function(){f.popDependents(this)},onEmoji:function(e){f.popDependents(this),this.props.onEmoji(e)},setEmojiVariant:function(e,t){if(this.onEmoji(t),Store.EmojiVariant.setVariant(e,t),this.state.recent){var r=this.state.variants;r[e]=t,this.setState({variants:r})}return f.pop(f.TOOLTIP),!0},onContextMenu:function(e,t,r){this.clearPickerTimer(),e&&(e.preventDefault(),e.stopPropagation());var n=this.setEmojiVariant,i=c.skinToneEmojis[t],o=v.map(function(e,r){var o=i+e;return React.createElement(p,{key:o,action:_.partial(n,t,o)},React.createElement(u,{text:o,emojiSize:u.EMOJI_SIZE.LARGE}))});l.openTooltip(o,{anchor:r||e.target,type:h.Type.PICKER,parent:this,menuDirection:{x:h.Direction.X.RIGHT,y:h.Direction.Y.TOP}})},clearPickerTimer:function(){this.pickerTimer&&(this.unregNativeListener(window,"mouseup",this.clearPickerTimer,!0),this.clearSafeTimeout(this.pickerTimer),this.pickerTimer=null)},eatClick:function(e){e.preventDefault(),e.stopPropagation(),this.unregCmd("window_click",this.eatClick)},startPickerTimer:function(e,t){this.clearPickerTimer();var r=e.target;this.pickerTimer=this.safeDelay(function(){this.regCmd("window_click",this.eatClick),this.onContextMenu(null,t,r)},250),this.regNativeListener(window,"mouseup",this.clearPickerTimer,!0)},getEmoji:function(){var e=this.onContextMenu,t=this.startPickerTimer,r=this.onEmoji,n=this.state.recent?this.state.recent:d[this.props.tab];return n.map(function(n){var i,o,a,s=c.codeToEmoji[n];if(c.skinToneEmojis[s]){o=function(t){e(t,s,t.target)},a=_.partial(t,_,s);var d;this.state.recent?(d=this.state.variants[s],d?(n=c.emojiMap[d],i=_.partial(r,d)):i=_.partial(r,s)):(d=Store.EmojiVariant.getVariant(s),d?(n=c.emojiMap[d],i=_.partial(r,d)):i=o)}else i=_.partial(r,s);return React.createElement("span",{key:s,onClick:i,onContextMenu:o,onMouseDown:a,className:"emojik emoji"+n})}.bind(this))},render:function(){var e="emoji-"+this.props.tab;return React.createElement("div",{className:e},this.getEmoji())}})},function(e,t){e.exports={people:["ordered1157","ordered1156","ordered1153","ordered1163","ordered0055","ordered1162","ordered1166","ordered1177","ordered1179","ordered1176","ordered1178","ordered1181","ordered1182","ordered1180","ordered1204","ordered1154","ordered1173","ordered1165","ordered1171","ordered1183","ordered1188","ordered1187","ordered1155","ordered1198","ordered1195","ordered1190","ordered1201","ordered1158","ordered1172","ordered1194","ordered1196","ordered1193","ordered1202","ordered1185","ordered1186","ordered1189","ordered1175","ordered1159","ordered1164","ordered1208","ordered1167","ordered1205","ordered1206","ordered1203","ordered1184","ordered1191","ordered1192","ordered1161","ordered0892","ordered1199","ordered1197","ordered1169","ordered1174","ordered1200","ordered1207","ordered1160","ordered1168","ordered1170","ordered0839","ordered0845","ordered0820","ordered0869","ordered0900","ordered0863","ordered0778","ordered0784","ordered0790","ordered0796","ordered0851","ordered0857","ordered0833","ordered0884","ordered0875","ordered1211","ordered1209","ordered1212","ordered1214","ordered1213","ordered1217","ordered1216","ordered1210","ordered1215","ordered0881","ordered0882","ordered1236","ordered1237","ordered1238","ordered0893","ordered0890","ordered0968","ordered1093","ordered0118","ordered0426","ordered0975","ordered0964","ordered0961","ordered0965","ordered0966","ordered0963","ordered0967","ordered0677","ordered0676","ordered0683","ordered0690","ordered0689","ordered0733","ordered0739","ordered0727","ordered0715","ordered0096","ordered0108","ordered0721","ordered0102","ordered0751","ordered0691","ordered0697","ordered0709","ordered0703","ordered1245","ordered1263","ordered0049","ordered0745","ordered0969","ordered1142","ordered1366","ordered1338","ordered0564","ordered0906","ordered0817","ordered0802","ordered0818","ordered0819","ordered0938","ordered0942","ordered0826","ordered1224","ordered1218","ordered0894","ordered1239","ordered0919","ordered0925","ordered0913","ordered0827","ordered1257","ordered1251","ordered1230","ordered0538","ordered0757","ordered0758","ordered0771","ordered0770","ordered0773","ordered0772","ordered0774","ordered0761","ordered0760","ordered0766","ordered0763","ordered0558","ordered0762","ordered0764","ordered0765","ordered0992","ordered0768","ordered0769","ordered0767","ordered0759","ordered0504","ordered0397","ordered0912","ordered0954","ordered0952","ordered0955","ordered0953","ordered0129","ordered0947","ordered0950","ordered0946","ordered0948","ordered0949","ordered0957","ordered0951","ordered0935","ordered0934","ordered0936","ordered0937","ordered0776","ordered0777","ordered0976","ordered0775","ordered0977"],nature:["ordered0667","ordered0671","ordered0662","ordered0658","ordered0670","ordered0661","ordered0669","ordered0660","ordered0653","ordered0672","ordered0668","ordered0674","ordered0659","ordered0636","ordered0666","ordered0631","ordered0665","ordered0630","ordered0637","ordered0673","ordered0652","ordered0651","ordered0649","ordered0650","ordered0648","ordered0633","ordered0626","ordered0647","ordered0640","ordered0642","ordered0641","ordered0643","ordered0625","ordered0638","ordered0639","ordered0645","ordered0644","ordered0657","ordered0664","ordered0624","ordered0617","ordered0628","ordered0613","ordered0616","ordered0618","ordered0620","ordered0622","ordered0627","ordered0629","ordered0632","ordered0634","ordered0635","ordered0614","ordered0615","ordered0663","ordered0646","ordered0623","ordered0656","ordered0655","ordered0619","ordered0621","ordered0654","ordered0675","ordered0941","ordered0435","ordered0434","ordered0443","ordered0436","ordered0438","ordered0437","ordered0444","ordered0446","ordered0445","ordered0442","ordered0441","ordered0447","ordered0433","ordered0432","ordered0430","ordered0431","ordered0428","ordered0429","ordered0439","ordered0411","ordered0425","ordered0424","ordered0421","ordered0412","ordered0413","ordered0414","ordered0415","ordered0416","ordered0417","ordered0418","ordered0419","ordered0423","ordered0422","ordered0420","ordered0408","ordered0409","ordered0410","ordered0406","ordered0407","ordered0427","ordered0143","ordered0043","ordered0083","ordered0044","ordered0077","ordered0047","ordered0121","ordered0082","ordered0395","ordered0396","ordered0403","ordered0405"],things:["ordered0522","ordered0956","ordered0523","ordered0527","ordered0528","ordered0524","ordered0515","ordered0516","ordered0525","ordered0526","ordered0507","ordered0883","ordered0509","ordered0508","ordered0505","ordered0520","ordered0518","ordered0519","ordered0517","ordered0521","ordered1102","ordered0534","ordered1051","ordered1052","ordered1055","ordered0995","ordered0996","ordered0993","ordered0994","ordered0991","ordered1045","ordered0045","ordered1026","ordered1027","ordered1028","ordered1029","ordered1053","ordered1054","ordered1066","ordered1065","ordered1064","ordered1063","ordered1076","ordered1077","ordered1030","ordered1031","ordered0033","ordered0027","ordered0032","ordered0026","ordered1075","ordered1074","ordered1071","ordered1072","ordered1073","ordered1070","ordered0960","ordered1094","ordered1062","ordered1061","ordered1068","ordered1067","ordered1069","ordered1359","ordered1353","ordered1352","ordered1350","ordered1095","ordered1097","ordered1096","ordered1316","ordered1318","ordered0962","ordered1099","ordered1098","ordered0933","ordered0932","ordered0980","ordered0984","ordered0985","ordered0987","ordered0986","ordered0983","ordered0988","ordered1046","ordered1035","ordered1033","ordered1032","ordered0095","ordered1037","ordered1036","ordered1043","ordered1039","ordered1038","ordered1040","ordered1041","ordered1042","ordered1034","ordered1025","ordered1000","ordered0999","ordered1013","ordered1006","ordered1004","ordered1005","ordered1024","ordered1007","ordered1001","ordered1002","ordered1003","ordered0997","ordered0998","ordered0092","ordered1008","ordered1010","ordered0115","ordered0114","ordered1011","ordered1012","ordered1017","ordered1019","ordered1020","ordered1021","ordered1015","ordered1016","ordered1014","ordered1022","ordered1018","ordered1078","ordered1023","ordered1100","ordered1101","ordered1044","ordered0537","ordered0541","ordered0533","ordered0536","ordered0557","ordered0550","ordered0551","ordered0554","ordered0556","ordered0555","ordered0552","ordered0553","ordered0891","ordered0543","ordered0150","ordered0549","ordered0149","ordered0547","ordered0544","ordered0583","ordered0561","ordered0080","ordered0081","ordered0559","ordered0546","ordered0584","ordered0548","ordered0088","ordered1332","ordered1326","ordered0562","ordered0577","ordered0576","ordered0560","ordered0563","ordered0585","ordered0570","ordered0532","ordered0048","ordered0496","ordered0497","ordered0503","ordered0501","ordered0502","ordered0499","ordered0500","ordered0498","ordered0495","ordered0464","ordered0463","ordered0474","ordered0466","ordered0465","ordered0472","ordered0470","ordered0479","ordered0492","ordered0478","ordered0480","ordered0468","ordered0467","ordered0469","ordered0471","ordered0493","ordered0477","ordered0476","ordered0494","ordered0473","ordered0484","ordered0489","ordered0481","ordered0483","ordered0482","ordered0506","ordered0491","ordered0485","ordered0486","ordered0487","ordered0488","ordered0490","ordered0457","ordered0458","ordered0453","ordered0454","ordered0461","ordered0450","ordered0452","ordered0462","ordered0460","ordered0451","ordered0455","ordered0459","ordered0456","ordered0475","ordered0449","ordered0448","ordered0440"],
places:["ordered0591","ordered0592","ordered0602","ordered0593","ordered0594","ordered0596","ordered0597","ordered0601","ordered0600","ordered0599","ordered0945","ordered0086","ordered0603","ordered0595","ordered0402","ordered0401","ordered0606","ordered0607","ordered0090","ordered0604","ordered1149","ordered1151","ordered1148","ordered0399","ordered0400","ordered0398","ordered1150","ordered0404","ordered0529","ordered0530","ordered0087","ordered0531","ordered1303","ordered0089","ordered1310","ordered1304","ordered0075","ordered1269","ordered0094","ordered0990","ordered1270","ordered1271","ordered1279","ordered1278","ordered1299","ordered1275","ordered1273","ordered1274","ordered1277","ordered1276","ordered1298","ordered1280","ordered1272","ordered1283","ordered1281","ordered1282","ordered1294","ordered1293","ordered1292","ordered1290","ordered1291","ordered1296","ordered1295","ordered1314","ordered1288","ordered1289","ordered1287","ordered1286","ordered1285","ordered1324","ordered1302","ordered1300","ordered1301","ordered1297","ordered0931","ordered1284","ordered0540","ordered1312","ordered1311","ordered0076","ordered1313","ordered1104","ordered0091","ordered0605","ordered0545","ordered0072","ordered1152","ordered0539","ordered0542","ordered1009","ordered1315","ordered0256","ordered0215","ordered0181","ordered0299","ordered0222","ordered0258","ordered0246","ordered0333","ordered0377","ordered0253","ordered0179","ordered0364","ordered0357","ordered0306","ordered0330","ordered0298","ordered0208","ordered0372","ordered0206","ordered0313","ordered0250","ordered0257","ordered0214","ordered0224","ordered0174","ordered0337","ordered0228","ordered0210","ordered0362","ordered1364","ordered0204","ordered0272","ordered0261","ordered0254","ordered0342","ordered0173","ordered0268","ordered0321","ordered0226","ordered0283","ordered0260","ordered0167","ordered0207","ordered0241","ordered0189","ordered0249","ordered0368","ordered0324","ordered0366","ordered0248","ordered0235","ordered0195","ordered0220","ordered0213","ordered0203","ordered1365"],symbols:["ordered0003","ordered0004","ordered0005","ordered0006","ordered0007","ordered0008","ordered0009","ordered0010","ordered0011","ordered0002","ordered1087","ordered1090","ordered0001","ordered1091","ordered0139","ordered0140","ordered0138","ordered0133","ordered1088","ordered1089","ordered1092","ordered0021","ordered0020","ordered0022","ordered0023","ordered0018","ordered0019","ordered1060","ordered0038","ordered0037","ordered1116","ordered1117","ordered0024","ordered0025","ordered0017","ordered0029","ordered0028","ordered0030","ordered0031","ordered0137","ordered0136","ordered0162","ordered1056","ordered1057","ordered1058","ordered0160","ordered0164","ordered0157","ordered0158","ordered0161","ordered1050","ordered0535","ordered0380","ordered0383","ordered0385","ordered0387","ordered0386","ordered0384","ordered0393","ordered0391","ordered0392","ordered0388","ordered0382","ordered1348","ordered1346","ordered1347","ordered1349","ordered1351","ordered1322","ordered1320","ordered0154","ordered0074","ordered1319","ordered0389","ordered0390","ordered0381","ordered0034","ordered1360","ordered1362","ordered1363","ordered1361","ordered0394","ordered0148","ordered0147","ordered0156","ordered0163","ordered0159","ordered1317","ordered1086","ordered1049","ordered1321","ordered1323","ordered1325","ordered1344","ordered1345","ordered0085","ordered0119","ordered0122","ordered0124","ordered0093","ordered0120","ordered0958","ordered0165","ordered1047","ordered1048","ordered0151","ordered0152","ordered0155","ordered0153","ordered0959","ordered0135","ordered0073","ordered0056","ordered0057","ordered0058","ordered0059","ordered0060","ordered0061","ordered0062","ordered0063","ordered0064","ordered0065","ordered0066","ordered0067","ordered0084","ordered1103","ordered0598","ordered0989","ordered0982","ordered0981","ordered0012","ordered0013","ordered0016","ordered0146","ordered0145","ordered1085","ordered1082","ordered1081","ordered1083","ordered1084","ordered0123","ordered0144","ordered0128","ordered0125","ordered0127","ordered0126","ordered1059","ordered1129","ordered1141","ordered1118","ordered1130","ordered1119","ordered1131","ordered1120","ordered1132","ordered1121","ordered1133","ordered1122","ordered1134","ordered1123","ordered1124","ordered1125","ordered1126","ordered1127","ordered1128","ordered1135","ordered1136","ordered1137","ordered1138","ordered1139","ordered1140","ordered0117","ordered0130","ordered0131","ordered0132","ordered0068","ordered0070","ordered0069","ordered0071","ordered0978","ordered0979","ordered0116","ordered0046","ordered1080","ordered1079","ordered0134","ordered1105","ordered1106","ordered1107","ordered0040","ordered0039","ordered0042","ordered0041","ordered0035","ordered0036","ordered1114","ordered0142","ordered0141","ordered0079","ordered0078","ordered1108","ordered1109","ordered1115","ordered1110","ordered1111","ordered1112","ordered1113"]}},function(e,t,r){function n(e,t,r,n,i,o){for(var a=!0;a;){var s=e,c=t,d=r,u=n,l=i,p=o;if(f=m=g=h=void 0,a=!1,d>u)return-1;var h,f=Math.round((d+u)/2),m=s[f],g=m.offsetLeft-l;if(g>=c)h=p;else{if(g+m.clientWidth>c)return f;h=!p}h?(e=s,t=c,r=d,n=f-1,i=l,o=p,a=!0):(e=s,t=c,r=f+1,n=u,i=l,o=p,a=!0)}}function i(e,t){for(var r=0,n=e.childNodes,i=0;i<n.length;i++){var o=n[i];if(o===t)break;r+=o.clientWidth}return r}var o=r(163),a=r(15),s=r(438),c=r(467),d=r(235),u=r(144),l=r(150),p=r(166),h=React.addons.PureRenderMixin,f=4096,m={SMALL:"small",LARGE:"large"},g=React.createClass({displayName:"EmojiText",mixins:[c,s,d,h],statics:{EMOJI_SIZE:m},propTypes:{text:React.PropTypes.string,emojiSize:React.PropTypes.oneOf(_.values(m)),element:React.PropTypes.any,classes:React.PropTypes.string,direction:React.PropTypes.string,linkify:React.PropTypes.bool,titlify:React.PropTypes.bool,ellipsify:React.PropTypes.bool,selectable:React.PropTypes.bool,wbr:React.PropTypes.number,dirMismatch:React.PropTypes.bool},getInitialState:function(){return this.debouncedRecompute=this.safeDebounce(this.recompute,20),this.reged=!1,{ellipsified:null}},getDefaultProps:function(){return{emojiSize:m.SMALL,element:"span"}},componentWillMount:function(){a.isWebkit&&this.props.ellipsify&&this.containsEmoji()&&this.regResizeListener()},componentWillReceiveProps:function(e){if(a.isWebkit&&this.props.ellipsify&&e.text!==this.props.text){var t=(e.text||"").substring(0,f);o.containsEmoji(t)?(this.setState({ellipsified:null},this.ellipsify),this.containsEmoji()||this.regResizeListener()):(this.setState({ellipsified:null}),this.containsEmoji()&&this.unregResizeListener())}},containsEmoji:function(){var e=(this.props.text||"").substring(0,f);return o.containsEmoji(e)},regResizeListener:function(){this.reged||(this.regNativeListener(window,"resize",this.debouncedRecompute),this.regCmd("resize",this.debouncedRecompute),this.reged=!0)},unregResizeListener:function(){this.reged&&(this.unregNativeListener(window,"resize",this.debouncedRecompute),this.unregCmd("resize",this.debouncedRecompute),this.reged=!1)},recompute:function(){this.setState({ellipsified:null},this.ellipsify)},ellipsifyCheck:function(){this.isMounted()&&this.containsEmoji()&&this.ellipsify()},componentDidMount:function(){a.isWebkit&&this.props.ellipsify&&(u.uiBusy?l.waitForBBEvent(u,"ui_idle").then(this.ellipsifyCheck)["catch"](Promise.CancellationError,_.noop):this.ellipsifyCheck())},ellipsify:function(){var e=this.getDOMNode();if(e){var t=e.querySelectorAll("img");if(0!==t.length){var r,o=!l10n.isRTL(),a=0;if(r=e.clientWidth){if(r===e.scrollWidth)return;a=0}else{var s=e.parentNode;if(a=i(s,e),r=s.clientWidth-a,s.clientWidth===s.scrollWidth)return}var c=n(t,o?r:0,0,t.length-1,o?a:0,o);if(!(0>c)){var d=t[c],u=10;u-=Math.floor(u/4);var l=n(t,o?r-u:u,0,c,o?a:0,o);l>-1&&(d=t[l]);for(var p=e.childNodes,h=[],f=0;f<p.length;f++){var m=p[f];if(m===d)break;3===m.nodeType?h.push(m.textContent||""):h.push(m.alt||"")}if(h.length){var g=h.length-1;h[g]=h[g].trimRight()}this.setState({ellipsified:h.join("")})}}}},render:function(){if(!this.props.text)return null;var e=this.state.ellipsified;e||(e=this.props.ellipsify?(this.props.text||"").substring(0,f):this.props.text);var t,r=this.props.wbr,n=this.props.selectable?"selectable-text":void 0;this.props.linkify?t=Wa.linkify(e,!0,r,n):(e=r&&e.length>r?Wa.wbr(e,r):e,t=o.emojiToHTML(_.escape(e),n,this.props.emojiSize)),this.state.ellipsified&&(t+="&hellip;");var i=p(this.props.classes,{emojitext:!this.props.classes,ellipsify:this.props.ellipsify,"inverse-text-direction":this.props.dirMismatch,"selectable-text":this.props.selectable}),a=this.props.element;return this.props.titlify?React.createElement(a,{className:i,dir:this.props.direction,title:this.props.text,dangerouslySetInnerHTML:{__html:t}}):React.createElement(a,{className:i,dir:this.props.direction,dangerouslySetInnerHTML:{__html:t}})}});e.exports=g},function(e,t){var r=React.createClass({displayName:"FloatingPlaceholder",propTypes:{children:React.PropTypes.node.isRequired,placeholder:React.PropTypes.string,hasText:React.PropTypes.bool},render:function(){var e="placeholder";return this.props.hasText&&(e+=" placeholder-enter"),this.props.placeholder?React.createElement("div",{className:"floating-placeholder"},React.createElement("span",{className:e},this.props.placeholder),this.props.children):this.props.children}});e.exports=r},function(e,t,r){var n=r(4),i=r(437),o=r(144),a=r(15),s={GUIDE_ALLOW:"guide-allow",GUIDE_UNBLOCK:"guide-unblock",GUIDE_NONE:"guide-none"},c={CHROME_MEDIA_ERROR:"__chrome_media_error__",FIREFOX_LOCK:"__firefox_lock__",OPERA_MEDIA:"__opera_media__"},d=React.createClass({displayName:"GuidePopup",propTypes:{title:React.PropTypes.string.isRequired,desc:React.PropTypes.string.isRequired,browserPrefixDesc:React.PropTypes.bool.isRequired,type:React.PropTypes.oneOf(_.values(s)).isRequired,onConfirm:React.PropTypes.func,onCancel:React.PropTypes.func},statics:{TYPE:s},getDefaultProps:function(){return{browserPrefixDesc:!0,type:s.GUIDE_NONE,onConfirm:o.closeModal.bind(o)}},componentDidMount:function(){var e=this.getDescription(),t=this.refs.description.getDOMNode();e.indexOf(c.CHROME_MEDIA_ERROR)>-1&&(t.innerHTML=t.innerHTML.replace(c.CHROME_MEDIA_ERROR,'<span class="chrome-media-icon"></span>')),e.indexOf(c.FIREFOX_LOCK)>-1&&(t.innerHTML=t.innerHTML.replace(c.FIREFOX_LOCK,'<span class="firefox-lock-icon"></span>')),e.indexOf(c.OPERA_MEDIA)>-1&&(t.innerHTML=t.innerHTML.replace(c.OPERA_MEDIA,'<span class="opera-media-icon"></span>'))},getDescription:function(){var e=this.props.desc+"_"+a.browser;return this.props.browserPrefixDesc&&l10n.hasT(e)?l10n.t(e):l10n.t(this.props.desc)},render:function(){var e="popup-guide";if(a.browser===n.BROWSER_TYPE.CHROME)switch(a.os){case n.OS_TYPE.MAC:e+=" popup-guide-mac";break;case n.OS_TYPE.CHROMEOS:e+=" popup-guide-chrome";break;case n.OS_TYPE.WINDOWS:}var t=null;this.props.type!==s.GUIDE_NONE&&a.browser===n.BROWSER_TYPE.CHROME&&(t=React.createElement("div",{className:"round"},React.createElement("div",{className:"round-body "+this.props.type})));var r=this.props.onCancel?l10n.t("learn_more"):void 0;return React.createElement(i,{title:l10n.t(this.props.title),classes:e,onOK:this.props.onConfirm,okText:l10n.t("ok_got_it"),onCancel:this.props.onCancel,cancelText:r},t,React.createElement("div",{className:"text text-tip",ref:"description"},this.getDescription()))}});e.exports=d},function(e,t,r){function n(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}var i=r(474),o=r(475),a=r(470),s=r(464),c=r(231),d=r(144),u=r(450),l=r(477),p=r(166),h=500,f=React.createClass({displayName:"ProfileViewerModal",mixins:[l],propTypes:{contact:React.PropTypes.instanceOf(c),getZoomNode:React.PropTypes.func.isRequired},getInitialState:function(){return{formattedUser:this.async("contact.formattedUser"),imgFull:this.async("contact.profilePicThumb.imgFull"),style:{visibility:"hidden"}}},componentWillMount:function(){u.push(this,u.MEDIA_VIEWER)},close:function(){var e=void 0;if(this.props.getZoomNode(function(t){e=t}),!e)return d.closeModal();var t=this.refs.image.getDOMNode(),r=t.getBoundingClientRect(),n=e.getBoundingClientRect(),i=n.top-r.top,o=n.left-r.left,a=e.clientWidth/t.clientWidth;d.closeModal(),Velocity(t,{translateX:[o,0],translateY:[i,0],scale:[a,1]},{duration:200,easing:[.1,.82,.25,1]})},onClose:function(){u.find(u.MEDIA_VIEWER)&&u.pop(u.MEDIA_VIEWER)},onImageLoad:function(e){var t=this,r=e.target;this.setState({size:{width:r.clientWidth,height:r.clientHeight}},function(){t.props.getZoomNode(function(e){var n=r.getBoundingClientRect(),i=e.getBoundingClientRect(),o=i.top-n.top,a=i.left-n.left,s=e.clientWidth/r.clientWidth;t.setState({style:{visibility:"hidden",transform:"translateX("+a+"px) translateY("+o+"px) scale("+s+")",borderRadius:"50%",transition:"transform 0s"}},function(){t.setState({style:{transform:"translateX(0px) translateY(0px) scale(1)",borderRadius:"0%",transition:"transform "+h+"ms cubic-bezier(.1,.82,.25,1),\n                                         border-radius "+h+"ms cubic-bezier(.1,.82,.25,1)"}})})})})},render:function(){var e=this.props,t=e.contact,r=(n(e,["contact"]),p("media-viewer","media-viewer-animate"));return React.createElement("div",{className:r,onWheel:this.onScroll,onClick:this.onClose},React.createElement("div",{className:"media-panel-header"},React.createElement("div",{className:"chat media-chat"},React.createElement("div",{className:"chat-avatar"},React.createElement(o,{id:t.id})),React.createElement("div",{className:"chat-body"},React.createElement("div",{className:"chat-main"},React.createElement(a,{text:this.state.formattedUser})))),React.createElement("div",{className:"menu menu-horizontal media-panel-tools"},React.createElement("div",{className:"menu-item"},React.createElement("button",{className:"icon icon-l btn-media-share icon-x-viewer",title:l10n.t("web_close"),onClick:this.onClose},l10n.t("web_close"))))),React.createElement("div",{className:"media-content",dir:"ltr",ref:"container"},React.createElement("div",{className:"media"},React.createElement(s,{type:s.TYPES.SCALE_DOWN,size:this.state.size},React.createElement("div",{className:"profile-viewer",ref:"image",style:this.state.style},React.createElement(i,{src:this.state.imgFull,hasPrivacyChecks:!0,onLoad:this.onImageLoad}))))))}});e.exports=f},function(e,t,r){function n(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(240),a=r(20),s=r(435),c=r(150),d=r(19),u=r(151),l=r(4),p=10,h=React.createClass({displayName:"ImageTag",mixins:[s],propTypes:{hasPrivacyChecks:React.PropTypes.bool},getInitialState:function(){var e=new Image;return e.src=this.props.src,e.complete?{src:this.props.src}:(this.ensureLoaded(this.props.src),{src:null})},componentWillReceiveProps:function(e){this.props.src!==e.src&&this.ensureLoaded(e.src)},componentWillUnmount:function(){this.ensureLoadedPromise&&this.ensureLoadedPromise.cancel()},ensureLoaded:function(e){var t=this;this.ensureLoadedPromise&&this.ensureLoadedPromise.cancel(),this.ensureLoadedPromise=c.loopOnError(u.ShouldLoop,Promise.TimeoutError,function(r){if(r>=p)throw new u.ImageError("Too many image retries",e);var n;return n=t.props.hasPrivacyChecks&&!o.phoneActive&&r>0?c.waitForBBEvent(o,"change:phoneActive",_.matches({phoneActive:!0})):a.state===a.STATE.CONNECTED?Promise.delay(Math.floor(1e3*Wa.expBackoff(r,60,void 0,.1))):c.waitForBBEvent(a,"change:state",_.matches({state:a.STATE.CONNECTED})),r>0&&Wa.isHttpUrl(e)&&(n=n.then(function(){return new Promise(function(r,n){d.get(e).then(function(i){var o=i.status;o>=200&&400>o?r():o>=500?n(new u.ShouldLoop):(t.props.onError(o),n(new u.ImageError("Image error: "+o,e)))})["catch"](function(e){n(new u.ShouldLoop)})})}).timeout(3e4,"imageTagRetryTimeout")),n.then(function(){return new Promise(function(t,r){var n=function(t){r(Wa.isHttpUrl(e)?new u.ShouldLoop:new u.ImageError("Invalid Data URI",e))},i=new Image;i.onload=function(){t(e)},i.onerror=n,i.src=e})}).then(function(e){t.isMounted()&&t.setState({src:e})})})["catch"](Promise.CancellationError,_.noop)["catch"](u.ImageError,this.props.onError||_.noop)["finally"](function(){delete t.ensureLoadedPromise})},render:function(){var e,t,r=this.props,o=(r.src,r.onLoad,n(r,["src","onLoad"]));return this.state.src?(t=this.state.src,e=this.props.onLoad):(t=l.ONE_BY_ONE_TRANS_GIF,e=null),React.createElement("img",i({src:t,onLoad:e},o))}});e.exports=h},function(e,t,r){var n=r(476),i=r(477),o=r(436),a="large",s="regular",c="low",d="high",u=React.createClass({displayName:"DetailImage",mixins:[i],propTypes:{id:React.PropTypes.string.isRequired,size:React.PropTypes.oneOf([s,a]),loader:React.PropTypes.bool,quality:React.PropTypes.oneOf([c,d]),onClick:React.PropTypes.func,onLoad:React.PropTypes.func},getDefaultProps:function(){return{size:s,quality:c}},statics:{LARGE:a,REGULAR:s,LOW:c,HIGH:d},getInitialState:function(){var e=this.props.quality;return Wa.isBroadcastWid(this.props.id)?{loaded:!1}:e===u.HIGH?{loaded:!1,imgFull:this.async("id.ProfilePicThumb.imgFull",null)}:e===u.LOW?{loaded:!1,img:this.async("id.ProfilePicThumb.img",null)}:void 0},onLoad:function(e){this.state.loaded||this.setState({loaded:!0}),this.props.onLoad&&this.props.onLoad()},onError:function(e){if(410===e){var t=Store.ProfilePicThumb.get(this.props.id);t&&t.update()}},getClasses:function(){var e="avatar",t=this.props.id;return Wa.isUserWid(t)?e+=" icon-user-default":Wa.isGroupWid(t)?e+=" icon-group-default":Wa.isBroadcastWid(t)&&(e+=" icon-broadcast-default"),this.props.size===u.LARGE&&(e+=" avatar-l"),e},getStyle:function(){return this.props.onClick?{cursor:"pointer"}:null},render:function(){var e=this.state.img||this.state.imgFull,t=void 0;return!this.props.loader||this.state.loaded&&e||(t=React.createElement("div",{className:"avatar-spinner-container"},React.createElement(o,{size:50,stroke:3}))),e=e?React.createElement(n,{src:e,onLoad:this.onLoad,onError:this.onError}):null,React.createElement("div",{className:this.getClasses(),style:this.getStyle(),onClick:this.props.onClick},e,t)}});e.exports=u},function(e,t,r){function n(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(474),a=r(166),s=React.createClass({displayName:"ImageLoader",propTypes:{src:React.PropTypes.string.isRequired,onError:React.PropTypes.func},getInitialState:function(){return{loaded:!1}},componentWillMount:function(){var e=new Image;e.src=this.props.src,e.complete&&this.onLoad()},onLoad:function(e){this.state.isLoaded||this.setState({loaded:!0}),this.props.onLoad&&this.props.onLoad(e)},render:function(){var e=this.props,t=e.className,r=(e.onLoad,n(e,["className","onLoad"]));return t=a("avatar-image",t,{"is-loaded":this.state.loaded}),React.createElement(o,i({hasPrivacyChecks:!0,onLoad:this.onLoad,className:t},r))}});e.exports=s},function(e,t,r){var n=r(14),i=r(151),o=r(144),a=r(150),s={getInitialState:function(){return this._asyncs={},{}},async:function(e,t,r){var s=e.split(".");t=t||this.props;var c=this._getAsyncIndex(s),d=t[s[0]],u=c>1?d.getp(s.slice(1,c).join(".")):d;if(!u)throw new Error("async base did not resolve to a value");var l,p,h=_.isString(u)?u:u.getp("id"),f=this._getKeyPath(s);if(c>0?(l=Store[s[c]],p=l.get(h)):(p=u,l=p.getCollection()),!p)return n.log("asyncMixin:async Non-existing state in AsyncMixin!","red",{baseId:h,key:e})();if(l.isStateStale(h)){var m=this;if(o.uiBusy){var g=this._waAsyncWaits||(this._waAsyncWaits=[]),v=a.waitForBBEvent(o,"ui_idle").then(function(){l.find(h)["catch"](i.WapDrop,_.noop)})["catch"](Promise.CancellationError,_.noop)["finally"](function(){m._waAsyncWaits=_.without(m._waAsyncWaits,v)});g.push(v)}else l.find(h)["catch"](i.WapDrop,_.noop)}return this._addObserver(p,e,u),p.getp(f)},componentWillReceiveProps:function(e){var t=this._asyncs;for(var r in e){var n=t[r];if(n)for(var i in n){var o=n[i];if(o.base!==e[r]){var a=i.split("."),s=this._getObserverKeyPath(a),c=this._getStateKey(a),d=o.object,u=o.callback,l=o.context;d.off("change:"+s,u,l),d.isState&&d._uiObservers--;var p={};p[c]=this.async(i,e),this.setState(p)}}}},componentWillUnmount:function(){this._waAsyncUnmount=!0;var e=this._waAsyncWaits;if(e)for(;e.length;)e.shift().cancel();var t=this._asyncs;for(var r in t)for(var n in t[r]){var i=this._getObserverKeyPath(n.split(".")),o=t[r][n].object,a=t[r][n].callback,s=t[r][n].context;o.off("change:"+i,a,s),o.isState&&o._uiObservers--}},_addObserver:function(e,t,r){var n=t.split("."),i=this._getKeyPath(n),o=this._getObserverKeyPath(n),a=this._asyncs,s=function(){if(this.isMounted()){var t={};t[this._getStateKey(n)]=e.getp(i),this.setState(t)}};a[n[0]]=a[n[0]]||{},a[n[0]][t]={object:e,base:r,callback:s,context:this},e.on("change:"+o,s,this),e.isState&&e._uiObservers++},_getStateKey:function(e){return e[e.length-1]},_getKeyPath:function(e){for(var t=e.length,r=0;r<e.length;r++)if(0===e.indexOf("@")){t=r;break}var n=this._getAsyncIndex(e);return e.slice(n+1,t).join(".")},_getObserverKeyPath:function(e){var t=this._getAsyncIndex(e);return e.slice(t+1).join(".")},_getAsyncIndex:function(e){for(var t=0,r=1;r<e.length;r++)if(e[r].charAt(0).toLowerCase()!==e[r].charAt(0)){t=r;break}return t}};e.exports=s},function(e,t,r){var n=r(479),i=r(4),o={createThumbAndFull:function(e){return Promise.props({thumb:this.resize(e,i.PROF_PIC_THUMB_SIDE,i.PROF_PIC_THUMB_SIDE),full:this.resize(e,i.MAX_PIC_SIDE,i.MAX_PIC_SIDE)})},readFile:function(e){return new Promise(function(t,r){var n=new FileReader;n.readAsDataURL(e),n.onload=function(r){return t({file:e,url:this.result})},n.onabort=function(e){return r("onabort",e)},n.onerror=function(e){return r("onerror",e)}})},generateVideoThumb:function(e){return new Promise(function(t,r){var n=document.createElement("video");n.autoplay=!1,n.loop=!1,n.onloadeddata=function(){var e=document.createElement("canvas");e.height=n.videoHeight,e.width=n.videoWidth;var r=e.getContext("2d");return r.drawImage(n,0,0,n.videoWidth,n.videoHeight),t({url:e.toDataURL("image/jpeg"),width:n.videoWidth,height:n.videoHeight})},n.error=function(e){r(e)},n.src=e,n.load()})},resizeAndOrient:function(e,t,r){return new Promise(function(i,a){if(!e.type.match("image.*"))return a("Invalid image file",e);var s=new FileReader,c=new Image;s.onload=function(){n(this.result,function(e){c.src=e})},c.onload=function(){if(0===this.width||0===this.height)return a("Invalid image",c);var e=document.createElement("canvas"),n=o.boundWidthHeight(c.width,c.height,t,r);e.width=n.width,e.height=n.height;var s=e.getContext("2d");return s.drawImage(c,0,0,n.width,n.height),i({url:e.toDataURL("image/jpeg"),width:n.width,height:n.height})};var d=function(e){return a("onabort",e)},u=function(e){return a("onerror",e)};s.onabort=d,s.onerror=u,c.onabort=d,c.onerror=u,s.readAsDataURL(e)})},crop:function(e,t,r,n,i,o,a){return new Promise(function(s,c){var d=document.createElement("canvas"),u=d.getContext("2d"),l=new Image;l.onload=function(){return o&&a?(d.height=a,d.width=o,u.drawImage(l,t,r,n,i,0,0,o,a)):(d.height=i,d.width=n,u.drawImage(l,t,r,n,i)),s({url:d.toDataURL("image/jpeg"),width:n,height:i})};var p=function(e){return c("onabort",e)},h=function(e){return c("onerror",e)};0!==e.indexOf("data:")&&l.setAttribute("crossOrigin","anonymous"),l.onabort=p,l.onerror=h,l.src=e})},boundWidthHeight:function(e,t,r,n){return e=e||r,t=t||n,e>t?e>r&&(t*=r/e,e=r):t>n&&(e*=n/t,t=n),{width:e,height:t}}};e.exports=o},,,,,,,,,,,function(e,t,r){function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var i=r(438),o=r(439),a=React.createClass({displayName:"Draggable",mixins:[i],propTypes:{children:React.PropTypes.node.isRequired,start:React.PropTypes.shape({x:React.PropTypes.number,y:React.PropTypes.number}),scale:React.PropTypes.number,container:React.PropTypes.shape({width:React.PropTypes.number.isRequired,height:React.PropTypes.number.isRequired}),onStart:React.PropTypes.func,onDrag:React.PropTypes.func,onStop:React.PropTypes.func},getInitialState:function(){return{dragging:!1,x:0,y:0,offsetX:0,offsetY:0}},componentDidMount:function(){this.updateContainer()},componentWillReceiveProps:function(e){e.scale!==this.props.scale||e.container.width!==this.props.container.width||e.container.height!==this.props.container.height?this.updateContainer(e,!0):this.updateContainer(e)},updateContainer:function(e,t){e=e||this.props;var r=e.container;if(r&&this.refs.draggable){var n,i=this.refs.draggable.getDOMNode(),o=this.state.x,a=this.state.y,s=i.width*e.scale,c=i.height*e.scale;this.props.scale!==e.scale&&this.state.center?(n=this.state.center,o=r.width/2-n.x*s,a=r.height/2-n.y*c):n={x:(r.width/2-o)/s,y:(r.height/2-a)/c},o>0?o=0:o+s<r.width&&(o=r.width-s),a>0?a=0:a+c<r.height&&(a=r.height-c),this.setState({width:s,height:c,x:o,y:a,center:n}),this.props.onStop&&t&&e.onStop(o,a)}},handleMouseDown:function(e){e.preventDefault(),this.setState({dragging:!0,offsetX:e.clientX-this.state.x,offsetY:e.clientY-this.state.y}),this.regNativeListener(window,"mousemove",this.handleMouseMove),this.regNativeListener(window,"mouseup",this.handleMouseUp),this.props.onStart&&this.props.onStart()},handleMouseUp:function(e){this.unregisterListeners(),this.setState({dragging:!1}),this.props.onStop&&this.props.onStop(this.state.x,this.state.y)},handleMouseMove:function(e){if(this.state.dragging){var t=e.clientX-this.state.offsetX,r=e.clientY-this.state.offsetY,n=this.props.container;n&&((t>0||t+this.state.width<n.width)&&(t=this.state.x),(r>0||r+this.state.height<n.height)&&(r=this.state.y)),this.setState({x:t,y:r}),this.props.onDrag&&this.props.onDrag(t,r)}},render:function(){var e=this.props.scale?" scale("+this.props.scale+")":"",t=n({},o.prefix("transform"),"translate("+this.state.x+"px, "+this.state.y+"px)"+e);this.state.dragging||(t[o.prefix("transition")]="transform 200ms");var r="draggable";return this.state.dragging&&(r+=" dragging"),React.addons.cloneWithProps(React.Children.only(this.props.children),{style:t,draggable:!0,ref:"draggable",className:r,onMouseDown:this.handleMouseDown})}});e.exports=a},function(e,t,r){var n=r(465),i=r(440),o=r(436),a=r(166),s=r(450),c=React.createClass({displayName:"TextField",propTypes:{id:React.PropTypes.string,value:React.PropTypes.string.isRequired,placeholder:React.PropTypes.string,editable:React.PropTypes.bool,pending:React.PropTypes.bool,maxLength:React.PropTypes.number,showRemaining:React.PropTypes.bool,validate:React.PropTypes.func,onChange:React.PropTypes.func,onSave:React.PropTypes.func,onCancel:React.PropTypes.func},getDefaultProps:function(){return{placeholder:"",id:"",maxLength:25,editable:!1,showRemaining:!1,forceCancel:!1}},getInitialState:function(){return{editing:!1,value:this.props.value}},componentWillReceiveProps:function(e){this.setState({value:e.value})},onEdit:function(){this.setState({editing:!0})},onSave:function(e){e&&(e.preventDefault(),e.stopPropagation());var t=!0;this.props.validate&&(t=this.props.validate(this.props.value)),t?(this.props.onSave&&this.props.onSave(),this.setState({editing:!1})):this.props.onError&&this.props.onError()},close:function(){this.onCancel()},focus:function(){this.refs.input.focus()},onCancel:function(){this.state.editing&&this.setState({editing:!1},this.props.onCancel)},render:function(){var e,t=a({textfield:!0,"textfield-editable":this.props.editable,active:this.state.editing});return this.props.pending?e=React.createElement("div",{className:"icon icon-spinner"},React.createElement(o,{size:18,stroke:6})):this.state.editing?e=React.createElement("span",{className:"icon icon-checkmark",onClick:this.onSave,key:"btn-done",title:l10n.t("click_to_save_esc_to_cancel")},l10n.t("save_button")):this.props.editable&&(e=React.createElement("span",{className:"icon icon-pencil","data-ignore-capture":s.IGNORE_ANY,onClick:this.onEdit,key:"btn-edit",title:l10n.t("edit_button")},l10n.t("edit_button"))),React.createElement("div",{className:t},React.createElement(n,{id:this.props.id,ref:"input",placeholder:this.props.placeholder,value:this.state.value,editable:this.state.editing,maxLength:this.props.maxLength,showRemaining:this.props.showRemaining,onEnter:this.onSave,onChange:this.props.onChange,onCancel:this.onCancel,parent:this}),React.createElement(i,{transitionName:"pop",component:"div",className:"textfield-controls"},e))}});e.exports=c},function(e,t,r){var n=r(14),i=r(144),o=r(492),a=r(437),s=r(493),c={title:0,hour:1,day:24,week:168},d=React.createClass({displayName:"DoNotDisturbPopup",getInitialState:function(){return{notifications:Store.Mute.getGlobalNotifications(),sounds:Store.Mute.getGlobalSounds(),dnd:c.title}},componentWillUnmount:function(){this.state.dnd!==c.title&&i.openToast(React.createElement(s,{msg:this.globalMuteDurationLabel(this.state.dnd),id:s.genId()}))},globalMuteDurationLabel:function(e){switch(this.state.dnd){case 1:return l10n.t("global_muted_1hour");case 24:return l10n.t("global_muted_1day");case 168:return l10n.t("global_muted_1week");default:return n.log("DoNotDisturbPopup:globalMuteDurationLabel non standard global mute duration:"+e)(),l10n.t("global_muted")}},onSounds:function(){var e=!this.state.sounds;this.setState({sounds:e}),Store.Mute.setGlobalSounds(e)},onNotifications:function(){var e=!this.state.notifications;this.setState({notifications:e}),Store.Mute.setGlobalNotifications(e)},onDND:function(e){var t=parseInt(e.target.value,10);if(0===t)return this.setState({dnd:c.title}),void Store.Mute.globalMute().unmute();this.setState({dnd:t});var r=moment().unix()+60*e.target.value*60;Store.Mute.globalMute().mute(r)},onClose:function(e){i.closeModal()},render:function(){return React.createElement(a,{title:l10n.t("menuitem_notifications"),okText:l10n.t("web_ok"),onOK:this.onClose},React.createElement("div",{className:"section",onClick:this.onNotifications},React.createElement("span",{"data-a8n":Wa.a8n("menu-icon-notifications"),className:"menu-icon inline"},React.createElement(o,{onChange:this.onNotifications,checked:this.state.notifications})),l10n.t("option_desktop_notifications")),React.createElement("div",{className:"section",onClick:this.onSounds},React.createElement("span",{"data-a8n":Wa.a8n("menu-icon-notifications"),className:"menu-icon inline"},React.createElement(o,{onChange:this.onSounds,checked:this.state.sounds})),l10n.t("option_sounds")),React.createElement("div",{className:"section"},React.createElement("div",{className:"select"},React.createElement("select",{value:this.state.dnd,onChange:this.onDND},React.createElement("option",{value:c.title,disabled:this.state.state===c.title},l10n.t("option_select_mute")),React.createElement("option",{value:c.hour,disabled:this.state.state===c.hour},l10n.t("mute_1hour")),React.createElement("option",{value:c.day,disabled:this.state.state===c.day},l10n.t("mute_1day")),React.createElement("option",{value:c.week,disabled:this.state.state===c.week},l10n.t("mute_1week"))))))}});e.exports=d},function(e,t,r){var n=r(438),i=r(166),o=React.createClass({displayName:"CheckBox",mixins:[n],propTypes:{checked:React.PropTypes.bool.isRequired,onChange:React.PropTypes.func.isRequired},getInitialState:function(){return{checked:this.props.checked,transition:null}},statics:{BOX:"box",CHECKMARK:"checkmark"},componentDidMount:function(){this.regNativeListener(this.refs.checkbox.getDOMNode(),"animationEnd",this.onAnimationEnd)},componentWillReceiveProps:function(e){if(this.state.checked!==e.checked){var t=this.state.checked?o.CHECKMARK:o.BOX;this.setState({transition:t})}},onAnimationEnd:function(){if(this.state.transition===o.CHECKMARK&&this.state.checked||this.state.transition===o.BOX&&!this.state.checked){
var e=this.state.transition===o.CHECKMARK?o.BOX:o.CHECKMARK;this.setState({transition:e})}else this.setState({transition:null,checked:!this.state.checked})},onToggle:function(e){e&&e.stopPropagation(),this.props.onChange()},render:function(){var e=i("checkbox",this.state.transition,{checked:this.state.checked,unchecked:!this.state.checked});return React.createElement("div",{className:"checkbox-container",onClick:this.onToggle},React.createElement("div",{className:e,ref:"checkbox"}))}});e.exports=o},function(e,t,r){var n=r(144),i=r(235),o=r(166),a=4e3,s=React.createClass({displayName:"Toast",mixins:[i],propTypes:{id:React.PropTypes.string.isRequired,msg:React.PropTypes.string.isRequired,action:React.PropTypes.shape({actionText:React.PropTypes.string.isRequired,onAction:React.PropTypes.func.isRequired}),onDismiss:React.PropTypes.func,duration:React.PropTypes.number},statics:{genId:function(e){return _.uniqueId(e||"toast")}},getDefaultProps:function(){return{duration:a}},componentWillMount:function(){this.delay=this.safeDelay(function(){n.closeToast(this)},a)},restartDelay:function(){this.clearSafeTimeout(this.delay),this.delay=this.safeDelay(function(){n.closeToast(this)},a)},onDismiss:function(){n.closeToast(this),this.props.onDismiss&&this.props.onDismiss()},render:function(){var e,t=this.props,r=t.msg,n=t.action,i=t.className;return n&&(e=React.createElement("button",{className:"action",onClick:n.onAction},n.actionText)),React.createElement("div",{className:o("toast",i)},React.createElement("span",null,r),e,React.createElement("button",{className:"icon icon-x-alt",onClick:this.onDismiss}))}});e.exports=s},function(e,t,r){var n=r(495),i=r(496),o=r(144),a=React.createClass({displayName:"NewChatFlow",mixins:[n],componentWillMount:function(){this.push(React.createElement(i,{title:l10n.t("new_chat_flow_title"),onBack:this.endFlow,onClick:this.onClick}))},onClick:function(e,t){Store.Chat.find(t.id).then(o.openChat.bind(o)),this.endFlow()}});e.exports=a},function(e,t,r){function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var i,o=r(144),a=r(166),s=r(450),c=r(440),d=(i={},n(i,s.DRAWER_LEFT,"drawer-container-left"),n(i,s.DRAWER_RIGHT,"drawer-container-right"),n(i,s.DRAWER_MID,"drawer-container-mid"),n(i,s.MODAL,"modal"),i),u={PUSH:"-push",POP:"-pop",DEFAULT_DRAWER:"flow-transition-drawer",DEFAULT_MODAL:"flow-transition-modal"},l={propTypes:{type:React.PropTypes.oneOf(_.keys(d))},getDefaultProps:function(){return{type:d[s.MODAL]}},getInitialState:function(){return{_stack:[]}},endFlow:function(){this.props.type===d.MODAL?o.closeModal():o.closeDrawer(this.props.type)},push:function(e,t){this.state._stack.push(e),this.setState({_stack:this.state._stack,_transition:(t||this.props.transition||u.DEFAULT_MODAL)+u.PUSH})},pop:function(e,t){if(this.state._stack.pop(),e){var r=_.last(this.state._stack);e.key=_.uniqueId("flow_"),r=React.addons.cloneWithProps(r,e),this.state._stack.splice(this.state._stack.length-1,1,r)}this.setState({_stack:this.state._stack,_transition:(t||this.props.transition||u.DEFAULT_MODAL)+u.POP})},render:function(){var e=_.last(this.state._stack),t=a(d[this.props.type],{"flow-drawer-container":this.props.type!==d[s.MODAL]});return React.createElement("div",{className:t},React.createElement(c,{transitionName:this.state._transition},e))}};l.Type=d,l.Transition=u,e.exports=l},function(e,t,r){var n=r(452),i=r(453),o=r(455),a=r(497),s=r(503),c=r(235),d=React.createClass({displayName:"ContactDrawer",mixins:[c],propTypes:{onBack:React.PropTypes.func.isRequired,onClick:React.PropTypes.func.isRequired},getInitialState:function(){return{searchText:"",cancelSearch:!1,active:!1}},componentDidMount:function(){this.safeDefer(function(e){e.setState({active:!0})},this)},getFilteredContacts:function(){var e=Store.Contact.getFilteredContacts(),t=this.state.searchText;return t?(t=l10n.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e},close:function(){return this.searchText?(this.setState({searchText:"",cancelSearch:!0}),!0):!1},onSearch:function(e){this.setState({searchText:e})},render:function(){var e=this.state.active?React.createElement(a,{scrollTarget:1,contacts:this.getFilteredContacts(),onClick:this.props.onClick}):null;return React.createElement(n,{key:"contact-modal",onCancel:this.props.onBack},React.createElement(i,{title:this.props.title,type:i.Type.LARGE,onBack:this.props.onBack}),React.createElement(s,{searchText:this.state.searchText,isSearching:!this.state.cancelSearch,onSearch:this.onSearch,searchType:s.CONTACT,placeholder:l10n.t("search_contacts")}),React.createElement(o,null,e))}});e.exports=d},function(e,t,r){var n=r(498),i=r(499),o=r(502),a=React.createClass({displayName:"ContactList",propTypes:{contacts:React.PropTypes.array.isRequired,exclude:React.PropTypes.array,onClick:React.PropTypes.func,scrollTarget:React.PropTypes.any},getInitialState:function(){var e=this.props.exclude;return e&&(e=_.object(e.map(function(e){return[e.id,!0]}))),{exclude:e}},render:function(){for(var e=this.props.contacts,t=[],r=e.length>10,a=this.state.exclude||{},s="XXX",c=0;c<e.length;c++){var d=e[c];if(r){var u=d.header;u!==s&&(t.push(React.createElement(o,{key:u,header:u})),s=u)}var l=d.id;t.push(React.createElement(i,{contact:d,onClick:this.props.onClick,member:a[l],key:l}))}return React.createElement(n,{scrollTarget:this.props.scrollTarget,classes:["chatlist"],data:t,height:72,extraItems:4})}});e.exports=a},function(e,t,r){function n(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(439),s=r(166),c=r(144),d=r(438),u=r(235),l=72,p=React.createClass({displayName:"List",mixins:[d,u],propTypes:{extraItems:React.PropTypes.number,scrollTarget:React.PropTypes.oneOfType([React.PropTypes.object,React.PropTypes.number]),scrollTop:React.PropTypes.number,animate:React.PropTypes.bool.isRequired,classes:React.PropTypes.arrayOf(React.PropTypes.string),height:React.PropTypes.number.isRequired,data:React.PropTypes.arrayOf(React.PropTypes.element).isRequired},getDefaultProps:function(){return{classes:[],scrollTarget:null,data:null,height:l,extraItems:30,animate:!1}},statics:{DEFAULT_HEIGHT:l},getInitialState:function(){return{scrollTarget:void 0,firstVisibleIndex:0,visibleCount:0,physicalCount:0,renderVisible:!0}},componentWillReceiveProps:function(e){_.isNumber(e.scrollTop)&&this.state.scrollTarget&&(this.state.scrollTarget.scrollTop=e.scrollTop),(this.props.scrollTarget!==e.scrollTarget||this.props.height!==e.height||this.props.data.length!==e.data.length)&&this.initialize(e)},componentWillMount:function(){this.scrollTop=0,this._eventLoopBusy=!1,this._uiBusy=!1,this.renderedItems={},this.disablePointerEventsOff=this.safeDebounce(this._disablePointerEventsOff,150),this.disableUIBusy=this.safeDebounce(this._disableUIBusy,150)},componentDidMount:function(){this.initialize();var e=this;this.regNativeListener(window,"resize",function(){e.initialize()})},initialize:function(e){var t=e?e:this.props;this.state.scrollTarget&&this.unregNativeListener(this.state.scrollTarget,"scroll",this.onScroll);var r=t.scrollTarget;if("number"==typeof r){for(var n=this.getDOMNode(),i=0;r>i;i++)n=n.parentNode;r=n}else r||(r=this.getDOMNode());this.regNativeListener(r,"scroll",this.onScroll),this.scrollTop=r.scrollTop;var o=Math.floor(this.scrollTop/t.height),a=r.clientHeight,s=Math.min(Math.ceil(a/t.height),t.data.length),c=Math.min(s+t.extraItems,t.data.length);return this.setState({scrollTarget:r,firstVisibleIndex:o,visibleCount:s,physicalCount:c,renderVisible:!0}),this.renderedItems={},r},_disablePointerEventsOff:function(e){this._pointerEvents=!1,this.refs.viewport.getDOMNode().style.pointerEvents="auto"},disablePointerEvents:function(e){this.disablePointerEventsOff(),this._pointerEvents||(this.refs.viewport.getDOMNode().style.pointerEvents="none",this._pointerEvents=!0)},onScroll:function(e){this._eventLoopBusy||window.requestAnimationFrame(this._onScroll),this._eventLoopBusy=!0},_disableUIBusy:function(){c.setUiBusy(!1),this._uiBusy=!1},_onScroll:function(){if(this.isMounted()){this.disablePointerEvents(),this._uiBusy||(c.setUiBusy(!0),this._uiBusy=!0),this.disableUIBusy(),this.scrollTop=this.state.scrollTarget.scrollTop;var e=Math.floor(this.scrollTop/this.props.height);if(this.state.firstVisibleIndex===e)this._eventLoopBusy=!1;else{var t=this;this.setState({firstVisibleIndex:e,renderVisible:!1},function(){t._eventLoopBusy=!1})}}},getFirstPhysicalIndex:function(){var e=this.state.firstVisibleIndex+this.state.visibleCount/2,t=Math.max(0,Math.floor(e-this.state.physicalCount/2));return Math.min(t,this.props.data.length-this.state.physicalCount)},getComponents:function(){var e=this,t=this.getFirstPhysicalIndex(),r=Math.min(t+this.state.physicalCount,this.props.data.length),n={},i=_.chain(this.props.data).forEach(function(e,t){return n[e.key]=t}).slice(t,r).forEach(function(t,r){return e.renderedItems[t.key]=t}).value(),o=this.state.renderVisible?i:this.renderedItems;return _(o).sortBy("key").map(function(t){var r=n[t.key]===e.props.data.length-1?"last":null;return React.createElement(h,{key:t.key,rowHeight:e.props.height,classes:r,zIndex:e.props.data.length-n[t.key]-1,rowNumber:n[t.key]},t)}).value()},render:function(){var e={container:{willChange:"transform"},viewport:{height:this.props.data.length*this.props.height}},t={container:s("infinite-list",this.props.classes,{"infinite-list-animate":this.props.animate&&!this._eventLoopBusy}),viewport:"infinite-list-viewport"},r=this.getComponents();return React.createElement("div",{className:t.container,style:e.container},React.createElement("div",{className:t.viewport,ref:"viewport",style:e.viewport},r))}}),h=React.createClass({displayName:"ListItem",propTypes:{children:React.PropTypes.element.isRequired,rowNumber:React.PropTypes.number.isRequired,rowHeight:React.PropTypes.number.isRequired,zIndex:React.PropTypes.number.isRequired},getInitialState:function(){return{rendered:!1}},componentDidMount:function(){this.setState({rendered:!0})},render:function(){var e=this.props,t=e.children,r=e.rowNumber,c=e.rowHeight,d=e.zIndex,u=e.classes,l=n(e,["children","rowNumber","rowHeight","zIndex","classes"]),p=i({zIndex:d,height:c,willChange:"transform"},a.prefix("transform"),"translate3d(0, "+100*r+"%, 0)"),h=s(u,{"infinite-list-item":!0,"infinite-list-item-keyframe":!this.state.rendered,"infinite-list-item-transition":!0});return React.createElement("div",o({className:h,style:p},l),t)}});e.exports=p},function(e,t,r){var n=r(231),i=r(500),o=r(501),a=r(450),s=r(477),c=r(166),d=React.createClass({displayName:"Contact",mixins:[s],propTypes:{contact:React.PropTypes.instanceOf(n).isRequired,onClick:React.PropTypes.func,onDelete:React.PropTypes.func,onContext:React.PropTypes.func,contextEnabled:React.PropTypes.func,admin:React.PropTypes.bool,member:React.PropTypes.bool},getInitialState:function(){return{formattedName:this.async("contact.formattedName"),pendingAction:this.async("contact.pendingAction"),contextMenu:!1}},contextEnabled:function(){return!1},onDelete:function(e){e.stopPropagation(),this.props.onDelete(e,this.props.contact)},onClick:function(e){_.isFunction(this.props.onClick)&&this.props.onClick(e,this.props.contact)},onContext:function(e){return this.state.contextMenu?(a.pop(a.MENU),void this.setState({contextMenu:!1})):(this.props.onContext(e,this.props.contact,this.onContextClose),void this.setState({contextMenu:!0}))},onContextClose:function(){this.setState({contextMenu:!1})},render:function(){var e,t,r=this.props,n=r.contact,a=r.onContext,s=r.onDelete,d=r.contextEnabled,u=r.admin,l=r.member,p=c("contact",{member:l});u&&(e=React.createElement("div",{className:"chat-meta"},React.createElement("div",{className:"chat-marker chat-marker-admin"},l10n.t("web_group_admin")))),s&&(t=React.createElement("div",{className:"chat-controls"},React.createElement("button",{className:"icon icon-x-alt-small",onClick:this.onDelete})));var h;return a&&(h=this.onContext),React.createElement(i,{id:n.id,className:p,contextEnabled:d||this.contextEnabled,pendingAction:this.state.pendingAction,detail:t,primary:this.state.formattedName,primaryDetail:e,secondary:React.createElement(o,{status:n.status}),onClick:this.onClick,onContext:h})}});e.exports=d},function(e,t,r){function n(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(475),a=r(470),s=r(436),c=r(450),d=r(477),u=React.addons.PureRenderMixin,l=r(440),p=r(166),h=React.createClass({displayName:"Cell",mixins:[d,u],propTypes:{id:React.PropTypes.string.isRequired,contextEnabled:React.PropTypes.func.isRequired,pendingAction:React.PropTypes.number,contextMenu:React.PropTypes.bool,detail:React.PropTypes.node,primary:React.PropTypes.string.isRequired,primaryDetail:React.PropTypes.node,secondary:React.PropTypes.node,secondaryDetail:React.PropTypes.node,onClick:React.PropTypes.func,onContext:React.PropTypes.func},getInitialState:function(){return{hover:!1}},onMenuClick:function(e){this.props.contextEnabled()&&(e.stopPropagation(),e.preventDefault(),this.props.onContext({anchor:e.target}))},onContextMenu:function(e){this.props.contextEnabled()&&(e.stopPropagation(),e.preventDefault(),this.props.onContext({event:e}))},mouseOver:function(){!this.state.hover&&this.props.contextEnabled()&&this.setState({hover:!0})},mouseEnter:function(){!this.state.hover&&this.props.contextEnabled()&&this.setState({hover:!0})},mouseLeave:function(){this.state.hover&&this.setState({hover:!1})},render:function(){var e=this.props,t=e.id,r=e.contextEnabled,d=e.className,u=e.pendingAction,h=e.detail,f=e.primary,m=e.primaryDetail,g=e.secondary,v=e.secondaryDetail,y=e.onClick,_=e.onContext,b=n(e,["id","contextEnabled","className","pendingAction","detail","primary","primaryDetail","secondary","secondaryDetail","onClick","onContext"]),E=this.props.contextMenu||this.state.hover,R=p(d,{chat:!0,hover:E}),w=null,S=null;return u?S=React.createElement("div",{className:"btn-context icon-spinner"},React.createElement(s,{size:18,stroke:6})):E&&(w=React.createElement("span",{className:"icon icon-down btn-context",key:"icon-context","data-ignore-capture":_?c.IGNORE_CONTEXT:c.IGNORE_ANY,onClick:this.onMenuClick})),React.createElement("div",i({className:R,"data-ignore-capture":c.IGNORE_ANY,onClick:y,onContextMenu:r()?this.onContextMenu:null,onMouseEnter:this.state.hover?null:this.mouseEnter,onMouseOver:this.state.hover?null:this.mouseOver,onMouseLeave:this.state.hover?this.mouseLeave:null},b),React.createElement("div",{className:"chat-avatar"},React.createElement(o,{id:t})),React.createElement("div",{className:"chat-body"},React.createElement("div",{className:"chat-main"},React.createElement("div",{className:"chat-title"},React.createElement(a,{text:f,direction:"auto",titlify:!0,ellipsify:!0})),m),React.createElement("div",{className:"chat-secondary"},g,React.createElement("div",{className:"chat-meta"},v,React.createElement(l,{transitionName:"pop"},S),React.createElement(l,{transitionName:"pop-fast"},w)))),h)}});e.exports=h},function(e,t,r){var n=r(232),i=r(470),o=r(477),a=React.createClass({displayName:"Status",mixins:[o],propTypes:{status:React.PropTypes.instanceOf(n)},getInitialState:function(){return{status:this.async("status.status")}},render:function(){return _.isUndefined(this.state.status)?React.createElement("div",{className:"muted"},l10n.t("contact_status_loading")):React.createElement("div",{className:"chat-status ellipsify",title:this.state.status},React.createElement(i,{direction:"auto",ellipsify:!0,text:this.state.status}))}});e.exports=a},function(e,t){var r=React.createClass({displayName:"SectionHeader",propTypes:{header:React.PropTypes.string.isRequired},render:function(){return React.createElement("div",{className:"list-title"},this.props.header)}});e.exports=r},function(e,t,r){var n=r(235),i=r(450),o=r(440),a=React.createClass({displayName:"ChatlistSearch",mixins:[n],propTypes:{searchText:React.PropTypes.string.isRequired,searchType:React.PropTypes.oneOf(["chatlist","contact"]).isRequired,onSearch:React.PropTypes.func.isRequired,placeholder:React.PropTypes.string},statics:{CHATLIST:"chatlist",CONTACT:"contact"},getInitialState:function(){return{isSearching:!1}},componentWillUnmount:function(){this.onCancel()},onBlur:function(e){this.props.searchText||this.onCancel()},onChange:function(e){this.props.onSearch(e.target.value)},onCancel:function(e){i.pop(this.props.searchType)},onReset:function(e){e.stopPropagation(),this.focus(),this.props.onSearch("")},onSearchOn:function(e){this.setState({isSearching:!0}),i.push(this,this.props.searchType),this.safeDefer(function(){this.refs.input.getDOMNode().focus()})},focus:function(){this.refs.input.getDOMNode().focus()},close:function(){this.safeIsMounted()&&(this.refs.input.getDOMNode().blur(),this.props.onSearch(""),this.setState({isSearching:!1}))},render:function(){var e="pane-subheader pane-list-subheader subheader-search";this.state.isSearching&&(e+=" active");var t=null;this.state.isSearching&&(_.isEmpty(this.props.searchText)||(t=React.createElement("button",{className:"icon icon-x-alt",key:"icon-clear-search",onClick:this.onReset})));var r=this.props.placeholder||l10n.t("search_or_start_new_chat");return React.createElement("div",{className:e},React.createElement("button",{className:"icon icon-search-morph",onMouseDown:this.state.isSearching?this.onCancel:this.onSearchOn},React.createElement("div",{className:"icon icon-back-blue"}),React.createElement("div",{className:"icon icon-search"})),React.createElement(o,{transitionName:"pop"},t),React.createElement("div",{className:"input-placeholder"},r),React.createElement("label",{htmlFor:"input-chatlist-search",className:"cont-input-search"},React.createElement("input",{type:"text",ref:"input",className:"input input-search",tabIndex:2,dir:"auto",title:r,value:this.props.searchText,onBlur:this.onBlur,onFocus:this.state.isSearching?null:this.onSearchOn,onChange:this.onChange})))}});e.exports=a},function(e,t,r){var n=r(495),i=r(505),o=r(506),a=React.createClass({displayName:"NewGroupFlow",mixins:[n],getDefaultProps:function(){return{transition:n.Transition.DEFAULT_DRAWER}},componentWillMount:function(){this.push(React.createElement(i,{key:"NewGroupDrawer",onBack:this.endFlow,onContinue:this.groupParticipants}))},groupParticipants:function(e,t,r){this.push(React.createElement(o,{key:"NewGroupParticipantsDrawer",subject:e,thumb:t,full:r,onBack:this.participantsBack,onContinue:this.createGroup}))},createGroup:function(e,t,r,n){Store.Chat.createGroup(e,t,r,n),this.endFlow()},participantsBack:function(e,t,r){this.pop({subject:e,thumb:t,full:r})}});e.exports=a},function(e,t,r){var n=r(452),i=r(453),o=r(455),a=r(465),s=r(456),c=r(440),d=React.createClass({displayName:"NewGroupDrawer",propTypes:{thumb:React.PropTypes.string,full:React.PropTypes.string,subject:React.PropTypes.string,onBack:React.PropTypes.func.isRequired,onContinue:React.PropTypes.func.isRequired},getInitialState:function(){return{text:this.props.subject||"",thumb:this.props.thumb,full:this.props.full,emojiActive:!1}},preventBlur:function(e){e.preventDefault(),e.stopPropagation(),this.refs.emojiInput.restoreFocus()},onImageSet:function(e,t){this.setState({thumb:e,full:t})},onContinue:function(){var e=this.state.text,t=this.refs.photoPicker;if(t.state.isEditing){var r=this;t.cropImage().then(function(t){r.props.onContinue(e,t.thumb,t.full)})}else this.props.onContinue(e,this.state.thumb,this.state.full)},onInputChange:function(e){this.setState({text:e.target.value})},render:function(){var e=this.state.text.length>0?React.createElement("div",{className:"drawer-section drawer-controls"},React.createElement("button",{className:"btn btn-round",onClick:this.onContinue},React.createElement("span",{className:"icon icon-forward-light icon-l"}))):null;return React.createElement(n,{id:"new-group",onCancel:this.props.onBack},React.createElement(i,{title:l10n.t("new_group_flow_title"),type:i.Type.LARGE,onBack:this.props.onBack}),React.createElement(o,null,React.createElement("div",{className:"drawer-section"},React.createElement(s,{type:s.Type.GROUP,startImage:this.state.full,onImageSet:this.onImageSet,ref:"photoPicker"})),React.createElement("div",{className:"drawer-section",onMouseDown:this.preventBlur},React.createElement(a,{ref:"emojiInput",placeholder:l10n.t("group_subject"),floating:!0,value:this.state.text,editable:!0,showRemaining:!0,maxLength:25,onEnter:this.onContinue,onChange:this.onInputChange})),React.createElement(c,{transitionName:"btn"},e)))}});e.exports=d},function(e,t,r){var n=r(452),i=r(453),o=r(455),a=r(497),s=r(499),c=r(435),d=r(4),u=r(144),l=r(493),p=r(440),h=l.genId("max_participant_toast"),f=React.createClass({displayName:"NewGroupParticipantsDrawer",mixins:[c],propTypes:{thumb:React.PropTypes.string,full:React.PropTypes.string,subject:React.PropTypes.string.isRequired,onBack:React.PropTypes.func.isRequired,onContinue:React.PropTypes.func.isRequired},getInitialState:function(){return{searchText:"",participants:[]}},getFilteredContacts:function(){var e=Store.Contact.getFilteredContacts();e=_.difference(e,this.state.participants);var t=this.state.searchText;return t?(t=l10n.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e},componentDidMount:function(){this.focus()},componentDidUpdate:function(){this.adjustInput()},onKeyDown:function(e){if("Backspace"!==e.key||this.state.searchText||_.isEmpty(this.state.participants))"Enter"===e.key&&_.size(this.state.participants)&&this.onContinue();else{e.preventDefault();var t=this.state.participants;this.setState({participants:t.slice(0,t.length-1)})}},onInput:function(e){this.setState({searchText:e.target.value})},adjustInput:function(){var e=this.refs.input.getDOMNode().offsetParent.offsetWidth-10,t=this.refs.sizer.getDOMNode().offsetWidth,r=t>e?e:t;this.refs.input.getDOMNode().style.width=r+"px";var n;n=e-this.refs.input.getDOMNode().offsetLeft-r>0?e-this.refs.input.getDOMNode().offsetLeft:e,this.refs.input.getDOMNode().style.width=n+"px",this.focus()},onReset:function(){this.setState({searchText:""})},focus:function(){this.refs.input.getDOMNode().focus()},onBack:function(){var e=this.props;e.onBack(e.subject,e.thumb,e.full)},onContinue:function(){var e=this.props;e.onContinue(e.subject,e.thumb,e.full,this.state.participants)},onDelete:function(e,t){var r=this.state.participants;this.setState({participants:_.without(r,t)})},onContactClick:function(e,t){var r=this.state.participants;if(_.contains(r,t))this.setState({participants:_.without(r,t)});else if(r.length>=d.MAX_GROUP_SIZE){var n=l10n.t("action_group_create_failed_participant",{max:d.MAX_GROUP_SIZE});u.openToast(React.createElement(l,{msg:n,id:h}))}else this.setState({participants:r.concat(t),searchText:""})},render:function(){var e=_.size(this.state.participants)?_.map(this.state.participants,function(e){return React.createElement(s,{contact:e,onDelete:this.onDelete,key:e.id})},this):null,t=_.size(this.state.participants)?React.createElement("button",{className:"btn btn-round",onClick:this.onContinue},React.createElement("span",{className:"icon icon-checkmark-light"})):null,r=_.size(this.state.participants)?" ":l10n.t("group_participant_hint");return React.createElement(n,{id:"new-group",onCancel:this.onBack},React.createElement(i,{title:l10n.t("add_group_participants_title"),type:i.Type.LARGE,onBack:this.onBack}),React.createElement(o,{type:"flex"},React.createElement("div",{className:"drawer-section new-group-search"},React.createElement("div",{className:"input-clear input-ext"},React.createElement("div",{className:"input input-line"},React.createElement("div",{className:"list-names list-deletable new-group-preview"},e),React.createElement("input",{className:"inputarea",ref:"input",placeholder:r,onKeyDown:this.onKeyDown,onChange:this.onInput,value:this.state.searchText}),React.createElement("span",{className:"inputarea-sizer",ref:"sizer"},this.state.searchText)))),React.createElement("div",{className:"new-group-contacts"},React.createElement(a,{scrollTarget:1,contacts:this.getFilteredContacts(),onClick:this.onContactClick})),React.createElement(p,{transitionName:"btn",className:"drawer-section drawer-controls"},t)))}});e.exports=f},function(e,t,r){var n=r(450),i=r(440),o=React.createClass({displayName:"MenuBar",propTypes:{children:React.PropTypes.node,a8n:React.PropTypes.string},render:function(){return React.createElement("div",{className:"menu menu-horizontal"},this.props.children)}}),a=React.createClass({displayName:"MenuBarItem",propTypes:{icon:React.PropTypes.string.isRequired,title:React.PropTypes.string.isRequired,children:React.PropTypes.node,transitionName:React.PropTypes.string,onClick:React.PropTypes.func},getDefaultProps:function(){return{transitionName:"dropdown"}},getInitialState:function(){return{active:!1}},onClick:function(e){e.stopPropagation(),this.props.onClick(e)},onOpen:function(e){e.preventDefault(),e.stopPropagation(),this.setState({active:!0}),n.push(this,n.MENU,!0)},onClose:function(e){e.preventDefault(),e.stopPropagation(),this.setState({active:!1}),n.pop(n.MENU)},close:function(){this.setState({active:!1})},render:function(){var e="icon icon-"+this.props.icon,t=this.state.active,r=this.props.onClick?this.onClick:t?this.onClose:this.onOpen,o=null;if(this.props.children){var a=this.props.transitionName,s=React.Children.only(this.props.children);o=React.createElement(i,{transitionName:a},t?s:null)}var c="menu-item";return t&&(c+=" active"),React.createElement("div",{"data-a8n":Wa.a8n(this.props.a8n),className:c},React.createElement("button",{className:e,"data-ignore-capture":n.IGNORE_ANY,title:this.props.title,onClick:r},this.props.title),o)}});e.exports={MenuBar:o,MenuBarItem:a}},function(e,t,r){var n=r(498),i=r(144),o=r(502),a=r(509),s=r(499),c=React.createClass({displayName:"Chatlist",propTypes:{isSearching:React.PropTypes.bool,chats:React.PropTypes.array,contacts:React.PropTypes.array,onClick:React.PropTypes.func,onSelect:React.PropTypes.func,stripped:React.PropTypes.bool},getDefaultProps:function(){return{chats:[]}},onClick:function(e,t){var r=this;Store.Chat.find(t.id).then(function(e){r.props.isSearching&&r.props.onClick&&r.props.onClick(),r.props.onSelect?r.props.onSelect(e):i.openChat(e)})},getList:function(){for(var e=this.props,t=e.chats,r=e.contacts,n=e.stripped,i=[],c=0;c<t.length;c++)t[c]&&(this.props.isSearching&&0===c&&r.length&&i.push(React.createElement(o,{key:"chat-header",header:l10n.t("web_chats")})),i.push(React.createElement(a,{chat:t[c],mode:n?a.Mode.INFO:a.Mode.LAST,noContext:n,noHighlight:n,onClick:this.onClick,key:t[c].id})));for(var d=0;d<r.length;d++)r[d]&&(0===d&&i.push(React.createElement(o,{key:"contact-header",header:l10n.t("web_contacts")})),r[d]&&i.push(React.createElement(s,{contact:r[d],onClick:this.onClick,key:r[d].id})));return i},render:function(){return React.createElement(n,{scrollTarget:1,classes:["chatlist"],data:this.getList(),height:72,animate:!0,extraItems:4})}});e.exports=c},function(e,t,r){var n=r(201),i=r(500),o=r(510),a=r(511),s=r(512),c=r(513),d=r(514),u=r(515),l=r(519),p=r(520),h=r(521),f=r(522),m=r(477),g=r(4),v=r(450),y=r(144),b=r(166),E={LAST:"last",INFO:"info"},R=React.createClass({displayName:"Chat",mixins:[m],propTypes:{chat:React.PropTypes.instanceOf(n).isRequired,mode:React.PropTypes.oneOf(_.values(E)).isRequired,noHighlight:React.PropTypes.bool,noContext:React.PropTypes.bool,onClick:React.PropTypes.func},statics:{Mode:E},getDefaultProps:function(){return{mode:E.LAST}},getInitialState:function(){return this.hoverCounter=0,{formattedTitle:this.async("chat.formattedTitle"),hasUnread:this.async("chat.hasUnread"),isReadOnly:this.async("chat.isReadOnly"),active:this.async("chat.active"),pendingAction:this.async("chat.pendingAction"),contextMenu:!1}},componentWillUpdate:function(e,t){this.state.isReadOnly!==t.isReadOnly&&v.pop(v.MENU)},contextEnabled:function(){var e=this.props,t=e.chat,r=e.noContext;return!r&&(t.mute.canMute()||t.canArchive()||t.canDelete()||t.canExit())},onMenu:function(e){if(this.state.contextMenu)return v.pop(v.MENU),void this.setState({contextMenu:!1});var t=this.props.chat,r=[];t.canArchive()&&r.push(React.createElement(a,{key:"archive",onArchive:this.onArchive,chat:t})),t.mute.canMute()&&r.push(React.createElement(o,{key:"mute",onMute:this.onMute,chat:t})),t.canDelete()&&r.push(React.createElement(s,{key:"delete",onDeleteOrExit:this.onDeleteOrExit,chat:t})),t.canMarkUnseen()&&r.push(React.createElement(c,{key:"mark_unread",onMarkUnread:this.onMarkUnread,chat:t})),this.setState({contextMenu:!0}),y.openContextMenu(r,{onClose:this.removeContext,event:e.event,anchor:e.anchor})},removeContext:function(){this.setState({contextMenu:!1})},onMute:function(e){y.muteChat(this.props.chat,e)},onArchive:function(e){y.archiveChat(this.props.chat,e)},onDeleteOrExit:function(){y.deleteOrExitChat(this.props.chat)},onMarkUnread:function(e){y.markChatUnread(this.props.chat,e)},onClick:function w(e){var t=this.props,w=t.onClick,r=t.chat;_.isFunction(w)?w(e,r):y.openChat(r)},onMouseDown:function(e){0===e.button&&this.props.chat.preload()},onDragEnter:function(e){var t=e.dataTransfer;_.contains(t.types,g.DRAG_TYPE_FILE)&&(0===this.hoverCounter&&this.setState({dragging:!0}),this.hoverCounter+=1)},onDragLeave:function(e){var t=e.dataTransfer;_.contains(t.types,g.DRAG_TYPE_FILE)&&(this.hoverCounter-=1,0===this.hoverCounter&&this.setState({dragging:!1}))},onDrop:function(e){this.setState({dragging:!1});var t=void 0,r=e.dataTransfer;_.contains(r.types,g.DRAG_TYPE_FILE)&&(t=Array.prototype.slice.call(e.target.files||r.files),y.openChat(this.props.chat),y.openDrawer(React.createElement(f,{files:t,chat:this.props.chat,type:v.DRAWER_MID}),"slide-up"))},render:function(){var e,t,r,n=this.props,o=n.chat,a=n.mode,s=n.noHighlight,c=b({unread:this.state.hasUnread,active:o.active&&!s,"chat-drag":this.state.dragging});switch(a){case E.LAST:t=React.createElement(d,{chat:o}),e=React.createElement(u,{chat:o}),r=React.createElement(h,{chat:o});break;case E.INFO:e=o.isGroup?React.createElement(l,{presence:o.presence,groupMetadata:o.groupMetadata,location:"list"}):React.createElement(p,{presence:o.presence,location:"list"})}return React.createElement("div",{className:"chat-drag-cover",onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDrop:this.onDrop},React.createElement(i,{id:o.id,className:c,contextEnabled:this.contextEnabled,pendingAction:this.state.pendingAction,contextMenu:this.state.contextMenu,primary:this.state.formattedTitle,primaryDetail:t,secondary:e,secondaryDetail:r,onClick:this.onClick,onContext:this.onMenu,onMouseDown:this.onMouseDown}))}});e.exports=R},function(e,t,r){var n=r(201),i=r(477),o=r(458),a=React.createClass({displayName:"MuteMenuItem",mixins:[i],propTypes:{chat:React.PropTypes.instanceOf(n).isRequired,onMute:React.PropTypes.func.isRequired},getInitialState:function(){return{isMuted:this.async("chat.mute.isMuted")}},render:function(){var e=this.props.onMute.bind(null,!this.state.isMuted);return React.createElement(o,{action:e,shortcut:"m"},this.state.isMuted?l10n.t("web_menuitem_mute_off"):l10n.t("web_menuitem_mute"))}});e.exports=a},function(e,t,r){var n=r(201),i=r(477),o=r(458),a=r(450),s=React.createClass({displayName:"ArchiveMenuItem",mixins:[i],propTypes:{chat:React.PropTypes.instanceOf(n).isRequired,onArchive:React.PropTypes.func.isRequired},getInitialState:function(){return{archive:this.async("chat.archive")}},componentWillUpdate:function(e,t){this.state.archive!==t.archive&&a.pop(a.MENU);
},render:function(){var e=this.props.onArchive.bind(null,!this.state.archive);return React.createElement(o,{a8n:"mi-archive",action:e,shortcut:"a",key:"ArchiveMenuItem"},this.state.archive?l10n.t("unarchive_chat"):l10n.t("archive_chat"))}});e.exports=s},function(e,t,r){var n=r(201),i=r(477),o=r(458),a=React.createClass({displayName:"DeleteMenuItem",mixins:[i],propTypes:{chat:React.PropTypes.instanceOf(n).isRequired,onDeleteOrExit:React.PropTypes.func.isRequired},getInitialState:function(){return{isReadOnly:this.async("chat.isReadOnly")}},render:function(){var e;switch(this.props.chat.kind){case n.KIND.GROUP:e=this.props.chat.isReadOnly?l10n.t("web_delete_group"):l10n.t("web_exit_group");break;case n.KIND.BROADCAST:e=l10n.t("web_delete_list");break;case n.KIND.CHAT:e=l10n.t("delete_chat")}return React.createElement(o,{a8n:"mi-delete",action:this.props.onDeleteOrExit,shortcut:"x"},e)}});e.exports=a},function(e,t,r){var n=r(201),i=r(477),o=r(458),a=r(450),s=React.createClass({displayName:"MarkUnreadMenuItem",mixins:[i],propTypes:{chat:React.PropTypes.instanceOf(n).isRequired,onMarkUnread:React.PropTypes.func.isRequired},getInitialState:function(){return{unreadCount:this.async("chat.unreadCount")}},componentWillUpdate:function(e,t){!this.state.unreadCount!=!t.unreadCount&&a.pop(a.MENU)},render:function(){var e=this.props.onMarkUnread.bind(null,!this.state.unreadCount);return React.createElement(o,{action:e,shortcut:"r",key:"MarkUnreadMenuItem"},this.state.unreadCount?l10n.t("mark_read_chat"):l10n.t("mark_unread_chat"))}});e.exports=s},function(e,t,r){var n=r(201),i=r(477),o=React.createClass({displayName:"Timestamp",mixins:[i],propTypes:{chat:React.PropTypes.instanceOf(n).isRequired},getInitialState:function(){return{t:this.async("chat.t")}},getFortmattedTime:function(){var e=this.state.t,t=moment().startOf("day");return e>=t.unix()?Wa.formatTimestamp(e):Wa.formatDateRelative(e)},render:function(){return this.state.t?React.createElement("div",{className:"chat-meta"},React.createElement("span",{className:"chat-time"},this.getFortmattedTime())):null}});e.exports=o},function(e,t,r){var n=r(201),i=r(470),o=r(516),a=r(435),s=React.createClass({displayName:"ChatstateInfo",mixins:[a],propTypes:{chat:React.PropTypes.instanceOf(n)},componentWillMount:function(){var e=this.props.chat;this.addObserver(e.msgs,"change:last"),this.addObserver(e.presence,"change:chatstate.id change:chatstate.type change:withholdDisplay")},render:function(){var e=this.props.chat,t=e.presence;if(t.isActive()){var r=t.getFormattedString();return React.createElement("div",{className:"chat-status typing ellipsify",dir:"auto"},React.createElement(i,{ellipsify:!0,titlify:!0,text:r}))}var n=e.msgs.last();return n?React.createElement(o,{key:n.id,msg:n}):React.createElement("div",{className:"chat-status"})}});e.exports=s},function(e,t,r){var n=r(230),i=r(15),o=r(517),a=r(518),s=r(470),c=r(477),d=r(435),u=r(166),l=React.createClass({displayName:"LastMsg",mixins:[c,d],propTypes:{msg:React.PropTypes.instanceOf(n).isRequired},getInitialState:function(){return this.props.msg.sender?{formattedShortName:this.async("msg.senderObj.formattedShortName")}:{}},componentWillMount:function(){"ptt"===this.props.msg.type&&this.addObserver(this.props.msg,"change:duration")},render:function(){var e=this.props.msg,t=[];if(e.isSentByMe&&t.push(React.createElement(o,{msg:e,key:"symbol"})),!e.isSentByMe&&e.isGroupMsg&&"gp2"!==e.type&&"group_notification"!==e.type){var r=u("chat-status-name",{number:!e.senderObj.name});t.push(React.createElement(s,{text:this.state.formattedShortName,direction:"auto",classes:r,key:"author"})),t.push(React.createElement("span",{className:"chat-status-divider",key:"divider"},":"))}e.hasSymbol&&t.push(React.createElement(a,{msg:e,key:"msg-symbol"})),t.push(React.createElement(s,{direction:"auto",ellipsify:!0,text:e.msgText(),key:"status"}));var n="chat-status";i.isGecko&&(n+=" ellipsify");var c=l10n.embedDir(e.msgText());return React.createElement("div",{className:n,title:c},t)}});e.exports=l},function(e,t,r){var n=r(230),i=r(477),o=r(166),a=React.createClass({displayName:"MsgAck",mixins:[i],propTypes:{msg:React.PropTypes.instanceOf(n)},getInitialState:function(){return{ack:this.async("msg.ack")}},render:function(){var e=this.props.msg.ack,t=o("icon",{"icon-status-time":1>e,"icon-status-check":1===e,"icon-status-dblcheck":2===e,"icon-status-dblcheck-ack":e>2});return React.createElement("span",{className:t})}});e.exports=a},function(e,t,r){var n=r(14),i=r(230),o=r(435),a=React.createClass({displayName:"MsgSymbol",mixins:[o],propTypes:{msg:React.PropTypes.instanceOf(i)},componentWillMount:function(){var e=this.props.msg;"ptt"===e.type&&e.ack<4&&this.addObserver(this.props.msg,"change:ack")},getClasses:function(){var e="icon media-icon",t=this.props.msg;switch(t.type){case"location":case"image":case"video":case"audio":case"vcard":e+=" icon-status-"+t.type;break;case"ptt":var r=4===t.ack?"blue":t.isSentByMe?"gray":"green";e+=" icon-status-"+t.type+"-"+r;break;default:n.log("chat:getClasses Invalid msg type.")()}return e},render:function(){return React.createElement("span",{className:this.getClasses()})}});e.exports=a},function(e,t,r){var n=r(435),i=r(470),o=r(151),a=r(202),s=r(238),c=React.createClass({displayName:"GroupSubtitle",mixins:[n],propTypes:{presence:React.PropTypes.instanceOf(a),groupMetadata:React.PropTypes.instanceOf(s),placeholder:React.PropTypes.node,location:React.PropTypes.oneOf(["list","title"])},componentWillMount:function(){Store.GroupMetadata.find(this.props.groupMetadata.id)["catch"](o.WapDrop,_.noop);var e=this.props.groupMetadata.participants;this.addObserver(e,"sort remove reset"),this.addObserver(this.props.presence,"change:chatstate.id change:chatstate.type change:forceDisplay change:withholdDisplay")},getSubtitle:function(){return this.props.groupMetadata.participants.map(function(e){return e.contact.formattedShortName}).join(", ")},render:function(){var e,t=this.props.presence;return"list"===this.props.location?(e=t.getFormattedString()||this.getSubtitle(),e?React.createElement(i,{ellipsify:!0,titlify:!0,text:e}):null):(e=t.withholdDisplay?this.props.placeholder:t.getFormattedString()||(t.forceDisplay?this.getSubtitle():this.getSubtitle()||this.props.placeholder),e?React.createElement("div",{className:"chat-status ellipsify"},React.createElement(i,{ellipsify:!0,titlify:!0,text:e})):null)}});e.exports=c},function(e,t,r){var n=r(477),i=r(470),o=r(202),a=React.createClass({displayName:"UserSubtitle",mixins:[n],propTypes:{presence:React.PropTypes.instanceOf(o),placeholder:React.PropTypes.node,location:React.PropTypes.oneOf(["list","title"])},getInitialState:function(){return{hasData:this.async("presence.hasData"),type:this.async("presence.chatstate.type"),deny:this.async("presence.chatstate.deny"),t:this.async("presence.chatstate.t"),forceDisplay:this.async("presence.forceDisplay"),withholdDisplay:this.async("presence.withholdDisplay")}},render:function(){var e,t=this.props.presence;return"list"===this.props.location?(e=t.getFormattedString(),e?React.createElement(i,{ellipsify:!0,titlify:!0,text:e}):null):(e=t.withholdDisplay?this.props.placeholder:t.getFormattedString()||(t.forceDisplay?"":this.props.placeholder),e?React.createElement("div",{className:"chat-status ellipsify"},React.createElement(i,{ellipsify:!0,titlify:!0,text:e})):null)}});e.exports=a},function(e,t,r){var n=r(477),i=r(440),o=React.createClass({displayName:"Icons",mixins:[n],propTypes:{chat:React.PropTypes.object.isRequired},getInitialState:function(){return{isMuted:this.async("chat.mute.isMuted"),unreadCount:this.async("chat.unreadCount"),archive:this.async("chat.archive")}},render:function(){var e=this.props.chat,t=this.state.isMuted?React.createElement("span",{className:"icon icon-meta icon-muted",key:"icon-muted"}):null,r=0!==e.unreadCount?React.createElement("span",{className:"icon-meta unread-count",key:"icon-unread"},e.unreadCount>0?l10n.n(this.state.unreadCount):React.createElement("span",null," ")):null,n=this.state.archive?React.createElement("span",{className:"icon-meta chat-marker chat-marker-archived",key:"icon-archived"},l10n.t("chat_archived")):null;return React.createElement(i,{transitionName:"pop"},t,n,r)}});e.exports=o},function(e,t,r){var n=r(495),i=r(523),o=r(201),a=React.createClass({displayName:"AttachMediaFlow",mixins:[n],propTypes:{files:React.PropTypes.array,state:React.PropTypes.string,chat:React.PropTypes.instanceOf(o).isRequired},componentWillMount:function(){this.push(React.createElement(i,{files:this.props.files,state:this.props.state,onBack:this.endFlow,onSend:this.sendMedia}))},sendMedia:function(e){var t=this.props.chat;_.delay(function(){t.sendMedia(e)},300),this.endFlow()}});e.exports=a},function(e,t,r){var n=r(151),i=r(438),o=r(235),a=r(4),s=r(464),c=r(452),d=r(453),u=r(455),l=r(478),p=r(436),h=r(440),f=r(465),m=r(450),g=function(e){return 150+15*e},v=400,y=10,b="image",E="video",R="url",w="invalid",S={ACTIVE:"active",PROCESSING:"processing",INVALID:"invalid"},T=React.createClass({displayName:"AttachMediaDrawer",mixins:[i,o],propTypes:{files:React.PropTypes.array,state:React.PropTypes.oneOf(_.values(S)),onBack:React.PropTypes.func.isRequired,onSend:React.PropTypes.func.isRequired},statics:{STATE:S},getDefaultProps:function(){return{state:S.PROCESSING,isDragging:!1}},getInitialState:function(){return{state:this.props.state,activeIndex:-1,media:[]}},componentWillMount:function(){this.regNativeListener(window,"keydown",this.onKeyDown),this.regNativeListener(window,"drop",this.onWindowDrop)},componentDidMount:function(){if(this.props.files){var e=this;this.safeDelay(function(){e.initialize()},300)}},componentWillUnmount:function(){var e=this;this.state.media.forEach(function(t){var r=e.getFileType(t.file);r===E&&window.URL.revokeObjectURL(t.vid)})},initialize:function(){var e=this.props.files;e=e.slice(0,Math.min(e.length,y)),this.processFiles(e).bind(this).then(function(e){this.isMounted()&&this.setState({media:e,state:S.ACTIVE,activeIndex:0})})["catch"](function(){this.isMounted()&&this.setState({state:S.INVALID,activeIndex:-1,prevIndex:void 0})})},getFileType:function(e){var t=e.type;return t.match(/url/)?R:t.match(/^image\/.*/)?b:t.match(/^video\/.*/)?E:w},processFiles:function(e){var t=this;return t.setState({state:S.PROCESSING}),Promise.all(e.map(function(e){if(e.size>Wa.CONST.MAX_MEDIA_UPLOAD_SIZE)return Promise.reject(new n.MediaFileTooLarge);var r=t.getFileType(e),i=Math.ceil(1e6*Math.random());switch(r){case E:var o=window.URL.createObjectURL(e);return l.generateVideoThumb(o).then(function(t){return{file:e,img:t.url,width:t.width,height:t.height,vid:o,key:i}})["catch"](function(){window.URL.revokeObjectURL(o)});case b:return l.resizeAndOrient(e,Wa.CONST.IMG_MAX_EDGE,Wa.CONST.IMG_MAX_EDGE).then(function(e){return{file:window.dataURLtoBlob(e.url),img:e.url,width:e.width,height:e.height,key:i}});case R:return l.crop(e.url,0,0,Wa.CONST.IMG_MAX_EDGE,Wa.CONST.IMG_MAX_EDGE).then(function(e){return{file:window.dataURLtoBlob(e.url),img:e.url,width:e.width,height:e.height,key:i}});default:return Promise.reject(new n.InvalidMediaFileType)}}))},onDragOver:function(e){this.state.isDragging||this.setState({isDragging:!0})},onWindowDrop:function(e){_.isEmpty(this.props.files)&&_.isEmpty(this.state.media)&&this.props.onBack()},onDrop:function(e){this.setState({isDragging:!1}),this.onFilePick(e)},onDragLeave:function(e){this.state.media.length||this.props.onBack(),this.setState({isDragging:!1})},onKeyDown:function(e){if(this.state.state!==S.INVALID&&!e.repeat)if(37===e.keyCode){var t=this.state.media[this.state.activeIndex],r=this.refs.emojiInput&&this.refs.emojiInput.refs.inputLine;(t&&!t.caption||r&&r.isCollapsed()&&0===r.getCursor())&&this.onPrev()}else if(39===e.keyCode){var t=this.state.media[this.state.activeIndex],r=this.refs.emojiInput&&this.refs.emojiInput.refs.inputLine;(t&&!t.caption||r&&r.isCollapsed()&&r.getCursor()===t.caption.length)&&this.onNext()}},onNext:function(){this.state.activeIndex+1<this.state.media.length&&this.setState({prevIndex:this.state.activeIndex,activeIndex:this.state.activeIndex+1,state:S.ACTIVE})},onPrev:function(){this.state.activeIndex>0&&this.setState({prevIndex:this.state.activeIndex,activeIndex:this.state.activeIndex-1,state:S.ACTIVE})},onSelectThumb:function(e,t){e!==this.state.activeIndex&&this.setState({prevIndex:this.state.activeIndex,activeIndex:e,state:S.ACTIVE})},onSend:function(){this.props.onSend(this.state.media)},onAddFileClick:function(e){var t=this.refs.input.getDOMNode();t.click()},onFilePick:function(e){for(var t=[],r=e.target.files||e.dataTransfer.files,n=r.length+this.state.media.length>y?Math.max(y-this.state.media.length,0):r.length,i=0;n>i;i++)t.push(r[i]);!r.length&&this.state.media.length<y&&e.dataTransfer.getData("text/uri-list")&&t.push({type:"url",url:e.dataTransfer.getData("text/uri-list")}),this.processFiles(t).bind(this).then(function(e){if(this.isMounted()){var t=this.state.media.concat(e);this.setState({prevIndex:void 0,activeIndex:Math.min(this.state.media.length,9),media:t,state:S.ACTIVE})}})["catch"](function(){this.isMounted()&&this.setState({state:S.INVALID,activeIndex:-1,prevIndex:void 0})}),e.target.value=""},onRemoveThumb:function(e,t){t.stopPropagation(),t.preventDefault();var r=this.state.media;r.splice(e,1);var n=this.state.activeIndex;n>=e&&(n=Math.max(--n,0)),this.setState({prevIndex:void 0,activeIndex:r.length?n:-1,media:r})},onCaptionChange:function(e){var t=this.state.media;t[this.state.activeIndex].caption=e.target.value,this.setState({media:t})},render:function(){var e,t,r,n=this,i=0,o="media-scale",l=this.state.activeIndex;if(this.state.state===S.PROCESSING)e=React.createElement(p,{key:"processing"});else if(this.state.state===S.ACTIVE&&l>-1){var R=this.state.media[l],w=this.getFileType(R.file),T=R.width&&R.height?{width:R.width,height:R.height}:null;w===b?e=React.createElement("img",{src:R.img,className:"media-viewer-img"}):w===E&&(e=React.createElement("video",{controls:!0,className:"media-viewer-img",type:R.file.type,src:R.vid})),e=React.createElement("div",{className:"media-body-container",key:this.state.media[l].key},React.createElement("div",{className:"media-element-container"},React.createElement("div",{className:"media-element"},React.createElement(s,{type:s.TYPES.SCALE_DOWN,size:T},e))),React.createElement("div",{className:"media-caption"},React.createElement(f,{id:m.CAPTION_INPUT,ref:"emojiInput",editable:!0,value:this.state.media[l].caption,floating:!1,maxLength:a.MAX_CAPTION_LENGTH,showRemaining:!0,placeholder:l10n.t("add_a_caption"),onEnter:this.onSend,onChange:this.onCaptionChange}))),_.isNumber(this.state.prevIndex)&&this.state.prevIndex!==l&&(o=this.state.prevIndex<l?"media-slide-forward":"media-slide-back")}else this.state.state===S.INVALID&&(e=React.createElement("div",{className:"invalid-media-container",key:"pending"},React.createElement("div",{className:"invalid-media"},l10n.t("invalid_media_files"))));this.state.media.length>0&&(t=this.state.media.map(function(e,t){var r="media-thumb stagger-delay";t===n.state.activeIndex&&(r+=" active");var i=Math.max(n.state.media.length-n.state.activeIndex-1,1),o=g(t)/i*Math.max(0,t-n.state.activeIndex)+"ms",a={backgroundImage:"url("+e.img+")"};return React.createElement("div",{className:r,key:"media-"+e.key,onClick:n.onSelectThumb.bind(null,t),staggerDelay:o},React.createElement("span",{className:"btn-delete icon icon-x-alt-light",onClick:n.onRemoveThumb.bind(null,t)}),React.createElement("div",{className:"media-thumb-body",style:a}))}),i=1===this.state.media.length?v:v+g(this.state.media.length),r=React.createElement("div",{className:"drawer-controls"},React.createElement("button",{className:"btn btn-round btn-l","data-ignore-capture":m.IGNORE_ANY,onClick:this.onSend},React.createElement("span",{className:"icon icon-send-light"}))));var C=this.state.isDragging?React.createElement("div",{key:"container",className:"drag-drop"},React.createElement("div",{className:"stitching"},l10n.t("drag_media_here"))):null,N=this.state.media.length<y?React.createElement("div",{key:"media-more",className:"media-thumb btn-add-media",onClick:this.onAddFileClick},React.createElement("button",{className:"btn-fill"},React.createElement("span",{className:"icon icon-add-alt"}),l10n.t("add_media"))):null;return React.createElement(c,{key:"attach-image-modal",ref:"container",position:"right",id:"media",variant:"noheader",onDrop:this.onDrop,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave},React.createElement(d,{title:l10n.t("web_preview_msg"),type:d.Type.OFFSET,onCancel:this.props.onBack}),React.createElement(u,null,C,React.createElement("div",{className:"media-body"},React.createElement(h,{transitionName:o},e)),React.createElement(h,{transitionName:"thumb-scale",className:"media-collection"},t,N),React.createElement(h,{transitionName:"btn",delay:i},r),React.createElement("input",{ref:"input",type:"file",accept:Wa.CONST.IMAGE_MIMES+","+Wa.CONST.VIDEO_MIMES,style:{display:"none"},onChange:this.onFilePick,multiple:!0})))}});e.exports=T},function(e,t){var r=React.createClass({displayName:"ChatlistEmpty",propTypes:{state:React.PropTypes.string},statics:{EMPTY_LIST:"nochats",EMPTY_SEARCH:"nosearch",ALL_ARCHIVED:"allarchived",LOADING:"loading"},render:function(){var e="",t="";switch(this.props.state){case r.EMPTY_LIST:t="msg-search-notfound",e=l10n.t("no_chats");break;case r.EMPTY_SEARCH:t="msg-search-notfound",e=l10n.t("search_no_chats_or_contacts");break;case r.ALL_ARCHIVED:t="msg-search-notfound",e=l10n.t("all_chats_archived");break;case r.LOADING:t="loading",e=""}return React.createElement("div",{className:t},e)}});e.exports=r},function(e,t,r){var n=r(14),i=r(15),o=r(20),a=r(240),s=r(435),s=r(435),c=r(467),d=r(235),u=r(4),l=r(144),u=r(4),p=r(166),h=r(440),f=r(472),m=React.createClass({displayName:"ButterBar",mixins:[s,c],componentWillMount:function(){this.addObserver(a,"change:displayInfo"),this.addObserver(a,"change:needsUpdate")},onReload:function(){Wa.hardRefresh()},render:function(){var e,t=a.needsUpdate?React.createElement(g,{type:"update",key:"update",title:l10n.t("update_available"),text:l10n.t("click_to_update_whatsapp_web"),action:this.onReload}):null;switch(a.displayInfo){case a.INFO.OFFLINE:e=React.createElement(g,{type:"computer",key:"socket",title:l10n.t("computer_not_connected"),text:l10n.t("make_sure_computer_active_internet_connection")});break;case a.INFO.OPENING:case a.INFO.CONNECTING:e=React.createElement(_,{key:"socket"});break;case a.INFO.NORMAL:e=null;break;case a.INFO.RESUMING:case a.INFO.TIMEOUT:var r=window.open.bind(window,"http://www.whatsapp.com/faq/web/28080002","_blank"),n=React.createElement("span",null,l10n.t("make_sure_phone_active_internet_connection")," ",React.createElement("span",{className:"action",onClick:r},l10n.t("learn_more")));e=React.createElement(g,{type:"phone",key:"socket",title:l10n.t("phone_not_connected"),text:n})}var i=window.Notification?React.createElement(y,{key:"notification"}):null;return React.createElement("div",{className:"butterbar-container"},React.createElement(h,{transitionName:"butterbar"},i,t,e),React.createElement(v,{socket:!!e}))}}),g=React.createClass({displayName:"BB",propTypes:{type:React.PropTypes.oneOf(["computer","phone","notification","battery","update"]),title:React.PropTypes.node.isRequired,text:React.PropTypes.node,dismissable:React.PropTypes.bool,onDismiss:React.PropTypes.func,action:React.PropTypes.func},onClick:function(){this.props.action&&this.props.action()},render:function(){var e,t;switch(this.props.type){case"computer":case"phone":case"notification":case"battery":case"update":e="butterbar-"+this.props.type,t="icon-alert-"+this.props.type;break;default:n.log("butterbar:render invalid type")()}var r=p("butterbar",e,{action:this.props.action}),i=p("icon","icon-alert",t),o=this.props.dismissable?React.createElement("div",{className:"butterbar-controls"},React.createElement("button",{className:"icon icon-x-light",onClick:this.props.onDismiss})):null,a=this.props.text?React.createElement("div",{className:"butterbar-text"},this.props.text):null;return React.createElement("div",{className:"butterbar-wrapper"},React.createElement("div",{className:r,onClick:this.onClick},React.createElement("div",{className:"butterbar-icon"},React.createElement("span",{className:i})),React.createElement("div",{className:"butterbar-body"},React.createElement("div",{className:"butterbar-title"},this.props.title),a),o))}}),v=React.createClass({displayName:"Battery",mixins:[s],propTypes:{socket:React.PropTypes.bool},getInitialState:function(){return{lowBatteryWarning:Store.Conn.get(1).isBatteryLow}},componentWillMount:function(){this.addObserver(Store.Conn.get(1),"change:battery",this.batteryUpdate),this.addObserver(Store.Conn.get(1),"change:isBatteryLow",this.onBatteryLowChange)},onBatteryLowChange:function(){this.setState({lowBatteryWarning:Store.Conn.get(1).isBatteryLow})},batteryUpdate:function(){var e=Store.Conn.get(1);e.plugged||(e.battery===u.BATTERY_LOW_THRESHOLD_1||e.battery===u.BATTERY_LOW_THRESHOLD_2)&&this.setState({lowBatteryWarning:!0})},cancelLowBatteryWarning:function(){this.setState({lowBatteryWarning:!1})},render:function(){var e=this.state.lowBatteryWarning&&!this.props.socket?React.createElement(g,{type:"battery",title:l10n.t("phone_battery_low"),text:l10n.t("charge_phone_description"),dismissable:!0,onDismiss:this.cancelLowBatteryWarning}):null;return React.createElement(h,{transitionName:"butterbar"},e)}}),y=React.createClass({displayName:"Notification",getInitialState:function(){return{permission:window.Notification.permission}},guideConfirm:function(){l.closeModal()},guideLearnMore:function(){switch(i.browser){case u.BROWSER_TYPE.CHROME:return window.open("http://www.whatsapp.com/faq/web/28080004","_blank");case u.BROWSER_TYPE.FIREFOX:return window.open("http://www.whatsapp.com/faq/web/28080006","_blank");case u.BROWSER_TYPE.SAFRI:return window.open("http://www.whatsapp.com/faq/web/28080008","_blank");case u.BROWSER_TYPE.OPERA:return window.open("http://www.whatsapp.com/faq/web/28080007","_blank");default:return window.open("http://www.whatsapp.com/faq/web/28080004","_blank")}},requestPermissions:function(){l.openModal(React.createElement(f,{title:"guide_desktop_notifications_title",desc:"guide_desktop_notifications_description",onConfirm:this.guideConfirm,onCancel:this.guideLearnMore,type:f.TYPE.GUIDE_ALLOW}));var e=this;window.Notification.requestPermission(function(t){l.closeModal(),e.setState({permission:t})})},render:function(){if(this.state.permission!==u.PERMISSION_DEFAULT)return null;var e=React.createElement("span",{className:"action",onClick:this.requestPermissions},l10n.t("enable_desktop_notifications"));return React.createElement(g,{type:"notification",title:l10n.t("get_notified_of_new_messages"),text:e})}}),_=React.createClass({displayName:"Resume",mixins:[d,s],getInitialState:function(){return{takingTooLong:!1,didShowSubtitle:!1}},componentWillMount:function(){this.addObserver(o,"change:state",this.onProgress),this.addObserver(o,"change:retryTimestamp",this.onProgress)},onProgress:function(){this.clearSafeInterval(this.interval),delete this.interval,this.startTimeout(),this.setState({takingTooLong:!1})},componentDidMount:function(){this.startTimeout()},startTimeout:function(){this.safeDelay(this.connectTimeout,3e3)},connectTimeout:function(){this.interval=this.safeInterval(this.timeoutTick,1e3),this.setState({takingTooLong:!0,didShowSubtitle:!0})},timeoutTick:function(){this.setState({now:Date.now()})},retry:function(e){o.poke(),this.onProgress()},cancel:function(e){o.logout()},render:function(){var e,t;if(a.displayInfo===a.INFO.OPENING)e=l10n.t("connecting_to_whatsapp");else{if(a.displayInfo!==a.INFO.CONNECTING)return null;e=l10n.t("connecting_to_whatsapp_or_phone")}if(this.state.takingTooLong){var r=o.retryTimestamp-Date.now();if(6e4>r){var n=Math.ceil(r/1e3);r=l10n.t("retrying_in_some_seconds",{number:n,_plural:n})}else r=l10n.t("retrying_in",{duration:moment.duration(r).humanize()});t=React.createElement("span",null,r," ",React.createElement("span",{className:"action",onClick:this.retry},l10n.t("retry_now")))}else t=this.state.didShowSubtitle?React.createElement("span",null,l10n.t("retrying")):null;return React.createElement(g,{type:"phone",title:e,text:t})}});e.exports=m},function(e,t,r){var n=r(467),i=r(440),o=r(493),a=React.addons.cloneWithProps,s=3,c=React.createClass({displayName:"ToastManager",mixins:[n],componentWillMount:function(){this.regCmd("open_toast",this.openToast),this.regCmd("close_toast",this.closeToast),this.regCmd("error_2412",this.onError2412),this.regCmd("window_error",this.onWindowError)},getInitialState:function(){return{toasts:{}}},openToast:function(e,t){var r;(r=this.refs[e.props.id])?r.restartDelay():(this.state.toasts[e.props.id]=e,this.setState({toasts:this.state.toasts}))},closeToast:function(e){var t=this.state.toasts;t[e.props.id]&&this.setState({toasts:_.omit(t,e.props.id)})},componentWillUpdate:function(e,t){this.animateEnter=_.size(this.state.toasts)>_.size(t.toasts)},onError2412:function(e){this.openToast(React.createElement(o,{msg:e,id:o.genId()}))},onWindowError:function(e){this.openToast(React.createElement(o,{msg:e,id:o.genId()}))},render:function(){var e=this.animateEnter,t=_.chain(this.state.toasts).sortBy("id").reverse().map(function(t,r){var n=s>r?"slide"+r:"slide"+s;return 0!==r||e||(n=""),a(t,{key:t.props.id,ref:t.props.id,className:n})}).value();return React.createElement(i,{transitionName:"toast-transition"},t)}});e.exports=c},function(e,t,r){var n=r(435),i=r(450),o=r(201),a=r(528),s=r(537),c=r(574),d=r(522),u=r(523),l=r(144),p=React.createClass({displayName:"ConversationPanel",mixins:[n],propTypes:{chat:React.PropTypes.instanceOf(o).isRequired},getInitialState:function(){return{canCompose:this.canCompose()}},componentWillMount:function(){var e=this.props.chat;e.isGroup?this.addObserver(e,"change:isReadOnly",this.onComposeState):e.isUser&&this.addObserver(Store.Blocklist,"add remove reset",this.onComposeState)},componentDidMount:function(){var e=this.props.chat;e.set("active",!0),e.isDirty()&&e.sendSeen()},componentWillUnmount:function(){l.closeDrawer(i.DRAWER_RIGHT),this.props.chat.set("active",!1)},onComposeState:function(){var e=this.canCompose();this.state.canCompose!==e&&this.setState({canCompose:e})},canCompose:function(){var e=this.props.chat;return e.isReadOnly?!1:e.isUser?!e.contact.isBlocked():!0},onPageUpDown:function(e){this.refs.msgs.onPageUpDown(e)},onDragEnter:function(e){_.contains(e.dataTransfer.types,"Files")&&(l.openDrawer(React.createElement(d,{chat:this.props.chat,state:u.STATE.ACTIVE,type:i.DRAWER_MID}),"slide-up"),e.stopPropagation(),e.preventDefault())},render:function(){var e,t=this.props.chat;if(this.state.canCompose)e=React.createElement(c,{chat:t,onPageUpDown:this.onPageUpDown});else{var r=t.isGroup?l10n.t("web_cannot_send_not_a_group_participant"):l10n.t("web_cannot_send_to_blocked_contact_1",{contact:t.contact.formattedName});e=React.createElement("footer",{className:"pane-footer pane-chat-footer"},React.createElement("div",{className:"block-message"},r))}return React.createElement("div",{id:"main",className:"pane pane-chat",onDragOver:this.onDragOver,onDragEnter:this.onDragEnter},React.createElement(a,{chat:t}),React.createElement(s,{ref:"msgs",chat:t}),e)}});e.exports=p},function(e,t,r){var n=r(477),i=r(438),o=r(450),a=r(201),s=r(519),c=r(520),d=r(475),u=r(470),l=r(522),p=r(529),h=r(530),f=r(532),m=r(536),g=r(144),v=r(472),y=r(151),b=r(507),E=b.MenuBar,R=b.MenuBarItem,w=r(457),S=r(458),T=r(510),C=r(511),N=r(512),o=r(450),I=React.createClass({displayName:"ConversationHeader",mixins:[n,i],propTypes:{chat:React.PropTypes.instanceOf(a).isRequired},statics:{ATTACH_MEDIA_ACTIVE:"attach_media_active",GROUP_CHAT_ACTIVE:"group_chat_active"},getInitialState:function(){return{img:this.async("chat.ProfilePicThumb.img"),formattedTitle:this.async("chat.formattedTitle"),activeDropdown:void 0}},toggleInfo:function(){if(o.find(o.DRAWER_RIGHT))return void g.closeDrawer();var e=this.props.chat;e.isUser?g.openDrawer(React.createElement(h,{contact:e.contact,type:o.DRAWER_RIGHT}),"slide-left"):e.isBroadcast?g.openDrawer(React.createElement(m,{chat:e,type:o.DRAWER_RIGHT}),"slide-left"):e.isGroup&&g.openDrawer(React.createElement(f,{chat:e,type:o.DRAWER_RIGHT}),"slide-left")},render:function(){var e,t,r=this.props.chat;return r.isUser?(e=React.createElement(k,{chat:r}),t=React.createElement(c,{presence:r.presence,placeholder:l10n.t("click_here_for_user_info"),location:"title"})):r.isBroadcast?(e=React.createElement(M,{chat:r}),t=null):r.isGroup&&(e=React.createElement(O,{chat:r}),t=React.createElement(s,{presence:r.presence,groupMetadata:r.groupMetadata,placeholder:l10n.t("click_here_for_group_info"),location:"title"})),React.createElement("header",{className:"pane-header pane-chat-header"},React.createElement("div",{className:"chat-avatar",onClick:this.toggleInfo},React.createElement(d,{id:r.id})),React.createElement("div",{className:"chat-body",onClick:this.toggleInfo},React.createElement("div",{className:"chat-main"},React.createElement("h2",{className:"chat-title",dir:"auto"},React.createElement(u,{text:this.state.formattedTitle,titlify:!0,ellipsify:!0}))),t),React.createElement("div",{className:"pane-chat-controls"},React.createElement(E,{key:"conversation-header"},React.createElement(R,{a8n:"conversation-clip",icon:"clip",title:l10n.t("menutitle_attach"),transitionName:"menu"},React.createElement(P,{chat:r})),React.createElement(R,{a8n:"conversation-menu",icon:"menu",title:l10n.t("menutitle_menu")},e))))}}),P=React.createClass({displayName:"AttachMenuDropdown",mixins:[i],propTypes:{chat:React.PropTypes.instanceOf(a).isRequired},onClick:function(){o.pop()},stopPropagation:function(e){e.stopPropagation()},onImageClick:function(e){e.stopPropagation();var t=this.refs.input.getDOMNode();t.click()},onFilePick:function(e){e.stopPropagation();for(var t=e.target.files,r=[],n=0;n<t.length;n++)r.push(t[n]);e.target.value="",o.pop(o.MENU),g.openDrawer(React.createElement(l,{files:r,chat:this.props.chat,type:o.DRAWER_MID}),"slide-up")},guideConfirm:function(){g.closeModal()},onCaptureClick:function(){o.pop(o.MENU);var e=this.props.chat,t=new Promise(function(r,n){navigator.getUserMedia({video:!0},function(n){g.closeModal(),r(n),t.isResolved()&&g.openDrawer(React.createElement(p,{chat:e,stream:n,type:o.DRAWER_MID}),"slide-up")},function(e){var r=_.isString(e)?e:e.name,i=y.GUM[r]||y.GUM.GUMError;n(new i),t&&t.isResolved()&&g.closeModal()})}).bind(this).timeout(1e3,"waitForGUMConversationHeaderTimeout").then(function(t){g.openDrawer(React.createElement(p,{chat:e,stream:t,type:o.DRAWER_MID}),"slide-up")})["catch"](Promise.TimeoutError,function(){g.openModal(React.createElement(v,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_description",type:v.TYPE.GUIDE_ALLOW}))})["catch"](y.GUM.PermissionDeniedError,function(){g.openModal(React.createElement(v,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_fail_description",type:v.TYPE.GUIDE_UNBLOCK}))})["catch"](y.GUM.GUMError,function(){g.openModal(React.createElement(v,{title:"guide_desktop_camera_missing_title",desc:"guide_desktop_camera_missing_description",type:v.TYPE.GUIDE_NONE}))})},onLocationClick:function(){},render:function(){var e=navigator.getUserMedia?React.createElement("button",{className:"menu-icons-item",onClick:this.onCaptureClick},React.createElement("span",{className:"icon icon-camera"})):null;return React.createElement(w,{type:w.Type.MENU,key:"AttachMenuDropdown"},React.createElement("button",{className:"menu-icons-item",onClick:this.onImageClick},React.createElement("span",{className:"icon icon-image"})),e,React.createElement("input",{ref:"input",type:"file",accept:Wa.CONST.IMAGE_MIMES+","+Wa.CONST.VIDEO_MIMES,style:{display:"none"},onClick:this.stopPropagation,onChange:this.onFilePick,multiple:!0}))}}),O=React.createClass({displayName:"GroupMenuDropdown",
mixins:[n],propTypes:{chat:React.PropTypes.instanceOf(a).isRequired},getInitialState:function(){return{isReadOnly:this.async("chat.isReadOnly")}},onGroupInfo:function(){return o.find(o.DRAWER_RIGHT)?void g.closeDrawer():void g.openDrawer(React.createElement(f,{chat:this.props.chat,type:o.DRAWER_RIGHT}),"slide-left")},onMute:function(e){g.muteChat(this.props.chat,e)},onArchive:function(e){g.archiveChat(this.props.chat,e)},onDeleteOrExit:function(){g.deleteOrExitChat(this.props.chat)},render:function(){var e=this.props.chat,t=[];return e.canArchive()&&t.push(React.createElement(C,{key:"archive",onArchive:this.onArchive,chat:e})),e.mute.canMute()&&t.push(React.createElement(T,{key:"mute",onMute:this.onMute,chat:e})),e.canDelete()&&t.push(React.createElement(N,{key:"delete",onDeleteOrExit:this.onDeleteOrExit,chat:e})),React.createElement(w,{type:w.Type.DROPDOWN_MENU,key:"GroupMenuDropdown",flipOnRTL:!0,direction:{x:w.Direction.X.LEFT}},React.createElement(S,{action:this.onGroupInfo,shortcut:"i"},l10n.t("web_group_info")),t)}}),M=React.createClass({displayName:"BroadcastMenuDropdown",propTypes:{chat:React.PropTypes.instanceOf(a).isRequired},onBroadcastInfo:function(){return o.find(o.DRAWER_RIGHT)?void g.closeDrawer():void g.openDrawer(React.createElement(m,{chat:this.props.chat,type:o.DRAWER_RIGHT}),"slide-left")},onDeleteOrExit:function(){g.deleteOrExitChat(this.props.chat)},onArchive:function(e){g.archiveChat(this.props.chat,e)},render:function(){var e=this.props.chat,t=[];return e.canArchive()&&t.push(React.createElement(C,{key:"archive",onArchive:this.onArchive,chat:e})),e.canDelete()&&t.push(React.createElement(N,{key:"delete",onDeleteOrExit:this.onDeleteOrExit,chat:e})),React.createElement(w,{type:w.Type.DROPDOWN_MENU,key:"BroadcastMenuDropdown",flipOnRTL:!0,direction:{x:w.Direction.X.LEFT}},React.createElement(S,{action:this.onBroadcastInfo,shortcut:"i"},l10n.t("web_list_info")),t)}}),k=React.createClass({displayName:"ContactMenuDropdown",propTypes:{chat:React.PropTypes.instanceOf(a).isRequired},onContactInfo:function(){return o.find(o.DRAWER_RIGHT)?void g.closeDrawer(o.DRAWER_RIGHT):void g.openDrawer(React.createElement(h,{contact:this.props.chat.contact,type:o.DRAWER_RIGHT}),"slide-left")},onArchive:function(e){g.archiveChat(this.props.chat,e)},onDeleteOrExit:function(){g.deleteOrExitChat(this.props.chat)},render:function(){var e=this.props.chat,t=[];return e.canArchive()&&t.push(React.createElement(C,{key:"archive",onArchive:this.onArchive,chat:e})),e.canDelete()&&t.push(React.createElement(N,{key:"delete",onDeleteOrExit:this.onDeleteOrExit,chat:e})),React.createElement(w,{type:w.Type.DROPDOWN_MENU,key:"ContactMenuDropdown",flipOnRTL:!0,direction:{x:w.Direction.X.LEFT}},React.createElement(S,{a8n:"mi-contact",action:this.onContactInfo,shortcut:"i"},l10n.t("web_contact_info")),t)}});e.exports=I},function(e,t,r){var n=r(495),i=r(462),o=r(201),a=React.createClass({displayName:"CaptureFlow",mixins:[n],propTypes:{chat:React.PropTypes.instanceOf(o).isRequired,stream:React.PropTypes.object.isRequired},componentWillMount:function(){this.push(React.createElement(i,{onBack:this.endFlow,caption:!0,onSend:this.sendMedia,stream:this.props.stream}))},sendMedia:function(e){this.props.chat.sendMedia(e),this.endFlow()}});e.exports=a},function(e,t,r){var n=r(477),i=r(235),o=r(144),a=r(498),s=r(473),c=r(509),d=r(452),u=r(455),l=r(454),p=r(475),h=r(531),f=r(470),m=r(151),g=r(231),v=React.createClass({displayName:"ContactInfoDrawer",mixins:[n,i],propTypes:{contact:React.PropTypes.instanceOf(g).isRequired},getInitialState:function(){return{status:this.async("contact.Status.status"),commonGroups:void 0}},componentDidMount:function(){this.safeDelay(function(){this.props.contact.findCommonGroups().bind(this).then(function(e){this.isMounted()&&this.setState({commonGroups:_.compact(e)})})["catch"](m.WapDrop,_.noop)["catch"](_.noop)},300)},onDeleteChat:function(){var e=Store.Chat.get(this.props.contact.id);o.deleteOrExitChat(e)},onClose:function(){o.closeDrawer(this.props.type)},parseSelection:function(e){for(var t,r,n="",i=0;i<e.rangeCount;i++)for(r=document.createTreeWalker(e.getRangeAt(i).cloneContents(),window.NodeFilter.SHOW_ALL);r.nextNode();)t=r.currentNode,n+=t instanceof HTMLImageElement?t.alt:t.nodeValue?t.nodeValue:"";return n},onCopyPhone:function(e){var t=this.parseSelection(window.getSelection()),r="​",n="⁠",i=""+r+n+r;if(_.startsWith(t,i)){var o=t.match(new RegExp("^"+i+"(.*?)"+i));o&&o.length>1&&(t=_.last(o))}t=t.replace(new RegExp(""+i),""),e.clipboardData.setData("text/plain",t),e.stopPropagation(),e.preventDefault()},onViewPicture:function(e){if(this.canViewPicture){var t=e.target,r=function(e){e(t)};o.openModal(React.createElement(s,{contact:this.props.contact,getZoomNode:r}),"profile-viewer")}},onDetailImageLoad:function(e){this.canViewPicture=!0},render:function(){var e,t,r=this.props.contact,n=this.state.commonGroups;if(_.isArray(n)&&n.length){e=n.map(function(e){return React.createElement(c,{chat:e,mode:c.Mode.INFO,noHighlight:!0,key:e.id})});var i=3,o=24,s={minHeight:n.length>i?i*a.DEFAULT_HEIGHT+o:n.length*a.DEFAULT_HEIGHT+o};e=React.createElement(l,{title:l10n.t("web_groups_participation_you_and_name",{user:r.formattedShortName}),subtitle:l10n.n(n.length),classes:"animate-enter drawer-section-list",ref:"container",style:s,expands:!0,noContainer:!0},React.createElement("div",{className:"drawer-section-body drawer-section-body-expand chatlist",ref:"list"},React.createElement(a,{data:e,scrollTarget:1,height:72,extraItems:4})))}var m=Store.Chat.get(r.id);_.isArray(n)&&m&&m.canDelete()&&(t=React.createElement(l,{classes:"animate-enter drawer-section-action"},React.createElement("div",{onClick:this.onDeleteChat,className:"btn btn-danger"},l10n.t("delete_chat"))));var g=this.state.status?React.createElement(l,{title:l10n.t("web_status"),classes:"animate-enter1"},React.createElement(f,{classes:"textfield-static",direction:"auto",text:this.state.status})):null;return React.createElement(d,{key:"contact-info-modal",id:"info",variant:"panel",onCancel:this.onClose},React.createElement("header",{className:"pane-header"},React.createElement("div",{className:"header-close"},React.createElement("button",{onClick:this.onClose},React.createElement("span",{className:"icon icon-x"}))),React.createElement("div",{className:"header-body"},React.createElement("div",{className:"header-main"},React.createElement("div",{className:"header-title"},l10n.t("web_contact_info"))))),React.createElement(u,{expands:!!e},React.createElement(l,{classes:"drawer-scale drawer-section-photo"},React.createElement(p,{id:r.id,size:p.LARGE,loader:!0,onLoad:this.onDetailImageLoad,onClick:this.onViewPicture,quality:p.HIGH})),g,React.createElement(l,{title:l10n.t("web_contact_phone"),classes:"animate-enter2"},React.createElement(h,{className:"textfield-static",onCopy:this.onCopyPhone,dir:"auto"},Wa.widGetFormattedUser(r.id))),e,t))}});e.exports=v},function(e,t){function r(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}var n=React.createClass({displayName:"IsolatedBlock",propTypes:{Component:React.PropTypes.string.isRequired},getDefaultProps:function(){return{Component:"span"}},render:function(){var e=this.props,t=e.Component,n=(e.children,r(e,["Component","children"]));return React.createElement(t,n,"​⁠​",this.props.children,"​⁠​")}});e.exports=n},function(e,t,r){var n=r(477),i=r(435),o=r(144),a=r(201),s=r(498),c=r(499),d=r(452),u=r(455),l=r(454),p=r(456),h=r(470),f=r(458),m=r(490),g=r(450),v=r(437),y=r(533),_=r(493),b=r(4),E=_.genId("max_participant_toast"),R=React.createClass({displayName:"GroupInfoDrawer",mixins:[n,i],propTypes:{chat:React.PropTypes.instanceOf(a).isRequired},getInitialState:function(){return{imgFull:this.async("chat.ProfilePicThumb.imgFull"),name:this.async("chat.contact.name")||"",isReadOnly:this.async("chat.isReadOnly"),pendingSubject:!1,pendingPhoto:!1}},componentWillMount:function(){var e=this.props.chat.groupMetadata;this.addObserver(e.participants,"add remove reset sort change:isAdmin")},componentWillUnmount:function(){g.popDependents(this)},onImageSet:function(e,t){var r=Store.ProfilePicThumb.get(this.props.chat.id);this.setState({pendingPhoto:!0});var n;n=e&&t?r.setPicture(e,t):r.deletePicture(),n.bind(this).then(function(){this.isMounted()&&this.setState({pendingPhoto:!1})})},onParticipantClick:function(e,t){Wa.me!==t.id&&Store.Chat.find(t.id).then(function(e){o.openChat(e)})},menuEnabled:function(e){var t=this.props.chat.groupMetadata.participants,r=t.get(e.id);return r&&(t.canPromote(r)||t.canRemove(r))},onParticipantMenu:function(e,t,r){var n=this.props.chat.groupMetadata.participants,i=n.get(t.id);if(this.menuEnabled(t)){var a=[];if(n.canPromote(i)){var s=this.confirmParticipantPromote.bind(this,i);a.push(React.createElement(f,{key:"promote",action:s},l10n.t("menuitem_make_group_admin")))}if(n.canRemove(i)){var c=this.confirmParticipantRemove.bind(this,i);a.push(React.createElement(f,{key:"remove",action:c,shortcut:"d"},l10n.t("menuitem_remove")))}o.openContextMenu(a,{parent:this,anchor:e.anchor,event:e.event,onClose:r})}},confirmParticipantRemove:function(e){var t=this.onParticipantRemove.bind(this,e),r=l10n.t("confirm_remove_group_participant",{participant:e.contact.formattedName,subject:this.props.chat.contact.name});o.openModal(React.createElement(v,{onOK:t,okText:l10n.t("remove"),onCancel:o.closeModal.bind(o),cancelText:l10n.t("web_cancel")},React.createElement(h,{text:r})))},onParticipantRemove:function(e){e.contact.pendingAction++,this.props.chat.groupMetadata.participants.removeParticipant(e).then(function(){e.contact.pendingAction--}),o.closeModal()},confirmParticipantPromote:function(e){var t=this.onParticipantPromote.bind(this,e),r=l10n.t("confirm_promote_group_participant",{participant:e.contact.formattedName,subject:this.props.chat.contact.name});o.openModal(React.createElement(v,{onOK:t,okText:l10n.t("menuitem_make_group_admin"),onCancel:o.closeModal.bind(o),cancelText:l10n.t("web_cancel")},React.createElement(h,{text:r})))},onParticipantPromote:function(e){e.contact.pendingAction++,this.props.chat.groupMetadata.participants.promoteParticipant(e).then(function(){e.contact.pendingAction--}),o.closeModal()},openAddGroupParticipantFlow:function(){if(this.props.chat.groupMetadata.participants.length>=b.MAX_GROUP_SIZE){var e=l10n.t("action_group_create_failed_participant",{max:b.MAX_GROUP_SIZE});o.openToast(React.createElement(_,{msg:e,id:E}))}else{var t=React.createElement(y,{chat:this.props.chat});o.openModal(t,"modal-flow")}},onClose:function(){o.closeDrawer(this.props.type)},onExitOrDeleteGroup:function(){o.deleteOrExitChat(this.props.chat)},onSubjectChange:function(e){this.setState({name:e.target.value})},validateSubject:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return!!e.trim()},onSetSubjectError:function(){o.openModal(React.createElement(v,{onOK:o.closeModal.bind(o),okText:l10n.t("web_ok")},l10n.t("action_group_subject_empty")))},onSetSubject:function(e){var t=this.props.chat,r=t.groupMetadata;r.canSetSubject()&&this.state.name!==t.contact.name&&(this.setState({pendingSubject:!0}),t.setSubject(this.state.name).bind(this)["finally"](function(){this.isMounted()&&this.setState({name:t.contact.name,pendingSubject:!1})}))},onCancelSubject:function(){this.setState({name:this.props.chat.contact.name})},render:function(){var e,t,r=this.props.chat,n=r.groupMetadata,i=this,o=n.participants.map(function(e){var t=e.contact;return React.createElement(c,{contact:t,key:e.id,admin:!!e.isAdmin,onClick:i.onParticipantClick,contextEnabled:i.menuEnabled.bind(i,t),onContext:i.onParticipantMenu})});r.canDelete()&&(t=React.createElement(l,{classes:"animate-enter3 drawer-section-action"},React.createElement("div",{onClick:this.onExitOrDeleteGroup,className:"btn btn-danger"},r.isReadOnly?l10n.t("web_delete_group"):l10n.t("web_exit_group")))),n.participants.canAdd()&&(e=React.createElement("div",{className:"list-action",onClick:this.openAddGroupParticipantFlow},React.createElement("div",{className:"list-action-icon"},React.createElement("span",{className:"icon icon-add-user"})),React.createElement("div",{className:"list-action-body"},l10n.t("add_group_participant"))));var a=3,h=24,f=55,v=e?h+f:h,y={minHeight:o.length>a?a*s.DEFAULT_HEIGHT+v:o.length*s.DEFAULT_HEIGHT+v},_=o.length?React.createElement(l,{title:l10n.t("web_participants_title"),subtitle:l10n.t("web_participants_count",{count:o.length,max:b.MAX_GROUP_SIZE}),classes:"animate-enter2 drawer-section-list",expands:!0,style:y,ref:"container",noContainer:!0},e,React.createElement("div",{className:"drawer-section-body drawer-section-body-expand chatlist"},React.createElement(s,{data:o,scrollTarget:1,height:s.DEFAULT_HEIGHT,extraItems:4}))):null,E=React.createElement(l,{title:l10n.t("subject"),classes:"animate-enter1"},React.createElement(m,{id:g.SUBJECT_INPUT,value:this.state.name,editable:n.canSetSubject(),pending:this.state.pendingSubject,showRemaining:!0,validate:this.validateSubject,maxLength:b.MAX_SUBJECT_LENGTH,onChange:this.onSubjectChange,onSave:this.onSetSubject,onError:this.onSetSubjectError,onCancel:this.onCancelSubject})),R=r.contact.profilePicThumb,w=r.isReadOnly||!R.canDelete()&&!R.canSet()?p.Type.NO_EDIT:p.Type.GROUP,S=React.createElement(p,{type:w,id:r.contact.id,pending:this.state.pendingPhoto,startImage:this.state.imgFull,onImageSet:this.onImageSet}),T=null;return r.groupMetadata.creation&&(T=React.createElement("div",{className:"header-secondary"},l10n.t("web_group_creation_time",{when:Wa.formatDateAndTimeRelative(r.groupMetadata.creation)}))),React.createElement(d,{key:"contact-info-modal",id:"info",variant:"panel",onCancel:this.onClose},React.createElement("header",{className:"pane-header"},React.createElement("div",{className:"header-close"},React.createElement("button",{onClick:this.onClose},React.createElement("span",{className:"icon icon-x"}))),React.createElement("div",{className:"header-body"},React.createElement("div",{className:"header-main"},React.createElement("div",{className:"header-title"},l10n.t("web_group_info"))),T)),React.createElement(u,{expands:!!o.length},React.createElement(l,{classes:"drawer-scale drawer-section-photo"},S),E,_,t))}});e.exports=R},function(e,t,r){var n=r(495),i=r(437),o=r(534),a=r(201),s=r(144),c=r(470),d=React.createClass({displayName:"AddGroupParticipant",mixins:[n],propTypes:{chat:React.PropTypes.instanceOf(a).isRequired},componentWillMount:function(){var e=this.props.chat.groupMetadata;this.push(React.createElement(o,{onContact:this.confirmAddParticipant,exclude:e.participants.pluck("contact"),title:l10n.t("add_group_participant")}))},confirmAddParticipant:function(e){var t=this.onAddParticipant.bind(this,e),r=l10n.t("confirm_add_group_participant",{participant:e.formattedName,subject:this.props.chat.contact.name});this.push(React.createElement(i,{onOK:t,okText:l10n.t("add_group_participant"),onCancel:this.onBack,cancelText:l10n.t("web_cancel")},React.createElement(c,{text:r})))},onBack:function(){this.pop()},onAddParticipant:function(e){this.props.chat.groupMetadata.participants.addParticipant(e),s.closeModal()}});e.exports=d},function(e,t,r){var n=r(461),i=r(535),o=r(144),a=React.createClass({displayName:"ContactModal",propTypes:{title:React.PropTypes.string,onContact:React.PropTypes.func.isRequired,exclude:React.PropTypes.arrayOf(React.PropTypes.instanceOf(Store.Contact.model))},onCancel:function(){o.closeModal()},onContact:function(e,t){this.props.onContact(t)},render:function(){return React.createElement(n,{type:n.TOWER},React.createElement(i,{onBack:this.onCancel,onContact:this.onContact,title:this.props.title,exclude:this.props.exclude}))}});e.exports=a},function(e,t,r){var n=r(452),i=r(453),o=r(455),a=r(497),s=r(503),c=r(235),d=React.createClass({displayName:"ContactPickerDrawer",mixins:[c],propTypes:{title:React.PropTypes.string,onBack:React.PropTypes.func.isRequired,onContact:React.PropTypes.func.isRequired,exclude:React.PropTypes.arrayOf(React.PropTypes.instanceOf(Store.Contact.model))},getInitialState:function(){return{searchText:"",cancelSearch:!1,active:!1}},componentDidMount:function(){this.safeDefer(function(e){e.setState({active:!0})},this)},getFilteredContacts:function(){var e=Store.Contact.getFilteredContacts(),t=this.state.searchText;return t?(t=l10n.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e},close:function(){return this.searchText?(this.setState({searchText:"",cancelSearch:!0}),!0):!1},onSearch:function(e){this.setState({searchText:e})},render:function(){var e=this.state.active?React.createElement(a,{scrollTarget:1,contacts:this.getFilteredContacts(),exclude:this.props.exclude,onClick:this.props.onContact}):null;return React.createElement(n,{key:"contact-modal",onCancel:this.props.onBack,position:"right"},React.createElement(i,{title:this.props.title,type:i.Type.POPUP,onCancel:this.props.onBack}),React.createElement(s,{searchText:this.state.searchText,isSearching:!this.state.cancelSearch,onSearch:this.onSearch,searchType:s.CONTACT,placeholder:l10n.t("search_contacts")}),React.createElement(o,null,e))}});e.exports=d},function(e,t,r){var n=r(435),i=r(144),o=r(201),a=r(473),s=r(498),c=r(499),d=r(452),u=r(455),l=r(454),p=r(475),h=React.createClass({displayName:"BroadcastInfoDrawer",mixins:[n],propTypes:{chat:React.PropTypes.instanceOf(o).isRequired},componentWillMount:function(){var e=this.props.chat.groupMetadata;this.addObserver(e.participants,"add remove sort reset")},onParticipantClick:function(e,t){Wa.me!==t.id&&Store.Chat.find(t.id).then(function(e){i.openChat(e)})},onClose:function(){i.closeDrawer(this.props.type)},onViewPicture:function(e){var t=e.target,r=function(e){e(t)};i.openModal(React.createElement(a,{contact:this.props.chat.contact,getZoomNode:r}),"profile-viewer")},render:function(){var e,t=this.props.chat,r=t.groupMetadata,n=this.onParticipantClick,i=r.participants.map(function(e){var t=Store.Contact.get(e.id)||Store.Contact.add({id:e.id});return React.createElement(c,{contact:t,admin:!!e.isAdmin,onClick:n,key:e.id})}),o=3,a=24,h={minHeight:i.length>o?o*s.DEFAULT_HEIGHT+a:i.length*s.DEFAULT_HEIGHT+a},f=i.length?React.createElement(l,{classes:"animate-enter1",title:l10n.t("web_recipients_title"),subtitle:l10n.n(i.length),style:h,expands:!0},React.createElement(s,{data:i,scrollTarget:1,height:72,extraItems:4})):null;return t.groupMetadata.creation?(e=Wa.formatTimestampWithDate(t.groupMetadata.creation),e=React.createElement("div",{className:"header-secondary"},l10n.t("web_group_creation_time",{when:e}))):e=null,React.createElement(d,{key:"contact-info-modal",id:"info",variant:"panel",onCancel:this.onClose},React.createElement("header",{className:"pane-header"},React.createElement("div",{className:"header-close"},React.createElement("button",{onClick:this.onClose},React.createElement("span",{className:"icon icon-x"}))),React.createElement("div",{className:"header-body"},React.createElement("div",{className:"header-main"},React.createElement("div",{className:"header-title"},l10n.t("broadcast_list_info")),e))),React.createElement(u,{expands:!!i.length},React.createElement(l,{classes:"drawer-scale drawer-section-photo"},React.createElement(p,{id:t.id,size:p.LARGE,onClick:this.onViewPicture})),f))}});e.exports=h},function(e,t,r){var n=r(477),i=r(435),o=r(467),a=r(235),s=r(538),c=r(573),d=r(144),u=r(201),l=r(438),p=r(15),h=React.createClass({displayName:"ConversationMsgs",mixins:[n,o,i,l,a],propTypes:{chat:React.PropTypes.instanceOf(u).isRequired},statics:{MSG_CHUNK:50},getInitialState:function(){return{cursor:Math.min(h.MSG_CHUNK,this.props.chat.msgs.length),unreadCount:this.props.chat.unreadCount}},componentWillMount:function(){var e=this.props.chat;if(this.regCmd("load_earlier_msgs:"+e.id,this.loadEarlierMsgs),this.regCmd("open_chat",this.onOpenChat),this.regCmd("compose_height_change",this.composeHeightChange),this.addObserver(e,"change:unreadCount",this.onUnreadCount),this.addObserver(e.msgs,"change:last",this.onLastMsgChanged),this.addObserver(e.msgs,"bulk_add remove"),this.regNativeListener(window,"focus",this.windowGainedFocus),this.regNativeListener(window,"blur",this.windowLostFocus),e.isGroup){var t=this.props.chat.groupMetadata;this.addObserver(t.participants,"change:contact.name change:contact.isMyContact"),this.addObserver(t,"change:trusted")}else e.isUser&&this.addObserver(e.contact,"change:isMyContact")},componentDidMount:function(){var e=this.props.chat;if(!e.noEarlierMsgs){var t=this.getDOMNode();0===t.scrollTop&&d.loadEarlierMsgs(this.props.chat)}},componentWillUnmount:function(){this.props.chat.isDirty()&&this.props.chat.sendSeen(),this.props.chat.markedUnread=!1},scrollTo:function(e){e(this.getDOMNode())},loadEarlierMsgs:function(){var e=this.props.chat;if(e.msgs.length<=this.state.cursor){var t=this;e.loadEarlierMsgs().then(function(){t.isMounted()&&t.setState({cursor:e.msgs.length})})}else{var r=Math.min(this.state.cursor+h.MSG_CHUNK,e.msgs.length);this.setState({cursor:r})}},composeHeightChange:function(e){var t=this.getDOMNode();if(e){if(0>e&&t.scrollTop===t.scrollHeight-t.clientHeight)return;t.scrollTop=t.scrollTop+e}else{var r=t.scrollHeight-(t.scrollTop+t.clientHeight);Velocity(t,{tween:18},{progress:function(){t.scrollTop=t.scrollHeight-r-t.clientHeight},duration:300},[.1,.82,.25,1])}},nearBottom:function(e){return e=e||this.getDOMNode(),e.scrollTop+Wa.CONST.SCROLL_FUDGE>e.scrollHeight-e.clientHeight},getMsgs:function(){var e=this.props.chat.msgs,t=e.length,r=Math.max(0,t-this.state.cursor);return this.props.chat.msgs.toArray().slice(r,t)},onScroll:function(e){this.handleScroll(e.target,this.props.chat,this.nearBottom)},handleScroll:_.throttle(function(e,t,r){0===e.scrollTop&&d.loadEarlierMsgs(t),r(e)&&t.isDirty()&&document.hasFocus()&&t.sendSeen()},100),windowGainedFocus:function(){var e=this.props.chat;!this.clearUnreadTimer&&e.isDirty()&&(this.clearUnreadTimer=this.safeDelay(function(){delete this.clearUnreadTimer;var t=this.getDOMNode();this.nearBottom(t)&&e.isDirty()&&e.sendSeen()},Wa.CONST.CLEAR_CHAT_DIRTY_WAIT))},windowLostFocus:function(){var e=this.props.chat;0===e.unreadCount&&this.setState({unreadCount:0}),e.markedUnread=!1},onOpenChat:function(e){e.id===this.props.chat.id&&this.scrollToBottom()},scrollToBottom:function(){var e=this.getDOMNode();e.scrollTop=e.scrollHeight},onLastMsgChanged:function(){var e=this.props.chat,t=e.msgs.last();(document.hasFocus()||t&&t.isSentByMe)&&(this.state.unreadCount&&this.setState({unreadCount:0}),(t&&t.isSentByMe||this.nearBottom())&&this.scrollToBottom()),t&&t.isSentByMe&&e.isDirty()&&e.sendSeen();var r=e.msgs.length;r!==this.state.cursor&&this.setState({cursor:r})},onUnreadCount:function(){var e=this.props.chat,t=document.hasFocus();return t||0===e.unreadCount?void(t&&e.isDirty()&&this.nearBottom()&&e.sendSeen()):void this.setState({unreadCount:e.unreadCount})},onPageUpDown:function(e){this.getDOMNode().focus()},onKeyPress:function(e){e.metaKey||e.ctrlKey||(p.isGecko?d.pasteChatTextInput(this.props.chat,e.key):d.focusChatTextInput(this.props.chat))},onPaste:function(e){e.preventDefault(),d.pasteChatTextInput(this.props.chat,e.clipboardData.getData("text/plain"))},render:function(){return React.createElement("div",{className:"pane-body pane-chat-body lastTabIndex",onScroll:this.onScroll,onKeyPress:this.onKeyPress,onPaste:this.onPaste,tabIndex:"0"},React.createElement("div",{className:"pane-chat-empty"}),React.createElement(c,{chat:this.props.chat}),React.createElement(s,{key:"ml-"+this.props.chat.id,scrollTo:this.scrollTo,chatId:this.props.chat.id,unreadCount:this.state.unreadCount,msgs:this.getMsgs()}))}});e.exports=h},function(e,t,r){var n=r(230),i=r(539),o=r(541),a=r(542),s=r(467),c={FRONT:"front",SWITCH:"switch",BACK:"back",MUTATE:"mutate",UNREAD:"unread"},d=React.createClass({displayName:"MessageList",mixins:[s],propTypes:{msgs:React.PropTypes.arrayOf(React.PropTypes.instanceOf(n)).isRequired,scrollTo:React.PropTypes.func.isRequired,chatId:React.PropTypes.string.isRequired,unreadCount:React.PropTypes.number},propChangeType:function(e){var t=this.props.msgs,r=e.msgs;return this.props.unreadCount!==e.unreadCount?c.UNREAD:this.props.chatId!==e.chatId?c.SWITCH:t.length&&r.length&&t[0].id!==r[0].id?c.BACK:t.length===r.length||r.length<t.length?c.MUTATE:c.FRONT},componentWillMount:function(){this.regCmd("is_msg_visible",this.isMsgVisible)},didInsertMessageUnread:function(e){this.props.scrollTo(function(t){t.scrollTop=e.offsetTop-t.clientHeight/4}),this.shouldScrollBottom=!1,this.shouldRestoreScroll=void 0},componentDidMount:function(){this._hasRendered=!0,this.shouldScrollBottom!==!1&&this.props.scrollTo(function(e){e.scrollTop=e.scrollHeight})},componentWillUpdate:function(e){this.props.scrollTo(function(t){var r=this.propChangeType(e);if(r===c.SWITCH)this.shouldScrollBottom=!0;else if(r===c.FRONT){var n=_.last(e.msgs);(n.isSentByMe||t.scrollTop+t.offsetHeight===t.scrollHeight)&&(this.shouldScrollBottom=!0),this.shouldScrollBottom||(this.shouldRestoreScroll=t.scrollHeight-t.scrollTop-t.clientHeight)}else(r===c.BACK||r===c.UNREAD)&&(this.shouldRestoreScroll=t.scrollHeight-t.scrollTop-t.clientHeight)}.bind(this))},componentDidUpdate:function(e){this.props.scrollTo(function(e){this.shouldScrollBottom?(e.scrollTop=e.scrollHeight,this.shouldScrollBottom=!1):"undefined"!=typeof this.shouldRestoreScroll&&(e.scrollTop=e.scrollHeight-this.shouldRestoreScroll-e.clientHeight,this.shouldRestoreScroll=void 0)}.bind(this))},processHiddenText:function(e,t){var r="​",n="⁠",i=n+n,o=n+n+n,a=i+"([^"+n+"]+)"+o,s=n+n+n+n,c=n+n+n+n+n,d=s+"[^"+n+"]+"+c;if(e=e.replace(new RegExp(r,"g"),""),e=e.replace(new RegExp(""+d,"g"),""),e=e.replace(new RegExp("^[^"+n+"]+"+c+"(.*)","g"),"$1"),e=e.replace(new RegExp("(.*)"+s+"[^"+n+"]+$","g"),"$1"),!new RegExp("^"+a).test(e)&&new RegExp(""+a,"g").test(e)){for(var u,l=t.getRangeAt(0).startContainer,p=0;5>p&&!(u=l.getAttribute&&l.getAttribute("data-id"));p++)l=l.parentNode;var h=Store.Msg.get(u);if(h){var f="["+Wa.formatDate(h.t)+", "+Wa.formatTimestamp(h.t)+"]",m=h.senderObj.formattedUser;e=f+" "+m+": "+e}}e=e.replace(new RegExp("^(.*)"+a+"$","g"),"$1");var g=e.match(new RegExp(a,"g"));return g&&1===g.length&&(e=e.replace(new RegExp(a,"g"),"")),e=e.replace(new RegExp(""+a,"g"),"\n$1"),"\n"===e.charAt(0)&&(e=e.slice(1)),e},parseSelection:function(e){for(var t,r,n="",i=0;i<e.rangeCount;i++)for(r=document.createTreeWalker(e.getRangeAt(i).cloneContents(),window.NodeFilter.SHOW_ALL);r.nextNode();)t=r.currentNode,n+=t instanceof HTMLImageElement?t.alt:t.nodeValue?t.nodeValue:"";return n},onCopy:function(e){var t=window.getSelection(),r=this.parseSelection(t);e.clipboardData.setData("text/plain",this.processHiddenText(r,t)),e.stopPropagation(),e.preventDefault()},isMsgVisible:function(e,t){var r=void 0,n=this.refs[e.toString()];if(n){var i=this.getDOMNode().parentNode,o=i.scrollTop,a=o+i.clientHeight,s=n.getDOMNode();s.offsetTop+s.clientHeight>o&&s.offsetTop<a&&(r=n.refs.component.refs.img.getDOMNode())}t(r)},render:function(){for(var e,t,r=[],s=this.props.msgs,c=s.length,d=this.props.unreadCount,u=[n.TYPE.CHAT,n.TYPE.IMAGE,n.TYPE.VIDEO,n.TYPE.AUDIO,n.TYPE.VCARD,n.TYPE.LOCATION,n.TYPE.PTT];d>0;){if(c--,0>c){c=s.length;break}e=s[c],u.indexOf(e.type)>-1&&d--}var l=s[c];if(l&&l.chat.noEarlierMsgs)for(t=0;c>t;t++)if(u.indexOf(s[t].type)){c=s.length;break}var p=!1;for(t=0;t<s.length;t++)if(e=s[t]){if(0===t||!s[t-1].isSameDay(e)){var h=Wa.formatDateRelative(e.t).toUpperCase(),f="msg-"+e.id+"-date";r.push(React.createElement("div",{className:"msg",key:f},React.createElement("div",{className:"message message-system"},React.createElement(i,{text:h})))),p=!1}t===c&&(r.push(React.createElement("div",{className:"msg msg-unread message msg-wide",key:"msg-unread"},React.createElement(o,{shouldScrollTo:!this._hasRendered,didInsert:this.didInsertMessageUnread,count:this.props.unreadCount}))),p=!1);var m=_.matches({from:e.from,startOfDay:e.startOfDay}),g=_.matches({author:e.author,startOfDay:e.startOfDay}),v=e.isGroupMsg?g:m,y=a.Position.SINGLE,b=s[t+1];(b&&t+1===c||b&&b.isNotification||0===t||b&&!e.isSameDay(b))&&(b=!1),e.isNotification?y=a.Position.SINGLE:v(b)&&!v(p)?y=a.Position.FRONT:v(p)&&v(b)?y=a.Position.MID:v(p)&&!v(b)&&(y=a.Position.END),e.type===n.TYPE.IMAGE?r.push(React.createElement(a,{key:"msg-"+e.id,ref:e.id.toString(),msg:e,position:y})):r.push(React.createElement(a,{key:"msg-"+e.id,msg:e,position:y})),p=e.isNotification?!1:e}return React.createElement("div",{className:"message-list",onCopy:this.onCopy},r)}});e.exports=d},function(e,t,r){var n=r(540),i=r(470),o=React.addons.PureRenderMixin,a=React.createClass({displayName:"Notification",mixins:[o],propTypes:{text:React.PropTypes.string.isRequired},render:function(){return React.createElement("span",{className:"message-system-body"},React.createElement(n,null,React.createElement(i,{direction:"auto",text:this.props.text})))}});e.exports=a},function(e,t){var r=React.createClass({displayName:"HiddenToken",propTypes:{children:React.PropTypes.node.isRequired},render:function(){return React.createElement("span",{className:"hidden-token"},"⁠⁠⁠⁠",this.props.children,"⁠⁠⁠⁠⁠")}});e.exports=r},function(e,t,r){var n=r(540),i=r(477),o=React.createClass({displayName:"Unread",mixins:[i],propTypes:{count:React.PropTypes.number.isRequired,shouldScrollTo:React.PropTypes.bool.isRequired,didInsert:React.PropTypes.func.isRequired},componentDidMount:function(){this.props.shouldScrollTo&&this.props.didInsert(this.getDOMNode().parentNode)},render:function(){var e=l10n.t("unread_message_count",{count:l10n.n(this.props.count),_plural:this.props.count});return React.createElement("span",{className:"msg-unread-body"},React.createElement(n,null,e))}});e.exports=o},function(e,t,r){var n=r(14),i=r(543),o=r(435),a=r(230),s=r(144),c=r(437),d=r(470),u=r(544),l=r(458),p=r(450),h=r(546),f=r(547),m=r(549),g=r(552),v=r(557),y=r(539),b=r(565),E=r(566),R=r(569),w=r(570),S=r(166),T=r(170),C=r(201),N=r(440),I={BEGIN:"begin",MID:"mid",END:"end",SINGLE:"single"},P=React.createClass({displayName:"Wrapper",mixins:[o],propTypes:{msg:React.PropTypes.instanceOf(a).isRequired,position:React.PropTypes.oneOf(_.values(I))},getInitialState:function(){return{failed:this.props.msg.isFailed,hover:!1,contextMenu:!1}},shouldComponentUpdate:function(e,t){return t.hover!==this.state.hover||t.contextMenu!==this.state.contextMenu||t.failed!==this.state.failed||e.position!==this.props.position},componentWillMount:function(){var e=this,t=this.props.msg;T.supportsFeature(T.F.RESEND_ICON)&&t.mayFail&&(this.addObserver(t,"change:ack",this.onAckChange),this.addObserver(t,"change:urlState",function(){return e.forceUpdate()}))},onFailedChange:function(){var e=this.props.msg;e.mayFail||(this.removeObserver(e,"change:ack"),this.removeObserver(e,"change:urlState")),this.setState({failed:e.isFailed})},resend:function(){var e=this.props.msg;return e.isMMS&&!T.supportsFeature(T.F.MEDIA_RETRY)?void s.openModal(React.createElement(h,{msg:e})):void e.resend().bind(this).then(function(t){this.isMounted()&&this.setState({failed:e.isFailed})})["catch"](function(e){n.log("wrapper:resend failure: "+e)()})},openForwardFlow:function(){var e=this.props.msg;e.ack<1&&e.isMMS&&e.isSentByMe?s.openModal(React.createElement(c,{title:l10n.t("err_unsent_forward_title"),onOK:s.closeModal.bind(s),okText:l10n.t("web_ok")},l10n.t("err_unsent_forward_text"))):s.openModal(React.createElement(u,{msgs:[this.props.msg]}),"modal-flow")},openInfoDrawer:function(){this.props.msg.chat.kind===C.KIND.CHAT?s.openDrawer(React.createElement(f,{msg:this.props.msg,type:p.DRAWER_RIGHT}),"slide-left"):s.openDrawer(React.createElement(m,{msg:this.props.msg,type:p.DRAWER_RIGHT}),"slide-left")},openContactChat:function(){Store.Chat.find(this.props.msg.author).then(function(e){s.openChat(e)})},mouseEnter:function(){this.contextEnabled()&&!this.state.hover&&this.setState({hover:!0})},mouseOver:function(){this.contextEnabled()&&!this.state.hover&&this.setState({
hover:!0})},mouseLeave:function(){this.contextEnabled()&&this.state.hover&&this.setState({hover:!1})},contextEnabled:function(){return!this.props.msg.isNotification},removeContext:function(){this.setState({contextMenu:!1})},onDeleteMessage:function(){var e=this,t=function(){p.pop(p.MENU),s.closeModal(),e.props.msg.chat.sendDeleteMsg(e.props.msg)},r=l10n.t("delete_message_confirmation");s.openModal(React.createElement(c,{onOK:t,okText:l10n.t("web_delete"),onCancel:s.closeModal.bind(s),cancelText:l10n.t("web_cancel")},React.createElement(d,{text:r})))},onMenu:function(e){if(e.stopPropagation(),e.preventDefault(),this.state.contextMenu)return p.pop(p.MENU),void this.setState({contextMenu:!1});var t=this.props.msg,r=[React.createElement(l,{key:"forward",action:this.openForwardFlow},l10n.t("forward_message"))];t.isGroupMsg&&t.author&&!t.isSentByMe&&r.push(React.createElement(l,{key:"author",action:this.openContactChat},l10n.t("message_author",{author:t.displayName()}))),t.chat.canSendDeleteMsg()&&r.push(React.createElement(l,{key:"delete",action:this.onDeleteMessage},l10n.t("delete_message"))),t.isSentByMe&&T.supportsFeature(T.F.MESSAGE_INFO)&&r.push(React.createElement(l,{key:"info",action:this.openInfoDrawer},l10n.t("message_info"))),this.setState({contextMenu:!0}),s.openContextMenu(r,{onClose:this.removeContext,anchor:e.target,classes:"dropdown-compact"})},getMsgComponent:function(){var e=this.props,t=e.msg,r=e.position,i=t.type,o=t.subtype,s=r===I.MID||r===I.END;switch(i){case a.TYPE.CHAT:var c=t.senderObj?t.senderObj.name:null;return React.createElement(g,{msg:t,trusted:t.isTrusted(),ref:"component",senderName:c,isContinuation:s});case a.TYPE.IMAGE:return React.createElement(v,{msg:t,ref:"component",isContinuation:s});case a.TYPE.GROUP_NOTIFICATION:case a.TYPE.GP2:case a.TYPE.BROADCAST_NOTIFICATION:case a.TYPE.NOTIFICATION:var d=t.body;return Wa.isTypeGroupNotification(i)?d=Wa.formatGroupNotification(t):"broadcast_notification"===i&&(d=Wa.formatBroadcastNotification(o,t.body)),React.createElement(y,{text:d,ref:"component"});case a.TYPE.AUDIO:case a.TYPE.VIDEO:return React.createElement(b,{msg:t,isContinuation:s,ref:"component"});case a.TYPE.VCARD:return React.createElement(E,{msg:t,isContinuation:s,ref:"component"});case a.TYPE.LOCATION:return React.createElement(R,{msg:t,isContinuation:s,ref:"component"});case a.TYPE.PTT:return React.createElement(w,{msg:t,isContinuation:s,ref:"component"});default:n.log("messageList:render Unknown message type: "+i)()}},render:function(){var e,t=this.props,r=t.msg,n=t.position;(this.state.hover||this.state.contextMenu)&&(e=React.createElement("span",{className:"icon icon-down btn-context btn-context-"+r.type,key:"icon-context",onClick:this.onMenu}));var o;if(T.supportsFeature(T.F.RESEND_ICON)&&r.isFailed&&r.urlState!==a.URL_STATE.UPLOADING){var s=React.createElement("span",null,l10n.t("resend_message"));o=React.createElement(i,{style:{"float":"right"},trigger:!0,tooltip:s,direction:"left"},React.createElement("button",{className:"error",onClick:this.resend},React.createElement("span",{className:"icon icon-error"})))}var c=n===I.MID||n===I.END,d={wrapper:S("msg",{"msg-continuation":n===I.FRONT||n===I.MID,"msg-group":r.isGroupMsg&&!c}),container:S("message",{"message-system":r.isNotification,"message-out":!r.isNotification&&r.isSentByMe,"message-in":!r.isNotification&&!r.isSentByMe,hover:this.state.contextMenu||this.state.hover,tail:n===I.END||n===I.SINGLE})};return React.createElement("div",{className:d.wrapper},React.createElement("div",{className:d.container,onMouseOver:this.mouseOver,onMouseEnter:this.mouseEnter,onMouseLeave:this.mouseLeave},o,this.getMsgComponent(),React.createElement(N,{transitionName:"pop-fast"},e)))}});P.Position=I,e.exports=P},function(e,t){var r=React.createClass({displayName:"TooltipTrigger",propTypes:{trigger:React.PropTypes.bool,tooltip:React.PropTypes.node.isRequired,style:React.PropTypes.object,direction:React.PropTypes.oneOf(["top","right","bottom","left"])},getDefaultProps:function(){return{direction:"top"}},getInitialState:function(){return{active:this.props.trigger?!1:!0}},showModal:function(){this.setState({active:!0})},hideModal:function(){this.setState({active:!1})},render:function(){var e=this.state.active?React.createElement(n,{direction:this.props.direction,ref:"tooltip",body:this.props.tooltip}):null,t=this.props.trigger;return React.createElement("div",{style:this.props.style,className:"tooltip-container",onMouseEnter:t?this.showModal:null,onMouseLeave:t?this.hideModal:null},this.props.children,e)}}),n=React.createClass({displayName:"Tooltip",propTypes:{body:React.PropTypes.node.isRequired,direction:React.PropTypes.string.isRequired},render:function(){var e="tooltip "+this.props.direction;return React.createElement("div",{className:e},this.props.body)}});e.exports=r},function(e,t,r){var n=r(495),i=r(437),o=r(545),a=r(230),s=r(144),c=r(151),d=r(470),u=React.createClass({displayName:"ForwardMessageFlow",mixins:[n],propTypes:{msgs:React.PropTypes.arrayOf(React.PropTypes.instanceOf(a)).isRequired},componentWillMount:function(){this.push(React.createElement(o,{onChat:this.confirmForward,onCancel:this.endFlow,key:"ChatModal",title:l10n.t("forward_message_to")}))},confirmForward:function(e){var t=e.isGroup?l10n.t("confirm_forward_to_group",{chat:e.formattedTitle}):l10n.t("confirm_forward_to_contact",{chat:e.formattedTitle});this.push(React.createElement(i,{onOK:_.partial(this.forward,e),okText:l10n.t("web_ok"),onCancel:this.pop.bind(null,void 0,void 0),key:"ConfirmPopup",cancelText:l10n.t("web_cancel")},React.createElement(d,{text:t})))},forward:function(e){var t=this,r=Date.now();this.props.msgs.forEach(function(n){n.forward(e)["catch"](c.MediaMissing,function(e){t.showMissingMedia(n,r)})["catch"](c.ContactBlocked,function(n){t.showContactBlocked(e,r)})["catch"](function(e){throw e})}),this.endFlow(),s.openChat(e)},showContactBlocked:function(e,t){var r=Date.now()-t>1e3?void 0:!1;s.openModal(React.createElement(i,{key:"contactBlocked",onOK:s.closeModal.bind(s)},l10n.t("web_cannot_send_to_blocked_contact_1",{contact:e.contact.formattedName})),r)},showMissingMedia:function(e,t){var r,n;switch(e.type){case a.TYPE.VIDEO:r=l10n.t("missing_video_title"),n=l10n.t("missing_video_foward_text");break;case a.TYPE.AUDIO:case a.TYPE.PTT:r=l10n.t("missing_audio_title"),n=l10n.t("missing_audio_forward_text");break;case a.TYPE.IMAGE:r=l10n.t("missing_photo_title"),n=l10n.t("missing_photo_forward_text")}var o=Date.now()-t>1e3?void 0:!1;s.openModal(React.createElement(i,{title:r,onOK:s.closeModal.bind(s),okText:l10n.t("web_ok")},n),o)}});e.exports=u},function(e,t,r){var n=r(461),i=r(144),o=r(452),a=r(453),s=r(455),c=r(440),d=r(503),u=r(509),l=r(499),p=r(498),h=r(166),f={RECENT:"recent",GROUPS:"groups",CONTACTS:"contacts"},m=React.createClass({displayName:"ChatModal",propTypes:{title:React.PropTypes.string,onChat:React.PropTypes.func.isRequired},getInitialState:function(){return{searchText:"",selected:f.RECENT}},onSelectTab:function(e){var t=this,r=_.values(f).indexOf(this.state.selected),n=_.values(f).indexOf(e),i=n>r?"right":"left";this.tabSelected=!0,this.setState({searchText:"",selected:e,direction:i},function(){delete t.tabSelected})},getFilteredChats:function(){var e=this.state.searchText;return e?(e=l10n.accentFold(e),Store.Chat.filter(function(t){return t.contact.searchMatch(e)&&!t.isNewlyCreated()})):Store.Chat.filter(function(e){return!e.isNewlyCreated()})},getFilteredGroups:function(){var e=this.state.searchText;return e?(e=l10n.accentFold(e),Store.Chat.filter(function(t){return t.isGroup&&t.contact.searchMatch(e)&&!t.isNewlyCreated()})):Store.Chat.filter(function(e){return e.isGroup&&!e.isNewlyCreated()})},getFilteredContacts:function(){var e=Store.Contact.getFilteredContacts(),t=this.state.searchText;return t?(t=l10n.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e},getItems:function(){var e=this,t=[];switch(this.state.selected){case f.CONTACTS:t=this.getFilteredContacts(),t=t.map(function(t){return React.createElement(l,{contact:t,onClick:e.forwardToContact,key:t.id})});break;case f.GROUPS:t=this.getFilteredGroups(),t=t.map(function(t){return React.createElement(u,{chat:t,mode:u.Mode.INFO,noHighlight:!0,noContext:!0,onClick:e.forwardToChat,key:t.id})});break;case f.RECENT:t=this.getFilteredChats(),t=t.map(function(t){return t.isGroup?React.createElement(u,{chat:t,mode:u.Mode.INFO,noHighlight:!0,noContext:!0,onClick:e.forwardToChat,key:t.id}):React.createElement(l,{contact:t.contact,onClick:e.forwardToContact,key:t.id})})}return 0===t.length?null:React.createElement(p,{data:t,scrollTop:this.tabSelected?0:void 0,scrollTarget:3,height:72,extraItems:4})},getTabs:function(){var e=this;return[{tab:f.RECENT,title:l10n.t("web_recent_chats")},{tab:f.GROUPS,title:l10n.t("web_groups")},{tab:f.CONTACTS,title:l10n.t("web_contacts")}].map(function(t){var r=h("menu-item",{active:e.state.selected===t.tab});return React.createElement("button",{className:r,onClick:e.onSelectTab.bind(null,t.tab),key:t.tab,title:t.title},t.title)})},forwardToContact:function(e,t){Store.Chat.find(t.id).then(this.forwardToChat.bind(this,e))},forwardToChat:function(e,t){this.props.onChat(t)},onSearch:function(e){this.setState({searchText:e})},onStopSearch:function(){this.setState({searchText:""})},onCancel:function(){i.closeModal()},render:function(){var e=this.getItems();if(!e)if(this.state.searchText)e=React.createElement("div",{className:"msg-search-notfound"},l10n.t("search_no_chats_or_contacts"));else{var t;switch(this.state.selected){case f.CONTACTS:t=l10n.t("no_contacts");break;case f.GROUPS:t=l10n.t("no_groups");break;case f.RECENT:t=l10n.t("no_chats")}e=React.createElement("div",{className:"msg-search-notfound"},t)}var r="right"===this.state.direction?"slide-forward":"slide-back";return React.createElement(n,{type:n.TOWER},React.createElement(o,{key:"chat-modal",onCancel:this.onCancel},React.createElement(a,{title:this.props.title,type:a.Type.POPUP,onCancel:this.onCancel}),React.createElement("div",{className:"menu-tabs menu-tabs-lists","data-active-tab":this.state.selected},this.getTabs()),React.createElement(d,{searchText:this.state.searchText,onSearch:this.onSearch,key:this.state.selected,searchType:d.CHATLIST,placeholder:l10n.t("search")}),React.createElement(s,null,React.createElement(c,{transitionName:r},React.createElement("div",{className:"chatlist",key:this.state.selected},e)))))}});e.exports=m},function(e,t,r){var n=r(437),i=r(230),o=r(144),a=React.createClass({displayName:"RemoteUpload",propTypes:{msg:React.PropTypes.instanceOf(i).isRequired},render:function(){var e,t;switch(this.props.msg.type){case i.TYPE.IMAGE:e=l10n.t("retry_upload_photo_title"),t=l10n.t("retry_upload_photo_text");break;case i.TYPE.VIDEO:e=l10n.t("retry_upload_video_title"),t=l10n.t("retry_upload_video_text");break;case i.TYPE.AUDIO:case i.TYPE.PTT:e=l10n.t("retry_upload_audio_title"),t=l10n.t("retry_upload_audio_text")}return React.createElement(n,{title:e,onOK:o.closeModal.bind(o),okText:l10n.t("web_ok")},t)}});e.exports=a},function(e,t,r){var n=r(144),i=r(435),o=r(452),a=r(453),s=r(455),c=r(454),d=r(548),u=r(230),l=React.createClass({displayName:"ContactMsgInfoDrawer",mixins:[i],propTypes:{msg:React.PropTypes.instanceOf(u)},getInitialState:function(){return{msgInfo:void 0}},componentWillMount:function(){var e=this;Store.MsgInfo.find(this.props.msg).then(function(t){e.setState({msgInfo:t}),e.addObserver(t,"change:playedRemaining change:readRemaining change:deliveryRemaining")})},onClose:function(){n.closeDrawer(this.props.type)},render:function(){var e=this.state.msgInfo,t=void 0;if(e){var r=[],n=void 0,i=void 0,u=void 0;e.isPTT&&(n=e.played.first(),i=n&&n.t,u=React.createElement("span",{className:"icon icon-status icon-status-ptt-blue"}),r.push(React.createElement(d,{title:l10n.t("message_info_played"),t:i,icon:u,key:"played"}))),n=e.read.first(),i=n&&n.t,u=React.createElement("span",{className:"icon icon-status icon-status-dblcheck-ack"}),r.push(React.createElement(d,{title:l10n.t("message_info_read"),t:i,icon:u,key:"read"})),n=e.delivery.first(),i=n&&n.t,u=React.createElement("span",{className:"icon icon-status icon-status-dblcheck"}),r.push(React.createElement(d,{title:l10n.t("message_info_delivered"),t:i,icon:u,key:"delivery"})),t=React.createElement(c,{classes:"drawer-section-info well animate-enter"},r)}return React.createElement(o,{key:"message-info-modal",id:"info",variant:"panel",onCancel:this.onClose},React.createElement(a,{title:l10n.t("message_info"),type:a.Type.SMALL,onCancel:this.onClose}),React.createElement(s,null,t))}});e.exports=l},function(e,t){var r=React.createClass({displayName:"ContactMsgInfoCell",propTypes:{title:React.PropTypes.string.isRequired,icon:React.PropTypes.node.isRequired,t:React.PropTypes.number},render:function(){var e=this.props,t=e.title,r=e.t,n=e.icon,i=r?Wa.formatDateAndTimeRelative(r):"-",o={cursor:"auto"};return React.createElement("div",{className:"contact chat",style:o},React.createElement("div",{className:"chat-body"},React.createElement("div",{className:"chat-main"},React.createElement("div",{className:"chat-title"},React.createElement("span",{className:"ellipsify",dir:"auto"},n,t))),React.createElement("div",{className:"chat-secondary"},React.createElement("div",{className:"chat-status ellipsify"},React.createElement("span",{className:"ellipsify",dir:"auto"},i)))))}});e.exports=r},function(e,t,r){var n=r(144),i=r(435),o=r(452),a=r(453),s=r(455),c=r(454),d=r(550),u=r(551),l=r(230),p=React.createClass({displayName:"GroupMsgInfoDrawer",mixins:[i],propTypes:{msg:React.PropTypes.instanceOf(l)},getInitialState:function(){return{msgInfo:void 0}},componentWillMount:function(){var e=this;Store.MsgInfo.find(this.props.msg).then(function(t){e.setState({msgInfo:t}),e.addObserver(t,"change:playedRemaining change:readRemaining change:deliveryRemaining")})},onClose:function(){n.closeDrawer(this.props.type)},render:function(){var e=this.state.msgInfo,t=void 0;if(e&&e.isPTT){var r=React.createElement("span",{className:"icon icon-status-ptt-blue"}),n=e.played.map(function(e){return React.createElement(u,{participant:e,key:e.id})}),i=e.playedRemaining>0?React.createElement(d,{separator:0!==e.read.length},l10n.t("message_info_remaining",{count:e.playedRemaining,_plural:e.playedRemaining})):null;t=React.createElement(c,{classes:"animate-enter",key:"played-section",title:l10n.t("message_info_played_by"),subtitle:r},n,i)}var l=void 0;if(e&&!(e.played.length>0&&0===e.readRemaining)){var p=React.createElement("span",{className:"icon icon-status-dblcheck-ack"}),n=e.read.map(function(e){return React.createElement(u,{participant:e,key:e.id})}),i=e.readRemaining>0?React.createElement(d,{separator:0!==e.read.length},l10n.t("message_info_remaining",{count:e.readRemaining,_plural:e.readRemaining})):null;l=React.createElement(c,{classes:"animate-enter",key:"read-section",title:l10n.t("message_info_read_by"),subtitle:p},n,i)}var h=void 0;if(e&&e.deliveryRemaining>0){var f=React.createElement("span",{className:"icon icon-status-dblcheck"}),n=e.delivery.map(function(e){return React.createElement(u,{participant:e,key:e.id})}),i=e.deliveryRemaining>0?React.createElement(d,{separator:0!==e.delivery.length},l10n.t("message_info_remaining",{count:e.deliveryRemaining,_plural:e.deliveryRemaining})):null;h=React.createElement(c,{classes:"animate-enter1",key:"delivered-section",title:l10n.t("message_info_delivered_to"),subtitle:f},n,i)}return React.createElement(o,{key:"message-info-modal",id:"info",variant:"panel",onCancel:this.onClose},React.createElement(a,{title:l10n.t("message_info"),type:a.Type.SMALL,onCancel:this.onClose}),React.createElement(s,null,t,l,h))}});e.exports=p},function(e,t,r){var n=r(166),i=React.createClass({displayName:"DrawerSectionFooter",propTypes:{children:React.PropTypes.node.isRequired,separator:React.PropTypes.bool},getDefaultProps:function(){return{separator:!0}},render:function(){var e=n("drawer-section-footer",{separator:this.props.separator});return React.createElement("div",{className:e},React.createElement("div",{className:"col-main"},this.props.children))}});e.exports=i},function(e,t,r){var n=r(500),i=r(477),o=React.createClass({displayName:"GroupMsgInfoCell",mixins:[i],propTypes:{participant:React.PropTypes.instanceOf(Object).isRequired},getInitialState:function(){return{formattedName:this.async("participant.contact.formattedName")}},render:function(){var e=this.props.participant,t={cursor:"auto"};return React.createElement(n,{id:e.id,contextEnabled:function(){return!1},primary:this.state.formattedName,secondary:Wa.formatDateAndTimeRelative(e.t),style:t})}});e.exports=o},function(e,t,r){var n=r(553),i=r(554),o=r(556),a=r(230),s=r(470),c=r(166),d=React.addons.PureRenderMixin,u=React.createClass({displayName:"Text",mixins:[d],propTypes:{msg:React.PropTypes.instanceOf(a).isRequired,senderName:React.PropTypes.string,isContinuation:React.PropTypes.bool,trusted:React.PropTypes.bool},render:function(){var e=this.props,t=e.msg,r=e.isContinuation,a=e.trusted,d=c("bubble","bubble-text",{"bubble-text-broadcast":t.broadcast});return React.createElement("div",{className:d},r?null:React.createElement(n,{msg:t}),React.createElement("div",{className:"message-text","data-id":t.id},React.createElement(o,{msg:t}),React.createElement(s,{text:t.body,selectable:!0,dirMismatch:t.rtl!==l10n.isRTL(),direction:"auto",linkify:a,wbr:15})),React.createElement(i,{msg:t}))}});e.exports=u},function(e,t,r){var n=r(540),i=r(470),o=r(230),a=r(144),s=React.createClass({displayName:"Author",propTypes:{msg:React.PropTypes.instanceOf(o).isRequired},onClick:function(e){Store.Chat.find(this.props.msg.author).then(function(e){a.openChat(e)})},getClasses:function(){var e=this.props.msg,t=e.chat.assignedColor(e.sender),r="message-author color-"+t;return e.senderObj.name||(r+=" title-number"),r},getName:function(){var e=this.props.msg,t=e.senderObj;if(t.name)return React.createElement("span",{className:"text-clickable",onClick:this.onClick},React.createElement(i,{text:t.name}));var r=e.id+"-number",n=e.id+"-push-name";return[React.createElement("span",{className:"number text-clickable",key:r,onClick:this.onClick},Wa.widGetFormattedUser(t.id)),React.createElement("span",{className:"ellipsify screen-name",key:n,onClick:this.onClick},React.createElement(i,{classes:"screen-name-text",direction:"auto",text:e.notifyName}))]},render:function(){var e=this.props.msg;return e.isSentByMe||!e.isGroupMsg||e.isContinuation?null:React.createElement("h3",{className:this.getClasses()},React.createElement(n,null,this.getName()))}});e.exports=s},function(e,t,r){var n=r(540),i=r(555),o=r(230),a=r(477),s=r(166),c=React.createClass({displayName:"Meta",mixins:[a],propTypes:{msg:React.PropTypes.instanceOf(o).isRequired},getInitialState:function(){var e=this.props.msg;return{ack:e.ack<3?this.async("msg.ack"):e.ack}},render:function(){var e,t=this.props.msg;if(t.broadcast){var r=(t.type===o.TYPE.IMAGE||t.type===o.TYPE.VIDEO)&&!t.caption,a=s("icon-s",{"icon-broadcast-light":r,"icon-broadcast":!r});e=React.createElement("span",{className:a})}var c=t.caption?"image-caption":t.type,d=t.isSentByMe?React.createElement(i,{ack:this.state.ack,type:c}):null;return React.createElement("div",{className:"message-meta"},e,React.createElement(n,null,React.createElement("span",{className:"message-datetime"},Wa.formatTimestamp(t.t))),d)}});e.exports=c},function(e,t,r){var n=r(230),i=React.createClass({displayName:"Status",propTypes:{ack:React.PropTypes.number.isRequired,type:React.PropTypes.string.isRequired},getStatus:function(){var e="icon",t=this.props.ack,r=this.props.type;return e+=1>t?" icon-msg-time":1===t?" icon-msg-check":2===t?" icon-msg-dblcheck":" icon-msg-dblcheck-ack",(r===n.TYPE.IMAGE||r===n.TYPE.VIDEO||r===n.TYPE.AUDIO)&&(e+="-light"),e},render:function(){return React.createElement("span",{className:this.getStatus()})}});e.exports=i},function(e,t,r){var n=r(230),i=React.createClass({displayName:"HiddenText",propTypes:{msg:React.PropTypes.instanceOf(n).isRequired},render:function(){var e=this.props.msg,t=e.senderObj.formattedUser,r="["+Wa.formatDate(e.t)+", "+Wa.formatTimestamp(e.t)+"]";return React.createElement("span",{className:"message-pre-text"},"⁠⁠",r," ",t,": ⁠⁠⁠")}});e.exports=i},function(e,t,r){var n=r(14),i=r(477),o=r(553),a=r(558),s=r(166),c=r(144),d=r(437),u=r(546),l=r(559),p=r(151),h=r(19),f=r(560),m=r(561),g=r(554),v=r(230),y=r(438),b=r(170),E=r(4),R=React.createClass({displayName:"Picture",mixins:[i,y],propTypes:{msg:React.PropTypes.instanceOf(v).isRequired,isContinuation:React.PropTypes.bool},defaultWidth:330,canLoad:function(){return _.contains([v.URL_STATE.URL,v.URL_STATE.STATUS_200],this.props.msg.urlState)},getInitialState:function(){this.retry=0;var e=this.props.msg,t=e.url,r=e.mediaKey;if(t&&this.canLoad()){var n=new Image;n.src=t,n.complete?this.onPreloadLoad(n):this.preloadImage(t,r)}return{urlState:this.async("msg.urlState"),url:this.async("msg.url"),mediaKey:this.async("msg.mediaKey"),uploadState:this.async("msg.uploadState")}},componentDidMount:function(){this.regNativeListener(window,"online",this.ensureImageLoaded)},componentWillUpdate:function(e,t){(t.url!==this.state.url||t.mediaKey!==this.state.mediaKey)&&this.canLoad()&&this.preloadImage(t.url,t.mediaKey)},ensureImageLoaded:function(){var e=this.props.msg;e.url&&e.urlState!==v.URL_STATE.STATUS_200&&this.preloadImage(e.url,e.mediaKey)},isImageLoaded:function(e){if(!e)return!1;var t=new Image;return t.src=e,t.complete},preloadImage:function(e,t,r){if(e){this.preloadImagePromise&&this.preloadImagePromise.cancel();var i;i=Wa.isEncryptedMediaURL(e)?h.get(e,h.RESP_TYPE.ARRAY_BUFFER).then(function(r){if(200===r.status){var n=l.decryptE2EImage(r.response,t);return URL.createObjectURL(n)}throw new p.ImageError("Image preload error: "+r.status,e)})["catch"](p.MediaEncryptionError,function(t){throw n.log("conv:message:pic:preloadImage: "+t,"red")(),new p.ImageError("encryption error",e)})["catch"](function(t){throw new p.ImageError("conv:message:pic:preloadImage encryption XHR Error",e)}):Promise.resolve(e);var o=this.preloadImagePromise=i.then(function(t){return new Promise(function(r,n){var i=function(t){n(new p.ImageError("Image preload error",e))},o=new Image;o.onload=function(){r(o)},o.onerror=i,o.src=t})}).bind(this).cancellable().then(this.onPreloadLoad)["catch"](Promise.CancellationError,_.noop)["catch"](p.ImageError,r?this.onImgErrorRMR:this.onPreloadError)["finally"](function(){o===this.preloadImagePromise&&delete this.preloadImagePromise})}},onPreloadLoad:function(e){var t=this.props.msg;t.set({fullWidth:e.naturalWidth,fullHeight:e.naturalHeight}),t.urlState200(e.src)},onPreloadError:function(e){e.src===this.props.msg.url&&(this.props.msg.urlState=v.URL_STATE.STATUS_ERR)},onImgErrorRMR:function(e){this.props.msg.mediaLoadError(e.src)},getImgStyle:function(){var e=this.getHeight(),t=this.aspect(this.defaultWidth,e);return this.isPortrait(t)?{width:this.defaultWidth}:{height:"100%"}},getStyle:function(){return{width:this.defaultWidth+"px",height:this.getHeight()}},getHeight:function(){var e,t,r=this.props.msg;r.urlState===v.URL_STATE.STATUS_200?(e=r.fullWidth||r.width,t=r.fullHeight||r.height):(e=r.width||1,t=r.height||1);var n,i=this.defaultWidth,o=this.aspect(e,t),a=this.isPortrait(o);return a?n=i:o&&(o>2.4?n=i/2.4:e&&t&&(n=t*(i/e))),Math.round(n)},isPortrait:function(e){return e?1>=e:null},aspect:function(e,t){return e&&t?e/t:void 0},showMissingMedia:function(){c.openModal(React.createElement(d,{title:l10n.t("missing_photo_title"),onOK:c.closeModal.bind(c),okText:l10n.t("web_ok")},l10n.t("missing_photo_text")))},cancelMediaReupload:function(){this.preloadImagePromise&&this.preloadImagePromise.cancel(),this.props.msg.urlState=v.URL_STATE.NO_URL},remoteMediaReupload:function(){b.supportsFeature(b.F.MEDIA_RETRY)?this.props.msg.resend()["catch"](_.noop):c.openModal(React.createElement(u,{msg:this.props.msg}))},requestMediaReupload:function(){var e=this.props.msg;e.url?this.preloadImage(e.url,e.mediaKey,!0):e.requestMediaReupload()},cancelMmsUpload:function(){var e=this.props.msg;e.uploadPromise&&e.uploadPromise.cancel()},retryMmsUpload:function(){var e=this.props.msg.reuploadMedia();e&&e["catch"](Promise.CancellationError,_.noop)["catch"](p.GaveUpRetry,_.noop)},launchMediaViewer:function(e){c.openModal(React.createElement(m,{startId:this.props.msg.id.toString()}),"media-viewer")},onDragStart:function(e){e.nativeEvent.dataTransfer.setData(E.DRAG_TYPE_LOCAL_IMAGE,!0)},render:function(){var e=this.props.msg,t=e.caption?null:React.createElement("div",{className:"shade"}),r=e.caption?React.createElement(a,{msg:e}):null,i=_.noop,c=null,d="data:image/jpeg;base64,"+e.body;if(e.ack<0)switch(e.urlState){case v.URL_STATE.UPLOADING:c=React.createElement(f.Pending,null);break;default:c=React.createElement(f.Upload,{filesize:e.size}),i=this.remoteMediaReupload}else switch(e.urlState){case v.URL_STATE.INIT:case v.URL_STATE.REFRESHING:c=React.createElement(f.Pending,null);break;case v.URL_STATE.NO_URL:case v.URL_STATE.RMR_ERROR_RETRY:case v.URL_STATE.STATUS_ERR:c=React.createElement(f.Download,{filesize:e.size}),i=this.requestMediaReupload;break;case v.URL_STATE.REFRESH_RETRY:c=React.createElement(f.Download,{filesize:e.size}),i=e.initializeMedia.bind(e);break;case v.URL_STATE.URL:case v.URL_STATE.RMR_FETCHING:c=React.createElement(f.PendingCancel,null),i=this.cancelMediaReupload;break;case v.URL_STATE.RMR_ERROR_MISSING:i=this.showMissingMedia;break;case v.URL_STATE.STATUS_200:d=e.url;case v.URL_STATE.UPLOADING:switch(e.uploadState){case v.UPLOAD_STATE.UPLOADING:d=e.url,c=React.createElement(f.PendingCancel,null),i=this.cancelMmsUpload;break;case v.UPLOAD_STATE.RETRY:d=e.url,c=React.createElement(f.Upload,{filesize:e.size}),i=this.retryMmsUpload;break;case v.UPLOAD_STATE.PHONE_UPLOADING:c=React.createElement(f.Pending,null);break;default:i=this.launchMediaViewer}break;default:n.log("picture:render Unknown image state")()}var u=s("bubble-image",{"bubble-image-caption":e.caption}),l=s("image-thumb-body",{"image-thumb-lores":d!==e.url});return React.createElement("div",{className:u},this.props.isContinuation?null:React.createElement(o,{msg:e}),React.createElement("div",{className:"image-thumb",onClick:i,style:this.getStyle()},c,React.createElement("img",{src:d,onDragStart:this.onDragStart,className:l,style:this.getImgStyle(),ref:"img"}),t),r,React.createElement(g,{msg:this.props.msg}))}});e.exports=R},function(e,t,r){var n=r(470),i=r(556),o=r(230),a=React.createClass({displayName:"Caption",propTypes:{msg:React.PropTypes.instanceOf(o).isRequired},render:function(){var e=this.props.msg;return React.createElement("div",{className:"image-caption message-text","data-id":e.id},React.createElement(i,{msg:e}),React.createElement(n,{direction:"auto",selectable:!0,text:e.caption,linkify:!0}))}});e.exports=a},function(e,t,r){function n(e){return CryptoJS.lib.WordArray.create(new Uint8Array(e))}var i=r(156),o=r(151),a=window.goog.crypt.base64.decodeStringToByteArray,s={decryptE2EImage:function(e,t){try{if(!t)throw new o.MediaEncryptionError("no media key: "+t);if(e.length<10)throw new o.MediaEncryptionError("ciphertext too short: "+e.length);var r=new window.e2e.Hkdf(new window.e2e.hash.Sha256),s=window.goog.crypt.stringToUtf8ByteArray("WhatsApp Image Keys"),c=r.getHKDF(a(t),s,112);if(!c||c.length<112)throw new o.MediaEncryptionError("hkdf error");var d=c.slice(0,16),u=c.slice(16,48),l=c.slice(48,80),p=i.wrap(e),h=p.slice(p.limit-10).toBase64(),f=p.slice(p.offset,p.limit-10).toBuffer(),m=i.concat([new Uint8Array(d),f]).toBuffer(),g=CryptoJS.lib.WordArray.create(m),v=CryptoJS.HmacSHA256(g,n(l)).toString(CryptoJS.enc.Base64),y=i.fromBase64(v).slice(0,10).toBase64();if(!y||!h||y!==h)throw new o.MediaEncryptionError("hmac fail computed: "+v+" given: "+h);var _=CryptoJS.AES.decrypt({ciphertext:CryptoJS.lib.WordArray.create(f),salt:void 0},n(u),{iv:n(d),mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),b=i.fromBase64(_.toString(CryptoJS.enc.Base64)).toBuffer(),E=new Blob([b],{type:"image/jpeg"});return E}catch(R){throw R instanceof o.MediaEncryptionError?R:new o.MediaEncryptionError("unknown error: "+R.stack)}}};e.exports=s},function(e,t,r){var n=r(540),i=r(436),o=React.createClass({displayName:"Pending",render:function(){return React.createElement("div",{className:"media-state-controls"},React.createElement("button",{className:"icon-media"},React.createElement(i,{size:50,stroke:3})))}}),a=React.createClass({displayName:"PendingCancel",render:function(){return React.createElement("div",{className:"media-state-controls"},React.createElement("button",{className:"icon-xl icon-media-cancel"},React.createElement(i,{size:50,stroke:3})))}}),s=React.createClass({displayName:"Cancel",render:function(){return React.createElement("div",{className:"media-state-controls"},React.createElement("button",{className:"icon-xl icon-media-download"}))}}),c=React.createClass({displayName:"Download",propTypes:{filesize:React.PropTypes.number.isRequired},render:function(){return React.createElement("div",{className:"media-state-controls"},React.createElement("button",{className:"btn-meta"},React.createElement("span",{className:"icon-xl icon-media-download-noborder"}),React.createElement(n,null,this.props.filesize>0?l10n.filesize(this.props.filesize):null)))}}),d=React.createClass({displayName:"Upload",propTypes:{filesize:React.PropTypes.number.isRequired},render:function(){return React.createElement("div",{className:"media-state-controls"},React.createElement("button",{className:"btn-meta"},React.createElement("span",{className:"icon-xl icon-media-upload-noborder"}),React.createElement(n,null,this.props.filesize>0?l10n.filesize(this.props.filesize):null)))}}),u=React.createClass({displayName:"Play",render:function(){return React.createElement("div",{className:"media-state-controls"},React.createElement("button",{className:"icon-xl icon-media-play"}))}}),l=React.createClass({displayName:"Missing",render:function(){var e;switch(this.props.msg.type){case"image":e=l10n.t("missing_photo_title");break;case"video":e=l10n.t("missing_video_title");break;case"audio":e=l10n.t("missing_audio_title")}return React.createElement("div",{className:"media-state-controls"},React.createElement("button",{className:"btn-meta missing-text"},e))}});e.exports={Pending:o,Cancel:s,PendingCancel:a,Download:c,Upload:d,Play:u,Missing:l}},function(e,t,r){var n=r(144),i=r(438),o=r(562),a=React.createClass({displayName:"MediaViewerFlow",mixins:[i],propTypes:{startId:React.PropTypes.string.isRequired},getInitialState:function(){var e=Store.Msg.get(this.props.startId),t=e.chat.mediaMsgs(),r=t.indexOf(e);return{mediaMsgs:t,index:r}},componentWillMount:function(){this.regNativeListener(window,"keydown",this.onKeyDown)},componentDidMount:function(){this.hasRendered=!0},onKeyDown:function(e){37===e.keyCode?this.onPrev():39===e.keyCode&&this.onNext()},onNext:function(e){e&&e.stopPropagation(),this.state.index<this.state.mediaMsgs.length-1&&this.setState({index:this.state.index+1})},onPrev:function(e){e&&e.stopPropagation(),this.state.index>0&&this.setState({index:this.state.index-1})},endFlow:function(){n.closeModal()},render:function(){var e=void 0,t=void 0;return(t=this.state.mediaMsgs[this.state.index])&&(e=React.createElement(o,{msg:t,key:t.id,onBack:this.endFlow,onNext:this.onNext,onPrev:this.onPrev,zoomIn:!this.hasRendered})),React.createElement("div",null,e)}});e.exports=a},function(e,t,r){var n=r(14),i=r(230),o=r(477),a=r(438),s=r(467),c=r(559),d=r(470),u=r(475),l=r(474),p=r(563),h=r(564),f=r(464),m=r(560),g=r(450),v=r(144),y=r(151),b=r(19),E=r(166),R=500,w=React.createClass({displayName:"MediaViewerModal",mixins:[o,s],propTypes:{msg:React.PropTypes.instanceOf(i).isRequired,zoomIn:React.PropTypes.bool,onBack:React.PropTypes.func.isRequired,onNext:React.PropTypes.func,onPrev:React.PropTypes.func},getInitialState:function(){return{urlState:this.async("msg.urlState")}},componentWillMount:function(){
var e=this;g.push(this,g.MEDIA_VIEWER),this.regCmd("open_chat",this.onClose),this.props.zoomIn&&v.isMsgVisible(this.props.msg.id,function(t){e.setState({zoomElement:t,style:t?{transition:"transform 2s",visibility:"hidden"}:{}})})},onImageLoad:function(e){var t=this.state.zoomElement,r=e.target;t&&r&&this.props.zoomIn&&this.animateZoom(t,e.target)},animateZoom:function(e,t){var r=this,n=t.getBoundingClientRect(),i=e.getBoundingClientRect(),o=i.top-n.top,a=i.left-n.left,s=e.clientWidth/t.clientWidth;this.setState({style:{visibility:"hidden",transform:"translateX("+a+"px) translateY("+o+"px) scale("+s+")",transition:"transform 0s"}},function(){r.setState({style:{transform:"translateX(0px) translateY(0px) scale(1)",transition:"transform "+R+"ms cubic-bezier(.1,.82,.25,1)"}})})},stopPropagation:function(e){Wa.isDownloading=!0,setTimeout(function(){Wa.isDownloading&&(Wa.isDownloading=!1)},500),e.stopPropagation()},onScroll:function(e){this.onClose()},onClose:function(){g.find(g.MEDIA_VIEWER)&&g.pop(g.MEDIA_VIEWER)},close:function(e){var t=this,r=void 0;if(this.state.zoomIn?r=this.state.zoomElement:v.isMsgVisible(this.props.msg.id,function(e){r=e}),!r)return this.props.onBack();var n=this.refs.mediaImage,i=n&&n.refs?n.refs.image:null;if(!i)return this.props.onBack();i=i.getDOMNode();var o=i.getBoundingClientRect(),a=r.getBoundingClientRect(),s=a.top-o.top,c=a.left-o.left,d=r.clientWidth/i.clientWidth;Velocity(i,{translateX:[c,0],translateY:[s,0],scale:[d,1]},{duration:200,easing:[.1,.82,.25,1]}).then(function(){t.props.onBack()})},render:function(){var e,t=this.props.msg;switch(t.type){case"image":e=React.createElement(S,{msg:t,style:this.state.style,ref:"mediaImage",onLoad:this.onImageLoad});break;case"video":e=React.createElement(T,{msg:t});break;case"audio":e=React.createElement(N,{msg:t})}var r=this.props.onNext?React.createElement("button",{className:"btn btn-round btn-media-next",onClick:this.props.onNext},React.createElement("span",{className:"icon icon-chevron-right icon-l",title:l10n.t("next_button")},l10n.t("next_button"))):React.createElement("div",{className:"btn-media-next"}),n=this.props.onPrev?React.createElement("button",{className:"btn btn-round btn-media-prev",onClick:this.props.onPrev},React.createElement("span",{className:"icon icon-chevron-left icon-l",title:l10n.t("previous_button")},l10n.t("previous_button"))):React.createElement("div",{className:"btn-media-prev"}),o=[i.URL_STATE.URL,i.URL_STATE.STATUS_200].indexOf(t.urlState)>-1?React.createElement("div",{className:"menu-item"},React.createElement("a",{className:"icon icon-l btn-media-share icon-download",title:l10n.t("web_button_download"),onClick:this.stopPropagation,download:!0,href:t.url},l10n.t("web_button_download"))):null,a=t.displayName(!0,!0);t.isGroupMsg&&(a+=" @ "+t.chat.formattedTitle);var s=E("media-viewer",{"media-viewer-animate":this.props.zoomIn});return React.createElement("div",{className:s,onWheel:this.onScroll,onClick:this.onClose},React.createElement("div",{className:"media-panel-header"},React.createElement("div",{className:"chat media-chat"},React.createElement("div",{className:"chat-avatar"},React.createElement(u,{id:t.sender})),React.createElement("div",{className:"chat-body"},React.createElement("div",{className:"chat-main"},React.createElement(d,{text:a})),React.createElement("div",{className:"chat-secondary"},React.createElement("div",{className:"chat-status ellipsify"},Wa.formatDateAndTimeRelative(t.t))))),React.createElement("div",{className:"menu menu-horizontal media-panel-tools"},o,React.createElement("div",{className:"menu-item"},React.createElement("button",{className:"icon icon-l btn-media-share icon-x-viewer",title:l10n.t("web_close"),onClick:this.onClose},l10n.t("web_close"))))),React.createElement("div",{className:"media-content",dir:"ltr",ref:"container"},n,React.createElement("div",{className:"media"},React.createElement(I,{msg:t}),e),r))}}),S=React.createClass({displayName:"MediaImage",mixins:[o,a],propTypes:{msg:React.PropTypes.instanceOf(i).isRequired,onLoad:React.PropTypes.func},canLoad:function(){return _.contains([i.URL_STATE.URL,i.URL_STATE.STATUS_200],this.props.msg.urlState)},canRMR:function(){return _.contains([i.URL_STATE.NO_URL,i.URL_STATE.STATUS_ERR],this.props.msg.urlState)},getInitialState:function(){this.retry=0;var e=this.props.msg,t=e.url,r=e.mediaKey;if(t)if(this.canLoad()){var n=new Image;n.src=t,n.complete&&this.onPreloadLoad(n)}else this.canRMR()&&this.preloadImage(t,r);return{urlState:this.async("msg.urlState"),url:this.async("msg.url"),mediaKey:this.async("msg.mediaKey")}},componentDidMount:function(){this.regNativeListener(window,"online",this.ensureImageLoaded);var e=this.props.msg;e.urlState===i.URL_STATE.NO_URL&&e.requestMediaReupload()},componentWillUpdate:function(e,t){(t.url!==this.state.url||t.mediaKey!==this.state.mediaKey)&&this.canLoad()&&this.preloadImage(t.url,t.mediaKey)},ensureImageLoaded:function(){var e=this.props.msg;e.url&&e.urlState!==i.URL_STATE.STATUS_200&&this.preloadImage(e.url,e.mediaKey)},preloadImage:function(e,t){if(e){this.preloadImagePromise&&this.preloadImagePromise.cancel();var r;r=Wa.isEncryptedMediaURL(e)?b.get(e,b.RESP_TYPE.ARRAY_BUFFER).then(function(r){if(200===r.status){var n=c.decryptE2EImage(r.response,t);return URL.createObjectURL(n)}throw new y.ImageError("Image preload error: "+r.status,e)})["catch"](y.MediaEncryptionError,function(t){throw n.log("modals:mediaViewer:image:preloadImage: "+t,"red")(),new y.ImageError("encryption error",e)})["catch"](function(t){throw new y.ImageError("modals:mediaViewer:image:preloadImage encryption XHR Error",e)}):Promise.resolve(e);var i=this.preloadImagePromise=r.then(function(t){return new Promise(function(r,n){var i=function(t){n(new y.ImageError("Image preload error",e))},o=new Image;o.onload=function(){r(o)},o.onerror=i,o.src=t})}).bind(this).cancellable().then(this.onPreloadLoad)["catch"](Promise.CancellationError,_.noop)["catch"](y.ImageError,this.onPreloadError)["finally"](function(){i===this.preloadImagePromise&&delete this.preloadImagePromise})}},onPreloadLoad:function(e){var t=this.props.msg;t.set({fullWidth:e.naturalWidth,fullHeight:e.naturalHeight}),t.urlState200(e.src)},onPreloadError:function(e){this.props.msg.mediaLoadError(e.src)},onImageLoad:function(e){this.onPreloadLoad(e.target),this.props.onLoad&&this.props.onLoad(e)},onImageClick:function(e){e.stopPropagation()},render:function(){var e=this.props.msg,t="media-viewer-img",r=e.fullWidth,n=e.fullHeight,o=r&&n?{width:r,height:n}:null;switch(this.state.urlState){case i.URL_STATE.STATUS_200:return React.createElement(f,{type:f.TYPES.SCALE_DOWN,size:o,style:{overflow:"visible"}},React.createElement(l,{src:e.url,style:this.props.style,ref:"image",onLoad:this.onImageLoad,onClick:this.onImageClick,className:t}));default:return React.createElement(C,{msg:e})}}}),T=React.createClass({displayName:"MediaVideo",mixins:[o,a],propTypes:{msg:React.PropTypes.instanceOf(i).isRequired},getInitialState:function(){return this.retry=0,{played:!1,urlState:this.async("msg.urlState"),mmsSrc:this.async("msg.mmsSrc")}},componentDidMount:function(){var e=this.props.msg;e.urlState===i.URL_STATE.NO_URL&&e.requestMediaReupload()},onPlayerClick:function(e){e.stopPropagation();var t=this.refs.player.getDOMNode();e.clientY>t.clientHeight+t.offsetTop-44||(t.paused?t.play():t.pause())},onPlayerError:function(e){var t=e.target.src,r=e.target.error||{code:"__MISSING__"};switch(r.code){case MediaError.MEDIA_ERR_NETWORK:case MediaError.MEDIA_ERR_DECODE:case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:this.props.msg.mediaLoadError(t);break;default:n.log("mediaVideoModal:onPlayerError unknown error",r.code,t)()}},onPlayerPlay:function(e){var t=e.target,r=this.props.msg;r.set({fullWidth:t.videoWidth,fullHeight:t.videoHeight}),r.urlState200(t.src),this.state.played||this.setState({played:!0})},render:function(){var e=this.props.msg,t="media-viewer-img",r=e.fullWidth,n=e.fullHeight,o=r&&n?{width:r,height:n}:null;switch(this.state.urlState){case i.URL_STATE.URL:case i.URL_STATE.STATUS_200:var a,s,c=React.createElement(f,{type:f.TYPES.SCALE_DOWN,size:o},React.createElement(p,{src:e.mmsSrc,ref:"player",className:t,onPlay:this.onPlayerPlay,onClick:this.onPlayerClick,onError:this.onPlayerError,autoPlay:!0,controls:!0},l10n.t("video_playback_not_supported")));return this.state.played||(a={display:"none"},s=React.createElement(C,{msg:e})),React.createElement("div",null,s,React.createElement("div",{style:a},c));default:return React.createElement(C,{msg:e})}}}),C=React.createClass({displayName:"BlurredImage",render:function(){var e=this.props.msg,t="data:image/jpeg;base64,"+e.body,r=Wa.boundHeightWidth(10*e.height,10*e.width,500,500),n={width:r.width,height:r.height};return React.createElement("div",{className:"media-viewer-blur-crop",style:n},React.createElement("img",{className:"media-viewer-blur-img",src:t}))}}),N=React.createClass({displayName:"MediaAudio",mixins:[o,a],propTypes:{msg:React.PropTypes.instanceOf(i).isRequired},getInitialState:function(){return this.retry=0,{urlState:this.async("msg.urlState"),mmsSrc:this.async("msg.mmsSrc")}},componentDidMount:function(){var e=this.props.msg;e.urlState===i.URL_STATE.NO_URL&&e.requestMediaReupload()},onPlayerClick:function(e){e.stopPropagation()},onPlayerError:function(e){var t=e.target.src,r=e.target.error||{code:"__MISSING__"};switch(r.code){case MediaError.MEDIA_ERR_NETWORK:case MediaError.MEDIA_ERR_DECODE:case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:this.props.msg.mediaLoadError(t);break;default:n.log("mediaAudioModal:onPlayerError unknown error",r.code,t)()}},onPlayerPlay:function(e){this.props.msg.urlState200(e.target.src)},render:function(){var e=this.props.msg,t="media-viewer-img media-viewer-audio";switch(this.state.urlState){case i.URL_STATE.URL:case i.URL_STATE.STATUS_200:return React.createElement(h,{src:e.mmsSrc,ref:"player",className:t,onClick:this.onPlayerClick,onPlay:this.onPlayerPlay,onError:this.onPlayerError,autoPlay:!0,controls:!0},l10n.t("audio_playback_not_supported"));default:return React.createElement("div",{className:"image-audio"})}}}),I=React.createClass({displayName:"MediaState",mixins:[o],propTypes:{msg:React.PropTypes.instanceOf(i).isRequired},getInitialState:function(){return{urlState:this.async("msg.urlState")}},initializeMedia:function(e){e.stopPropagation(),this.props.msg.initializeMedia()},requestMediaReupload:function(e){e.stopPropagation(),this.props.msg.requestMediaReupload()},cancelMediaReupload:function(e){e.stopPropagation(),this.props.msg.urlState=i.URL_STATE.NO_URL},captureClick:function(e){e.stopPropagation()},render:function(){var e=this.props.msg;switch(this.state.urlState){case i.URL_STATE.STATUS_200:return null;case i.URL_STATE.NO_URL:case i.URL_STATE.RMR_ERROR_RETRY:case i.URL_STATE.STATUS_ERR:return React.createElement("div",{onClick:this.requestMediaReupload},React.createElement(m.Download,{filesize:e.size}));case i.URL_STATE.REFRESH_RETRY:return React.createElement("div",{onClick:this.initializeMedia},React.createElement(m.Download,{filesize:e.size}));case i.URL_STATE.INIT:case i.URL_STATE.REFRESHING:case i.URL_STATE.URL:return React.createElement(m.Pending,null);case i.URL_STATE.RMR_FETCHING:return"image"===e.type?React.createElement("div",{onClick:this.cancelMediaReupload},React.createElement(m.Pending,null)):null;case i.URL_STATE.RMR_ERROR_MISSING:return React.createElement("div",{onClick:this.captureClick},React.createElement(m.Missing,{msg:e}));case i.URL_STATE.UPLOADING:return null}}});e.exports=w},function(e,t,r){var n=r(20),i=r(467),o=r(438),a=r(235),s=r(144),c=r(15),d=React.createClass({displayName:"VideoTag",mixins:[i,o,a],propTypes:{src:React.PropTypes.string.isRequired,poster:React.PropTypes.string,className:React.PropTypes.string,controls:React.PropTypes.bool,width:React.PropTypes.number,height:React.PropTypes.number,onClick:React.PropTypes.func,onPlay:React.PropTypes.func,onError:React.PropTypes.func,autoPlay:React.PropTypes.bool},componentDidMount:function(){var e=this.getDOMNode();this.regNativeListener(e,"playing",this.onPlaying),this.regCmd("mediaPlaying",this.onOtherPlaying),this.regNativeListener(e,"error",this.onPlayerError,!0),(c.isGecko||c.isSafari)&&(this.props.autoPlay?this.startCheckForSuccess():this.regNativeListener(e,"play",this.startCheckForSuccess))},startCheckForSuccess:function(){this.checkIteration=0,this.checkForSuccessInterval=this.safeInterval(this.checkForSuccess,250)},clearCheckForSuccess:function(){this.checkForSuccessInterval&&(this.clearSafeInterval(this.checkForSuccessInterval),delete this.checkForSuccessInterval,delete this.checkIteration)},checkForSuccess:function(){if(n.state===n.STATE.CONNECTED){if(this.checkIteration++,this.checkIteration>240)return void this.onPlayerError({target:{src:this.props.src,error:{code:MediaError.MEDIA_ERR_NETWORK}}});var e=this.getDOMNode(),t=e.buffered;t&&t.length&&t.end(0)>0&&this.onPlaying({target:e})}},onPlayerError:function(e){this.clearCheckForSuccess(),this.props.onError&&this.props.onError(e)},onOtherPlaying:function(e){e!==this&&this.getDOMNode().pause()},onPlaying:function(e){this.clearCheckForSuccess(),s.mediaPlaying(this),this.props.onPlay&&this.props.onPlay(e)},render:function(){var e={height:this.props.height,width:this.props.width};return React.createElement("video",{src:this.props.src,poster:this.props.poster,style:e,width:this.props.width,height:this.props.height,className:this.props.className,onClick:this.props.onClick,controls:this.props.controls,autoPlay:this.props.autoPlay},this.props.children)}});e.exports=d},function(e,t,r){var n=r(20),i=r(467),o=r(438),a=r(235),s=r(144),c=r(15),d=React.createClass({displayName:"AudioTag",mixins:[i,o,a],propTypes:{src:React.PropTypes.string,className:React.PropTypes.string,controls:React.PropTypes.bool,preload:React.PropTypes.string,type:React.PropTypes.string,onClick:React.PropTypes.func,onPlay:React.PropTypes.func,onError:React.PropTypes.func,autoPlay:React.PropTypes.bool},componentDidMount:function(){var e=this.getDOMNode();this.regNativeListener(e,"error",this.onPlayerError,!0),this.regNativeListener(e,"playing",this.onPlaying),this.regCmd("mediaPlaying",this.onOtherPlaying),(c.isGecko||c.isSafari)&&(this.props.autoPlay?(this.checkIteration=0,this.checkForSuccessInterval=this.safeInterval(this.checkForSuccess,250)):this.props.autoPlay?this.startCheckForSuccess():this.regNativeListener(e,"play",this.startCheckForSuccess))},startCheckForSuccess:function(){this.checkIteration=0,this.checkForSuccessInterval=this.safeInterval(this.checkForSuccess,250)},clearCheckForSuccess:function(){this.checkForSuccessInterval&&(this.clearSafeInterval(this.checkForSuccessInterval),delete this.checkForSuccessInterval,delete this.checkIteration)},checkForSuccess:function(){if(n.state===n.STATE.CONNECTED){if(this.checkIteration++,this.checkIteration>40)return void this.onPlayerError({target:{src:this.props.src,error:{code:MediaError.MEDIA_ERR_NETWORK}}});var e=this.getDOMNode(),t=e.buffered;t&&t.length&&t.end(0)>0&&this.onPlaying({target:e})}},onPlayerError:function(e){this.clearCheckForSuccess(),this.props.onError&&this.props.onError(e)},onOtherPlaying:function(e){e!==this&&this.getDOMNode().pause()},onPlaying:function(e){this.clearCheckForSuccess(),s.mediaPlaying(this),this.props.onPlay&&this.props.onPlay(e)},render:function(){return React.createElement("audio",{src:this.props.src,className:this.props.className,onClick:this.props.onClick,controls:this.props.controls,preload:this.props.preload,type:this.props.type,autoPlay:this.props.autoPlay},this.props.children)}});e.exports=d},function(e,t,r){var n=r(14),i=r(230),o=r(477),a=r(438),s=r(560),c=r(558),d=r(554),u=r(553),l=r(144),p=r(561),h=r(437),f=r(546),s=r(560),m=r(151),g=r(170),v=React.createClass({displayName:"AudioVideo",mixins:[o,a],propTypes:{msg:React.PropTypes.instanceOf(i).isRequired,isContinuation:React.PropTypes.bool},getInitialState:function(){return this.retry=0,{urlState:this.async("msg.urlState"),url:this.async("msg.url"),uploadState:this.async("msg.uploadState")}},showMissingMedia:function(){var e,t;switch(this.props.msg.type){case i.TYPE.VIDEO:e=l10n.t("missing_video_title"),t=l10n.t("missing_video_text");break;case i.TYPE.AUDIO:e=l10n.t("missing_audio_title"),t=l10n.t("missing_audio_text")}l.openModal(React.createElement(h,{title:e,onOK:l.closeModal.bind(l),okText:l10n.t("web_ok")},t))},cancelMediaReupload:function(){this.preloadImagePromise&&this.preloadImagePromise.cancel(),this.props.msg.urlState=i.URL_STATE.NO_URL},remoteMediaReupload:function(){g.supportsFeature(g.F.MEDIA_RETRY)?this.props.msg.resend()["catch"](_.noop):l.openModal(React.createElement(f,{msg:this.props.msg}))},requestMediaReupload:function(){var e=this,t=this.props.msg;t.requestMediaReupload().then(function(){e.isMounted()&&t.urlState===i.URL_STATE.URL&&e.launchMediaViewer()})},launchMediaViewer:function(e){l.openModal(React.createElement(p,{startId:this.props.msg.id.toString()}),"media-viewer")},cancelMmsUpload:function(){var e=this.props.msg;e.uploadPromise&&e.uploadPromise.cancel()},retryMmsUpload:function(){var e=this.props.msg.reuploadMedia();e&&e["catch"](Promise.CancellationError,_.noop)["catch"](m.GaveUpRetry,_.noop)},render:function(){var e=this.props.msg,t=e.caption&&e.type!==i.TYPE.VIDEO||e.type===i.TYPE.AUDIO?null:React.createElement("div",{className:"shade"}),r=e.caption?React.createElement(c,{msg:e}):null,o="bubble-image bubble-video";e.caption&&(o+=" bubble-image-caption");var a=_.noop,l=null;if(e.ack<0)switch(e.urlState){case i.URL_STATE.UPLOADING:l=React.createElement(s.Pending,null);break;default:l=React.createElement(s.Upload,{filesize:e.size}),a=this.remoteMediaReupload}else switch(e.urlState){case i.URL_STATE.INIT:case i.URL_STATE.REFRESHING:l=React.createElement(s.Pending,null);break;case i.URL_STATE.NO_URL:case i.URL_STATE.RMR_ERROR_RETRY:case i.URL_STATE.STATUS_ERR:l=React.createElement(s.Download,{filesize:e.size}),a=this.requestMediaReupload;break;case i.URL_STATE.REFRESH_RETRY:l=React.createElement(s.Download,{filesize:e.size}),a=e.initializeMedia.bind(e);break;case i.URL_STATE.RMR_FETCHING:l=React.createElement(s.PendingCancel,null),a=this.cancelMediaReupload;break;case i.URL_STATE.RMR_ERROR_MISSING:a=this.showMissingMedia;break;case i.URL_STATE.URL:case i.URL_STATE.STATUS_200:case i.URL_STATE.UPLOADING:switch(e.uploadState){case i.UPLOAD_STATE.UPLOADING:l=React.createElement(s.PendingCancel,null),a=this.cancelMmsUpload;break;case i.UPLOAD_STATE.RETRY:l=React.createElement(s.Upload,{filesize:e.size}),a=this.retryMmsUpload;break;case i.UPLOAD_STATE.PHONE_UPLOADING:l=React.createElement(s.Pending,null);break;default:l=React.createElement(s.Play,null),a=this.launchMediaViewer}break;default:n.log("audioVideo:render Unknown media state")()}var p=Wa.formatDuration(e.duration);p&&(p=React.createElement("span",{className:"message-duration"},e.type===i.TYPE.VIDEO?React.createElement("span",{className:"icon-s icon-msg-video-light"}):React.createElement("span",{className:"icon-s icon-msg-audio-light"}),p));var h;if(e.type===i.TYPE.VIDEO){var f="data:image/jpeg;base64,"+e.body,m={backgroundImage:'url("'+f+'")'};h=React.createElement("div",{className:"image-thumb-body",style:m})}else e.type===i.TYPE.AUDIO&&(h=React.createElement("div",{className:"image-audio"}));return React.createElement("div",null,React.createElement("div",{className:o},this.props.isContinuation?null:React.createElement(u,{msg:e}),React.createElement("div",{className:"image-thumb",onClick:a},l,h,t,p),r,React.createElement(d,{msg:this.props.msg})))}});e.exports=v},function(e,t,r){var n=r(567),i=r(553),o=r(558),a=r(568),s=r(554),c=r(230),d=r(166),u=r(144),l=React.createClass({displayName:"Vcard",propTypes:{msg:React.PropTypes.instanceOf(c).isRequired,isContinuation:React.PropTypes.bool},openContactChat:function(){var e=this.props.msg.vcardWAid;Store.Chat.find(e).then(function(e){u.openChat(e)})},render:function(){var e=this.props.msg,t=React.createElement(n,{thumb:Wa.vCardGetThumbnail(e.body),type:e.type,ref:"media",shade:!1,duration:e.duration}),r=e.isSentByMe?t:null,c=e.isSentByMe?null:t,u=e.author?"text":"text no-author",l=e.caption?React.createElement(o,{msg:e}):null,p=d(["bubble","bubble-attach","bubble-contact"],{"bubble-attach-caption":!!e.caption}),h=[];return e.vcardWAid&&h.push(React.createElement("div",{className:"bubble-btn",onClick:this.openContactChat,title:l10n.t("message_author",{author:e.subtype}),key:"chat"},l10n.t("message"))),h=h.length?React.createElement("div",{className:"bubble-actions"},h):null,h=null,React.createElement("div",null,React.createElement("div",{className:p},React.createElement("div",{className:"wrapper"},r,React.createElement("div",{className:"contents"},this.props.isContinuation?null:React.createElement(i,{msg:e}),React.createElement("div",{className:u},React.createElement(s,{msg:e,contextMenu:this.contextMenu})),React.createElement(a,{msg:e})),c),l,h))}});e.exports=l},function(e,t,r){var n=r(540),i=r(230),o=React.createClass({displayName:"PreviewImage",propTypes:{duration:React.PropTypes.oneOfType([React.PropTypes.string,React.PropTypes.number]),shade:React.PropTypes.bool,thumb:React.PropTypes.string,type:React.PropTypes.oneOf([i.TYPE.AUDIO,i.TYPE.LOCATION,i.TYPE.VIDEO,i.TYPE.PTT,i.TYPE.VCARD]).isRequired},getDefaultProps:function(){return{shade:!0}},getIconClassNames:function(){return this.props.type===i.TYPE.VIDEO?"icon-sm icon-video-inv":this.props.type===i.TYPE.AUDIO?"icon-sm icon-arrow-inv":void 0},getClassNames:function(){var e="preview";return e+=this.props.type===i.TYPE.VCARD?" icon-user-default":" icon-user-default-square",this.props.thumb||(e+=" preview-"+this.props.type+" no-image"),e},getStyles:function(){var e=this.props.thumb;return e?Wa.isHttpUrl(e)?{backgroundImage:'url("'+e+'")'}:{backgroundImage:'url("data:image/jpeg;base64,'+e+'")'}:{}},render:function(){var e=Wa.formatDuration(this.props.duration),t=this.props.shade?React.createElement("span",{className:"shade"}):null;return React.createElement("div",{className:this.getClassNames(),style:this.getStyles()},t,React.createElement("span",{className:"meta meta-audio"},React.createElement("span",{className:this.getIconClassNames()}),React.createElement(n,null,e)))}});e.exports=o},function(e,t,r){var n=r(230),i=React.createClass({displayName:"VcardAction",propTypes:{msg:React.PropTypes.instanceOf(n).isRequired},componentWillMount:function(){var e=this.props.msg.body,t=new Blob([e],{type:"text/vcard"});this.setState({url:URL.createObjectURL(t)})},componentWillUnmount:function(){URL.revokeObjectURL(this.state.url)},preventUnload:function(e){Wa.isDownloading=!0,setTimeout(function(){Wa.isDownloading&&(Wa.isDownloading=!1)},500)},render:function(){var e=this.props.msg.subtype;return React.createElement("div",{className:"action"},React.createElement("a",{className:"button button-contact",onClick:this.preventUnload,title:e+".vcf"},React.createElement("span",{className:"icon-sm icon-contact"}),e))}});e.exports=i},function(e,t,r){var n=r(540),i=r(567),o=r(477),a=r(230),s=r(554),c=r(553),d=React.createClass({displayName:"Location",mixins:[o],propTypes:{msg:React.PropTypes.instanceOf(a).isRequired,isContinuation:React.PropTypes.bool},getInitialState:function(){return{url:this.async("msg.body")}},googleMapUrl:function(){var e=this.props.msg,t=this.loc();return t&&t.name?["https://maps.google.com/maps/search",encodeURIComponent(t.name),"@"+e.lat+","+e.lng+",17z"].join("/"):Wa.buildUrl("https://maps.google.com/maps",{q:e.lat+","+e.lng,z:17})},mapUrl:function(){return this.props.msg.clientUrl||this.googleMapUrl()},loc:function u(){var u=this.props.msg.get("loc");return u?(u=u.split("\n"),2===u.length?{name:u[0],addr:u[1]}:{name:u}):void 0},render:function(){var e,t,r=this.props.msg,o=React.createElement("a",{href:this.googleMapUrl(),target:"_blank"},React.createElement(i,{thumb:r.body,type:r.type,shade:!1})),a=r.isSentByMe?o:null,d=r.isSentByMe?null:o,u=r.isSentByMe?"text no-author":"text",l=this.loc();return l?(e=React.createElement("h4",{className:"text-title"},React.createElement("a",{href:this.mapUrl(),title:l.name,target:"_blank"},React.createElement(n,null,l.name))),t=l.addr?React.createElement("p",{title:l.addr},React.createElement(n,null,l.addr)):null):e=React.createElement("h4",{className:"text-title"},React.createElement("a",{href:this.mapUrl(),title:l10n.t("web_view"),target:"_blank"},React.createElement(n,null,l10n.t("web_view")))),React.createElement("div",{className:"bubble bubble-attach bubble-location"},React.createElement("div",{className:"wrapper"},a,React.createElement("div",{className:"contents"},this.props.isContinuation?null:React.createElement(c,{msg:r}),React.createElement("div",{className:u},e,t,React.createElement(s,{msg:r}))),d))}});e.exports=d},function(e,t,r){var n=r(14),i=r(230),o=r(477),a=r(554),s=r(553),c=r(151),d=r(567),u=r(571),l=r(572),p=r(546),h=r(144),f=r(170),m=React.createClass({displayName:"PTT",mixins:[o],propTypes:{msg:React.PropTypes.instanceOf(i).isRequired,isContinuation:React.PropTypes.bool},getInitialState:function(){return{uploadState:this.async("msg.uploadState"),urlState:this.async("msg.urlState"),url:this.async("msg.url"),img:this.async("msg.sender.ProfilePicThumb.img"),ack:this.async("msg.ack"),currentTime:0,playing:!1,autoPlay:!1}},getStatusClass:function(e){return e+=" audio-state-default",this.state.ack===Wa.CONST.ACK_PLAYED&&(e+=" audio-state-played"),e},cancelMmsUpload:function(){var e=this.props.msg;e.uploadPromise&&e.uploadPromise.cancel()},retryMmsUpload:function(){var e=this.props.msg.reuploadMedia();e&&e["catch"](Promise.CancellationError,_.noop)["catch"](c.GaveUpRetry,_.noop)},cancelMediaReupload:function(){this.props.msg.urlState=i.URL_STATE.NO_URL},remoteMediaReupload:function(){f.supportsFeature(f.F.MEDIA_RETRY)?this.props.msg.resend()["catch"](_.noop):h.openModal(React.createElement(p,{msg:this.props.msg}))},requestMediaReupload:function(){this.props.msg.requestMediaReupload().bind(this).then(function(){this.isMounted()&&this.setState({autoPlay:!0})})},handleTimeUpdate:function(e){this.setState({currentTime:e})},handlePlayingUpdate:function(e){this.setState({autoPlay:!1,playing:e})},render:function(){var e=this.props.msg,t=this.getStatusClass("bubble bubble-attach bubble-audio"),r="audio-status icon ";r+=this.state.ack===Wa.CONST.ACK_PLAYED?e.isSentByMe?"icon-ptt-out-blue":"icon-ptt-in-blue":e.isSentByMe?"icon-ptt-out-gray":"icon-ptt-in-green";var o,c=React.createElement("span",{className:r,key:"status"}),p=this.state.playing?this.state.currentTime:e.duration,h=React.createElement(d,{key:"image",thumb:this.state.img,type:e.type,shade:!1,duration:p}),f=e.isSentByMe?[h,c]:null,m=e.isSentByMe?null:[h,c],g=e.isSentByMe?"text no-author":"text";if(e.ack<0)o=React.createElement(u,{action:this.remoteMediaReupload,msg:e});else switch(e.urlState){case i.URL_STATE.INIT:case i.URL_STATE.REFRESHING:o=React.createElement(u,{msg:e});break;case i.URL_STATE.NO_URL:case i.URL_STATE.REFRESH_RETRY:case i.URL_STATE.RMR_ERROR_RETRY:case i.URL_STATE.STATUS_ERR:o=React.createElement(u,{action:this.requestMediaReupload,msg:e});break;case i.URL_STATE.RMR_FETCHING:o=React.createElement(u,{action:this.cancelMediaReupload,msg:e});break;case i.URL_STATE.STATUS_200:case i.URL_STATE.UPLOADING:switch(e.uploadState){case i.UPLOAD_STATE.UPLOADING:o=React.createElement(u,{action:this.cancelMmsUpload,msg:e});break;case i.UPLOAD_STATE.RETRY:o=React.createElement(u,{action:this.retryMmsUpload,msg:e});break;case i.UPLOAD_STATE.PHONE_UPLOADING:o=React.createElement(u,{msg:e});break;default:o=React.createElement(l,{msg:e,autoPlay:this.state.autoPlay,onPlayingUpdate:this.handlePlayingUpdate,onTimeUpdate:this.handleTimeUpdate})}break;case i.URL_STATE.URL:case i.URL_STATE.RMR_ERROR_MISSING:o=React.createElement(l,{msg:e,autoPlay:this.state.autoPlay,onPlayingUpdate:this.handlePlayingUpdate,onTimeUpdate:this.handleTimeUpdate});break;default:n.log("ptt:render Unknown PTT state")()}return React.createElement("div",{className:t},React.createElement("div",{className:"wrapper"},f,React.createElement("div",{className:"contents"},this.props.isContinuation?null:React.createElement(s,{msg:e}),React.createElement("div",{className:g},o)),m,React.createElement(a,{msg:e})))}});e.exports=m},function(e,t,r){var n=r(14),i=r(230),o=r(436),a=React.createClass({displayName:"PTTLoader",propTypes:{action:React.PropTypes.func,msg:React.PropTypes.instanceOf(i).isRequired},render:function(){var e=null,t=this.props.msg;switch(t.uploadState){case i.UPLOAD_STATE.UPLOADING:e=React.createElement("button",{className:"btn-audio icon icon-audio-cancel-noborder",onClick:this.props.action},React.createElement(o,{stroke:3,size:38}));break;case i.UPLOAD_STATE.RETRY:e=React.createElement("button",{className:"btn-audio icon icon-audio-upload",onClick:this.props.action});break;default:if(t.ack<0)switch(t.urlState){case i.URL_STATE.UPLOADING:e=React.createElement("button",{className:"btn-audio",onClick:this.props.action},React.createElement(o,{stroke:3,size:38}));break;default:e=React.createElement("button",{className:"btn-audio icon icon-audio-upload",onClick:this.props.action})}else switch(t.urlState){case i.URL_STATE.INIT:case i.URL_STATE.REFRESHING:e=React.createElement("button",{className:"btn-audio",onClick:this.props.action},React.createElement(o,{stroke:3,size:38}));break;case i.URL_STATE.NO_URL:case i.URL_STATE.REFRESH_RETRY:case i.URL_STATE.RMR_ERROR_RETRY:case i.URL_STATE.STATUS_ERR:e=React.createElement("button",{className:"btn-audio icon icon-audio-download",onClick:this.props.action});break;case i.URL_STATE.RMR_FETCHING:e=React.createElement("button",{className:"btn-audio icon icon-audio-cancel-noborder",onClick:this.props.action},React.createElement(o,{stroke:3,size:38}));break;default:n.log("pttLoader:render Unknown PTT state")()}}return React.createElement("div",{className:"audio"},React.createElement("div",{className:"audio-controls"},e),React.createElement("div",{className:"audio-body"},React.createElement("input",{type:"range",className:"audio-track",min:0,max:100,value:0,disabled:"disabled"})))}});e.exports=a},function(e,t,r){var n=r(14),i=r(230),o=r(144),a=r(437),s=r(438),c=r(564),d=React.createClass({displayName:"PTTPlayer",mixins:[s],propTypes:{msg:React.PropTypes.instanceOf(i).isRequired,autoPlay:React.PropTypes.bool.isRequired,onPlayingUpdate:React.PropTypes.func.isRequired,onTimeUpdate:React.PropTypes.func.isRequired},playing:!1,dragging:!1,getInitialState:function(){return{progress:0}},onPlayClick:function(){this.hasPlayed=!0;var e=this.refs.audio.getDOMNode();this.playing?e.pause():e.play()},onPlaying:function(){this.playing=!0;var e=this.props.msg;!e.get("isSentByMe")&&e.get("ack")<Wa.CONST.ACK_PLAYED&&e.sendPlayed(),this.props.onPlayingUpdate&&this.props.onPlayingUpdate(this.playing)},onPause:function(){this.playing=!1,this.props.onPlayingUpdate&&this.props.onPlayingUpdate(this.playing)},onEnded:function(){var e=this.refs.audio.getDOMNode();e.currentTime=0,e.load()},onTimeUpdate:function(){var e=this.refs.audio.getDOMNode(),t=0;e.duration&&(t=Math.round(100*e.currentTime/e.duration),this.props.onTimeUpdate&&this.props.onTimeUpdate(e.currentTime)),this.setState({progress:t})},componentDidMount:function(){var e=this.refs.audio.getDOMNode();this.regNativeListener(e,"loadeddata",this.onLoad),this.regNativeListener(e,"playing",this.onPlaying),this.regNativeListener(e,"pause",this.onPause),this.regNativeListener(e,"ended",this.onEnded),this.regNativeListener(e,"timeupdate",this.onTimeUpdate),this.regNativeListener(e,"durationchange",this.onTimeUpdate),this.regNativeListener(e,"progress",this.onTimeUpdate),this.regNativeListener(e,"error",this.onPlayerError,!0)},onLoad:function(e){this.props.msg.urlState=i.URL_STATE.STATUS_200},onPlayerError:function(e){if(this.hasPlayed){var t=e.target.src,r=e.target.error||{code:"__MISSING__"};switch(r.code){case MediaError.MEDIA_ERR_NETWORK:case MediaError.MEDIA_ERR_DECODE:case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:
this.props.msg.mediaLoadError(t);break;default:n.log("pttPlayer:onError message ptt unknown error",r.code,t)()}}else this.props.msg.urlState=i.URL_STATE.NO_URL,this.props.msg.unset("url")},onDrag:function(e){var t=this.refs.audio.getDOMNode();this.setState({progress:e}),t.duration&&(t.currentTime=t.duration/100*e)},showMissingMedia:function(){o.openModal(React.createElement(a,{title:l10n.t("missing_audio_title"),onOK:o.closeModal.bind(o),okText:l10n.t("web_ok")},l10n.t("missing_audio_text")))},render:function(){var e="btn-audio icon ";e+=this.playing?"icon-audio-pause":"icon-audio-play";var t={value:this.state.progress,requestChange:this.onDrag},r=this.props.msg.urlState===i.URL_STATE.RMR_ERROR_MISSING?this.showMissingMedia:this.onPlayClick;return React.createElement("div",{className:"audio"},React.createElement("div",{className:"audio-controls"},React.createElement("button",{ref:"play_pause",className:e,onClick:r})),React.createElement("div",{className:"audio-body"},React.createElement("div",{className:"audio-track-container"},React.createElement("span",{className:"audio-progress",style:{width:this.state.progress+"%"}}),React.createElement("input",{type:"range",className:"audio-track",valueLink:t,min:"0",max:"100"}))),React.createElement(c,{ref:"audio",src:this.props.msg.mmsSrc,preload:"auto",autoPlay:this.props.autoPlay}))}});e.exports=d},function(e,t,r){var n=r(144),i=r(436),o=r(477),a=r(201),s=React.createClass({displayName:"LoadEarlierMessages",mixins:[o],propTypes:{chat:React.PropTypes.instanceOf(a).isRequired},getInitialState:function(){return{noEarlierMsgs:this.async("chat.noEarlierMsgs"),isLoadingMsgs:this.async("chat.isLoadingMsgs")}},loadEarlierMsgs:function(e){this.state.isLoadingMsgs||n.loadEarlierMsgs(this.props.chat)},render:function(){return this.state.noEarlierMsgs?null:this.state.isLoadingMsgs?React.createElement("div",{className:"more"},React.createElement("div",{className:"btn-more",title:l10n.t("loading_messages")},React.createElement(i,{stroke:6,size:24}))):React.createElement("div",{className:"more"},React.createElement("div",{className:"btn-more",title:l10n.t("load_earlier_messages"),onClick:this.loadEarlierMsgs},React.createElement("span",{className:"icon icon-refresh"})))}});e.exports=s},function(e,t,r){var n=r(201),i=r(468),o=r(466),a=r(467),s=r(235),c=r(450),d=r(144),u=r(437),l=r(151),p=r(440),h=r(575),f=React.createClass({displayName:"ComposeBox",mixins:[a,s],propTypes:{chat:React.PropTypes.instanceOf(n).isRequired,onPageUpDown:React.PropTypes.func.isRequired},getInitialState:function(){var e=this.props.chat;return this.text=e.composeText||"",this.selection=e.composeSel,{hasText:this.hasText(),emojiExpanded:!1,recording:!1}},componentWillMount:function(){var e=this.props.chat;e.unset("composeText"),e.unset("composeSel"),this.regCmd("focus_chat_text_input_"+this.props.chat.id,this.focusEmojiInput),this.regCmd("paste_chat_text_input_"+this.props.chat.id,this.pasteEmojiInput),this.regCmd("open_chat",this.onOpenChat),c.setBase(this)},focusEmojiInput:function(){this.refs.input&&this.refs.input.restoreFocus(!0)},pasteEmojiInput:function(e){this.refs.input&&(this.refs.input.restoreFocus(!0),this.refs.input.pasteText(e))},componentWillUnmount:function(){var e=this.props.chat;e.set("composeText",this.text),e.set("composeSel",this.selection)},componentDidMount:function(){this.height=this.refs.input.getDOMNode().clientHeight},focus:function(){this.refs.input&&this.refs.input.restoreFocus(!1)},onOpenChat:function(e){e.id===this.props.chat.id&&this.refs.input.restoreFocus(!1)},onMaxPasteExceeded:function(){d.openModal(React.createElement(u,{title:l10n.t("message_too_large_title"),onOK:d.closeModal.bind(d),okText:l10n.t("web_ok")},l10n.t("message_too_large_text")))},onChange:function(e){var t=this.refs.input.getDOMNode(),r=t.clientHeight,n=r-this.height;n&&d.composeHeightChange(n),this.height=r;var i=this.hasText();this.text=e.target.value;var o=this.hasText();o!==i&&this.setState({hasText:o}),o?(this.props.chat.presence.subscribe()["catch"](l.WapDrop,_.noop),this.props.chat.markComposing()):this.props.chat.markPaused()},onSelectionChange:function(e){this.selection=e},onFocus:function(){c.stealFocus(c.COMPOSE_INPUT)},onMouseDown:function(e){c.stealFocus(c.COMPOSE_INPUT),e.defaultPrevented&&this.refs.input.restoreFocus(!1)},onKeyDown:function(e){if(("PageUp"===e.key||"PageDown"===e.key)&&this.props.onPageUpDown){e.stopPropagation(),this.props.onPageUpDown(e);var t=this.refs.input;return void this.safeDefer(function(){t.restoreFocus(!0)})}},onKeyPress:function(e){return"Enter"!==e.key||e.shiftKey?void 0:(this.onSendText(),void e.preventDefault())},hasText:function(){return f.hasText=this.text.trim().length>0},onSendText:function(){if(this.hasText()){var e=this.text;this.text="",delete this.selection,this.forceUpdate(),this.props.chat.sendMessage(e),this.closeEmojiPanel()}},handleEmoji:function(e){this.refs.input.replaceSelection(e)},openEmojiPanel:function(){this.state.emojiExpanded!==!0&&(this.setState({emojiExpanded:!0}),d.composeHeightChange(),c.push(this,c.EMOJI))},closeEmojiPanel:function(){this.state.emojiExpanded!==!1&&c.pop(c.EMOJI)},close:function(){this.state.emojiExpanded!==!1&&(this.setState({emojiExpanded:!1}),d.composeHeightChange())},onPTT:function(e){e===h.REC?this.setState({recording:!0}):this.setState({recording:!1})},preventBlur:function(e){e.preventDefault(),e.stopPropagation(),this.refs.input.restoreFocus(!1)},render:function(){var e=this.state.emojiExpanded?React.createElement("button",{className:"icon icon-hide btn-emoji",onClick:this.closeEmojiPanel}):React.createElement("button",{className:"icon icon-smiley btn-emoji",onClick:this.openEmojiPanel}),t=this.state.emojiExpanded?React.createElement(i,{onEmoji:this.handleEmoji,key:"compose-emoji-panel"}):null,r="block-compose";this.state.recording&&(r+=" ptt-open");var n="input-container";this.state.recording&&(n+=" disabled");var a=null;return a=navigator.getUserMedia&&window.AudioContext?this.hasText()?React.createElement("button",{className:"icon btn-icon icon-send send-container",onClick:this.onSendText}):React.createElement(h,{key:"ptt",chat:this.props.chat,onStateChange:this.onPTT}):this.hasText()?React.createElement("button",{className:"icon btn-icon icon-send send-container",onClick:this.onSendText}):React.createElement("button",{className:"icon btn-icon icon-send send-container",onClick:this.onSendText,disabled:!0}),React.createElement("footer",{className:"pane-footer pane-chat-footer",onMouseDown:this.preventBlur,onContextMenu:this.preventBlur,onKeyDown:this.onKeyDown},React.createElement(p,{transitionName:"emoji"},t),React.createElement("div",{className:r},e,React.createElement("div",{className:n,"data-ignore-capture":c.IGNORE_ANY},React.createElement(o,{placeholder:l10n.t("type_a_message"),editable:!this.state.recording,ref:"input",value:this.text,selection:this.selection,multiline:!0,maxLength:Wa.CONST.MAX_TXT_MSG_SIZE,maxPaste:Wa.CONST.MAX_TXT_MSG_SIZE,onMaxPasteExceeded:this.onMaxPasteExceeded,onKeyPress:this.onKeyPress,onMouseDown:this.onMouseDown,onChange:this.onChange,onFocus:this.onFocus,onSelectionChange:this.onSelectionChange})),a))}});e.exports=f},function(e,t,r){var n,i=r(14),o=r(144),a=r(201),s=r(450),c=r(438),d=r(235),u=r(151),l=r(472),p=r(576),h=r(440),f=React.createClass({displayName:"PTT",mixins:[d,c],propTypes:{chat:React.PropTypes.instanceOf(a),onStateChange:React.PropTypes.func.isRequired},statics:{READY:"ready",DELAY:"delay",REC:"recording",PROCESSSING:"processsing",GUM_TIMEOUT:"ptt_gum_timeout",PERMISSION_DENIED:"permission_denied",NOT_SUPPORTED_ERROR:"not_supported_error",MANDATORY_UNSATISFIED_ERROR:"mandatory_unsatisfied_error",CANCEL:"cancel",SEND:"send"},getInitialState:function(){return{state:f.READY,active:void 0,elapsedTimeInterval:void 0,elapsedTime:0}},componentWillUnmount:function(){s.pop(s.PTT)},componentDidMount:function(){this.regNativeListener(window,"blur",this.cancelRecording)},isRecording:function(){var e=this.state.state;return e===f.REC||e===f.DELAY||e===f.PROCESSSING},getRecorder:function(){var e;return e=new Promise(function(t,r){navigator.getUserMedia({audio:!0},function(r){if(e.isResolved()){if(_.isFunction(r.stop))r.stop();else for(var n=r.getTracks(),i=0;i<n.length;i++)n[i].stop();o.closeModal()}else t(r)},function(t){var n=_.isString(t)?t:t.name,i=u.GUM[n]||u.GUM.GUMError;r(new i),e&&e.isResolved()&&o.closeModal()})}).timeout(1500,"waitForGUMConversationPTTTimeout").then(function(e){return n?n.connect(e):n=new p(e,Wa.CONST.RECORDER_CFG),n})["catch"](Promise.TimeoutError,function(e){throw o.openModal(React.createElement(l,{title:"guide_desktop_mic_title",desc:"guide_desktop_mic_description",type:l.TYPE.GUIDE_ALLOW})),e})["catch"](u.GUM.PermissionDeniedError,function(e){throw o.openModal(React.createElement(l,{title:"guide_desktop_mic_title",desc:"guide_desktop_mic_fail_description",type:l.TYPE.GUIDE_UNBLOCK})),e})["catch"](u.GUM.GUMError,function(e){if(e instanceof u.GUM.PermissionDeniedError)throw e;throw o.openModal(React.createElement(l,{title:"guide_desktop_mic_missing_title",desc:"guide_desktop_mic_missing_description",type:l.TYPE.GUIDE_NONE})),e})},cancelRecording:function(){this.isRecording()&&(this.state.state!==f.READY&&this.props.onStateChange(f.READY),this.safeIsMounted()&&this.setState({state:f.READY,active:void 0,elapsedTime:0}),this.clearSafeInterval(this.elapsedTimeInterval),delete this.elapsedTimeInterval,n&&n.stop(),this.props.chat.markPaused())},startInterval:function(){var e=this;this.elapsedTimeInterval=this.safeInterval(function(){e.setState({elapsedTime:e.state.elapsedTime+1})},1e3)},cancelPTTTimer:function(){this.pttTimer&&(this.clearSafeTimeout(this.pttTimer),delete this.pttTimer)},onPTTReady:function(){delete this.pttTimer,this.state.state===f.DELAY&&this.setState({state:f.REC})},close:function(){this.cancelRecording()},onMouseOverSend:function(){this.setState({active:f.SEND})},onMouseOutSend:function(){this.setState({active:void 0})},onMouseOverCancel:function(){this.setState({active:f.CANCEL})},onMouseOutCancel:function(){this.setState({active:void 0})},onMouseUpCancel:function(){this.state.elapsedTime<1||(this.cancelPTTTimer(),s.pop(s.PTT))},onMouseUpSend:function(){var e=this;if(!(this.state.elapsedTime<1)){this.cancelPTTTimer();var t=this.props.chat;this.state.state===f.REC?t.regCancellablePromise(new Promise(function(r,i){e.setState({state:f.PROCESSSING}),e.props.onStateChange(f.READY),n.exportOGG(function(n){t.sendMedia({file:n,type:"ptt",duration:e.state.elapsedTime})["finally"](r),s.pop(s.PTT)})}))["catch"](Promise.CancellationError,function(){s.pop(s.PTT)}):(s.pop(s.PTT),i.log("ptt:onMouseUpSend duration too short")())}},onMouseDown:function(){this.state.state===f.READY&&this.getRecorder().bind(this).then(function(e){e.record(),this.props.chat.presence.update()["catch"](u.WapDrop,_.noop),this.props.chat.markRecording(),this.setState({state:f.DELAY}),this.props.onStateChange(f.REC),s.push(this,s.PTT),s.stealFocus(s.PTT),this.pttTimer=this.safeDelay(this.onPTTReady,1500),this.startInterval()})["catch"](function(e){i.log("PTT Recording Error","red",e)})},render:function(){var e="btn-close btn-border ptt-close";this.state.active===f.CANCEL&&(e+=" is-hover");var t="btn-border ptt-send";this.state.active===f.SEND&&(t+=" is-hover");var r=this.state.state===f.DELAY||this.state.state===f.REC?React.createElement("div",{className:"ptt-recording",key:"recording"},React.createElement("button",{className:e,onMouseOver:this.onMouseOverCancel,onMouseOut:this.onMouseOutCancel,onMouseUp:this.onMouseUpCancel},React.createElement("span",{className:"icon icon-round-x btn-state-default"}),React.createElement("span",{className:"icon icon-round-x-inv btn-state-hover"})),React.createElement("div",{className:"ptt-counter"},moment.unix(this.state.elapsedTime).format("m:ss")),React.createElement("button",{className:t,onMouseOver:this.onMouseOverSend,onMouseOut:this.onMouseOutSend,onMouseUp:this.onMouseUpSend},React.createElement("span",{className:"icon icon-round-send btn-state-default"}),React.createElement("span",{className:"icon icon-round-send-inv btn-state-hover"}))):null,n=this.state.state===f.READY||this.state.state===f.PROCESSSING?React.createElement("button",{className:"icon btn-icon icon-ptt",onMouseDown:this.onMouseDown,disabled:this.state.state===f.PROCESSSING,key:"button"}):null,i="ptt-container";return r&&(i+=" active"),React.createElement("div",{className:i},React.createElement(h,{transitionName:"ptt"},r||n))}});e.exports=f},function(e,t){function r(e,t){this.config=_.merge(i,t),this.onComplete=_.noop,this.worker=new Worker(t.workerPath),this.worker.onmessage=function(e){this.onComplete&&this.onComplete(e.data)}.bind(this),this.context=new AudioContext,this.worker.postMessage({command:"init",config:{sampleRate:this.context.sampleRate}}),this.connect(e,t)}function n(e){this.ondata=this._ondata.bind(this),this.connect(e)}var i={workerPath:"recorderWorker.js",bufferLen:4096};r.prototype.connect=function(e,t){this.config=_.merge(this.config,t),this.stream=e,this.recording=!1,this.context=this.context||new AudioContext;var r=this.context.createScriptProcessor(this.config.bufferLen,2,2);r.onaudioprocess=function(e){this.recording&&this.worker.postMessage({command:"record",buffer:[e.inputBuffer.getChannelData(0),e.inputBuffer.getChannelData(1)]})}.bind(this);var n=this.context.createMediaStreamSource(this.stream);n.connect(r),r.connect(this.context.destination)},r.prototype.exportOGG=function(e){this.onComplete=e,this.worker.postMessage({command:"exportOGG",type:"audio/ogg"})},r.prototype.stop=function(){if(this.context.close&&this.context.close(),this.context=void 0,this.recording=!1,this.onComplete=void 0,_.isFunction(this.stream.stop))this.stream.stop();else for(var e=this.stream.getTracks(),t=0;t<e.length;t++)e[t].stop();this.stream=void 0,this.worker.postMessage({command:"clear"})},r.prototype.record=function(){this.recording=!0},n.prototype.record=function(){"inactive"===this.recorder.state&&(this.data=null,this.recorder.start())},n.prototype.stop=function(){this.data=null,this.stream.stop(),"inactive"!==this.recorder.state&&this.recorder.stop()},n.prototype.exportOGG=function(e){if(this.stop(),this.data)e(this.data);else{var t=this.recorder,r=function n(r){e(r.data),t.removeEventListener("dataavailable",n)};t.addEventListener("dataavailable",r)}},n.prototype._ondata=function(e){this.data=e.data},n.prototype.connect=function(e){var t=this.recorder;t&&t.removeEventListener("dataavailable",this._ondata),t=this.recorder=new window.MediaRecorder(e),this.stream=e,t.addEventListener("dataavailable",this._ondata)},window.MediaRecorder?e.exports=n:e.exports=r},function(e,t,r){var n=r(14),i=r(467),o=r(450),a=r(440),s=React.createClass({displayName:"DrawerManager",mixins:[i],propTypes:{onRightDrawer:React.PropTypes.func.isRequired},statics:{DEFAULT_TRANSITION:"drawer-left"},getInitialState:function(){var e={};return e[o.DRAWER_LEFT]={flow:null,transition:s.DEFAULT_TRANSITION},e[o.DRAWER_MID]={flow:null,transition:s.DEFAULT_TRANSITION},e[o.DRAWER_RIGHT]={flow:null,transition:s.DEFAULT_TRANSITION},{flows:e}},componentWillMount:function(){this.regCmd("open_drawer",this.openFlow),this.regCmd("close_drawer",this.closeFlow),this.regCmd("chat_delete",this.chatDelete)},openFlow:function(e,t){var r=e.props.type;return r?(r===o.DRAWER_RIGHT&&this.props.onRightDrawer(!0),o.push(this,r),this.state.flows[r]={flow:e,transition:t||s.DEFAULT_TRANSITION},void this.setState(this.state.flows)):void n.log("drawerManager:openFlow Tried to open flow without a type.")()},close:function(e){e===o.DRAWER_RIGHT&&this.props.onRightDrawer(!1);var t=this.state.flows;t[e]={flow:null,transition:t[e].transition},this.setState(t)},chatDelete:function(){this.closeFlow(o.DRAWER_RIGHT)},closeFlow:function(e){e?o.pop(e):(o.pop(o.DRAWER_MID),o.pop(o.DRAWER_RIGHT))},checkRTL:function(e){return l10n.isRTL()?e+"-rtl":e},render:function(){var e=o,t=this.state.flows[e.DRAWER_LEFT].flow,r=this.checkRTL(this.state.flows[e.DRAWER_LEFT].transition),n=this.state.flows[e.DRAWER_MID].flow,i=this.state.flows[e.DRAWER_MID].transition,s=this.state.flows[e.DRAWER_RIGHT].flow,c=this.checkRTL(this.state.flows[e.DRAWER_RIGHT].transition);return React.createElement("div",null,React.createElement(a,{transitionName:r},t),React.createElement(a,{transitionName:i},n),React.createElement(a,{transitionName:c},s))}});e.exports=s},function(e,t,r){var n=r(14),i=r(144),o=r(467),a=r(435),s=r(438),c=r(163),d=r(18),u=r(240),l=r(151),p=r(579),h=React.createClass({displayName:"NotificationManager",mixins:[o,a,s],componentWillMount:function(){this.tone=new Audio(d.CONST.NOTIFICATION_TONE_PATH),this.desktopNotifications=[],this.regCmd("alert_new_msg",this.alertNewMsg),this.regCmd("alert_call",this.showCallNotification),this.regCmd("cancel_call",this.cancelCallNotification),this.addObserver(Store.Chat,"add remove reset change:unreadCount",this.updateUnreadCount),this.addObserver(u,"change:displayInfo",this.updateUnreadCount)},componentDidMount:function(){this.updateUnreadCount()},componentWillUnmount:function(){for(this.setTitleAndFavicon(0);this.desktopNotifications.length;){var e=this.desktopNotifications.shift();e&&e.close&&e.close()}},updateUnreadCount:function(){var e;e=u.displayInfo===u.INFO.OFFLINE?-1:u.displayInfo===u.INFO.TIMEOUT?-1:Store.Chat.filter(function(e){return!e.archive&&e.isDirty()}).length,this.count!==e&&(this.count=e,this.setTitleAndFavicon(e))},setTitleAndFavicon:function(e){switch(e){case-1:case 0:document.title=l10n.t("whatsapp_web");break;default:document.title="("+l10n.n(e)+") "+l10n.t("whatsapp_web")}this.updateFavicon(e)},updateFavicon:function(e){var t;t=-1===e?"favicon-error2":0===e?"favicon":10>e?"f0"+e:100>e?"f"+e:"f00";var r="/img/favicon/1x/"+t+".png",i="/img/favicon/2x/"+t+".png",o={low:r,high:i,onSet:function(e){var t=document.getElementById("favicon");t||(t=document.createElement("link"),t.id="favicon",t.rel="shortcut icon",document.head.appendChild(t)),t.href=e,t.type="image/png"}};p.loadAsset(o,t).then(function(){n.log("Favicon updated: "+t)()})},alertNewMsg:function(e){var t=e.get("chat");if((!document.hasFocus()||!t.get("active"))&&!Store.Mute.globalMute().isMuted&&!t.mute.isMuted&&(Store.Mute.getGlobalNotifications()&&this.showDesktopNotification(e),Store.Mute.getGlobalSounds()))if(t.isGroup){var r=Date.now(),n=t.squelch||0;r>n&&(this.playAudioNotification(),Store.GroupMetadata.find(t.id).then(function(e){var n=e.participants.length,i=1e3*Math.min(120,30+5*n);t.squelch=r+i})["catch"](l.WapDrop,function(){t.squelch=r+6e4}))}else this.playAudioNotification()},showCallNotification:function(e,t){if(window.Notification&&window.Notification.permission===d.CONST.PERMISSION_ALLOWED){var r=Store.Contact.get(t),n=r?r.get("formattedName"):d.widGetFormattedUser(t),i=l10n.t("incoming_call_notification_title",{name:n}),o=l10n.t("incoming_call_notification_text"),a=this;Store.ProfilePicThumb.find(t).timeout(1e3,"showCallNotificationTimeout").then(function(r){var n=r&&r.get("img")?r.get("img"):d.CONST.USER_DEFAULT_ICON;a._showDesktopNotification(t,e,i,o,n,!0)})["catch"](l.WapDrop,Promise.TimeoutError,function(r){a._showDesktopNotification(t,e,i,o,d.CONST.USER_DEFAULT_ICON,!0)}),Store.Mute.getGlobalSounds()&&this.playAudioNotification()}},cancelCallNotification:function(e){var t=_.find(this.desktopNotifications,"tag",e);t&&t.close(),Store.Call.remove(Store.Call.get(e))},showDesktopNotification:function(e){if(window.Notification&&window.Notification.permission===d.CONST.PERMISSION_ALLOWED){var t=e.get("chat"),r=t.get("id"),n=e.asDesktopNotification();/^[\x00-\xFF]/.test(n)||(n=" "+n);var i=l10n.isRTL()?n+"‏‎ - ‫"+d.formatTimestamp(e.get("t"))+"‬":n+"‎‏ - ‪"+d.formatTimestamp(e.get("t"))+"‬",o=e.get("id"),a=t.isGroup?d.CONST.GROUP_DEFAULT_ICON:d.CONST.USER_DEFAULT_ICON,s=t.isGroup?l10n.t("default_group_message_notification_title"):l10n.t("default_contact_message_notification_title"),c=this;Store.ProfilePicThumb.find(r).timeout(1500,"showDesktopNotificationTimeout").then(function(e){var n=t.get("contact").get("formattedName")||s,d=e?e.get("img"):"";c._showDesktopNotification(r,o,n,i,d||a)})["catch"](l.WapDrop,Promise.TimeoutError,function(e){var n=t.get("contact").get("formattedName")||s;c._showDesktopNotification(r,o,n,i,a)})}},_showDesktopNotification:function(e,t,r,o,a,s){function u(){l&&l.close&&l.close()}var l,p=this;try{l=new window.Notification(c.normalizeEmoji(r),{body:c.normalizeEmoji(o),tag:s?t:e,icon:d.relToAbs(a),dir:"auto",lang:l10n.lng()})}catch(h){window.Notification=void 0}return l?(this.desktopNotifications.push(l),l.onclick=function(){s||(window.focus(),i.openChat(Store.Chat.get(e))),u()},l.onclose=function(){window.removeEventListener("unload",u),p.desktopNotifications=_.without(p.desktopNotifications,l)},l.onshow=function(){_.delay(u,s?d.CONST.CALL_NOTIFICATION_TIMEOUT:d.CONST.NOTIFICATION_TIMEOUT)},_.delay(u,s?d.CONST.CALL_NOTIFICATION_TIMEOUT:5*d.CONST.NOTIFICATION_TIMEOUT),void window.addEventListener("unload",u)):void n.log("notificationManager:showDesktopNotification: could not create Notification")()},playAudioNotification:function(){this.tone.play()},render:function(){return null}});e.exports=h},function(e,t,r){function n(){var e=this;this.assetStyle=new d("asset-style"),this.assets={},window.addEventListener("dpichange",function(){return e.loadAssets(e.assets)})}var i=r(14),o=r(150),a=r(151),s=r(240),c=r(10),d=r(580),u=r(581),l={sprite:{"class":".icon, .icon-s, .icon-l, .icon-xl",low:r(582),high:r(582)},"bg-chat":{"class":".pane-chat",low:r(583),high:r(584)},"emoji-small":{"class":".emoji",low:r(585),high:r(586)},"emoji-large":{"class":".emojik",low:r(587),high:r(588)},"intro-connection":{"class":".intro-image",low:r(589),high:r(590)}};n.prototype.loadInitialAssets=function(e){return this.loadAssets(l)},n.prototype.loadAssets=function(e){return Promise.all(_.map(e,this.loadAsset.bind(this)))},n.prototype.loadAsset=function(e,t){var r,n,o=this,a=u.currentRes,s=t+"-"+a;return r=window.performance.now(),this.unloadAsset(t),this.assets[t]=e,this.assets[t].promise=Promise.resolve().then(function(){return c.db.assets.get(s)})["catch"](function(e){i.log('Failed to "get" asset: '+s,"orange",e)}).then(function(t){var r=_.last(e[a].split("/"));if(t&&t.hash===r)return o.loadBlob(URL.createObjectURL(t.data));throw new Error("No result")})["catch"](function(){return o.loadAndCacheData(e[a],s).then(function(e){return URL.createObjectURL(e)})}).then(function(t){return e["class"]&&o.assetStyle.setRule(""+e["class"],{"background-image":"url('"+t+"')"}),n=window.performance.now(),i.log("Asset: "+s+" loaded: "+(n-r).toFixed(2)+"ms")(),e.onSet&&e.onSet(t),t})},n.prototype.unloadAsset=function(e){var t=this.assets[e];t&&t.promise&&t.promise.isFulfilled()&&URL.revokeObjectURL(t.promise.value()),delete this.assets[e]},n.prototype.loadAndCacheData=function(e,t){var r,n=_.last(e.split("/"));return this.loadData(e).then(function(e){return r=e,c.db.assets.put({key:t,hash:n,data:e})})["catch"](function(e){i.log('Failed to "put" asset: '+t,"orange",e)}).then(function(e){return r})},n.prototype.loadBlob=function(e){return new Promise(function(t,r){var n=new XMLHttpRequest;n.onload=function(){200===n.status?t(e):(i.log("Blob: "+e+" failed. Refetching asset","orange")(),r(e))},n.onerror=function(){return r(e)},n.open("GET",e,!0),n.send()})},n.prototype.loadData=function(e){return o.loopOnError(a.ShouldLoop,function(t){var r;return r=s.info===s.INFO.OFFLINE?o.waitForBBEvent(s,"change:info",function(e){return e.info!==s.INFO.OFFLINE}):Promise.delay(5e3*(t>0?1:0)),r.then(function(){return new Promise(function(t,r){var n=new XMLHttpRequest;n.onload=function(o){200===n.status?t(n.response):(i.log("Asset: "+_.last(e.split("/"))+" failed. Retrying...","orange",o)(),r(new a.ShouldLoop("Asset failed to load. Retrying...")))},n.onerror=function(t){i.log("Asset: "+_.last(e.split("/"))+" failed. Retrying...","orange",t)(),r(new a.ShouldLoop("Asset failed to load. Retrying..."))},n.open("GET",e,!0),n.responseType="blob",n.send()})})})},n.prototype.loadImage=function(e){return o.loopOnError(a.ShouldLoop,function(t){var r;return r=s.info===s.INFO.OFFLINE?o.waitForBBEvent(s,"change:info",function(e){return e.info!==s.INFO.OFFLINE}):Promise.delay(5e3*(t>0?1:0)),r.bind(this).then(function(){return new Promise(function(t,r){var n=new Image;n.onload=function(){t(e)},n.onerror=function(){i.log("Asset: "+_.last(e.split("/"))+" failed. Retrying...","orange")(),r(new a.ShouldLoop("Asset failed to load. Retrying..."))},n.src=e})})})},e.exports=new n},function(e,t){function r(e){this.styleSheet=this.createStyleSheet(e),this.rules={}}r.prototype.createStyleSheet=function(e){e=e||_.uniqueId("dynamic-style-");var t=document.createElement("style");return t.id=e,t.type="text/css",document.head.appendChild(t),t=t.sheet},r.prototype.addRule=function(e,t){var r=this.styleSheet.cssRules.length;return t=_.map(t,function(e,t){return t+": "+e+";"}).join(" "),this.styleSheet.insertRule(e+" { "+t+" }",r),this.rules[e]=this.styleSheet.cssRules[r],this.rules[e]},r.prototype.updateRule=function(e,t){var r=this.rules[e];return _.forEach(t,function(e,t){r.style[_.camelCase(t)]=e}),r},r.prototype.setRule=function(e,t){var r=this.rules[e];return r?this.updateRule(e,t):this.addRule(e,t)},e.exports=r},function(e,t){var r={LOW:"low",HIGH:"high"},n=window.matchMedia("\n    only screen and (-webkit-min-device-pixel-ratio: 2),\n    only screen and (min-device-pixel-ratio: 2),\n    only screen and (min-resolution: 2dppx)\n"),i={RES:r,currentRes:n.matches?r.HIGH:r.LOW},o=function(e){var t=e.matches?r.HIGH:r.LOW;if(t!==i.currentRes){i.currentRes=t;var n=document.createEvent("Event");n.initEvent("dpichange",!0,!0),window.dispatchEvent(n)}};n.addListener(o),e.exports=i},function(e,t,r){e.exports=r.p+"img/4151ee45e9d5c25cd648b612218b5d6e.svg"},function(e,t,r){e.exports=r.p+"img/a69d28e6e4627986ab04a25d03a6d5a2.jpg"},function(e,t,r){e.exports=r.p+"img/849f1639052d37c553a062feea623cef.jpg"},function(e,t,r){e.exports=r.p+"img/1aa14adeebe630720a6eb93c98e49116.png"},function(e,t,r){e.exports=r.p+"img/947c4b00d0bd55ce3a7765cd60640fd3.png"},function(e,t,r){e.exports=r.p+"img/cc9360e39343cb080f92d941e0806281.jpg"},function(e,t,r){e.exports=r.p+"img/8e9bed9abc4e05f49ab038a57b6b8ecb.jpg"},function(e,t,r){e.exports=r.p+"img/c98cc75f2aa905314d74375a975d2cf2.jpg"},function(e,t,r){e.exports=r.p+"img/9466a20e6d2921a21ac7ab82419be157.jpg"},function(e,t,r){var n=r(144),i=r(592),o=r(593),a=r(467),s=r(435),c=r(438),d=React.createClass({displayName:"ActionListener",mixins:[a,s,c],componentWillMount:function(){this.regCmd("mute_chat",this.onMute),this.regCmd("delete_or_exit_chat",this.onDeleteOrExit),this.regCmd("archive_chat",this.onArchive),this.regCmd("mark_chat_unread",this.onMarkUnread)},onMute:function u(e,t){if(t){var u=function(t){e.pendingAction++,e.mute.mute(t,!0)["finally"](function(){e.pendingAction--})};n.openModal(React.createElement(i,{onMute:u}))}else e.pendingAction++,e.mute.unmute(!0)["finally"](function(){e.pendingAction--})},onDeleteOrExit:function(e){var t=function(t){e.pendingAction++,t["finally"](function(){e.pendingAction--})};n.openModal(React.createElement(o,{chat:e,onDeleteOrExit:t}))},onArchive:function(e,t){e.pendingAction++,e.setArchive(t)["finally"](function(){e.pendingAction--})},onMarkUnread:function(e,t){e.pendingAction++,e.markUnread(t)["finally"](function(){e.pendingAction--})},render:function(){return null}});e.exports=d},function(e,t,r){var n=r(144),i=function(){return[{label:l10n.t("web_mute_8hours"),duration:8},{label:l10n.t("web_mute_1week"),duration:168},{label:l10n.t("web_mute_1year"),duration:8760}]},o=React.createClass({displayName:"MutePopup",propTypes:{onCancel:React.PropTypes.func,onMute:React.PropTypes.func.isRequired},getInitialState:function(){return{mute:8}},onChange:function(e){this.setState({mute:parseInt(e.target.value,10)})},onMute:function(e){e.stopPropagation(),n.closeModal(),this.props.onMute(3600*this.state.mute+moment().unix(),!0)},render:function(){var e=this.props.onCancel||function(){n.closeModal()},t=this.state.mute,r=this,o=i().map(function(e){var n=e.duration;return React.createElement("li",{key:"mute-"+n},React.createElement("label",null,React.createElement("input",{type:"radio",name:"duration",value:e.duration,checked:t===n,onChange:r.onChange}),e.label))});return React.createElement("div",{className:"backdrop"},React.createElement("div",{className:"popup-container"},React.createElement("div",{className:"popup"},React.createElement("div",{className:"popup-body"},React.createElement("div",{className:"popup-title",dir:"auto"},l10n.t("web_mute_time")),React.createElement("div",{className:"popup-contents"},React.createElement("form",{ref:"form"},React.createElement("ol",{className:"choices"},o)))),React.createElement("div",{className:"popup-controls"},React.createElement("button",{className:"btn-plain popup-controls-item",onClick:e},l10n.t("web_cancel")),React.createElement("button",{className:"btn-plain btn-default popup-controls-item",onClick:this.onMute},l10n.t("web_ok"))))))}});e.exports=o},function(e,t,r){var n=r(14),i=r(201),o=r(144),a=r(477),s=r(470),c=React.createClass({displayName:"DeleteChatPopup",mixins:[a],propTypes:{onCancel:React.PropTypes.func,onDeleteOrExit:React.PropTypes.func,chat:React.PropTypes.instanceOf(i).isRequired},getInitialState:function(){return{isReadOnly:this.async("chat.isReadOnly")}},getText:function(){var e=this.props.chat,t=e.formattedTitle;return e.isGroup?this.state.isReadOnly?l10n.t("web_delete_group_dialog_title",{groupName:t}):l10n.t("web_exit_group_dialog_title",{groupName:t}):e.isUser?l10n.t("delete_chat_dialog_title",{name:t}):e.isBroadcast?l10n.t("delete_list_dialog_title"):void 0},getButton:function(){var e=this.props.chat;return e.isGroup?this.state.isReadOnly?l10n.t("web_delete"):l10n.t("web_exit"):e.isUser||e.isBroadcast?l10n.t("web_delete"):void 0},onCancel:function(){o.closeModal(),_.isFunction(this.props.onCancel)&&this.props.onCancel()},onDelete:function(){var e,t=this.props.chat;t.isGroup?e=this.state.isReadOnly?t.sendDelete():t.sendExit():t.isUser||t.isBroadcast?e=t.sendDelete():n.log("deleteChatPopup:onDelete Unsupported chat type","red")(),_.isFunction(this.props.onDeleteOrExit)&&e&&this.props.onDeleteOrExit(e),o.closeModal()},render:function(){return React.createElement("div",{className:"backdrop"},React.createElement("div",{className:"popup-container"},React.createElement("div",{className:"popup"},React.createElement("div",{className:"popup-body"},React.createElement("div",{className:"popup-title",dir:"auto"},l10n.t("are_you_sure")),React.createElement("div",{className:"popup-contents"},React.createElement(s,{text:this.getText()}))),React.createElement("div",{className:"popup-controls"},React.createElement("button",{"data-a8n":Wa.a8n("cancel-btn"),className:"btn-plain popup-controls-item",onClick:this.onCancel},l10n.t("web_cancel")),React.createElement("button",{"data-a8n":Wa.a8n("delete-btn"),className:"btn-plain btn-default popup-controls-item",onClick:this.onDelete},this.getButton())))))}});e.exports=c},function(e,t){var r=React.createClass({displayName:"IntroPanel",componentDidMount:function(){var e=this.refs.image.getDOMNode(),t=this.refs.text.getDOMNode();Velocity(e,{scale:[1,0],opacity:[1,0]},{delay:1340,duration:180,easing:[.05,1.02,0,1.01]}),Velocity(t,{translateY:[0,80],opacity:[1,0]},{delay:1300,duration:140,easing:[.05,1.02,0,1.01]})},render:function(){return React.createElement("div",{className:"pane pane-intro"},React.createElement("div",{className:"intro-body"},React.createElement("div",{ref:"image",className:"intro-image"}),React.createElement("div",{ref:"text",className:"intro-text-container"},React.createElement("h1",{"data-a8n":Wa.a8n("intro-title"),className:"intro-title"},l10n.t("intro_title")),React.createElement("div",{"data-a8n":Wa.a8n("intro-text"),className:"intro-text"},l10n.t("intro_connection")))))}});e.exports=r},function(e,t,r){
var n=r(467),i=r(450),o=r(440),a=React.createClass({displayName:"ModalManager",mixins:[n],statics:{DEFAULT_TRANSITION:"modal"},getInitialState:function(){return{flow:null}},componentWillMount:function(){this.regCmd("open_modal",this.openFlow),this.regCmd("close_modal",this.closeFlow)},openFlow:function(e,t){i.push(this,i.MODAL),this.setState({flow:e,transition:t})},closeFlow:function(){i.pop(i.MODAL)},close:function(){this.setState({flow:null,transition:this.state.transition})},render:function(){var e,t,r=this.state.transition;return r=_.isBoolean(r)&&!r?void 0:r||a.DEFAULT_TRANSITION,this.state.flow&&(r?t=this.state.flow:e=this.state.flow),React.createElement("div",null,e,React.createElement(o,{transitionName:r},t))}});e.exports=a},function(e,t,r){var n=r(467),i=r(450),o=r(457),a=r(440),s={menu:null,origin:{x:0,y:0},anchor:null,event:null,menuDirection:{x:o.Direction.X.RIGHT,y:o.Direction.Y.BOTTOM},originPosition:{x:o.Direction.X.LEFT,y:o.Direction.Y.BOTTOM},originOffset:{x:0,y:0},onOpen:_.noop,onClose:_.noop,classes:null},c={MENU:"menu",TOOLTIP:"tooltip"},d=React.createClass({displayName:"ContextMenuManager",mixins:[n],propTypes:{type:React.PropTypes.oneOf(_.values(c)).isRequired},getDefaultProps:function(){return{type:c.MENU}},getInitialState:function(){return s},componentWillMount:function(){var e=this.props.type===c.MENU?"open_context_menu":"open_tooltip";this.regCmd(e,this.open)},open:function(e,t){this.state.menu&&i.pop(this.props.type),t=_.merge(_.clone(s,!0),t),t.event&&(t.origin={x:t.event.clientX,y:t.event.clientY},t.originOffset={x:10,y:10},t.event.stopPropagation()),t.key=Math.random(),t.menu=e,this.replaceState(t,function(){this.setDirection()}),i.push(this,this.props.type,!0,t.parent)},close:function(){_.isFunction(this.state.onClose)&&this.state.onClose(),this.setState(s)},setDirection:function(){var e=this.refs.menu.getDOMNode();if(!e)return null;var t=e.clientWidth,r=e.clientHeight,n=window.innerWidth,i=window.innerHeight,a=_.clone(this.state.menuDirection),s=_.clone(this.state.origin),c=s.x,d=s.x,u=s.y,l=s.y;if(this.state.anchor){var p=this.state.anchor,h=p.getBoundingClientRect();c=h.left,d=h.right,u=h.top,l=h.bottom}var f=a.x;f===o.Direction.X.RIGHT&&c+t>n&&d-t>0?f=o.Direction.X.LEFT:f===o.Direction.X.LEFT&&0>d-t&&n>c+t&&(f=o.Direction.X.RIGHT);var m=a.y;m===o.Direction.Y.BOTTOM&&l+r>i&&u-r>0?m=o.Direction.Y.TOP:m===o.Direction.Y.TOP&&0>u-r&&i>l+r&&(m=o.Direction.Y.BOTTOM);var g=f===o.Direction.X.RIGHT?c:d,v=m===o.Direction.Y.TOP?u:l;this.setState({menuDirection:{x:f,y:m},origin:{x:g,y:v}})},render:function(){var e;if(this.state.menu){var t={x:this.state.origin.x+this.state.originOffset.x,y:this.state.origin.y+this.state.originOffset.y};e=React.createElement(o,{origin:t,ref:"menu",classes:this.state.classes,type:this.state.type,key:"key-"+this.state.key,direction:this.state.menuDirection},this.state.menu)}var r=this.state.type===o.Type.PICKER?"dropdown-picker":"dropdown";return React.createElement(a,{transitionName:r},e)}});e.exports=d}]);